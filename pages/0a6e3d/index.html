<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>ğŸŒ— å®ç°å–æ¶ˆåŠŸèƒ½ | notebook</title>
        <meta name="generator" content="VuePress 1.9.7" />
        <link rel="icon" href="/notebook/favicon.ico">
    <link rel="stylesheet" href="/notebook//at.alicdn.com/t/font_3114978_qe0b39no76.css"> <meta name="description" content="a frontend notebook by Simon">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="ä¸ªäººå­¦ä¹ ç¬”è®°,å‰ç«¯å­¦ä¹ ç¬”è®°,å‰ç«¯å­¦ä¹ ,å‰ç«¯å­¦ä¹ èµ„æº,å‰ç«¯å­¦ä¹ è·¯çº¿,HTML,CSS,JavaScript,Vue,React">
    <meta name="theme-color" content="#204A7A">  <link rel="preload" href="/notebook/assets/css/0.styles.5de21057.css" as="style"><link rel="preload" href="/notebook/assets/js/app.0b1d0d1c.js" as="script"><link rel="preload" href="/notebook/assets/js/2.350001ab.js" as="script"><link rel="preload" href="/notebook/assets/js/3.cf638cd2.js" as="script"><link rel="preload" href="/notebook/assets/js/250.19f423ef.js" as="script"> <link rel="stylesheet" href="/notebook/assets/css/0.styles.5de21057.css">
    </head>
    <body class="theme-mode-light">
        <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/assets/img/logo.png" alt="notebook" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/" class="nav-link">ğŸŒ é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â˜•ï¸ å‰ç«¯ç¬”è®°" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">â˜•ï¸ å‰ç«¯ç¬”è®°</a> <span class="title" style="display:none;">â˜•ï¸ å‰ç«¯ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">ğŸ—º å‰ç«¯å­¦ä¹ è·¯çº¿</a></li><li class="dropdown-item"><h4>åˆ†ç±»</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">ğŸš¶ å‰ç«¯å…¥é—¨åŸºç¡€</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">ğŸš¶ğŸ» å‰ç«¯å·©å›ºåŸºç¡€</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">ğŸƒ å‰ç«¯æ ¸å¿ƒæ¡†æ¶</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ”– å…³äº" class="dropdown-title"><a href="/notebook/about/" class="link-title">ğŸ”– å…³äº</a> <span class="title" style="display:none;">ğŸ”– å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ğŸšç´¢å¼•</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/archives/" class="nav-link">ğŸ—„å½’æ¡£</a></li><li class="dropdown-subitem"><a href="/notebook/tags/" class="nav-link">ğŸ”–æ ‡ç­¾</a></li></ul></li></ul></div></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
        ğŸ GitHub
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/notebook/" class="nav-link">ğŸŒ é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â˜•ï¸ å‰ç«¯ç¬”è®°" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">â˜•ï¸ å‰ç«¯ç¬”è®°</a> <span class="title" style="display:none;">â˜•ï¸ å‰ç«¯ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">ğŸ—º å‰ç«¯å­¦ä¹ è·¯çº¿</a></li><li class="dropdown-item"><h4>åˆ†ç±»</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">ğŸš¶ å‰ç«¯å…¥é—¨åŸºç¡€</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">ğŸš¶ğŸ» å‰ç«¯å·©å›ºåŸºç¡€</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">ğŸƒ å‰ç«¯æ ¸å¿ƒæ¡†æ¶</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ”– å…³äº" class="dropdown-title"><a href="/notebook/about/" class="link-title">ğŸ”– å…³äº</a> <span class="title" style="display:none;">ğŸ”– å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ğŸšç´¢å¼•</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/archives/" class="nav-link">ğŸ—„å½’æ¡£</a></li><li class="dropdown-subitem"><a href="/notebook/tags/" class="nav-link">ğŸ”–æ ‡ç­¾</a></li></ul></li></ul></div></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
        ğŸ GitHub
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/notebook/pages/a07897/" class="sidebar-link">ğŸŒ‘ åˆå§‹åŒ– TypeScript åº“é¡¹ç›®</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> ğŸŒ’ å®ç°åŸºç¡€åŠŸèƒ½</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/notebook/pages/3de0b0/" class="sidebar-link">ğŸŒ˜ å®ç°å¼‚å¸¸æƒ…å†µå¤„ç†</a></li><li><a href="/notebook/pages/8fff17/" class="sidebar-link">ğŸŒ˜ å®ç°æ¥å£æ‹“å±•</a></li><li><a href="/notebook/pages/291f04/" class="sidebar-link">ğŸŒ˜ å®ç°æ‹¦æˆªå™¨</a></li><li><a href="/notebook/pages/1e5c77/" class="sidebar-link">ğŸŒ“ å®ç°åˆå¹¶é»˜è®¤é…ç½®</a></li><li><a href="/notebook/pages/4c10b2/" class="sidebar-link">ğŸŒ“ å®ç°è¯·æ±‚å’Œå“åº”é…ç½®åŒ–</a></li><li><a href="/notebook/pages/87b8ba/" class="sidebar-link">ğŸŒ“ æ‹“å±•åˆ›å»ºaxiosé™æ€æ¥å£</a></li><li><a href="/notebook/pages/0a6e3d/" aria-current="page" class="active sidebar-link">ğŸŒ— å®ç°å–æ¶ˆåŠŸèƒ½</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notebook/pages/0a6e3d/#éœ€æ±‚åˆ†æ" class="sidebar-link">éœ€æ±‚åˆ†æ</a></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0a6e3d/#å¼‚æ­¥åˆ†ç¦»çš„è®¾è®¡æ–¹æ¡ˆ" class="sidebar-link">å¼‚æ­¥åˆ†ç¦»çš„è®¾è®¡æ–¹æ¡ˆ</a></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0a6e3d/#canceltoken-ç±»çš„å®ç°" class="sidebar-link">CancelToken ç±»çš„å®ç°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0a6e3d/#æ¥å£å®šä¹‰" class="sidebar-link">æ¥å£å®šä¹‰</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0a6e3d/#ä»£ç å®ç°" class="sidebar-link">ä»£ç å®ç°</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0a6e3d/#canceltoken-æ‹“å±•é™æ€æ¥å£" class="sidebar-link">CancelToken æ‹“å±•é™æ€æ¥å£</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0a6e3d/#æ¥å£å®šä¹‰-2" class="sidebar-link">æ¥å£å®šä¹‰</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0a6e3d/#ä»£ç å®ç°-2" class="sidebar-link">ä»£ç å®ç°</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0a6e3d/#cancel-ç±»çš„å®ç°ä»¥åŠ-axios-çš„æ‹“å±•" class="sidebar-link">Cancel ç±»çš„å®ç°ä»¥åŠ axios çš„æ‹“å±•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0a6e3d/#æ¥å£å®šä¹‰-3" class="sidebar-link">æ¥å£å®šä¹‰</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0a6e3d/#ä»£ç å®ç°-3" class="sidebar-link">ä»£ç å®ç°</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0a6e3d/#é¢å¤–é€»è¾‘å®ç°" class="sidebar-link">é¢å¤–é€»è¾‘å®ç°</a></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0a6e3d/#ç¼–å†™æµ‹è¯•-demo" class="sidebar-link">ç¼–å†™æµ‹è¯• DEMO</a></li></ul></li><li><a href="/notebook/pages/211982/" class="sidebar-link">ğŸŒ— å®ç°æƒé™ç›¸å…³åŠŸèƒ½</a></li><li><a href="/notebook/pages/767314/" class="sidebar-link">ğŸŒ— å®ç° XSRF é˜²å¾¡</a></li><li><a href="/notebook/pages/2871e0/" class="sidebar-link">ğŸŒ— å®ç°ä¸Šä¼ å’Œä¸‹è½½è¿›åº¦ç›‘æ§</a></li><li><a href="/notebook/pages/441f8f/" class="sidebar-link">ğŸŒ— å®ç° HTTP æˆæƒ</a></li><li><a href="/notebook/pages/97d131/" class="sidebar-link">ğŸŒ— å®ç°è‡ªå®šä¹‰åˆæ³•çŠ¶æ€ç </a></li><li><a href="/notebook/pages/d6c1c4/" class="sidebar-link">ğŸŒ— å®ç°è‡ªå®šä¹‰å‚æ•°åºåˆ—åŒ–</a></li><li><a href="/notebook/pages/206979/" class="sidebar-link">ğŸŒ— å®ç° baseURL</a></li><li><a href="/notebook/pages/9850cb/" class="sidebar-link">ğŸŒ“ é™æ€æ–¹æ³•æ‹“å±•</a></li><li><a href="/notebook/pages/4b46b1/" class="sidebar-link">ğŸŒ– å•å…ƒæµ‹è¯• Jest çš„ä½¿ç”¨</a></li><li><a href="/notebook/pages/73c2b6/" class="sidebar-link">ğŸŒ– è¾…åŠ©æ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/169950/" class="sidebar-link">ğŸŒ– è¯·æ±‚æ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/f4e917/" class="sidebar-link">ğŸŒ– headers æ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/528987/" class="sidebar-link">ğŸŒ– Axios å®ä¾‹æ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/7e14c7/" class="sidebar-link">ğŸŒ– æ‹¦æˆªå™¨æ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/f2e77e/" class="sidebar-link">ğŸŒ– åˆå¹¶é…ç½®æ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/4877d8/" class="sidebar-link">ğŸŒ– è¯·æ±‚å–æ¶ˆæ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/b58e50/" class="sidebar-link">ğŸŒ– æ›´å¤šæ¨¡å—å•å…ƒæµ‹è¯•</a></li><li><a href="/notebook/pages/2b07f0/" class="sidebar-link">ğŸŒ• éƒ¨ç½²ä¸å‘å¸ƒ</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-16f6d530><div class="articleInfo" data-v-16f6d530><ul class="breadcrumbs" data-v-16f6d530><li data-v-16f6d530><a href="/notebook/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-16f6d530></a></li> <li data-v-16f6d530><a href="/notebook/categories/?category=%20%F0%9F%92%BD%20TypeScript-Axios" title="åˆ†ç±»" data-v-16f6d530> ğŸ’½ TypeScript-Axios</a></li></ul> <div class="info" data-v-16f6d530><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-16f6d530><a href="https://github.com/simon1uo" target="_blank" title="ä½œè€…" class="beLink" data-v-16f6d530>Simon Luo</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-16f6d530><a href="javascript:;" data-v-16f6d530>2022-06-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><!---->ğŸŒ— å®ç°å–æ¶ˆåŠŸèƒ½<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="header-anchor">#</a> éœ€æ±‚åˆ†æ</h2> <p>åœ¨æœ‰äº›åœºæ™¯ï¼Œå¸Œæœ›èƒ½ <strong>ä¸»åŠ¨å–æ¶ˆè¯·æ±‚</strong>ã€‚</p> <blockquote><p>ä¾‹å¦‚å¸¸è§çš„æœç´¢æ¡†æ¡ˆä¾‹ï¼Œç”¨æˆ·åœ¨è¾“å…¥è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥æ¡†çš„å†…å®¹ä¸æ–­å˜åŒ–ã€‚æ­£å¸¸æƒ…å†µæ¯æ¬¡å˜åŒ–éƒ½åº”è¯¥å‘æœåŠ¡å™¨å‘é€ä¸€æ¬¡è¯·æ±‚ã€‚ä½†æ˜¯å½“ç”¨æˆ·è¾“å…¥è¿‡å¿«çš„æ—¶å€™ï¼Œä¸å¸Œæœ›æ¯æ¬¡å˜åŒ–è¯·æ±‚éƒ½ä¼šå‘é€å‡ºå»ã€‚é€šå¸¸è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <strong>é˜²æŠ–</strong> å»¶æ—¶å‘é€è¯·æ±‚ã€‚</p> <p>ä½†æ˜¯æœ‰ä¸€ç§æç«¯æƒ…å†µæ˜¯ï¼Œåæ®µæ¥å£å¾ˆæ…¢ï¼Œæ¯”å¦‚è¶…è¿‡ 1s æ‰ä¼šå“åº”ï¼Œè¿™ä¸ªæ—¶å€™åŠæ—¶åšäº† 200ms çš„é˜²æŠ–ï¼Œåœ¨æ…¢æ…¢è¾“å…¥ï¼ˆæ¯æ¬¡è¾“å…¥é—´éš”è¶…è¿‡ 200msï¼‰çš„æƒ…å†µä¸‹ï¼Œåœ¨å‰é¢çš„è¯·æ±‚æ²¡æœ‰å“åº”ä¹‹å‰ï¼Œä¹Ÿæœ‰å¯èƒ½å‘å‡ºå¤šä¸ªè¯·æ±‚ã€‚å› ä¸ºæ¥å£çš„å“åº”æ—¶é•¿ä¸å®šï¼Œå¦‚æœå…ˆå‘å‡ºå»çš„è¯·æ±‚å“åº”æ—¶é•¿æ¯”åå‘å‡ºå»çš„è¯·æ±‚è¦å°±ï¼Œé‚£ä¹ˆåè¯·æ±‚çš„å“åº”å…ˆå›æ¥ï¼Œå…ˆè¯·æ±‚çš„å“åº”åå›æ¥ï¼Œå°±ä¼šå‡ºç°å‰é¢è¯·æ±‚å“åº”ç»“æœè¦†ç›–åé¢è¯·æ±‚å“åº”ç»“æœçš„æƒ…å†µï¼Œé‚£ä¹ˆé€ æˆå“åº”ç»“æœæ··ä¹±ã€‚<strong>åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œé™¤äº†åšé˜²æŠ–ï¼Œè¿˜å¸Œæœ›åé¢çš„è¯·æ±‚å‘é€æ—¶ï¼Œå¦‚æœå‰é¢çš„è¯·æ±‚è¿˜æ²¡æœ‰å“åº”ï¼Œ å¯ä»¥æŠŠå‰é¢çš„è¯·æ±‚å–æ¶ˆã€‚</strong></p></blockquote> <p>ä»  <code>axios</code>  çš„å–æ¶ˆæ¥å£è®¾è®¡å±‚é¢ï¼Œå¯ä»¥å®ç°å¦‚ä¸‹ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request canceled'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç†é”™è¯¯</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å–æ¶ˆè¯·æ±‚ (è¯·æ±‚åŸå› æ˜¯å¯é€‰çš„)</span>
source<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'Operation canceled by the user.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>ç»™  <code>axios</code>  æ·»åŠ ä¸€ä¸ª  <code>CancelToken</code>  å¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ª  <code>source</code>  æ–¹æ³•è¿”å›ä¸€ä¸ª  <code>source</code>  å¯¹è±¡ï¼Œ <code>source.token</code>  æ˜¯æ¯ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™ä¼ ç»™é…ç½®å¯¹è±¡ä¸­çš„  <code>cancelToken</code>  å±æ€§ï¼Œç„¶ååœ¨è¯·æ±‚ä¸­å‘å‡ºå»åï¼Œå¯ä»¥é€šè¿‡  <code>cancelToken</code>  å–æ¶ˆè¯·æ±‚ã€‚</p></blockquote> <p>æˆ–è€…æ”¯æŒå¦ä¸€ç§æ–¹å¼çš„è°ƒç”¨ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">let</span> cancel<span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p><code>axios.CancelToken</code>  æ˜¯ä¸€ä¸ªç±»ï¼Œç›´æ¥æŠŠå®ƒå®ä¾‹åŒ–çš„å¯¹è±¡ä¼ ç»™è¯·æ±‚é…ç½®ä¸­çš„  <code>cancelToken</code>  å±æ€§ï¼Œ <code>CancelToken</code>  çš„æ„é€ å‡½æ•°å‚æ•°æ”¯æŒä¼ å…¥ä¸€ä¸ª  <code>executor</code>  æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªå–æ¶ˆå‡½æ•°  <code>c</code> ï¼Œå¯ä»¥åœ¨  <code>executor</code>  æ–¹æ³•æ‰§è¡Œçš„å†…éƒ¨æ‹¿åˆ°è¿™ä¸ªå–æ¶ˆå‡½æ•°  <code>c</code> ï¼Œèµ‹å€¼ç»™æˆ‘ä»¬å¤–éƒ¨å®šä¹‰çš„  <code>cancel</code>  å˜é‡ï¼Œä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ª  <code>cancel</code>  æ–¹æ³•æ¥å–æ¶ˆè¯·æ±‚ã€‚</p></blockquote> <h2 id="å¼‚æ­¥åˆ†ç¦»çš„è®¾è®¡æ–¹æ¡ˆ"><a href="#å¼‚æ­¥åˆ†ç¦»çš„è®¾è®¡æ–¹æ¡ˆ" class="header-anchor">#</a> å¼‚æ­¥åˆ†ç¦»çš„è®¾è®¡æ–¹æ¡ˆ</h2> <p>é€šè¿‡éœ€æ±‚åˆ†æï¼Œå¦‚æœæƒ³è¦å®ç°å–æ¶ˆæŸæ¬¡è¯·æ±‚ï¼Œéœ€è¦ä¸ºè¯¥è¯·æ±‚é…ç½®ä¸€ä¸ª  <code>CancelToken</code> ï¼Œç„¶ååœ¨å¤–éƒ¨è°ƒç”¨ä¸€ä¸ª  <code>cancel</code>  æ–¹æ³•ã€‚</p> <p>è¯·æ±‚çš„å‘é€æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œæœ€ç»ˆä¼šæ‰§è¡Œ  <code>xhr.send</code>  æ–¹æ³•ï¼Œ  <code>xhr</code>  å¯¹è±¡æä¾›äº†  <code>abort</code>  æ–¹æ³•ï¼Œå¯ä»¥æŠŠè¯·æ±‚å–æ¶ˆã€‚ä½†æ˜¯åœ¨å¤–éƒ¨ç¢°ä¸åˆ°  <code>xhr</code>  å¯¹è±¡ï¼Œè¦æƒ³æ‰§è¡Œ   <code>cancel</code>  çš„æ—¶å€™ï¼Œå»æ‰§è¡Œ  <code>xhr.abort</code>  æ–¹æ³•ã€‚</p> <p>ç›¸å½“äºåœ¨  <code>xhr</code>  å¼‚æ­¥è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œæ’å…¥ä¸€æ®µä»£ç ï¼Œå½“åœ¨å¤–éƒ¨æ‰§è¡Œ  <code>cancel</code>  çš„å‡½æ•°çš„æ—¶å€™ï¼Œå›å»æ‡‚è¿™æ®µä»£ç çš„æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œ  <code>xhr.abort</code>  æ–¹æ³•å–æ¶ˆè¯·æ±‚ã€‚</p> <p>åˆ©ç”¨ <strong>Promise</strong> å®ç°å¼‚æ­¥åˆ†ç¦»ã€‚ä¹Ÿå°±æ˜¯åœ¨  <code>cancelToken</code>  ä¸­ä¿å­˜ä¸€ä¸ª  <code>pending</code>  çŠ¶æ€çš„ Promise å¯¹è±¡ï¼Œç„¶åå½“æ‰§è¡Œ  <code>cancel</code>  æ–¹æ³•æ—¶ï¼Œèƒ½å¤Ÿè®¿é—®æ­é…è¿™ä¸ª Promise å¯¹è±¡ï¼ŒæŠŠå®ƒä»  <code>pending</code>  çŠ¶æ€å˜æˆ  <code>resolved</code>  çŠ¶æ€ã€‚è¿™æ ·å°±å¯ä»¥åœ¨  <code>then</code>  ä¸­å®ç°å–æ¶ˆè¯·æ±‚çš„é€»è¾‘ã€‚</p> <blockquote><p>ç±»ä¼¼å¦‚ä¸‹ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>cancelToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cancelToken<span class="token punctuation">.</span>promise
  	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>reason <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    	request<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    	<span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
  	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></blockquote> <h2 id="canceltoken-ç±»çš„å®ç°"><a href="#canceltoken-ç±»çš„å®ç°" class="header-anchor">#</a> <code>CancelToken</code>  ç±»çš„å®ç°</h2> <h3 id="æ¥å£å®šä¹‰"><a href="#æ¥å£å®šä¹‰" class="header-anchor">#</a> æ¥å£å®šä¹‰</h3> <p><code>src/types/index.ts</code> ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
  cancelToken<span class="token operator">?</span><span class="token operator">:</span> CancelToken
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
  promise<span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>
  reason<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Canceler</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CancelExecutor</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>cancel<span class="token operator">:</span> Canceler<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p><code>CancelToken</code>  æ˜¯å®ä¾‹ç±»å‹çš„æ¥å£å®šä¹‰ï¼Œ <code>Canceler</code>  æ˜¯å–æ¶ˆæ–¹æ³•çš„æ¥å£å®šä¹‰ï¼Œ <code>CancelExecutor</code>  æ˜¯  <code>CancelToken</code>  ç±»æ„é€ å‡½æ•°å‚æ•°çš„æ¥å£å®šä¹‰ã€‚</p></blockquote> <h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="header-anchor">#</a> ä»£ç å®ç°</h3> <p>åˆ›å»ºå•ç‹¬çš„ç›®å½•ç®¡ç†  <code>cancel</code>  ç›¸å…³çš„ä»£ç ã€‚</p> <p>åˆ›å»ºæ–‡ä»¶  <code>cancel/CancelToken.ts</code>  ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CancelExecutor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../types'</span>

<span class="token keyword">interface</span> <span class="token class-name">ResolvePromise</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>reason<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
  promise<span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>
  reason<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>executor<span class="token operator">:</span> CancelExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> resolvePromise<span class="token operator">:</span> ResolvePromise
    <span class="token keyword">this</span><span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      resolvePromise <span class="token operator">=</span> resolve
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">executor</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token keyword">return</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> message
      <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p>åœ¨  <code>CancelToken</code>  æ„é€ å‡½æ•°å†…éƒ¨ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª  <code>pending</code>  çŠ¶æ€çš„ Promise å¯¹è±¡ï¼Œç„¶åç”¨ä¸€ä¸ª  <code>resolvePromise</code>  å˜é‡æŒ‡å‘  <code>resolve</code>  å‡½æ•°ï¼Œæ¥ç€æ‰§è¡Œ  <code>executor</code>  å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ª  <code>cancel</code>  å‡½æ•°ï¼Œåœ¨  <code>cancel</code>  å‡½æ•°å†…éƒ¨ï¼Œè°ƒç”¨  <code>resolvePromise</code>  æŠŠ Promise å¯¹è±¡ ä»  <code>pending</code>  å˜ä¸º  <code>resolved</code>   çŠ¶æ€ã€‚</p></blockquote> <p>æ¥ç€åœ¨  <code>src/core/xhr.ts</code>  ä¸­æ·»åŠ å–æ¶ˆè¯·æ±‚çš„é€»è¾‘ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'get'</span><span class="token punctuation">,</span> headers<span class="token punctuation">,</span> responseType<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> cancelToken<span class="token punctuation">}</span> <span class="token operator">=</span> config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>åŠ å…¥ä»  <code>config</code>  ä¸­è·å–  <code>cancelToken</code> ã€‚</p></blockquote> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>cancelToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cancelToken<span class="token punctuation">.</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>reason <span class="token operator">=&gt;</span>  <span class="token punctuation">{</span>
    request<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="canceltoken-æ‹“å±•é™æ€æ¥å£"><a href="#canceltoken-æ‹“å±•é™æ€æ¥å£" class="header-anchor">#</a> <code>CancelToken</code>  æ‹“å±•é™æ€æ¥å£</h2> <h3 id="æ¥å£å®šä¹‰-2"><a href="#æ¥å£å®šä¹‰-2" class="header-anchor">#</a> æ¥å£å®šä¹‰</h3> <p>åœ¨  <code>src/types/index.ts</code>  ä¸­ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CancelTokenSource</span> <span class="token punctuation">{</span>
  token<span class="token operator">:</span> CancelToken
  cancel<span class="token operator">:</span> Canceler
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CancelTokenStatic</span><span class="token punctuation">{</span>
  <span class="token keyword">new</span><span class="token punctuation">(</span>executor<span class="token operator">:</span> CancelExecutor<span class="token punctuation">)</span><span class="token operator">:</span> CancelToken
  
  <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> CancelTokenSource
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>å…¶ä¸­  <code>CancelTokenSource</code>  ä½œä¸º  <code>CancelToken</code>  ç±»é™æ€æ–¹æ³•  <code>source</code>  å‡½æ•°çš„è¿”å›å€¼ç±»å‹ï¼Œ <code>CancelTokenStatic</code>  ä½œä¸º  <code>CancelToken</code>  ç±»çš„ç±»ç±»å‹ã€‚</p></blockquote> <h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="header-anchor">#</a> ä»£ç å®ç°</h3> <p>åœ¨  <code>src/cancel/CancelToken.ts</code>  ä¸­ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">static</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> CancelTokenSource <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cancel<span class="token operator">!</span><span class="token operator">:</span> Canceler
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      cancel <span class="token operator">=</span> c
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      cancel<span class="token punctuation">,</span>
      token
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>åœ¨ç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª  <code>source</code>  é™æ€æ–¹æ³•ï¼Œå®šä¹‰ä¸€ä¸ª  <code>cancel</code>  å˜é‡å®ä¾‹åŒ–ä¸€ä¸ª  <code>CancelToken</code>  ç±»å‹çš„å¯¹è±¡ï¼Œç„¶ååœ¨  <code>executor</code>  å‡½æ•°ä¸­ï¼ŒæŠŠ  <code>cancel</code>  æŒ‡å‘å‚æ•°  <code>c</code>  è¿™ä¸ªå–æ¶ˆå‡½æ•°ã€‚</p> <p>è¿™æ ·æ»¡è¶³äº†éœ€æ±‚åˆ†æä¸­ç¬¬ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œä½†æ˜¯ç¬¬ä¸€ç§ä½¿ç”¨æ–¹å¼çš„ä¾‹å­ä¸­ï¼Œåœ¨æ•è·è¯·æ±‚çš„æ—¶å€™ï¼Œé€šè¿‡  <code>axios.isCancel</code>  æ¥åˆ¤æ–­é”™è¯¯å‚æ•°  <code>e</code>  æ˜¯ä¸æ˜¯ä¸€æ¬¡å–æ¶ˆè¯·æ±‚å¯¼è‡´çš„é”™è¯¯ã€‚è¦å¯¹å–æ¶ˆé”™è¯¯çš„åŸå› åšä¸€å±‚åŒ…è£…ï¼Œå¹¶ä¸”ç»™  <code>axios</code>  æ‹“å±•é™æ€æ–¹æ³•ã€‚</p></blockquote> <h2 id="cancel-ç±»çš„å®ç°ä»¥åŠ-axios-çš„æ‹“å±•"><a href="#cancel-ç±»çš„å®ç°ä»¥åŠ-axios-çš„æ‹“å±•" class="header-anchor">#</a> <code>Cancel</code>  ç±»çš„å®ç°ä»¥åŠ  <code>axios</code>  çš„æ‹“å±•</h2> <h3 id="æ¥å£å®šä¹‰-3"><a href="#æ¥å£å®šä¹‰-3" class="header-anchor">#</a> æ¥å£å®šä¹‰</h3> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Cancel</span> <span class="token punctuation">{</span>
  message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CancelStatic</span> <span class="token punctuation">{</span>
  <span class="token keyword">new</span><span class="token punctuation">(</span>message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Cancel
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosStatic</span> <span class="token keyword">extends</span> <span class="token class-name">AxiosInstance</span> <span class="token punctuation">{</span>
  <span class="token function">create</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosInstance
  
  CancelToken<span class="token operator">:</span> CancelTokenStatic
  Cancel<span class="token operator">:</span> CancelStatic
  <span class="token function-variable function">isCancel</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>å…¶ä¸­  <code>Cancel</code>  æ˜¯å®ä¾‹ç±»å‹çš„æ¥å£å®šä¹‰ï¼› <code>CancelStatic</code>  æ˜¯ç±»ç±»å‹çš„æ¥å£å®šä¹‰ï¼Œå¹¶ä¸”è¦ç»™  <code>axios</code>  æ‹“å±•äº†å¤šä¸ªé™æ€æ–¹æ³•ã€‚</p></blockquote> <h3 id="ä»£ç å®ç°-3"><a href="#ä»£ç å®ç°-3" class="header-anchor">#</a> ä»£ç å®ç°</h3> <p>åˆ›å»º  <code>src/cancel/Cancel.ts</code>  æ–‡ä»¶ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Cancel</span> <span class="token punctuation">{</span>
  message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isCancel</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value <span class="token keyword">instanceof</span> <span class="token class-name">Cancel</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p><code>Cancel</code>  ç±»æ‹¥æœ‰ä¸€ä¸ª  <code>message</code>  å…¬å…±å±æ€§ã€‚ <code>isCancel</code>  æ–¹æ³•é€šè¿‡  <code>insanceof</code>  æ¥åˆ¤æ–­ä¼ å…¥çš„å€¼æ˜¯ä¸æ˜¯ä¸€ä¸ª  <code>Cancel</code>  å¯¹è±¡ã€‚</p></blockquote> <p>ç„¶åå¯¹  <code>CancelToken</code>  ç±»ä¸­çš„  <code>reason</code>  ç±»å‹åšä¿®æ”¹ï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ª  <code>Cancel</code>  ç±»å‹çš„å®ä¾‹ã€‚</p> <p>ä¿®æ”¹å®šä¹‰ï¼š <code>src/types/index.ts</code> ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
  promise<span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Cancel<span class="token operator">&gt;</span>
  reason<span class="token operator">?</span><span class="token operator">:</span> Cancel
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç„¶åä¿®æ”¹å®ç°éƒ¨åˆ†ï¼Œ  <code>src/cancel/CancelToken.ts</code> ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">ResolvePromise</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>reason<span class="token operator">?</span><span class="token operator">:</span> Cancel<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
  promise<span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Cancel<span class="token operator">&gt;</span>
  reason<span class="token operator">?</span><span class="token operator">:</span> Cancel

  <span class="token function">constructor</span><span class="token punctuation">(</span>executor<span class="token operator">:</span> CancelExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> resolvePromise<span class="token operator">:</span> ResolvePromise
    <span class="token keyword">this</span><span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span>Cancel<span class="token operator">&gt;</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      resolvePromise <span class="token operator">=</span> resolve
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">executor</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token keyword">return</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
      <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>ç„¶åç»™  <code>aixos</code>  æ‹“å±•é™æ€æ–¹æ³•ï¼Œæä¾›ç”¨æˆ·ä½¿ç”¨ï¼š</p> <p><code>src/axios</code> ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> CancelToken <span class="token keyword">from</span> <span class="token string">'./cancel/CancelToken'</span>
<span class="token keyword">import</span> Cancel<span class="token punctuation">,</span> <span class="token punctuation">{</span> isCancel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./cancel/Cancel'</span>

axios<span class="token punctuation">.</span>CancelToken <span class="token operator">=</span> CancelToken
axios<span class="token punctuation">.</span>Cancel <span class="token operator">=</span> Cancel
axios<span class="token punctuation">.</span>isCancel <span class="token operator">=</span> isCancel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="é¢å¤–é€»è¾‘å®ç°"><a href="#é¢å¤–é€»è¾‘å®ç°" class="header-anchor">#</a> é¢å¤–é€»è¾‘å®ç°</h2> <p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å®ç°ä¸€äº›é¢å¤–é€»è¾‘ï¼Œæ¯”å¦‚å½“ä¸€ä¸ªè¯·æ±‚æºå¸¦çš„  <code>cancelToken</code>  å·²ç»è¢«ä½¿ç”¨è¿‡ï¼Œé‚£ä¹ˆç”šè‡³éƒ½å¯ä»¥ä¸å‘é€è¿™ä¸ªè¯·æ±‚ï¼Œç›´æ¥è·‘å‡ºä¸€ä¸ªå¼‚å¸¸å³å¯ï¼Œå¹¶ä¸”æŠ›å¼‚å¸¸çš„ä¿¡æ¯å°±æ˜¯å–æ¶ˆçš„åŸå› ï¼Œæ‰€ä»¥éœ€è¦ç»™  <code>CancelToken</code>  æ‹“å±•ä¸€ä¸ªæ–¹æ³•ã€‚</p> <p>é¦–å…ˆä¿®æ”¹å®šä¹‰éƒ¨åˆ†ã€‚</p> <p><code>src/types/index.ts</code>  ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
  promise<span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Cancel<span class="token operator">&gt;</span>
  reason<span class="token operator">?</span><span class="token operator">:</span> Cancel

  <span class="token function">throwIfRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ç„¶åå®ç°è¿™ä¸ªæ–¹æ³•ï¼š</p> <p><code>src/cancel/CancelToken.ts</code> ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">CancelToken</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... </span>

  <span class="token function">throwIfRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reason
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>åˆ¤æ–­å¦‚æœå­˜åœ¨  <code>this.reason</code> ï¼Œè¯´æ˜è¿™ä¸ª  <code>token</code>  å·²ç»è¢«ä½¿ç”¨è¿‡äº†ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯å³å¯ã€‚</p></blockquote> <p>æ¥ä¸‹æ¥åœ¨å‘é€è¯·æ±‚ä¹‹å‰å¢åŠ ä¸€æ®µé€»è¾‘ï¼š</p> <p><code>src/core/dispatchRequest.ts</code> ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">dispatchRequest</span><span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosPromise <span class="token punctuation">{</span>
  <span class="token function">throwIfCancellationRequested</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
  <span class="token function">processConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">throwIfCancellationRequested</span><span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>cancelToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>cancelToken<span class="token punctuation">.</span><span class="token function">throwIfRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>å‘é€è¯·æ±‚ä¹‹å‰ï¼Œéœ€è¦æ£€æŸ¥ä¸€ä¸‹é…ç½®çš„  <code>cancelToken</code>  æ˜¯å¦è¢«ä½¿ç”¨è¿‡äº†ï¼Œå¦‚æœè¢«ä½¿ç”¨è¿‡å°±ä¸ç”¨å‘é€è¯·æ±‚ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸å³å¯ã€‚</p></blockquote> <h2 id="ç¼–å†™æµ‹è¯•-demo"><a href="#ç¼–å†™æµ‹è¯•-demo" class="header-anchor">#</a> ç¼–å†™æµ‹è¯• DEMO</h2> <p><code>examples/server.js</code>  æ·»åŠ   <code>router</code> ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/cancel/get'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/cancel/post'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>app.ts</code> ï¼š</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> axios<span class="token punctuation">,</span> <span class="token punctuation">{</span> Canceler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../src'</span>

<span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken
<span class="token keyword">const</span> source <span class="token operator">=</span> CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/cancel/get'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request canceled'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  source<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'Operation canceled by the user.'</span><span class="token punctuation">)</span>

  axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/cancel/post'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>


<span class="token keyword">let</span> cancel<span class="token operator">:</span> Canceler

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/cancel/get'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    cancel <span class="token operator">=</span> c
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request canceled'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/simon1uo/notebook/edit/master/docs/801. ğŸ’½ TypeScript-Axios/43. ğŸŒ— å®ç°å–æ¶ˆåŠŸèƒ½.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ğŸ“¢ ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2022/07/03, 00:32:39</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notebook/pages/87b8ba/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ğŸŒ“ æ‹“å±•åˆ›å»ºaxiosé™æ€æ¥å£</div></a> <a href="/notebook/pages/211982/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">ğŸŒ— å®ç°æƒé™ç›¸å…³åŠŸèƒ½</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
                â†
                <a href="/notebook/pages/87b8ba/" class="prev">ğŸŒ“ æ‹“å±•åˆ›å»ºaxiosé™æ€æ¥å£</a></span> <span class="next"><a href="/notebook/pages/211982/">ğŸŒ— å®ç°æƒé™ç›¸å…³åŠŸèƒ½</a>â†’
            </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
        Copyright Â© 2020-2022
        |
        <span></span>

    theme on based
    <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="theme">Vdoing</a> powered By Vuepress
</div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
                    è·Ÿéšç³»ç»Ÿ
                </li><li class="iconfont icon-rijianmoshi">
                    æµ…è‰²æ¨¡å¼
                </li><li class="iconfont icon-yejianmoshi">
                    æ·±è‰²æ¨¡å¼
                </li><li class="iconfont icon-yuedu">
                    é˜…è¯»æ¨¡å¼
                </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
        <script src="/notebook/assets/js/app.0b1d0d1c.js" defer></script><script src="/notebook/assets/js/2.350001ab.js" defer></script><script src="/notebook/assets/js/3.cf638cd2.js" defer></script><script src="/notebook/assets/js/250.19f423ef.js" defer></script>
    </body>
</html>

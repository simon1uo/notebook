<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>🧊 Vue 3 的组合 API 编程 | notebook</title>
        <meta name="generator" content="VuePress 1.9.7" />
        <link rel="icon" href="/notebook/favicon.ico">
    <link rel="stylesheet" href="/notebook//at.alicdn.com/t/font_3114978_qe0b39no76.css"> <meta name="description" content="a frontend notebook by Simon">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="个人学习笔记,前端学习笔记,前端学习,前端学习资源,前端学习路线,HTML,CSS,JavaScript,Vue,React">
    <meta name="theme-color" content="#204A7A">  <link rel="preload" href="/notebook/assets/css/0.styles.5de21057.css" as="style"><link rel="preload" href="/notebook/assets/js/app.58c8f232.js" as="script"><link rel="preload" href="/notebook/assets/js/2.350001ab.js" as="script"><link rel="preload" href="/notebook/assets/js/3.cf638cd2.js" as="script"><link rel="preload" href="/notebook/assets/js/177.5bb05ecc.js" as="script"> <link rel="stylesheet" href="/notebook/assets/css/0.styles.5de21057.css">
    </head>
    <body class="theme-mode-light">
        <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/assets/img/logo.png" alt="notebook" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/" class="nav-link">🌏 首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="☕️ 前端笔记" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">☕️ 前端笔记</a> <span class="title" style="display:none;">☕️ 前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">🗺 前端学习路线</a></li><li class="dropdown-item"><h4>分类</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">🚶 前端入门基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">🚶🏻 前端巩固基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">🏃 前端核心框架</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔖 关于" class="dropdown-title"><a href="/notebook/about/" class="link-title">🔖 关于</a> <span class="title" style="display:none;">🔖 关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>🚏索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/archives/" class="nav-link">🗄归档</a></li><li class="dropdown-subitem"><a href="/notebook/tags/" class="nav-link">🔖标签</a></li></ul></li></ul></div></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
        🍞 GitHub
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/notebook/" class="nav-link">🌏 首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="☕️ 前端笔记" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">☕️ 前端笔记</a> <span class="title" style="display:none;">☕️ 前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">🗺 前端学习路线</a></li><li class="dropdown-item"><h4>分类</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">🚶 前端入门基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">🚶🏻 前端巩固基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">🏃 前端核心框架</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔖 关于" class="dropdown-title"><a href="/notebook/about/" class="link-title">🔖 关于</a> <span class="title" style="display:none;">🔖 关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>🚏索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/archives/" class="nav-link">🗄归档</a></li><li class="dropdown-subitem"><a href="/notebook/tags/" class="nav-link">🔖标签</a></li></ul></li></ul></div></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
        🍞 GitHub
        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🎹 Web Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> ☔️ 核心框架项目搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🌧️ Vue 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> ⛈ Vue 组件编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> 🌨 Vue 3 组合式 API</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/pages/c8dfe0/" class="sidebar-link">☂️ Vue 3 上手</a></li><li><a href="/notebook/pages/0768ce/" aria-current="page" class="active sidebar-link">🧊 Vue 3 的组合 API 编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notebook/pages/0768ce/#常用-api" class="sidebar-link">常用 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#setup" class="sidebar-link">setup</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#ref-函数" class="sidebar-link">ref 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#reactive-函数" class="sidebar-link">reactive 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#对比-ref-与-reactive-函数" class="sidebar-link">对比 ref 与 reactive 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#setup-的注意点" class="sidebar-link">setup 的注意点</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#响应式原理" class="sidebar-link">响应式原理</a></li><li class="sidebar-sub-header level4"><a href="/notebook/pages/0768ce/#vue-2-中的响应式" class="sidebar-link">Vue 2 中的响应式</a></li><li class="sidebar-sub-header level4"><a href="/notebook/pages/0768ce/#vue3-的响应式" class="sidebar-link">Vue3 的响应式</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#计算属性-computed-函数" class="sidebar-link">计算属性 computed 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#数据监视-watch-函数" class="sidebar-link">数据监视 watch 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#watcheffect-函数" class="sidebar-link">watchEffect 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#自定义-hook-函数" class="sidebar-link">自定义 hook 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#toref-函数" class="sidebar-link">toRef 函数</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0768ce/#其他-api" class="sidebar-link">其他 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#shallowreactive-原始-shallowref-函数" class="sidebar-link">shallowReactive 原始 shallowRef 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#readonly-与-shallowreadonly-函数" class="sidebar-link">readonly 与 shallowReadonly 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#toraw-与-markraw-函数" class="sidebar-link">toRaw 与 markRaw 函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#customref" class="sidebar-link">customRef</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#provide-与-inject" class="sidebar-link">provide 与 inject</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#响应式数据判断" class="sidebar-link">响应式数据判断</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0768ce/#composition-api-的优势" class="sidebar-link">Composition API 的优势</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#options-api-存在的问题" class="sidebar-link">Options API 存在的问题</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0768ce/#composition-api-的优势-2" class="sidebar-link">Composition API 的优势</a></li></ul></li></ul></li><li><a href="/notebook/pages/f33531/" class="sidebar-link">🌊 Vue 3 其他更新</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-16f6d530><div class="articleInfo" data-v-16f6d530><ul class="breadcrumbs" data-v-16f6d530><li data-v-16f6d530><a href="/notebook/" title="首页" class="iconfont icon-home router-link-active" data-v-16f6d530></a></li> <li data-v-16f6d530><a href="/notebook/front-end/core-frame/# 🏃 前端核心框架" data-v-16f6d530> 🏃 前端核心框架</a></li><li data-v-16f6d530><a href="/notebook/front-end/core-frame/# 🌨 Vue 3 组合式 API" data-v-16f6d530> 🌨 Vue 3 组合式 API</a></li></ul> <div class="info" data-v-16f6d530><div title="作者" class="author iconfont icon-touxiang" data-v-16f6d530><a href="https://github.com/simon1uo" target="_blank" title="作者" class="beLink" data-v-16f6d530>Simon</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-16f6d530><a href="javascript:;" data-v-16f6d530>2022-04-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->🧊 Vue 3 的组合 API 编程<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="常用-api"><a href="#常用-api" class="header-anchor">#</a> 常用 API</h2> <h3 id="setup"><a href="#setup" class="header-anchor">#</a> <code>setup</code></h3> <ul><li><p><code>setup</code>  是 Vue 3 中的新的一个配置项，<strong>值为一个函数</strong>。</p> <p>是所有 Composition 组合 API 「表演的舞台」。</p></li> <li><p>组件中所有到的：<strong>数据、方法</strong>，都要配置在  <code>setup</code>  中。</p></li> <li><p><code>setup</code>  函数中的两种返回值：</p> <ul><li>⭐️ 若最后返回一个对象，则对象中的属性、方法，<strong>在模版中可以直接使用</strong>。</li> <li>若返回一个渲染函数，则可以返回自定义的渲染内容（了解）。</li></ul></li></ul> <p>🌰 例子：在  <code>setup</code>  中返回一个对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 数据</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'Simon'</span>
  <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token string">'3'</span>

  <span class="token comment">// 方法</span>
  <span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello, this is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, age:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    age<span class="token punctuation">,</span>
    sayHello
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>⚠️ 注意：
<ol><li>尽量不要与 Vue 2.x 中的配置混用：
<ul><li>Vue 2.x 的配置（ <code>data</code>  、 <code>methods</code> 、 <code>computed</code>   … ）中可以访问到  <code>setup</code>  中的属性、方法。</li> <li>但是在  <code>setup</code>  配置中不能访问 Vue 2.x 的配置（ <code>data</code>  、 <code>methods</code> 、 <code>computed</code>   … ）。</li> <li>当  <code>setup</code>  中的属性、方法与 Vue 2.x 的配置有重名时，<strong>以  <code>setup</code>  优先。</strong></li></ul></li> <li><code>setup</code>  不能是一个  <code>async</code>  函数，因为返回值不再是  <code>return</code>  对象，而是一个被  <code>async</code>  包裹的对象，而是  <code>promise</code>  ，此时模版无法使用  <code>return</code>  中的属性（<strong>后期可以返回一个  <code>Promise</code>  的实例，但是需要  <code>Suspense</code>  和异步组件的配合</strong> 🔗 <a href="">Suspense 组件</a>）</li></ol></li></ul> <h3 id="ref-函数"><a href="#ref-函数" class="header-anchor">#</a> <code>ref</code>  函数</h3> <blockquote><ul><li>在之前使用的  <code>ref</code>  ，作用是给原生的 DOM 标签添加标识，替代  <code>id</code>  的作用。</li> <li>在上述  <code>setup</code>  的例子中定义的数据不是一个响应式的数据，发生变化 Vue 无法监测。</li></ul></blockquote> <ul><li><p><code>ref</code>  函数作用：<strong>定义一个响应式的数据</strong>。</p></li> <li><p>语法：  <code>const xxx = ref(initValue)</code></p> <ul><li>创建一个  <code>ReflImpl</code>  ： <code>reference</code>  +  <code>implement</code>  包含响应式数据的<strong>引用  <code>ref</code>  对象</strong>（引用实现对象）。</li> <li>在 JS 中操作数据：  <code>xxx.value</code></li> <li><strong>在模版中读取数据</strong>：直接  <code></code> （自动解析  <code>ReflImpl</code>  的  <code>value</code>  值）</li></ul></li> <li><p>注意：</p> <ul><li>参数可以接收的数据有：基本数据类型、对象类型。</li> <li><strong>基本类型的数据</strong>：响应式依然是直接靠  <code>Object.defineProperty()</code>  的 <strong><code>get</code>  与  <code>set</code></strong> （数据劫持）完成的。</li> <li><strong>对象类型的数据</strong>：借助 Vue 3 中的  <code>reactive</code>  函数。</li></ul></li></ul> <h3 id="reactive-函数"><a href="#reactive-函数" class="header-anchor">#</a> <code>reactive</code>  函数</h3> <ul><li><p><code>reactive</code>  函数的作用：定义一个对象类型的响应式数据。（对于基本数据类型只能使用  <code>ref</code> ，基本数据类型放在对象中再使用  <code>reactive</code>  函数即可 ）</p></li> <li><p>语法： <code>const 代理对象 = reactive(源对象)</code> ，参数接收一个对象（或数组），返回一个<strong>代理对象</strong>（ <code>Proxy</code>  的实例对象，代理 Proxy 对象）</p></li> <li><p>使用  <code>reactive</code>  函数定义的<strong>响应式数据</strong>是「<strong>深层次的</strong>」。</p></li> <li><p><code>reactive</code>  函数内部基于 ES6 的  <code>Proxy</code>  函数实现，<strong>通过代理对象操作源对象的内部数据</strong>。</p></li></ul> <h3 id="对比-ref-与-reactive-函数"><a href="#对比-ref-与-reactive-函数" class="header-anchor">#</a> 对比  <code>ref</code>  与  <code>reactive</code>  函数</h3> <ul><li><p><strong>从定义数据类型角度对比</strong>：</p> <ul><li><code>ref</code>  用来定义基本数据类型。</li> <li><code>reactive</code>  用来定义对象（包括数组）类型。</li></ul> <p><code>reactive</code>  可以用来定义基本数据类型，封装在一个  <code>data</code>  对象中即可。</p></li> <li><p><strong>从原理角度对比</strong>：</p> <ul><li><code>ref</code>  通过   <code>Object.defineProperty()</code>  的  <code>get</code>  与  <code>set</code>  来实现响应式（数据劫持）。</li> <li><code>reactive</code>  通过使用  <code>Proxy</code>  （数据劫持）与  <code>Reflect</code>  （操作源对象内部的数据）结合实现响应式。</li></ul></li> <li><p><strong>从实用角度对比</strong>：</p> <ul><li><code>ref</code>  定义的数据，操作数据需要使用  <code>.value</code>  读取，在模版中可以直接读取。</li> <li><code>reactive</code>  定义的数据，操作和读取数据可以直接读取。</li></ul></li></ul> <h3 id="setup-的注意点"><a href="#setup-的注意点" class="header-anchor">#</a> <code>setup</code>  的注意点</h3> <ul><li><p><code>setup</code> <strong>执行的时机</strong>：</p> <ul><li>在  <code>beforeCreate</code>  之前执行一次， <code>this</code>  是  <code>undefined</code> 。</li></ul></li> <li><p><code>setup</code> <strong>的参数</strong>：</p> <ul><li><code>props</code> ：值为对象，包含：组件外部传递过来，<strong>且组件内部声明接收了的属性</strong>。</li> <li><code>context</code> ：<strong>上下文对象</strong>，包含以下内容：
<ul><li><code>attrs</code> ： 值为对象，包含：组件外部传递过来，<strong>但没有在  <code>props</code>  配置中声明的属性，相当于  <code>this.$attrs</code> 。</strong></li> <li><code>slots</code> ：<strong>收到的插槽内容</strong>，相当于  <code>this.$slots</code> 。</li> <li><code>emit</code> ：<strong>分发自定义事件的函数</strong>，相当于  <code>this.$emit</code> 。注意，自定义事件在要触发的组件中，与  <code>props</code>  相同，使用  <code>emits</code>  先声明，否则会警告。</li></ul></li></ul></li></ul> <h3 id="响应式原理"><a href="#响应式原理" class="header-anchor">#</a> 响应式原理</h3> <h4 id="vue-2-中的响应式"><a href="#vue-2-中的响应式" class="header-anchor">#</a> Vue 2 中的响应式</h4> <ul><li><p>实现原理（对于对象类型和数组类型的数据）：</p> <ul><li><p><strong>对象类型</strong>：通过  <code>Object.defineProperty()</code>  对属性的读取、修改进行拦截（数据劫持）。</p></li> <li><p><strong>数组类型</strong>：<strong>通过重写更新数组的一系列方法来实现拦截</strong>。（对数组的变更方法进行了包裹）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token function">set</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li> <li><p><strong>存在问题</strong>：<s>（可以通过  <code>Vue.set</code> （ <code>this.$set</code>  ） 解决）</s></p> <ul><li>新增属性、删除属性，<strong>界面不会更新</strong>。</li> <li>直接通过下标修改数组，<strong>界面不会自动更新</strong>。</li></ul></li></ul> <h4 id="vue3-的响应式"><a href="#vue3-的响应式" class="header-anchor">#</a> Vue3 的响应式</h4> <ul><li>实现原理:
<ul><li>通过 <strong>Proxy</strong>（代理）：<strong>拦截对象中任意属性的变化</strong>，包括：属性值的读写、属性的添加、属性的删除等。</li> <li>通过 <strong>Reflect</strong>（反射）：<strong>映射对源对象的属性进行操作</strong>。</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">// 拦截读取属性值</span>
    <span class="token function">get</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 拦截设置属性值或添加新属性</span>
    <span class="token function">set</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 拦截删除属性</span>
    <span class="token function">deleteProperty</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>🔗 相关链接 MDN：</p> <ul><li><p><strong>Proxy</strong>：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</p></li> <li><p><strong>Reflect</strong>：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</p></li></ul></blockquote> <h3 id="计算属性-computed-函数"><a href="#计算属性-computed-函数" class="header-anchor">#</a> 计算属性  <code>computed</code>  函数</h3> <p>Vue 3 中的计算属性  <code>computed</code>  函数的使用方法与 Vue 2 中的  <code>computed</code>  一致，在 Vue 3 中计算属性放入了  <code>setup</code>  中。可以将定义在  <code>setup</code>  中的数据设置为计算属性。</p> <p>🌰 计算属性的简写形式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 数据属性</span>
  <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'Simon'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Luo'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 计算属性</span>
  person<span class="token punctuation">.</span>fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    person<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><ul><li>上述简写的形式若将计算后的属性修改会提示警告，因为简写的计算属性是只读的。</li></ul></blockquote> <p>🌰 计算属性的完整形式（包括  <code>get()</code>  和  <code>set()</code>  ）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>person<span class="token punctuation">.</span>fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nameArr <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
    person<span class="token punctuation">.</span>firstName <span class="token operator">=</span> nameArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    person<span class="token punctuation">.</span>lastName <span class="token operator">=</span> nameArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="数据监视-watch-函数"><a href="#数据监视-watch-函数" class="header-anchor">#</a> 数据监视  <code>watch</code>  函数</h3> <p>与  <code>computed</code>  函数类似， <code>watch</code>  函数放在  <code>setup</code>  中使用，并且与 Vue 2 时的数据监视  <code>watch</code>  配置用法相同。</p> <p>但是 Vue 3 中的数据监视，<strong>对于不同的使用情况有不同的结果</strong>：</p> <ul><li>监视普通的  <code>ref</code>  定义的一个响应式数据：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oldValue'</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>监视普通的  <code>ref</code>  定义的多个响应式数据：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>sum<span class="token punctuation">,</span> msg<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oldValue'</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>监视使用  <code>ref</code>  定义的数据可以完整获取  <code>newValue</code>  、 <code>oldValue</code>  。</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>对于  <code>ref</code>  定义的响应式数据的一个注意点： <code>ref</code>  定义的普通数据的监视不能使用  <code>.value</code>  ，不用使用  <code>.value</code>  是因为  <code>ref</code>  定义的数据生成引用对象， <code>.value</code>  直接获取的是数据。</p> <p>而对于使用  <code>ref</code>  定义的响应式数据为一个对象时，此时  <code>.value</code>  的值为借用  <code>reative</code>  生成的  <code>Proxy</code>  对象，这时并不能监视到该层次的变化。可以使用加上  <code>.value</code>  或者开启深度监视解决。</p></div> <ul><li>监视  <code>reactive</code>  定义的响应式数据（以对象为例）：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oldValue'</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span> <span class="token comment">// 依旧是newValue</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li><p>监视使用  <code>reactive</code>  定义的响应式数据不能获取  <code>oldValue</code>  ；</p></li> <li><p>监视使用  <code>reactive</code>  定义的响应式数据，会强制开启深度监视（对于此事监视完整的一个对象而言）。</p></li></ul></div> <ul><li>监视  <code>reactive</code>  定义的响应式数据的某一个属性或者某些属性，第一个参数需要为一个函数的返回值或者对象，监测多个属性需要使用数组包裹。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>当监视的为  <code>reactive</code>  定义的响应式数据的某一个属性为一个对象时，并且其中有需要深度监视的属性，此时需要开启深度监视。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>job<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oldValue'</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>由于监视的是 reactive 定义的对象中的某个属性，所以 deep 配置有效</p></blockquote></div> <h3 id="watcheffect-函数"><a href="#watcheffect-函数" class="header-anchor">#</a> <code>watchEffect</code>  函数</h3> <ul><li>在  <code>watch</code>  函数中：既要指明监视的属性，也要指明监视的回调。</li> <li>在  <code>watchEffect</code>  函数中：不用指明监视哪个属性，<strong>监视的回调中用到哪个属性，那就监视哪个属性。</strong></li> <li>与  <code>computed</code>  函数相似，在  <code>computed</code>  函数中注重计算出来的值（回调函数的返回值），所以必须要返回一个值；但是  <code>watchEffect</code>  注重的是过程（<strong>回调函数的函数体</strong>），所以不用写返回值。</li></ul> <p>🌰  <code>watchEffect</code>  函数的使用例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> x1 <span class="token operator">=</span> sum<span class="token punctuation">.</span>value
  <span class="token keyword">const</span> x2 <span class="token operator">=</span> person<span class="token punctuation">.</span>age
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watchEffect回调执行'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>只要  <code>watchEffect</code>  指定的回调函数中<strong>用到的数据发生变化</strong>，则直接重新执行回调。</p></blockquote> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <p><img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/rPkbaj.svg" alt="Vue 3生命周期"></p> <ul><li>Vue 3 中可以继续使用 Vue 2 中的生命周期钩子，但有有两个被更名：
<ul><li><code>beforeDestroy</code>  改名为  <code>beforeUnmount</code></li> <li><code>destroyed</code>  改名为  <code>unmounted</code></li></ul></li> <li>Vue 3 也提供了 Composition API 形式的生命周期钩子，与 Vue 2 中钩子对应关系如下：
<ul><li><code>beforeCreate</code> ===&gt; <code>setup()</code></li> <li><code>created</code> =======&gt; <code>setup()</code></li> <li><code>beforeMount</code>  ===&gt; <code>onBeforeMount</code></li> <li><code>mounted</code> =======&gt; <code>onMounted</code></li> <li><code>beforeUpdate</code> ===&gt; <code>onBeforeUpdate</code></li> <li><code>updated</code>  =======&gt; <code>onUpdated</code></li> <li><code>beforeUnmount</code>  ==&gt; <code>onBeforeUnmount</code></li> <li><code>unmounted</code>  =====&gt; <code>onUnmounted</code></li></ul></li></ul> <h3 id="自定义-hook-函数"><a href="#自定义-hook-函数" class="header-anchor">#</a> 自定义 hook 函数</h3> <p>自定义 hook 函数本质是一个函数，<strong>把  <code>setup</code>  函数中使用的 Composition API 进行了封装。</strong></p> <ul><li><p>类似于 Vue2 中的 mixin。</p></li> <li><p>自定义 hook 的优势：<strong>复用代码，让  <code>setup</code>  中的逻辑更清楚易懂</strong>。</p></li></ul> <p>🌰 例子：</p> <ul><li>在  <code>src</code>  目录下创建新的目录  <code>hook</code>  存储  <code>hook</code>  函数，创建文件  <code>usePoint</code>  为例（一般命名开头为  <code>use</code>  ）：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 实现获取鼠标坐标</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>onBeforeUnmount<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> reactive<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实现的数据</span>
    <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 实现的方法</span>
    <span class="token keyword">function</span> <span class="token function">savePoint</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        point<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span>pageX
        point<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span>pageY
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>pageX<span class="token punctuation">,</span> event<span class="token punctuation">.</span>pageY<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 实现的相关钩子</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> savePoint<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> savePoint<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> point
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ul><li>在要使用这个  <code>hook</code>  函数的组件，引入当作函数并使用：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> usePoint <span class="token keyword">from</span> <span class="token string">&quot;../hooks/usePoint&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token function">usePoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    point
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="toref-函数"><a href="#toref-函数" class="header-anchor">#</a> <code>toRef</code>  函数</h3> <ul><li><code>toRef</code>  函数创建一个  <code>ref</code>  对象，其  <code>value</code>  值指向另一个对象中的某个属性。</li> <li>语法： <code>const name = toRef(person,'name')</code>  /  <code>toRefs(person)</code></li> <li>应用：<strong>要将响应式对象中的某个属性单独提供给外部使用时</strong>。</li></ul> <blockquote><p>与  <code>ref</code>  函数不同， <code>ref</code>  函数会重新创建新的引用  <code>RefImpl</code>  对象； <code>toRef</code>  创建的是引用原来的  <code>RefImpl</code>  对象。</p></blockquote> <p>🌰：使用  <code>toRefs()</code>  批量处理  <code>setup</code>  中的某个对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Simon'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">3</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
 	 	<span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="其他-api"><a href="#其他-api" class="header-anchor">#</a> 其他 API</h2> <h3 id="shallowreactive-原始-shallowref-函数"><a href="#shallowreactive-原始-shallowref-函数" class="header-anchor">#</a> <code>shallowReactive</code>  原始  <code>shallowRef</code>  函数</h3> <ul><li><p><strong>浅层响应式数据的定义</strong>：</p> <ul><li><p><code>shallowReactive</code> ：只处理对象最外层属性的响应式（<strong>浅响应式</strong>）。</p></li> <li><p><code>shallowRef</code> ：只处理基本数据类型的响应式，不进行对象的响应式处理（对于使用这个函数定义的对象，不会借用  <code>reactive</code>  处理对象为  <code>Proxy</code>  对象）。</p></li></ul></li> <li><p><strong>应用场景</strong>：</p> <ul><li>如果只有一个<strong>对象数据</strong>，由多层对象结构（结构较深层），但只需要实现外层属性的变化，使用  <code>shallowReactive</code>  函数定义。</li> <li>如果只有一个<strong>对象数据</strong>，<strong>后续功能不会修改该对象中的属性</strong>，而是生成新的对象来替换，使用  <code>shallowRef</code>  函数定义。</li></ul></li></ul> <h3 id="readonly-与-shallowreadonly-函数"><a href="#readonly-与-shallowreadonly-函数" class="header-anchor">#</a> <code>readonly</code>  与  <code>shallowReadonly</code>  函数</h3> <ul><li>只读属性相关的 API ：（* 对于定义的响应式数据有效）
<ul><li><code>readonly</code>  ：让一个响应式数据变为只读的（<strong>深只读</strong>）；</li> <li><code>shallowReadonly</code>  ：让一个响应式数据变为只读（<strong>浅只读</strong>）；</li></ul></li> <li><strong>应用场景</strong>：<strong>不希望响应式数据被修改时</strong>。（当收到来自另一个组件定义的响应式数据，在现组件不希望引入的数据被修改时）</li></ul> <h3 id="toraw-与-markraw-函数"><a href="#toraw-与-markraw-函数" class="header-anchor">#</a> <code>toRaw</code>  与  <code>markRaw</code>  函数</h3> <p>生成与标记为原始普通数据：</p> <ul><li><code>toRaw</code> ：
<ul><li>作用：将一个由  <code>reactive</code>  （只能是）定义的响应式对象转为普通对象（原始）。</li> <li>使用场景：用于读取响应式对象对应的普通对象，<strong>对这个普通对象的所有操作不会引起页面的变化</strong>。</li></ul></li> <li><code>markRaw</code>  ：
<ul><li>用于某些数据 ** 不应该被赋值时自动设置为响应式数据的，** 例如复杂的第三方库数据。</li> <li>当渲染具有不可变数据源的大列表时，<strong>跳过响应式转换会提高渲染性能</strong>。</li></ul></li></ul> <h3 id="customref"><a href="#customref" class="header-anchor">#</a> <code>customRef</code></h3> <ul><li>作用：创建一个自定义  <code>ref</code>  ，<strong>并且对其依赖项跟踪和更新触发进行显示控制</strong>。</li></ul> <p>🌰 实现防抖效果（延迟显示）：</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 自定义一个ref</span>
<span class="token keyword">function</span> <span class="token function">myRef</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer
  <span class="token comment">// console.log('myRef', value)</span>
  <span class="token keyword">return</span> <span class="token function">customRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track<span class="token punctuation">,</span> trigger</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 类似计算属性get/set</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">read from myRef, value: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 通知Vue追踪value的变化（告诉Vue）</span>
        <span class="token keyword">return</span> value
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">modify in myRef, after Modified Value: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          value <span class="token operator">=</span> newValue
          <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 通知Vue重新解析模版</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> keyword <span class="token operator">=</span> <span class="token function">myRef</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token comment">// 使用自定义ref</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></details> <h3 id="provide-与-inject"><a href="#provide-与-inject" class="header-anchor">#</a> <code>provide</code>  与  <code>inject</code></h3> <img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/D1Uy5Y.png" style="width:300px;"> <ul><li>作用： 实现 **（祖与后代）跨级组件之间 ** 的通信。</li> <li>套路：父组件有一个  <code>provide</code>  选项来提供数据，后代组件有一个  <code>inject</code>  选项来开始使用这些数据。</li></ul> <p>🌰 例子：</p> <ul><li>在祖组件中的  <code>setup</code>  中  <code>provide</code>  ：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">let</span> car <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'奔驰'</span><span class="token punctuation">,</span><span class="token literal-property property">price</span><span class="token operator">:</span><span class="token string">'40万'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">,</span>car<span class="token punctuation">)</span>
    <span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>在后代组件中使用  <code>inject</code>  获取：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">const</span> car <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>car<span class="token punctuation">}</span>
	<span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="响应式数据判断"><a href="#响应式数据判断" class="header-anchor">#</a> 响应式数据判断</h3> <p>当数据逐渐增多或者获取从它处来的数据，未知该数据的响应式类型（是否为响应式），需要进行该数据的判断，使用下列函数判断：</p> <ul><li><code>isRef</code>  ：检查目标数据是否为  <code>ref</code>  创建的引用对象；</li> <li><code>isReactive</code>  ：检查目标数据是否由  <code>reactive</code>  创建的响应式代理；</li> <li><code>isReadonly</code>  ：检查目标数据是否为由  <code>readonly</code>  创建的只读代理；</li> <li><code>isProxy</code>  ：检查一个对象是否由  <code>reactive</code>  或者  <code>readonly</code>  方法创建的代理。</li></ul> <h2 id="composition-api-的优势"><a href="#composition-api-的优势" class="header-anchor">#</a> Composition API 的优势</h2> <h3 id="options-api-存在的问题"><a href="#options-api-存在的问题" class="header-anchor">#</a> Options API 存在的问题</h3> <p><img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/EReLGK.gif" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用传统 Options API （配置式 API）中，<strong>新增或者修改一个需求</strong>，就需要分别在  <code>data</code> 、 <code>methods</code> 、 <code>computed</code>  里修改 。</p></div> <h3 id="composition-api-的优势-2"><a href="#composition-api-的优势-2" class="header-anchor">#</a> Composition API 的优势</h3> <p><img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/256pe6.gif" alt=""></p> <p><img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/duDTPa.gif" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>⭐️ 在 Composition API （<strong>基于函数组合</strong> API）中，可以整合在一块组织代码、函数（配合自定义钩子函数使用），<strong>让相关功能的代码更加有序的组织在一起</strong>。</p></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/simon1uo/notebook/edit/master/docs/105. 🏃 前端核心框架/15. 🌨 Vue 3 组合式 API/02. 🧊 Vue 3 的组合 API 编程.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">📢 上次更新:</span> <span class="time">2022/07/03, 16:33:17</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notebook/pages/c8dfe0/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">☂️ Vue 3 上手</div></a> <a href="/notebook/pages/f33531/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">🌊 Vue 3 其他更新</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
                ←
                <a href="/notebook/pages/c8dfe0/" class="prev">☂️ Vue 3 上手</a></span> <span class="next"><a href="/notebook/pages/f33531/">🌊 Vue 3 其他更新</a>→
            </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
        Copyright © 2020-2022
        |
        <span></span>

    theme on based
    <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="theme">Vdoing</a> powered By Vuepress
</div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
                    跟随系统
                </li><li class="iconfont icon-rijianmoshi">
                    浅色模式
                </li><li class="iconfont icon-yejianmoshi">
                    深色模式
                </li><li class="iconfont icon-yuedu">
                    阅读模式
                </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
        <script src="/notebook/assets/js/app.58c8f232.js" defer></script><script src="/notebook/assets/js/2.350001ab.js" defer></script><script src="/notebook/assets/js/3.cf638cd2.js" defer></script><script src="/notebook/assets/js/177.5bb05ecc.js" defer></script>
    </body>
</html>

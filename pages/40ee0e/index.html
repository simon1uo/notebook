<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>📦 JavaScript 浏览器存储 | notebook</title>
        <meta name="generator" content="VuePress 1.9.7" />
        <link rel="icon" href="/notebook/favicon.ico">
    <link rel="stylesheet" href="/notebook//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
    <script src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script> <meta name="description" content="a frontend notebook by Simon">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="个人学习笔记,前端学习笔记,前端学习,前端学习资源,前端学习路线,HTML,CSS,JavaScript,Vue,React">
    <meta name="theme-color" content="#204A7A">  <link rel="preload" href="/notebook/assets/css/0.styles.29a47cad.css" as="style"><link rel="preload" href="/notebook/assets/js/app.54612df9.js" as="script"><link rel="preload" href="/notebook/assets/js/2.f4898154.js" as="script"><link rel="preload" href="/notebook/assets/js/3.c3838318.js" as="script"><link rel="preload" href="/notebook/assets/js/139.f01349ee.js" as="script"> <link rel="stylesheet" href="/notebook/assets/css/0.styles.29a47cad.css">
    </head>
    <body class="theme-mode-light">
        <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/assets/img/logo.png" alt="notebook" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/" class="nav-link">🌏 首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="☕️ 前端笔记" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">☕️ 前端笔记</a> <span class="title" style="display:none;">☕️ 前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">🗺 前端学习路线</a></li><li class="dropdown-item"><h4>分类</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">🚶 前端入门基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">🚶🏻 前端巩固基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">🏃 前端核心框架</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/interview/" class="nav-link">🪞 前端面试题收集</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🚏 索引" class="dropdown-title"><a href="/notebook/archives/" class="link-title">🚏 索引</a> <span class="title" style="display:none;">🚏 索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/archives/" class="nav-link">🗄归档</a></li><li class="dropdown-item"><!----> <a href="/notebook/tags/" class="nav-link">🔖标签</a></li></ul></div></div><div class="nav-item"><a href="/notebook/about/" class="nav-link">🔖 关于</a></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
            🍞 GitHub
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/notebook/" class="nav-link">🌏 首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="☕️ 前端笔记" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">☕️ 前端笔记</a> <span class="title" style="display:none;">☕️ 前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">🗺 前端学习路线</a></li><li class="dropdown-item"><h4>分类</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">🚶 前端入门基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">🚶🏻 前端巩固基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">🏃 前端核心框架</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/interview/" class="nav-link">🪞 前端面试题收集</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🚏 索引" class="dropdown-title"><a href="/notebook/archives/" class="link-title">🚏 索引</a> <span class="title" style="display:none;">🚏 索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/archives/" class="nav-link">🗄归档</a></li><li class="dropdown-item"><!----> <a href="/notebook/tags/" class="nav-link">🔖标签</a></li></ul></div></div><div class="nav-item"><a href="/notebook/about/" class="nav-link">🔖 关于</a></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
            🍞 GitHub
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🍯 ES6 基本语法</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/notebook/pages/4e50dd/" class="sidebar-link">🌱 node.js 基本使用</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📒 JavaScript 深入对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📕 JavaScript 深入数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📗 JavaScript 深入函数</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📘 JavaScript 原型与继承</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📙 JavaScript 类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📓 JavaScript DOM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🍯 JavaScript AJAX 网络请求</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🚇 JavaScript Promise</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> 📔 JavaScript 其他内容</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/pages/921863/" class="sidebar-link">🧨 JavaScript 防抖与节流</a></li><li><a href="/notebook/pages/ce4056/" class="sidebar-link">🗑 JavaScript 关于使用 var 声明变量</a></li><li><a href="/notebook/pages/6edabb/" class="sidebar-link">🪤JavaScript 的模块管理</a></li><li><a href="/notebook/pages/7c3484/" class="sidebar-link">🔦 JavaScript 的错误处理</a></li><li><a href="/notebook/pages/15a7cb/" class="sidebar-link">🎪 JavaScript Proxy 和 Reflect</a></li><li><a href="/notebook/pages/40ee0e/" aria-current="page" class="active sidebar-link">📦 JavaScript 浏览器存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notebook/pages/40ee0e/#cookie" class="sidebar-link">Cookie</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/40ee0e/#读取-cookie" class="sidebar-link">读取 cookie</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/40ee0e/#写入-cookie" class="sidebar-link">写入 cookie</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/40ee0e/#cookie-操作函数" class="sidebar-link">cookie 操作函数</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/40ee0e/#第三方-cookie" class="sidebar-link">第三方 cookie</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/40ee0e/#localstorage-sessionstorage" class="sidebar-link">LocalStorage / SessionStorage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/40ee0e/#localstorage-的使用" class="sidebar-link">localStorage 的使用</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/40ee0e/#sessionstorage-的使用" class="sidebar-link">sessionStorage 的使用</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/40ee0e/#storage-事件" class="sidebar-link">storage 事件</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/40ee0e/#indexeddb" class="sidebar-link">IndexedDB</a></li></ul></li><li><a href="/notebook/pages/f38565/" class="sidebar-link">🎣 JavaScript 正则表达式</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🏃 JavaScript 进阶高级</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> ʦ TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🚟 axios</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-16f6d530><div class="articleInfo" data-v-16f6d530><ul class="breadcrumbs" data-v-16f6d530><li data-v-16f6d530><a href="/notebook/" title="首页" class="iconfont icon-home router-link-active" data-v-16f6d530></a></li> <li data-v-16f6d530><a href="/notebook/front-end/stable/# 🚶🏻 前端巩固基础" data-v-16f6d530> 🚶🏻 前端巩固基础</a></li><li data-v-16f6d530><a href="/notebook/front-end/stable/# 📔 JavaScript 其他内容" data-v-16f6d530> 📔 JavaScript 其他内容</a></li></ul> <div class="info" data-v-16f6d530><div title="作者" class="author iconfont icon-touxiang" data-v-16f6d530><a href="https://github.com/simon1uo" target="_blank" title="作者" class="beLink" data-v-16f6d530>Simon Luo</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-16f6d530><a href="javascript:;" data-v-16f6d530>2022-06-04</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->📦 JavaScript 浏览器存储<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h2> <p>Cookie 是一串 <strong>直接存储在浏览器的数据</strong>；是 HTTP 协议的一部分；</p> <ul><li>通常由 Web 服务器使用响应  <code>Set-Cookie</code>  HTTP header 设置。</li> <li>浏览器使用  <code>Cookie</code>  HTTP header 自动添加到（几乎） <strong>每个对相同域</strong> 的请求中。</li></ul> <blockquote><p>🌰 例子 / 登录身份验证：</p> <ul><li>登录成功后，服务器在响应中使用  <code>Set-Cookie</code>  HTTP-header 来设置具有唯一的会话标识符的 cookie。</li> <li>下次当请求被发送到同一个域时，浏览器会使用  <code>Cookie</code>  HTTP-header 通过网络发送 cookie。</li> <li>服务器通过这个 cookie 识别身份的请求。</li></ul></blockquote> <h3 id="读取-cookie"><a href="#读取-cookie" class="header-anchor">#</a> 读取 cookie</h3> <p>使用  <code>document.cookie</code>  读取网站存储的 cookie。</p> <ul><li><code>cument.cookie</code>  的值由  <code>name=value</code>  对组成，以  <code>;</code>  分隔。</li> <li>每一个都是<strong>独立的</strong> cookie。</li></ul> <h3 id="写入-cookie"><a href="#写入-cookie" class="header-anchor">#</a> 写入 cookie</h3> <blockquote><p>使用 JavaScript 写入 cookie 使用  <code>document.cookie</code> （<strong>不是数据属性</strong>），这个访问器 （包含  <code>getter</code>  /  <code>setter</code>  ），对其赋值操作会被特殊处理。</p></blockquote> <p>对  <code>document.cookie</code>  的写入操作<strong>只会更新其中提到的 cookie</strong>，<strong>而不会涉及其他 cookie</strong>。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;user=john&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 只更新名称为 user 的 cookie</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 展示所有的 cookie</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>cookie 的名称和值 <strong>可以是任何字符</strong>。为了保持有效的格式，它们应该使用内建的  <code>encodeURIComponent</code>  函数对其进行转义（与 URL 对象添加参数同理）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 特殊字符（空格），需要编码</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;my name&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">&quot;John Smith&quot;</span>

<span class="token comment">// 将 cookie 编码为 my%20name=John%20Smith</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>cookie 存储限制：</p> <ul><li><code>encodeURIComponent</code>  编码后的  <code>name=value</code>  对，大小不能超过 4KB。</li> <li>每个域的 cookie 总数不得超过 20+ 左右，<strong>具体限制取决于浏览器</strong>。</li></ul></blockquote> <p><strong>Cookie 中的要设置的选项参数：</strong></p> <blockquote><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;user=John; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <ul><li><p><code>path</code>  ：  <code>url</code> <strong>路径前缀</strong>。必须是绝对路径，使得该路径下的页面运行访问该 cookie。默认为当前路径。通常设置为  <code>path=/</code>  ，即使 cookie 对该网站的所有页面可见。</p> <p>例子，一个 cookie 带有  <code>path=/admin</code>  设置，那么该 cookie 在  <code>/admin</code>  和  <code>/admin/something</code>  下都是可见的，但是在  <code>/home</code>  或  <code>/adminpage</code>  下不可见。</p></li> <li><p><code>domain</code> ：控制可以访问 cookie 的域。在实际中，有一些安全限制无法设置的域，例如，无法从另一个二级域访问 cookie（ <code>other.com</code>  永远不会收到在  <code>site.com</code>  设置的 cookie），这使得 cookie 的敏感数据只能存储在一个站点上可用的 cookie 中。</p> <p>** 默认情况下，cookie 只有在设置的域下才能被访问到。 ** 注意，默认情况下，cookie 不会共享给 <strong>子域</strong>（例如，  <code>forum.site.com</code>  是  <code>site.com</code>  的子域）。</p> <p>可以通过设置  <code>domain</code>  允许子域设置 cookie：当在  <code>site.com</code>  设置 cookie 时，应该明确地将  <code>domain</code>  选项设置为根域： <code>domain=site.com</code> 。那么，所有子域都可以访问到这样的 cookie。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;user=John; domain=site.com&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在子域  <code>forum.site.com</code>  中，可以访问该 cookie：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 有 cookie user=John</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>expires</code>  /  <code>max-age</code>  ：控制 cookie 的过期事件。默认情况下， 不设置这两个参数的 cookie 在关闭浏览器后消失，即为 session cookie。可以通过设置这两个参数保持 cookie 在浏览器关闭后仍然存在。</p> <p><code>expire</code>  ：设置浏览器会清除掉该 cookie 的时间日期。</p> <p>🌰 例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>expires=Tue, 19 Jan 2038 03:14:07 GMT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>日期格式必须为 GMT 时区格式。可以通过  <code>date.toUTCString（）</code>   方法转换。</p> <p>🌰 例子 / 将 cookie 设置为 <strong>一天后到期</strong>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">86400e3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
date <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;user=john; expires=&quot;</span> <span class="token operator">+</span> date<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果将  <code>expires</code>  设置为过去的日期，那么 cookie 会被直接删除。</p></blockquote> <p><code>max-age</code>  ：是  <code>expires</code>  的替代选项，指明 cookie 的过期时间距离当前时间的秒数。（设置在设定的秒数之后过期）。</p> <p>🌰 例子 / 将 cookie 设置为 1 个小时后失效：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;user=John; max-age=3600&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>🌰 例子 / 设置为 0 或者负数，cookie 立即过期：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;user=John; max-age=0&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>secure</code>  ：设置 cookie 的安全协议。</p> <blockquote><p>默认情况下，如果在  <code>http://site.com</code>  上设置了 cookie，那么该 cookie 也会出现在  <code>https://site.com</code>  上，反之亦然。即此时的 cookie <strong>不区分 HTTP 协议</strong>。</p> <p>如果一个 cookie 是通过  <code>https://site.com</code>  设置的，那么它不会在相同域的 HTTP 环境下出现，例如  <code>http://site.com</code> 。所以，如果一个 cookie 包含绝不应该通过未加密的 HTTP 协议发送的敏感内容，那么就应该设置  <code>secure</code>  标识。</p></blockquote> <p>🌰 例子 / 设置为只能在当前协议下可访问的 cookie（如当前在 HTTPS 环境下）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;user=John; secure&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>samesite</code> ：cookie 的另一个安全特性，可以防止 XSRF （跨网站请求伪造） 攻击。</p> <blockquote><p>XSRF 攻击的例子：当用户登录了  <code>bank.com</code> ，有了当前网站的 cookie。浏览器会在每次请求时将其发送到  <code>bank.com</code>  的服务器，以便识别身份执行敏感的操作。</p> <p>此时，在浏览器的另一个窗口访问另一个网站，该网站具有发送  <code>bank.com/pay</code>  请求的表单。当每次访问  <code>bank.com</code>  网站时，浏览器都会发送 cookie ，即使请求是从不同的网站发送的。</p> <p>实际的网站不会允许这样的情况发生，所有由  <code>bank.com</code>  生成的表单都具有一个特殊的字段，（XSRF 保护 token）。恶意页面既不能生成，也不能从远程页面提取它。它可以在那里提交表单，但是无法获取数据。并且，网站  <code>bank.com</code>  会对收到的每个表单都进行这种 token 的检查。（一种防止 XSRF 的方式）</p></blockquote> <p>上面的方法，需要检查每个表单请求的 token 字段。使用 cookie 的  <code>samesite</code>  选项：</p> <p><code>samesite=strict</code> ：默认情况（没有值时）：除了来自同一个网站的请求，设置了  <code>samesite=strict</code>  的 cookie 在其他网站域永远不会被发送。</p> <blockquote><p>设置为  <code>strict</code>  后， XSRF 攻击是没有机会成功的，因为来自  <code>evil.com</code>  的提交没有 cookie。因此， <code>bank.com</code>  将无法识别用户，也就不会继续进行付款。</p> <p>但是  <code>strict</code>  有不方便的地方：当从其他地方访问  <code>bank.com</code>  连接时，同样也不能发送  <code>samesite=strict</code>  的 cookie。可以通过设置两种不同的 cookie 解决 ：一种用于「一般识别」；另一种用于进行敏感数据信息操作时的识别（设为  <code>strict</code>  的 cookie）。这样用户从别处访问网站时同样可以识别身份；并且进行敏感操作时必须从同一个网站启动才能进行。</p></blockquote> <p><code>samesite=lax</code> ：比  <code>strict</code>  轻松的 cookie 限制。 同样可以防止 XSRF 攻击，但是不会破坏用户的体验。</p> <p>与  <code>strict</code>  相似，从外部来到网站的，禁止浏览器发送 cookie，但是有例外的情况（符合以下两个条件）：</p> <ul><li><p>HTTP 方法为安全方法；（安全的 HTTP 方法一般用于读取数据，不会更改数据，例如 GET）</p></li> <li><p>该操作执行顶级导航（会更改浏览器地址栏中的 URL 的操作）</p> <blockquote><p>通常成立。如果在  <code>&lt;iframe&gt;</code>  中执行就不是顶级；用于网络请求的 JavaScript 方法不会执行任何导航。</p></blockquote></li></ul> <p><code>samesite=lax</code>  所做的是基本上<strong>允许最常见的前往 URL 操作携带 cookie。</strong>（例如，从笔记中打开网站），但是来自另一个网站的网络请求 / 表单提交都不会携带 cookie。</p></li> <li><p>httpOnly：Web 服务器使用  <code>Set-Cookie</code>  header 来设置 cookie。并且，它可以设置  <code>httpOnly</code>  选项。<strong>这个选项禁止任何 JavaScript 访问 cookie</strong>，即使用  <code>document.cookie</code>  看不到此类 cookie，也无法对此类 cookie 进行操作。</p></li></ul> <h3 id="cookie-操作函数"><a href="#cookie-操作函数" class="header-anchor">#</a> cookie 操作函数</h3> <p>编写常见的 cookie 操作函数，相对于使用  <code>document.cookie</code>  更加方便（可以使用相似第三方库引入使用）：</p> <ul><li><p><code>getCookie(name)</code> ：返回具有给定的  <code>name</code>  的 cookie。如果没有找到则返回  <code>undefined</code> 。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> matches <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
    <span class="token string">&quot;(?:^|; )&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([\.$?*|{}\(\)\[\]\\\/\+^])</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'\\$1'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=([^;]*)&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> matches <span class="token operator">?</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>matches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><code>setCookie(name, value, options)</code> ：将 cookie 的  <code>name</code>  设置为具有默认值  <code>path=/</code> （可以修改以添加其他默认值）和给定值  <code>value</code> 。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token comment">// 如果需要，可以在这里添加其他默认值</span>
    <span class="token operator">...</span>options
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>expires <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>expires <span class="token operator">=</span> options<span class="token punctuation">.</span>expires<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> updatedCookie <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> optionKey <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    updatedCookie <span class="token operator">+=</span> <span class="token string">&quot;; &quot;</span> <span class="token operator">+</span> optionKey<span class="token punctuation">;</span>
    <span class="token keyword">let</span> optionValue <span class="token operator">=</span> options<span class="token punctuation">[</span>optionKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>optionValue <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      updatedCookie <span class="token operator">+=</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> optionValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> updatedCookie<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用范例：</span>
<span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string-property property">'max-age'</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li> <li><p><code>deleteCookie(name)</code>  ：删除 cookie。</p> <p>通过设置过期时间  <code>max-age</code>   为 0 或者负数实现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deleteCookie</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setCookie</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'max-age'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>当进行更新或删除一个 cookie 操作时，<strong>应该使用和设置 cookie 时相同的路径和域选项。</strong></p></div> <h3 id="第三方-cookie"><a href="#第三方-cookie" class="header-anchor">#</a> 第三方 cookie</h3> <p>常见的第三方 cookie 用与跟踪和广告服务。它们被绑定在原始域上，因此  <code>ads.com</code>  可以在不同网站之间跟踪同一用户，如果这些网站都可以访问  <code>ads.com</code>  的话。</p> <blockquote><p>例如：</p> <ul><li><code>site.com</code>  网站的一个页面加载了另外一个网站的 banner： <code>&lt;img src=&quot;https://ads.com/banner.png&quot;&gt;</code> 。</li> <li>与 banner 一起， <code>ads.com</code>  的远程服务器可能会设置带有  <code>id=1234</code>  这样的 cookie 的  <code>Set-Cookie</code>  header。此类 cookie 源自  <code>ads.com</code>  域，并且仅在  <code>ads.com</code>  中可见。</li> <li>下次访问  <code>ads.com</code>  网站时，远程服务器获取 cookie  <code>id</code>  并识别用户。</li> <li>用户从  <code>site.com</code>  网站跳转至另一个也带有 banner 的网站  <code>other.com</code>  时， <code>ads.com</code>  会获得该 cookie，因为它属于  <code>ads.com</code> ，从而识别用户并在他在网站之间切换时对其进行跟踪。</li></ul></blockquote> <blockquote><p>现代浏览器可能会禁用此类的 cookie：</p> <ul><li>Safari 浏览器完全不允许第三方 cookie。</li> <li>Firefox 浏览器附带了一个第三方域的黑名单，它阻止了来自名单内的域的第三方 cookie。</li></ul></blockquote> <blockquote><p>对于加载来自第三方域的脚本中使用  <code>document.cookie</code>  设置 cookie，无论脚本来自何处，设置的 cookie 都属于当前网页的域而不是第三方 cookie。</p></blockquote> <h2 id="localstorage-sessionstorage"><a href="#localstorage-sessionstorage" class="header-anchor">#</a> LocalStorage / SessionStorage</h2> <p>通过 Web 存储对象  <code>localStorage</code>  和  <code>sessionStorage</code>   在浏览器中保存 键 / 值对数据。在页面刷新（ <code>sessionStorage</code> ） 或者浏览器重启之后（ <code>localStorage</code> ）数据仍然可以保留在浏览器中。</p> <blockquote><p>相对于 cookie，Web 存储对象：</p> <ul><li>Web 存储对象不会随每个请求被发送到服务器。所以可以存储更多的数据，并且浏览器允许保存至少 2 MB 的数据（或者更多），并且具有配置数据的设置；</li> <li>服务器无法通过 HTTP header 操作存储对象，一切通过 JavaScript 完成进行。</li> <li>存储绑定到源（域 / 协议 / 端口三者）。也就是说，<strong>不同协议或子域对应不同的存储对象</strong>，它们之间无法访问彼此数据。</li></ul></blockquote> <ul><li>键值  <code>key</code>  /  <code>value</code>  必须为字符串；</li> <li>存储大小限制为 5 MB+。取决于浏览器；</li> <li>没有过期时间（LocalStorage）</li></ul> <p><strong>两种存储对象提供相同的方法和属性</strong>：</p> <ul><li><code>setItem(key, value)</code>  ：存储键 / 值对。</li> <li><code>getItem(key)</code>  ：按照键获取值。</li> <li><code>removeItem(key)</code>  ：删除键及其对应的值。</li> <li><code>clear()</code>  ：删除所有数据。</li> <li><code>key(index)</code> ： 获取该索引下的 <strong>键名</strong>。</li> <li><code>length</code>  ：存储的内容的长度。</li></ul> <h3 id="localstorage-的使用"><a href="#localstorage-的使用" class="header-anchor">#</a> <code>localStorage</code>  的使用</h3> <p>一般<strong>在所有同源的窗口之间</strong>， <code>localStorage</code>  数据可以共享。</p> <p>🌰 例子 / 使用  <code>localStorage</code>  ：</p> <ul><li><p>存储数据：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>读取数据：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <blockquote><p>在重新打开浏览器的同一个页面（不同窗口）也可以获取该数据；在同一个源（域 / 端口 / 协议），URL 路径可以不同，都可以共享该数据。</p></blockquote> <p>🌰 例子 / 类对象形式的访问：</p> <p>与使用一个普通对象一样使用 LocalStorage：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 设置 key</span>
localStorage<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// 获取 key</span>
<span class="token function">alert</span><span class="token punctuation">(</span> localStorage<span class="token punctuation">.</span>test <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

<span class="token comment">// 删除 key</span>
<span class="token keyword">delete</span> localStorage<span class="token punctuation">.</span>test<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>但一般不建议这样使用：</p> <ul><li><p>键值对由用户生成，可以为任何的内容。如果设置与内置对象属性相同的键（如  <code>length</code>  /  <code>toString</code> ），使用这种方式会出错，而使用  <code>setItem</code>  /  <code>getItem</code>  可以正常工作：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token string">'length'</span><span class="token punctuation">;</span>
localStorage<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// Error，无法对 length 进行赋值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>存在  <code>storage</code>  事件，使用 类对象的形式修改数据不会触发； <code>setItem</code>  正常修改数据会触发。</p></li></ul> <p>🌰 例子 / 遍历键：</p> <p><strong>由于存储对象是不可迭代的</strong>。要获取所有的键（或者值）：</p> <ul><li><p>使用遍历数组的方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> localStorage<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> key <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>使用  <code>for... in</code>  循环方法：</p> <blockquote><p>注意这种方法会像处理常规对象一样；遍历所有的键，同时也会输出一些不需要的内建字段。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> localStorage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示 getItem，setItem 和其他内建的东西</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>需要使用  <code>hasOwnProperty</code>  检查过滤掉原型中的字段：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> localStorage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 跳过像 &quot;setItem&quot;，&quot;getItem&quot; 等这样的键</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>或者使用  <code>Object.keys</code>  获取只属于自己的键，需要的遍历出来：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <p><strong>注意，存储的对象的 键 / 值必须为 字符串。</strong> 如果为其他类型（数值、对象），会被自动转换为字符串。</p> <p>可以使用  <code>JSON.stringfy()</code>  存储对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>localStorage<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>读取的数据使用  <code>JSON.parse()</code>  转换：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>或者对整个存储对象进行字符化处理：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringfy</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="sessionstorage-的使用"><a href="#sessionstorage-的使用" class="header-anchor">#</a> <code>sessionStorage</code>  的使用</h3> <p>与  <code>localStorage</code>  的使用基本类似，使用频率较低。使用  <code>sessionStorage</code>  有以下的限制：</p> <ul><li>存储的数据只能保存在当前的会话（浏览器的标签页）：
<ul><li>意味着相同的页面不同的窗口会有不同的存储；</li> <li>但是在同一个页面下的  <code>iframe</code>  下的存储是相同的。</li></ul></li> <li>存储的数据在刷新后能保留，但是关闭或者重启浏览器不会保留。</li></ul> <h3 id="storage-事件"><a href="#storage-事件" class="header-anchor">#</a> <code>storage</code>  事件</h3> <p>当  <code>localStorage</code>  或  <code>sessionStorage</code>  中的数据更新后， <code>storage</code>  事件就会被触发，它会有以下的属性：</p> <ul><li><code>key</code> ：发生数据更改的键  <code>key</code> ；（如果调用的是  <code>clear</code>  ， <code>key</code>  为  <code>null</code> ）</li> <li><code>oldValue</code> ：旧值；（新增数值为  <code>null</code> ）</li> <li><code>newValue</code> ：新值；（删除数值为  <code>null</code> ）</li> <li><code>url</code> ：<strong>发生数据更改的文档的</strong> <code>url</code>  ；</li> <li><code>storageData</code> ：发生数据更改的（ <code>localStorage</code>  /  <code>sessionStorage</code> ）对象；</li> <li><code>storageArea</code> ：包含存储对象（ <code>sessionStorage</code>  和  <code>localStorage</code>  ）具有相同的事件，所以  <code>event.storageArea</code>  引用了<strong>被修改的对象</strong>。 允许同源的不同窗口交换信息。</li></ul> <p>并且，  <code>storage</code>  事件会在 <strong>所有可以访问到存储对象的  <code>window</code>  对象</strong> 上触发，导致当前数据发生改变的  <code>window</code>  对象除外。</p> <p>🌰 例子 / 当有两个窗口具有相同的页面， <code>localStorage</code>  在它们之间共享数据。如果两个窗口都监听  <code>window.onstorage</code>  事件，那么每个窗口都会对另一个窗口中发生的更新作出反应。</p> <ul><li><p>在其他文档对同一存储进行更新时会触发：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onstorage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">!=</span> <span class="token string">'now'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>newValue <span class="token operator">+</span> <span class="token string">&quot; at &quot;</span> event<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 或者使用 window.addEventListener('storage', event =&gt; {</span>
<span class="token comment">// ...</span>
<span class="token comment">// })</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>会捕捉到关于  <code>key</code>  为  <code>now</code>  的数据的更新：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'now'</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h2 id="indexeddb"><a href="#indexeddb" class="header-anchor">#</a> IndexedDB</h2> <p>是一个浏览器内建的数据库，比  <code>localStorage</code>  强大得多。</p> <ul><li>支持多种类型的键，可以存储几乎任何类型的值；</li> <li>支持事务可靠性；</li> <li>支持键值的范围查询、索引；</li> <li>相比于  <code>localStorage</code>  可以存储更大的数据；</li></ul> <blockquote><p>IndexedDB 适用于 离线应用，可与 ServiceWorkers 和其他技术相结合使用。</p></blockquote></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/simon1uo/notebook/edit/master/docs/101. 🚶🏻 前端巩固基础/40. 📔 JavaScript 其他内容/50. 📦 JavaScript 浏览器存储.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/notebook/tags/?tag=JavaScript%E6%B7%B1%E5%85%A5%E9%83%A8%E5%88%86" title="标签">#JavaScript深入部分</a></div> <div class="last-updated"><span class="prefix">📢 上次更新:</span> <span class="time">2022/09/02, 10:18:16</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notebook/pages/15a7cb/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">🎪 JavaScript Proxy 和 Reflect</div></a> <a href="/notebook/pages/f38565/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">🎣 JavaScript 正则表达式</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
                    ←
                    <a href="/notebook/pages/15a7cb/" class="prev">🎪 JavaScript Proxy 和 Reflect</a></span> <span class="next"><a href="/notebook/pages/f38565/">🎣 JavaScript 正则表达式</a>→
                </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
            Copyright © 2020-2022
            |
            <span>wrote with ❤️ by <a href="https://simon1uo.github.io">Simon</a></br></span>

        theme based on
        <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="theme">Vdoing</a> powered By Vuepress
    </div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
                        跟随系统
                    </li><li class="iconfont icon-rijianmoshi">
                        浅色模式
                    </li><li class="iconfont icon-yejianmoshi">
                        深色模式
                    </li><li class="iconfont icon-yuedu">
                        阅读模式
                    </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
        <script src="/notebook/assets/js/app.54612df9.js" defer></script><script src="/notebook/assets/js/2.f4898154.js" defer></script><script src="/notebook/assets/js/3.c3838318.js" defer></script><script src="/notebook/assets/js/139.f01349ee.js" defer></script>
    </body>
</html>

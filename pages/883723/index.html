<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>🥡 JavaScript 文档和资源加载 | notebook</title>
        <meta name="generator" content="VuePress 1.9.7" />
        <link rel="icon" href="/notebook/favicon.ico">
    <link rel="stylesheet" href="/notebook//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
    <script src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script> <meta name="description" content="a frontend notebook by Simon">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="个人学习笔记,前端学习笔记,前端学习,前端学习资源,前端学习路线,HTML,CSS,JavaScript,Vue,React">
    <meta name="theme-color" content="#204A7A">  <link rel="preload" href="/notebook/assets/css/0.styles.29a47cad.css" as="style"><link rel="preload" href="/notebook/assets/js/app.ca29606a.js" as="script"><link rel="preload" href="/notebook/assets/js/2.f4898154.js" as="script"><link rel="preload" href="/notebook/assets/js/3.c3838318.js" as="script"><link rel="preload" href="/notebook/assets/js/113.cb25939a.js" as="script"> <link rel="stylesheet" href="/notebook/assets/css/0.styles.29a47cad.css">
    </head>
    <body class="theme-mode-light">
        <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/assets/img/logo.png" alt="notebook" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/" class="nav-link">🌏 首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="☕️ 前端笔记" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">☕️ 前端笔记</a> <span class="title" style="display:none;">☕️ 前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">🗺 前端学习路线</a></li><li class="dropdown-item"><h4>分类</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">🚶 前端入门基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">🚶🏻 前端巩固基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">🏃 前端核心框架</a></li><li class="dropdown-subitem"><a href="/notebook/pages/883723/front-end/interview/" class="nav-link">🪞 前端面试题收集</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🚏 索引" class="dropdown-title"><a href="/notebook/archives/" class="link-title">🚏 索引</a> <span class="title" style="display:none;">🚏 索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/archives/" class="nav-link">🗄归档</a></li><li class="dropdown-item"><!----> <a href="/notebook/tags/" class="nav-link">🔖标签</a></li></ul></div></div><div class="nav-item"><a href="/notebook/about/" class="nav-link">🔖 关于</a></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
            🍞 GitHub
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/notebook/" class="nav-link">🌏 首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="☕️ 前端笔记" class="dropdown-title"><a href="/notebook/front-end/" class="link-title">☕️ 前端笔记</a> <span class="title" style="display:none;">☕️ 前端笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/front-end/roadmap/" class="nav-link">🗺 前端学习路线</a></li><li class="dropdown-item"><h4>分类</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/front-end/beginning/" class="nav-link">🚶 前端入门基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/stable/" class="nav-link">🚶🏻 前端巩固基础</a></li><li class="dropdown-subitem"><a href="/notebook/front-end/core-frame/" class="nav-link">🏃 前端核心框架</a></li><li class="dropdown-subitem"><a href="/notebook/pages/883723/front-end/interview/" class="nav-link">🪞 前端面试题收集</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🚏 索引" class="dropdown-title"><a href="/notebook/archives/" class="link-title">🚏 索引</a> <span class="title" style="display:none;">🚏 索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/archives/" class="nav-link">🗄归档</a></li><li class="dropdown-item"><!----> <a href="/notebook/tags/" class="nav-link">🔖标签</a></li></ul></div></div><div class="nav-item"><a href="/notebook/about/" class="nav-link">🔖 关于</a></div> <a href="https://github.com/simon1uo/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
            🍞 GitHub
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🍯 ES6 基本语法</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/notebook/pages/4e50dd/" class="sidebar-link">🌱 node.js 基本使用</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📒 JavaScript 深入对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📕 JavaScript 深入数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📗 JavaScript 深入函数</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📘 JavaScript 原型与继承</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📙 JavaScript 类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> 📓 JavaScript DOM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/pages/0bac3b/" class="sidebar-link">🍕 JavaScript DOM 树</a></li><li><a href="/notebook/pages/cae956/" class="sidebar-link">🍥 JavaScript DOM 操作</a></li><li><a href="/notebook/pages/9992c4/" class="sidebar-link">🥗 JavaScript DOM 样式和类</a></li><li><a href="/notebook/pages/f3541c/" class="sidebar-link">🥘 JavaScript 浏览器事件</a></li><li><a href="/notebook/pages/5fe7c6/" class="sidebar-link">🥫 JavaScript 事件使用示例</a></li><li><a href="/notebook/pages/006f30/" class="sidebar-link">🍩 JavaScript 事件循环</a></li><li><a href="/notebook/pages/2a600b/" class="sidebar-link">🌲 JavaScript DOM与BOM</a></li><li><a href="/notebook/pages/883723/" aria-current="page" class="active sidebar-link">🥡 JavaScript 文档和资源加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notebook/pages/883723/#。页面生命周期" class="sidebar-link">。页面生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#domcontentloaded" class="sidebar-link">DOMContentLoaded</a></li><li class="sidebar-sub-header level4"><a href="/notebook/pages/883723/#脚本" class="sidebar-link">脚本</a></li><li class="sidebar-sub-header level4"><a href="/notebook/pages/883723/#样式" class="sidebar-link">样式</a></li><li class="sidebar-sub-header level4"><a href="/notebook/pages/883723/#浏览器表单自动填充" class="sidebar-link">浏览器表单自动填充</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#window-onload" class="sidebar-link">window.onload</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#window-onunload" class="sidebar-link">window.onunload</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#window-onbeforeunload" class="sidebar-link">window.onbeforeunload</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#readystate" class="sidebar-link">readyState</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#生命周期总结" class="sidebar-link">生命周期总结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/883723/#脚本加载类型-顺序" class="sidebar-link">脚本加载类型 / 顺序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#defer" class="sidebar-link">defer</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#async" class="sidebar-link">async</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#动态脚本" class="sidebar-link">动态脚本</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/883723/#资源加载" class="sidebar-link">资源加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#加载脚本" class="sidebar-link">加载脚本</a></li><li class="sidebar-sub-header level4"><a href="/notebook/pages/883723/#script-onlaod" class="sidebar-link">script.onlaod</a></li><li class="sidebar-sub-header level4"><a href="/notebook/pages/883723/#script-onerror" class="sidebar-link">script.onerror</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/883723/#其他资源加载" class="sidebar-link">其他资源加载</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🍯 JavaScript AJAX 网络请求</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🚇 JavaScript Promise</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 📔 JavaScript 其他内容</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🏃 JavaScript 进阶高级</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> ʦ TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 🚟 axios</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-16f6d530><div class="articleInfo" data-v-16f6d530><ul class="breadcrumbs" data-v-16f6d530><li data-v-16f6d530><a href="/notebook/" title="首页" class="iconfont icon-home router-link-active" data-v-16f6d530></a></li> <li data-v-16f6d530><a href="/notebook/front-end/stable/# 🚶🏻 前端巩固基础" data-v-16f6d530> 🚶🏻 前端巩固基础</a></li><li data-v-16f6d530><a href="/notebook/front-end/stable/# 📓 JavaScript DOM" data-v-16f6d530> 📓 JavaScript DOM</a></li></ul> <div class="info" data-v-16f6d530><div title="作者" class="author iconfont icon-touxiang" data-v-16f6d530><a href="https://github.com/simon1uo" target="_blank" title="作者" class="beLink" data-v-16f6d530>Simon Luo</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-16f6d530><a href="javascript:;" data-v-16f6d530>2022-05-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->🥡 JavaScript 文档和资源加载<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="。页面生命周期"><a href="#。页面生命周期" class="header-anchor">#</a> 。页面生命周期</h2> <p>HTML 页面的生命周期包含三个重要事件：</p> <ul><li><code>DOMContentLoaded</code> ：浏览器已完全加载 HTML，并构建了 DOM 树，但像  <code>&lt;img&gt;</code>  和样式表之类的外部资源可能尚未加载完成。</li> <li><code>load</code> ：浏览器不仅加载完成了 HTML，还加载完成了所有外部资源：图片，样式等。</li> <li><code>beforeunload</code>  /  <code>unload</code> ： 当用户正在离开页面时。</li></ul> <p>每个事件的详细用途：</p> <ul><li><code>DOMContentLoaded</code>  事件：DOM 已经就绪，因此处理程序可以查找 DOM 节点，并初始化接口。</li> <li><code>load</code>  事件： 外部资源已加载完成，样式已被应用，图片大小也已知了。</li> <li><code>beforeunload</code>  事件：用户正在离开，可以检查用户否保存了更改，并询问他是否真的要离开。</li> <li><code>unload</code> ：用户几乎已经离开了，但是仍然可以启动一些操作，例如发送统计数据。</li></ul> <h3 id="domcontentloaded"><a href="#domcontentloaded" class="header-anchor">#</a> <code>DOMContentLoaded</code></h3> <p><code>DOMContentLoaded</code>  事件发生在  <code>document</code>  对象上，必须使用  <code>addEventListener</code>  来捕获它：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>🌰 例子：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'DOM is ready'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 图片目前尚未加载完成（除非已经被缓存），所以图片的大小为 0x0</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Image size: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>img<span class="token punctuation">.</span>offsetWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>img<span class="token punctuation">.</span>offsetHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> ready<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://en.js.cx/clipart/train.gif?speed=1&amp;cache=0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p><code>DOMContentLoaded</code>  处理程序在文档加载完成后触发，所以它可以查看所有元素，包括它下面的  <code>&lt;img&gt;</code>  元素。</p> <p>但是，它不会等待图片加载。因此， <code>alert</code>  显示其大小为零。</p></blockquote> <h4 id="脚本"><a href="#脚本" class="header-anchor">#</a> 脚本</h4> <p>当浏览器处理一个 HTML 文档，并在文档中遇到  <code>&lt;script&gt;</code>  标签时，就会在继续构建 DOM 之前运行它。这是一种防范措施，因为脚本可能想要修改 DOM，甚至对其执行  <code>document.write</code>  操作，所以  <code>DOMContentLoaded</code>  必须等待脚本执行结束。</p> <p>因此， <code>DOMContentLoaded</code>  肯定在下面的这些脚本执行结束之后发生：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;DOM ready!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Library loaded, inline script executed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>所以先显示  <code>Library loaded</code> ，再显示  <code>DOM ready</code> 。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>两个例外：</p> <ul><li>具有  <code>async</code>  特性（attribute）的脚本不会阻塞  <code>DOMContentLoaded</code> ；</li> <li>使用  <code>document.createElement('script')</code>  动态生成并添加到网页的脚本也不会阻塞  <code>DOMContentLoaded</code> 。</li></ul></div> <h4 id="样式"><a href="#样式" class="header-anchor">#</a> 样式</h4> <p>外部样式表不会影响 DOM，因此  <code>DOMContentLoaded</code>  不会等待它们。但是如果样式后面有一个脚本，那么该脚本必须等待样式表加载完成：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 在样式表加载完成之前，脚本都不会执行</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span>marginTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>脚本可能想要获取元素的坐标和其他与样式相关的属性，如上例所示。因此，它必须等待样式加载完成。</p> <p>所以，当  <code>DOMContentLoaded</code>  等待脚本时，它现在也在等待脚本前面的样式。</p></blockquote> <h4 id="浏览器表单自动填充"><a href="#浏览器表单自动填充" class="header-anchor">#</a> 浏览器表单自动填充</h4> <p>🌰 例子：<br>
如果页面有一个带有登录名和密码的表单，并且浏览器记住了这些值，那么在  <code>DOMContentLoaded</code>  上，浏览器会尝试自动填充它们（如果得到了用户允许）。</p> <blockquote><p>如果  <code>DOMContentLoaded</code>  被需要加载很长时间的脚本延迟触发，那么自动填充也会等待。</p> <p>某些网站中，登录名 / 密码字段不会立即自动填充，而是在页面被完全加载前会延迟填充。这实际上是  <code>DOMContentLoaded</code>  事件之前的延迟。</p></blockquote> <h3 id="window-onload"><a href="#window-onload" class="header-anchor">#</a> <code>window.onload</code></h3> <p>当整个页面，包括样式、图片和其他资源被加载完成时，会触发  <code>window</code>  对象上的  <code>load</code>  事件。可以通过  <code>onload</code>  属性获取此事件。</p> <p>🌰 例子：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 也可以用 window.addEventListener('load', (event) =&gt; {</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Page loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 此时图片已经加载完成</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Image size: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>img<span class="token punctuation">.</span>offsetWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>img<span class="token punctuation">.</span>offsetHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://en.js.cx/clipart/train.gif?speed=1&amp;cache=0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>这个例子会正确显示了图片大小，因为  <code>window.onload</code>  会等待所有图片加载完毕。</p></blockquote> <h3 id="window-onunload"><a href="#window-onunload" class="header-anchor">#</a> <code>window.onunload</code></h3> <p>当访问者离开页面时， <code>window</code>  对象上的  <code>unload</code>  事件就会被触发。可以在那里做一些不涉及延迟的操作，例如关闭相关的弹出窗口。</p> <p>特殊情况：发送分析数据：假设我们收集有关页面使用情况的数据：鼠标点击，滚动，被查看的页面区域等。当用户要离开的时候，我们希望通过  <code>unload</code>  事件将数据保存到我们的服务器上。</p> <p>特殊的  <code>navigator.sendBeacon(url, data)</code>  方法可以满足这种需求，它在后台发送数据，转换到另外一个页面不会有延迟：浏览器离开页面，但仍然在执行  <code>sendBeacon</code> 。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> analyticsData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* 带有收集的数据的对象 */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unload&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">&quot;/analytics&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>analyticsData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><ul><li>请求以 POST 方式发送。</li> <li>不仅能发送字符串，还能发送表单以及其他格式的数据。</li> <li>数据大小限制在 64kb。</li></ul></blockquote> <p>当 <code>sendBeacon</code>  请求完成时，浏览器可能已经离开了文档，所以就无法获取服务器响应。</p> <p>还有一个  <code>keep-alive</code>  标志，该标志用于在 <a href="https://zh.javascript.info/fetch" target="_blank" rel="noopener noreferrer">fetch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法中为通用的网络请求执行此类 “离开页面后” 的请求。</p> <p>如果要取消跳转到另一页面的操作，以使用另一个事件  <code>onbeforeunload</code> 。</p> <blockquote><p>, 浏览器内对 unload 内使用 fetch 等 api 发送统计数据的实现并不好，可能有 bug 导致统计数据失准。所以 MDN 里已经不推荐这样做了 <a href="https://disq.us/url?url=https%3A%2F%2Fvolument.com%2Fblog%2Fsendbeacon-is-broken%23comments%3A6NySHKpXCVnkcaJAa_sGI1LZiEc&amp;cuid=5627578" target="_blank" rel="noopener noreferrer">https://volument.com/blog/s...<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="window-onbeforeunload"><a href="#window-onbeforeunload" class="header-anchor">#</a> <code>window.onbeforeunload</code></h3> <p>如果访问者触发了离开页面的导航或试图关闭窗口， <code>beforeunload</code>  处理程序将要求进行更多确认。</p> <p>如果要取消事件，浏览器会询问用户是否确定。</p> <h3 id="readystate"><a href="#readystate" class="header-anchor">#</a> <code>readyState</code></h3> <p>在某些情况下，不确定文档是否已经准备就绪。<strong>如果希望的函数在 DOM 加载完成时执行，无论现在还是以后。</strong></p> <p><code>document.readyState</code>  属性可以为提供当前加载状态的信息。三个可能的值：</p> <ul><li><code>loading</code>  ：文档正在被加载。</li> <li><code>interactive</code>  ：文档被全部读取。</li> <li><code>complete</code>  ：文档被全部读取，并且所有资源（例如图片等）都已加载完成。</li></ul> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token string">'loading'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 仍在加载，等待事件</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> work<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// DOM 已就绪！</span>
  <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>检查  <code>document.readyState</code>  并设置一个处理程序，或在代码准备就绪时立即执行它。</p></blockquote> <p><code>readystatechange</code>  事件，会在状态发生改变时触发，因此可以打印所有这些状态：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当前状态</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 状态改变时打印它</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'readystatechange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><code>readystatechange</code>  事件是跟踪文档加载状态的另一种机制，它很早就存在了。现在则很少被使用。</p></blockquote> <h3 id="生命周期总结"><a href="#生命周期总结" class="header-anchor">#</a> 生命周期总结</h3> <p>页面的生命周期事件：</p> <ul><li><p><code>DOMContentLoaded</code>  事件： DOM 准备就绪时事件就会被触发。在这个阶段，可以将 JavaScript 应用于元素。</p> <ul><li>诸如  <code>&lt;script&gt;...&lt;/script&gt;</code>  或  <code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code>  之类的脚本会阻塞  <code>DOMContentLoaded</code> ，浏览器将等待它们执行结束。</li> <li>图片和其他资源仍然可以继续被加载。</li></ul></li> <li><p><code>window.onload</code>  事件：当页面和所有资源都加载完成时触发。</p></li> <li><p><code>window.beforeunload</code>  事件：在用户想要离开页面时。常用于要取消这个事件，浏览器就会询问我们是否真的要离开（例如，有未保存的更改）。</p></li> <li><p><code>window.unload</code>  事件：处理程序中，只能执行不涉及延迟或询问用户的简单操作。正是由于这个限制，它很少被使用。可以使用  <code>navigator.sendBeacon</code>  来发送网络请求。</p></li></ul> <p>获取当前文档的状态，使用  <code>document.readyState</code> 。可以在  <code>readystatechange</code>  事件中跟踪状态更改：</p> <ul><li><code>loading</code> ：文档正在被加载。</li> <li><code>interactive</code> ：文档已被解析完成，与  <code>DOMContentLoaded</code>  几乎同时发生，但是在  <code>DOMContentLoaded</code>  之前发生。</li> <li><code>complete</code>  ：文档和资源均已加载完成，与  <code>window.onload</code>  几乎同时发生，但是在  <code>window.onload</code>  之前发生。</li></ul> <h2 id="脚本加载类型-顺序"><a href="#脚本加载类型-顺序" class="header-anchor">#</a> 脚本加载类型 / 顺序</h2> <p>在现代的网站中，脚本往往体量很大，需要长事件处理。</p> <p>当浏览器加载 HTML 时遇到  <code>&lt;script&gt;...&lt;/script&gt;</code>  标签，浏览器就不能继续构建 DOM。它必须立刻执行此脚本。对于外部脚本  <code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code>  也是一样的：浏览器必须等脚本下载完，并执行结束，之后才能继续处理剩余的页面。</p> <p>这导致了两个问题：</p> <ul><li><p>** 脚本不能访问它完成加载之前下面的 DOM 元素。** 因此脚本无法给它们添加处理程序等。</p></li> <li><p>如果页面顶部加载了一个大型的脚本，<strong>这会阻塞页面</strong>。在脚本下载和执行结束之前，用户都不能看见页面内容。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>...content before script...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://javascript.info/article/script-async-defer/long.js?speed=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- This isn't visible until the script loads --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>...content after script...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <blockquote><p>解决方法：将脚本放在页面的底部。这样脚本可以访问元素的同时，不会阻塞页面的加载。</p> <p>但是这种解决方案远非完美。例如，浏览器只有在下载了完整的 HTML 文档之后才会注意到该脚本（并且可以开始下载它）。对于长的 HTML 文档来说，这样可能会造成明显的延迟。</p></blockquote> <p><code>&lt;script&gt;</code>  的两个特性可以解决这两个问题： <code>defer</code>  /  <code>async</code></p> <h3 id="defer"><a href="#defer" class="header-anchor">#</a> <code>defer</code></h3> <p>这个特性用于告诉浏览器 <strong>不要等待脚本的加载</strong>。浏览器可以继续处理 DOM，构建 DOM，同时脚本在 「后台下载」，等 DOM 构建完成后，脚本才会执行。</p> <p>🌰 例子：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>...content before script...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;DOM ready after defer!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://javascript.info/article/script-async-defer/long.js?speed=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 立即可见 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>...content after script...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用  <code>defer</code>  的  <code>&lt;script&gt;</code>  ：</p> <ul><li><p>脚本不会阻塞页面的加载；</p></li> <li><p>脚本总是等到 DOM 解析完毕，<strong>但是在  <code>DOMContentedLoaded</code></strong> 事件之前执行。</p></li> <li><p><strong>具有  <code>defer</code>  特性的脚本保持其相对顺序，就像常规脚本一样。</strong></p> <p>例如两个  <code>defer</code>  特性的脚本：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://javascript.info/article/script-async-defer/long.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://javascript.info/article/script-async-defer/small.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>浏览器会扫描脚本，并行下载它们，以此提高性能，因此在下面的实例中，两个脚本是并行下载的，但是  <code>defer</code>  还会确保脚本执行的相对顺序。即使  <code>small.js</code>  先加载完成，它也需要等到  <code>long.js</code>  执行结束才会被执行。</p></blockquote></li></ul> <p><code>defer</code>  需要先加载 JavaScript 库，然后再加载依赖于它的脚本时，这可能会很有用。并且 ⚠️ <strong><code>defer</code>  只能用于外部的脚本。</strong>（如果  <code>&lt;script&gt;</code>  脚本没有  <code>src</code> ，则会忽略  <code>defer</code>  特性。）</p> <h3 id="async"><a href="#async" class="header-anchor">#</a> <code>async</code></h3> <p><code>async</code>  特性与  <code>defer</code>  有些类似。它也能够让脚本不阻塞页面。但是在行为上二者有着重要的区别。</p> <p><code>async</code>  特性意味着<strong>脚本是完全独立的</strong>：</p> <ul><li>浏览器不会因  <code>async</code>  脚本而阻塞。</li> <li>其他脚本不会等待  <code>async</code>  脚本加载完成，同样， <code>async</code>  脚本也不会等待其他脚本。</li> <li><code>DOMContentLoaded</code> <strong>和异步脚本不会彼此等待</strong>：
<ul><li><code>DOMContentLoaded</code>  可能会发生在异步脚本之前（如果异步脚本在页面完成后才加载完成）</li> <li><code>DOMContentLoaded</code>  也可能发生在异步脚本之后（如果异步脚本很短，或者是从 HTTP 缓存中加载的）</li></ul></li></ul> <p>⚠️ <strong><code>async</code>  脚本会在后台加载，在加载就绪时运行；但是 DOM 和其他脚本不会等待它们加载并且 它们也不会等待其他东西；意味着是一个在加载完成时执行的完全独立的脚本</strong>。</p> <p>🌰 例子：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>...content before scripts...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;DOM ready!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">async</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://javascript.info/article/script-async-defer/long.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">async</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://javascript.info/article/script-async-defer/small.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>...content after scripts...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>这个例子中的 外部脚本的引入，不会等待对方的加载，先加载完成的（可能是  <code>small.js</code> ）先执行。并且：</p> <ul><li>页面内容立刻显示出来：加载写有  <code>async</code>  的脚本不会阻塞页面渲染。</li> <li><code>DOMContentLoaded</code>  可能在  <code>async</code>  之前或之后触发，不能保证谁先谁后。</li> <li><strong>异步脚本以加载优先的顺序执行。</strong></li></ul></blockquote> <p>当使用 第三方脚本 集成到页面时，使用 异步脚本加载方式，可以不必等待它们加载就完成 DOM 的加载。与  <code>defer</code>  相同， <code>async</code> <strong>特性仅适用于外部脚本</strong>。</p> <h3 id="动态脚本"><a href="#动态脚本" class="header-anchor">#</a> 动态脚本</h3> <p>这时一种向页面添加脚本的重要方式，可以使用 JavaScript 动态创建一个脚本，并将其附加到文档中。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;/article/script-async-defer/long.js&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>利用  <code>document.createElement</code> ，当脚本被附加到文档  <code>(*)</code>  时，脚本就会立即开始加载。</p></blockquote> <p>在默认的情况下动态脚本的行为是 <strong>异步的</strong>。</p> <ul><li>不会等待任何东西，也会有东西等待它们；</li> <li>先加载完成的脚本先执行（加载优先顺序）。</li></ul> <p>但是如果显式设置  <code>script.async = false</code>  就可以改变这个规则。脚本此时按照  <code>defer</code>  方式，脚本将按照脚本在文档中的顺序执行。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// long.js 先执行，因为代码中设置了 async=false</span>
<span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">&quot;/article/script-async-defer/long.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">&quot;/article/script-async-defer/small.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ul><li><code>defer</code>  一般用于需要整个 DOM 的脚本，和 / 或脚本的相对执行顺序很重要的时候。</li> <li><code>async</code>  一般用于独立脚本，例如计数器或广告，这些脚本的相对执行顺序无关紧要。</li></ul> <h2 id="资源加载"><a href="#资源加载" class="header-anchor">#</a> 资源加载</h2> <p>浏览器允许跟踪外部资源的加载，加载资源相关有两个事件：</p> <ul><li><code>onload</code> ：成功加载；</li> <li><code>onerror</code> ：出现错误。</li></ul> <blockquote><p>外部资源包括，图片、 <code>iframe</code> 、图片。</p></blockquote> <h3 id="加载脚本"><a href="#加载脚本" class="header-anchor">#</a> 加载脚本</h3> <p>对于加载 第三方的脚本，调用其中的函数，可以动态加载：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;my.js&quot;</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>要运行该脚本中的函数，需要等待脚本的加载完成才能运行。</p> <blockquote><p>使用 自定义的脚本，现在一般使用 <a href="/notebook/pages/6edabb/">🪤JavaScript 的模块管理</a>。第三方库依照使用说明导入。</p></blockquote> <h4 id="script-onlaod"><a href="#script-onlaod" class="header-anchor">#</a> <code>script.onlaod</code></h4> <p><code>onlaod</code>  事件，在脚本加载并执行完成时触发。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 可以从任意域（domain），加载任意脚本</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js&quot;</span>
document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>

script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 该脚本创建了一个变量 &quot;_&quot;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> _<span class="token punctuation">.</span><span class="token constant">VERSION</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示库的版本</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>在  <code>onload</code>  中可以使用脚本中的变量，运行函数。</p></blockquote> <h4 id="script-onerror"><a href="#script-onerror" class="header-anchor">#</a> <code>script.onerror</code></h4> <p>当脚本加载期间，出现的  <code>error</code>  会被  <code>onerror</code>  事件跟踪到。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://example.com/404.js&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 没有这个脚本</span>
document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>

script<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Error loading &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error loading https://example.com/404.js</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p><code>onerror</code>  无法获取更多 HTTP error 的详细信息。不能知道是 404 还是 500 或者其他情况。只知道是加载失败了。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>onload</code> / <code>onerror</code>  事件仅跟踪加载本身。在脚本处理和执行期间可能发生的 error <strong>超出了这些事件跟踪的范围</strong>。如果脚本成功加载，则即使脚本中有编程 error，也会触发  <code>onload</code>  事件。如果要跟踪脚本 error，可以使用  <code>window.onerror</code>  全局处理程序。</p></div> <h3 id="其他资源加载"><a href="#其他资源加载" class="header-anchor">#</a> 其他资源加载</h3> <p><code>onload</code>  /  <code>onerror</code>  事件也同样适用于 <strong>其他资源（基本上具有外部  <code>src</code>   的任何资源）的加载</strong>。</p> <p>🌰 例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://js.cx/clipart/train.gif&quot;</span><span class="token punctuation">;</span> 


img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Image loaded, size </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>img<span class="token punctuation">.</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>img<span class="token punctuation">.</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Error occurred while loading image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>注意：</p> <ul><li>大多数资源在被添加到文档中后，便开始加载。但是  <code>&lt;img&gt;</code>  是个例外。它要等到获得 src 才开始加载。</li> <li>对于  <code>&lt;iframe&gt;</code>  来说， <code>iframe</code>  加载完成时会触发  <code>iframe.onload</code>  事件，无论是成功加载还是出现  <code>error</code> 。</li></ul></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/simon1uo/notebook/edit/master/docs/101. 🚶🏻 前端巩固基础/36. 📓 JavaScript DOM/80. 🥡 JavaScript 文档和资源加载.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">📢 上次更新:</span> <span class="time">2022/07/19, 23:55:11</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notebook/pages/2a600b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">🌲 JavaScript DOM与BOM</div></a> <a href="/notebook/pages/e0da75/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">🥢 JavaScript Fetch</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
                    ←
                    <a href="/notebook/pages/2a600b/" class="prev">🌲 JavaScript DOM与BOM</a></span> <span class="next"><a href="/notebook/pages/e0da75/">🥢 JavaScript Fetch</a>→
                </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
            Copyright © 2020-2022
            |
            <span>wrote with ❤️ by <a href="https://simon1uo.github.io">Simon</a></br></span>

        theme based on
        <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="theme">Vdoing</a> powered By Vuepress
    </div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
                        跟随系统
                    </li><li class="iconfont icon-rijianmoshi">
                        浅色模式
                    </li><li class="iconfont icon-yejianmoshi">
                        深色模式
                    </li><li class="iconfont icon-yuedu">
                        阅读模式
                    </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
        <script src="/notebook/assets/js/app.ca29606a.js" defer></script><script src="/notebook/assets/js/2.f4898154.js" defer></script><script src="/notebook/assets/js/3.c3838318.js" defer></script><script src="/notebook/assets/js/113.cb25939a.js" defer></script>
    </body>
</html>

---
title: ğŸ‹ Spring æ•°æ®åº“ç¼–ç¨‹
date: 2022-04-18 14:08:10
permalink: /pages/328e92/
categories: 
  - _pages
  - ğŸ§‹ JavaEE
  - ğŸƒ Spring
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---
åœ¨ Spring ä¸­æ‰€æœ‰çš„å®ä¾‹çœ‹ä½œ beanï¼ŒåŒ…æ‹¬æ•°æ®åº“èµ„æºã€‚ï¼ˆåœ¨ Spring ä¸­çš„å†…ç½® [JdbcTemplate]() ç°åœ¨å¾ˆå°‘ä½¿ç”¨ï¼Œå¸¸ç”¨ä¸ Mybatis æ•´åˆï¼‰



### Spring ä¸ MyBatis æ•´åˆ

ğŸŒ° åŸºäº**é…ç½®æ–‡ä»¶**æ•´åˆä¾‹å­ï¼š

+ åˆ›å»º Maven é¡¹ç›®ï¼Œå¯¼å…¥ä¸‹åˆ—ä¾èµ–ï¼š

```xml
<packaging>jar</packaging>

<dependencies>
    <!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.28</version>
    </dependency>

    <!-- https://mvnrepository.com/artifact/org.springframework/spring-context -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.3.19</version>
    </dependency>

    <!-- https://mvnrepository.com/artifact/org.springframework/spring-jdbc -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.3.19</version>
    </dependency>

    <!-- https://mvnrepository.com/artifact/org.mybatis/mybatis -->
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>3.5.9</version>
    </dependency>

    <!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring -->
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis-spring</artifactId>
        <version>2.0.7</version>
    </dependency>

    <!-- https://mvnrepository.com/artifact/junit/junit -->
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.13.2</version>
        <scope>test</scope>
    </dependency>

</dependencies>
```



+ é…ç½® Spring é…ç½®æ–‡ä»¶ï¼ˆ`applicationContext.xml`ï¼‰ï¼Œè¿›è¡Œæ•°æ®åº“é…ç½®ï¼š

> + æ³¨æ„è¦åŠ å…¥ `context` å‘½åç©ºé—´ã€‚
> + ä½¿ç”¨ `context:property-placeholder` å¼•å…¥å¤–éƒ¨ `jdbc` æ•°æ®åº“é…ç½®æ–‡ä»¶ã€‚

```xml
<context:property-placeholder location="jdbc.properties"/>

<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="${jdbc.driver}"/>
    <property name="url" value="${jdbc.url}"/>
    <property name="username" value="${jdbc.username}"/>
    <property name="password" value="${jdbc.password}"/>
</bean>
```

+ åˆ›å»º `sqlSessionFactory` çš„ beanï¼Œå¯¹æ¯” Mybatis æ—¶æœŸçš„é…ç½®ç®€æ´äº†ä¸å°‘ï¼š

```xml
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
    <property name="dataSource" ref="dataSource"/>
</bean>
```



+ åˆ›å»º `wallet` æŒä¹…åŒ–ç±»ï¼š

```java
public class Wallet {
    private int id;
    private String name;
    private int money;
	
  // ... including getters and setters, toString()
}
```

+ åˆ›å»º `walletDAO` ç±»ä»¥åŠ Mybatis mapper é…ç½®æ–‡ä»¶ï¼š

```java
public interface WalletDAO {
    List<Wallet> findAll();
}
```

```xml
<mapper namespace="com.simon.mapper.WalletDAO">
    <select id="findAll" resultType="com.simon.domain.Wallet">
        SELECT * FROM wallet
    </select>
</mapper>
```

+ åˆ›å»º `walletService` ä»¥åŠå…¶å®ç°ç±» `walletServiceImpl` ï¼š

```java
public interface WalletService {
    void printAll();
}
```

```java
public class WalletServiceImpl implements WalletService {
    private WalletDAO walletDAO;

    public WalletDAO getWalletDAO() {
        return walletDAO;
    }

    public void setWalletDAO(WalletDAO walletDAO) {
        this.walletDAO = walletDAO;
    }

    @Override
    public void printAll() {
        List<Wallet> wallets = walletDAO.findAll();
        System.out.println("å½“å‰è´¦æˆ·ä¿¡æ¯");
        for (Wallet wallet : wallets) {
            System.out.println(wallet);
        }
    }
}
```



+ è¿”å› Spring é…ç½®æ–‡ä»¶ä¸­åˆ›å»º `WalletDAO` å’Œ `WalletService` çš„ beanï¼š

```xml
<bean id="walletDAO" class="org.mybatis.spring.mapper.MapperFactoryBean">
    <property name="mapperInterface" value="com.simon.mapper.WalletDAO"/>
    <property name="sqlSessionFactory" ref="sqlSessionFactory"/>
</bean>
<bean id="walletService" class="com.simon.service.impl.WalletServiceImpl">
    <property name="walletDAO" ref="walletDAO"/>
</bean>
```

> è‡³æ­¤å·²å®Œæˆåœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„ Spring ä¸ MyBatis çš„æ•´åˆé…ç½®ã€‚



+ åˆ›å»ºæµ‹è¯•ç±»ä¸æµ‹è¯•æ–¹æ³•ï¼š

```java
@Test
public void testPrintAll() {
    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
    WalletServiceImpl walletService = context.getBean("walletService", WalletServiceImpl.class);
    walletService.printAll();
}
```



ğŸŒ° **çœŸÂ·å®Œå…¨åŸºäºæ³¨è§£å®ç° Spring ä¸ Mybatisæ•´åˆ**ï¼š

> åœ¨ç½‘ä¸Šæ‰¾äº†è®¸å¤šæ–¹æ³•ï¼Œæœ€åè¿˜æ˜¯å¾—é  xml æ–‡ä»¶è¿›è¡Œ mapper æ‰«æã€‚æœ€åæ‘¸ç´¢å‡ºäº†ä»¥ä¸‹æ­¥éª¤ã€‚

å»¶ç»­ä¸Šè¿°ä¾‹å­çš„ `Wallet` ç›¸å…³é€»è¾‘å¤„ç†ï¼š

+ åˆ›å»º Spring æ³¨è§£é…ç½®ç±» `SpringConfig` ï¼š

```java
@Configuration // Spring é…ç½®ç±»
@ComponentScan(basePackages = "com.simon") // æ‰«æç»„ä»¶
@MapperScan(basePackages = "com.simon") // æ‰«æmapper
@PropertySource(value = {"classpath:jdbc.properties"}) // å¼•å…¥æ•°æ®åº“é…ç½®æ–‡ä»¶
public class SpringConfig {
    @Value("${jdbc.driver}")
    private String driverClassName;
    @Value("${jdbc.url}")
    private String url;
    @Value("${jdbc.username}")
    private String username;
    @Value("${jdbc.password}")
    private String password;

    // é…ç½®dataSource
    @Bean
    public DriverManagerDataSource getDataSource() {
        DriverManagerDataSource dataSource = new DriverManagerDataSource();
        dataSource.setDriverClassName(driverClassName);
        dataSource.setUrl(url);
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        return dataSource;
    }

    // é…ç½® SqlSession
    @Bean
    public SqlSessionFactoryBean getSqlSessionFactory(DriverManagerDataSource dataSource) {
        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();
        sqlSessionFactoryBean.setDataSource(dataSource);
        return sqlSessionFactoryBean;
    }
}
```

> + æ³¨æ„ `@MapperScan` ç”¨äºæ‰«æ mapper çš„æ³¨è§£ã€‚
> + `@Bean`ï¼šé…ç½®å¯¹è±¡åˆ›å»ºï¼Œç­‰ä»·äº `<bean>` æ ‡ç­¾ã€‚å¯ä»¥åœ¨è¢«ä¿®é¥°çš„æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸­ä¼ å…¥å— IoC å®¹å™¨ç®¡ç†çš„ç±»å‹ï¼ŒIoC å®¹å™¨ä¼šè‡ªåŠ¨æ ¹æ®ç±»å‹æ‰¾åˆ°å¯¹åº”å¯¹è±¡å¹¶æ³¨å…¥åˆ°æ­¤æ–¹æ³•ä¸­ã€‚åˆ†åˆ«å¯¹åº”é…ç½®æ–‡ä»¶ä¸­åˆ›å»º `dataSource` å’Œ `sqlSession` çš„ bean å®ä¾‹ã€‚



+ åœ¨ `WalletDAO` ä¸­æŒ‰ç…§ Mybatis æ³¨è§£æ–¹æ³•ç¼–å†™æ˜ å°„ ï¼š

```java
@Repository
public interface WalletDAO {
    @Select("SELECT * FROM wallet")
    List<Wallet> findAll();
}
```



+ åœ¨ `WalletServiceImpl` ä¸­ï¼š

```java
@Service
@Transactional
public class WalletServiceImpl implements WalletService {
    @Autowired
    private WalletDAO walletDAO;

    public WalletDAO getWalletDAO() {
        return walletDAO;
    }

    public void setWalletDAO(WalletDAO walletDAO) {
        this.walletDAO = walletDAO;
    }

    @Override
    public void printAll() {
        List<Wallet> wallets = walletDAO.findAll();
        System.out.println("å½“å‰è´¦æˆ·ä¿¡æ¯");
        for (Wallet wallet : wallets) {
            System.out.println(wallet);
        }
    }
}
```



+ æµ‹è¯•æ–¹æ³•å¦‚ä¸‹ï¼š

```java
public class WalletServiceTest {

    @Test
    public void testPrintAll() {
        ApplicationContext context = new AnnotationConfigApplicationContext(SpringConfig.class);
        WalletServiceImpl walletServiceImpl = context.getBean("walletServiceImpl", WalletServiceImpl.class);
        walletServiceImpl.printAll();
    }
}
```
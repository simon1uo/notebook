---
title:  ğŸœ JavaScript åŸå‹æ–¹æ³•
date: 2022-05-14 14:07:16
permalink: /pages/552ac6/
categories:
  -  ğŸ“š å‰ç«¯ç¬”è®°
  -  ğŸš¶ åŸºç¡€éƒ¨åˆ†
  -  ğŸ“˜ JavaScript åŸå‹ä¸ç»§æ‰¿
tags:
  - 
---
 `__proto__` å·²ç»è¢«è®¤ä¸ºè¿‡æ—¶ä¸”ä¸æ¨èä½¿ç”¨çš„ã€‚åœ¨ JavaScript è§„èŒƒä¸­ï¼Œ**proto** å¿…é¡»ä»…åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹æ‰èƒ½å¾—åˆ°æ”¯æŒã€‚



åœ¨ ç°ä»£ JavaScript ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹çš„ **åŸå‹æ–¹æ³•** æ›¿ä»£ `__proto__` çš„ä½¿ç”¨ï¼š

+ `Object.create(proto, [descriptors])`ï¼šåˆ©ç”¨ç»™å®šçš„ `proto` ä½œä¸º `[[Prototype]]` å’Œå¯é€‰çš„ **å±æ€§æè¿°** åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ã€‚
+ `Object.getPrototypeOf(obj)`ï¼šè·å–å¯¹è±¡ `obj` çš„åŸå‹å±æ€§ `[[Prototype]]`ã€‚
+ `Object.setPrototypeOf(obj, proto)` ï¼šå°†å¯¹è±¡ `obj` çš„ `[[Prototype]]` è®¾ç½®ä¸º `proto`ã€‚



ğŸŒ° ä¾‹å­ï¼š

```js
let animal = {
  eats: true
}

// åˆ›å»ºä»¥ animal ä¸ºåŸå‹çš„å¯¹è±¡
let rabbit = Object.create(animal)

// è·å– rabbit çš„åŸå‹
console.log(Object.getPrototypeOf(rabbit) === animal) // true

// ä¿®æ”¹ rabbit çš„åŸå‹
Object.setPrototypeOf(rabbit, {});
```



ğŸŒ° ä¾‹å­ / ä½¿ç”¨ `Object.create()` å®ç°å¯¹è±¡å…‹éš†ï¼Œé…åˆ è·å–å¯¹è±¡çš„å±æ€§æè¿°ç¬¦ï¼š

```js
let clone = Object.create(Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj));
```

> è¯¥å…‹éš†å¯¹ `obj` å¯¹è±¡è¿›è¡Œå®Œå…¨çœŸæ­£å‡†ç¡®çš„æ‹·è´ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å±æ€§ï¼šæšä¸¾å’Œä¸å¯æšä¸¾çš„ï¼Œæ•°æ®å±æ€§å’Œ setters/getters â€”â€” åŒ…æ‹¬æ‰€æœ‰å†…å®¹ï¼Œå¹¶å¸¦æœ‰æ­£ç¡®çš„ `[[Prototype]]`ã€‚



## æ™®é€šå¯¹è±¡ Plain Object

 `__proto__` çš„ä½¿ç”¨å¯èƒ½ä¼šå¸¦æ¥é—®é¢˜ï¼š

ğŸŒ° ä¾‹å­ï¼š

```js
let obj = {};

let key = prompt("What's the key?", "__proto__");
obj[key] = "some value";

console.log(obj[key]); // [object Object]
```

> è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå½“å¯¹è±¡å­˜å‚¨ `__proto__` ä½œä¸ºé”®æ—¶çš„å±æ€§æ—¶ï¼Œè¿™æ—¶èµ‹å€¼å°±ä¼šè¢«å¿½ç•¥ã€‚ï¼ˆ`__proto__` å±æ€§å¿…é¡»æ˜¯å¯¹è±¡æˆ–è€… `null`ã€‚å­—ç¬¦ä¸²ä¸èƒ½æˆä¸º prototypeã€‚ï¼‰å°½ç®¡å¹¶ä¸æ˜¯çœŸçš„æƒ³è¦æ„å›¾å‘ `__proto__` èµ‹å€¼ï¼Œä½†æ˜¯é”®åä¸º `__proto__`çš„é”®å€¼å¯¹æ²¡æœ‰è¢«æ­£ç¡®å­˜å‚¨ã€‚
>
> è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„æ¼æ´ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¹å¯¹è±¡è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œ**ç„¶ååŸå‹å¯èƒ½å°±è¢«æ›´æ”¹äº†**ã€‚ç»“æœï¼Œå¯èƒ½ä¼šå¯¼è‡´å®Œå…¨æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚å½“å¼€å‘è€…ä¸è€ƒè™‘è¿™ä¸ªæƒ…å†µï¼Œè®©è¿™ç±» bug å¾ˆéš¾è¢«å‘ç°ï¼Œç”šè‡³å˜æˆæ¼æ´ï¼Œå°¤å…¶æ˜¯åœ¨ JavaScript è¢«ç”¨åœ¨æœåŠ¡ç«¯çš„æ—¶å€™ã€‚
>
> å³ä½¿å¯¹åœ¨é»˜è®¤æƒ…å†µä¸‹ä¸ºå‡½æ•°çš„ `toString` ä»¥åŠå…¶ä»–å†…å»ºæ–¹æ³•æ‰§è¡Œèµ‹å€¼æ“ä½œï¼Œä¹Ÿä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚

è¦é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ Map ä»£æ›¿æ™®é€šå¯¹è±¡è¿›è¡Œå­˜å‚¨ã€‚



æƒ³è¦å°†ä¸€ä¸ªå¯¹è±¡ç”¨ä½œå…³è”æ•°ç»„ï¼Œå¹¶ä¸”æ‘†è„±æ­¤ç±»é—®é¢˜ï¼Œä½¿ç”¨ `Object.create(null)` åˆ›å»ºäº†ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ²¡æœ‰åŸå‹ï¼Œæ‰€ä»¥ä½¿ç”¨ `__proto__` ä½œä¸ºé”®æ²¡æœ‰é—®é¢˜ ï¼ˆ`[[Prototype]]` æ˜¯ `null`ï¼‰ï¼š

```js
let obj = Object.create(null);

let key = prompt("What's the key?", "__proto__");
obj[key] = "some value";

console.log(obj[key]) // "some value"
```



ä½¿ç”¨ `Object.create(null)` åˆ›å»ºçš„å¯¹è±¡è¢«ç§°ä¸º ã€Œvery plainã€ æˆ– ã€Œpure dictionaryã€ å¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬ç”šè‡³æ¯”é€šå¸¸çš„æ™®é€šå¯¹è±¡ï¼ˆplain objectï¼‰`{...}`è¿˜è¦ç®€å•ã€‚



ç¼ºç‚¹æ˜¯è¿™æ ·çš„å¯¹è±¡æ²¡æœ‰ä»»ä½•å†…å»ºçš„å¯¹è±¡çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `toString`ï¼š

```js
let obj = Object.create(null)
console.log(obj)
```

ä½†æ˜¯ å¯¹äºä¸å¯¹è±¡ç›¸å…³çš„æ–¹æ³•ï¼ˆ`Object.xxx(...)`ï¼‰ä»ç„¶å¯ç”¨ï¼Œå®ƒä»¬ä¸åœ¨åŸå‹ä¸­ï¼š
```js
let chineseDictionary = Object.create(null);
chineseDictionary.hello = "ä½ å¥½";
chineseDictionary.bye = "å†è§";

console.log(Object.keys(chineseDictionary))
```





## æ€»ç»“

ç°ä»£ JavaScript ä¸­ç›´æ¥è®¿é—®åŸå‹çš„æ–¹æ³•ï¼š

+ `Object.create(proto, [descriptors])`ï¼šåˆ©ç”¨ç»™å®šçš„ `proto` ä½œä¸º `[[Prototype]]` å’Œå¯é€‰çš„ **å±æ€§æè¿°** åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ã€‚
+ `Object.getPrototypeOf(obj)`ï¼šè·å–å¯¹è±¡ `obj` çš„åŸå‹å±æ€§ `[[Prototype]]`ã€‚
+ `Object.setPrototypeOf(obj, proto)` ï¼šå°†å¯¹è±¡ `obj` çš„ `[[Prototype]]` è®¾ç½®ä¸º `proto`ã€‚



æ›´å¤šæ–¹æ³•ï¼š

+ `Object.keys(obj)` / `Object.values(obj)` / `Object.entries` ï¼šè¿”å›ä¸€ä¸ªå¯æšä¸¾çš„ç”± **å¯¹è±¡** è‡ªèº«çš„å­—ç¬¦ä¸²å±æ€§å/å€¼/é”®å€¼å¯¹ç»„æˆçš„æ•°ç»„ã€‚
+ `Object.getOwnPropertySymbols(obj)`ï¼šè¿”å›å¯¹è±¡æ‰€æœ‰çš„ symbol ç±»å‹çš„é”®ç»„æˆçš„æ•°ç»„ã€‚
+ `Object.getOwnPropertyNames(obk)`ï¼šè¿”å›ä¸€ä¸ªç”±è‡ªèº«çš„æ‰€æœ‰å­—ç¬¦ä¸²é”®ç»„æˆçš„æ•°ç»„ã€‚
+ `Reflect.ownKeys`ï¼šè¿”å›ä¸€ä¸ªç”±è‡ªèº«æ‰€æœ‰é”®ç»„æˆçš„æ•°ç»„ã€‚
+ `obj.hasOwnProperty(key)`ï¼šå¦‚æœ `obj` æ‹¥æœ‰åä¸º `key` çš„è‡ªèº«çš„å±æ€§ï¼ˆéç»§æ‰¿è€Œæ¥çš„ï¼‰ï¼Œåˆ™è¿”å› `true`ã€‚
+ æ‰€æœ‰è¿”å›å¯¹è±¡å±æ€§çš„æ–¹æ³•ï¼ˆå¦‚ `Object.keys` åŠå…¶ä»–ï¼‰ï¼Œ éƒ½è¿”å›ã€Œè‡ªèº«ã€çš„å±æ€§ã€‚å¦‚æœæƒ³ç»§æ‰¿å®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `for...in`ã€‚



## å®ä¾‹

### ä¸ºå¯¹è±¡æ·»åŠ ä¸å¯æšä¸¾çš„æ–¹æ³•

> ä¸ºè¯¥å¯¹è±¡æ·»åŠ  `dictionary.toString()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åº”è¯¥è¿”å›ä»¥é€—å·åˆ†éš”çš„æ‰€æœ‰é”®çš„åˆ—è¡¨ã€‚å¹¶ä¸” `toString` æ–¹æ³•ä¸åº”è¯¥åœ¨ä½¿ç”¨ `for...in` å¾ªç¯éå†æ•°ç»„çš„æ—¶å€™æ˜¾ç°å‡ºæ¥ã€‚
>
> ```js
> let dictionary = Object.create(null);
> 
> dictionary.apple = "Apple";
> dictionary.__proto__ = "test";
> 
> for(let key in dictionary) {
>   alert(key); // "apple", then "__proto__"
> }
> 
> console.log(dictionary)
> ```

::: details

```js
let dictionary = Object.create(null, {
  toString: {
    value() {
      return Object.keys(this).join()
    }
  }
})
```

ä¸ºäº†ä½¿ `toString` ä¸å¯æšä¸¾ï¼Œä½¿ç”¨ä¸€ä¸ª **å±æ€§æè¿°å™¨** æ¥å®šä¹‰å®ƒã€‚`Object.create` è¯­æ³•å…è®¸ä¸ºä¸€ä¸ªå¯¹è±¡æä¾›å±æ€§æè¿°å™¨ä½œä¸º **ç¬¬äºŒå‚æ•°**ã€‚å½“ä½¿ç”¨æè¿°å™¨åˆ›å»ºä¸€ä¸ªå±æ€§ï¼Œå®ƒçš„æ ‡è¯†é»˜è®¤æ˜¯ `false`ã€‚å› æ­¤åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œ`dictonary.toString` æ˜¯ä¸å¯æšä¸¾çš„ã€‚



æˆ–è€…ä½¿ç”¨ `Object.defineProperties`ï¼š

```js
Object.defineProperties(dictionary, "toString", {
  value: function() {
    return Object.keys(this).join()
  },
  enumerable: false
})
```



:::



### è°ƒç”¨æ–¹æ³•çš„å·®å¼‚

> åˆ›å»ºä¸€ä¸ªæ–°çš„ `rabbit` å¯¹è±¡ï¼š
>
> ```javascript
> function Rabbit(name) {
>   this.name = name;
> }
> Rabbit.prototype.sayHi = function() {
>   alert(this.name);
> };
> 
> let rabbit = new Rabbit("Rabbit");
> ```
>
> åˆ†æï¼š
> ```js
> rabbit.sayHi();
> Rabbit.prototype.sayHi();
> Object.getPrototypeOf(rabbit).sayHi();
> rabbit.__proto__.sayHi();
> ```

::: details

```js
rabbit.sayHi();                        // Rabbit
Rabbit.prototype.sayHi();              // undefined
Object.getPrototypeOf(rabbit).sayHi(); // undefined
rabbit.__proto__.sayHi();              // undefined
```

`this` æŒ‡å‘é—®é¢˜ã€‚

æ‰€ä»¥ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªè°ƒç”¨æ˜¾ç¤º `Rabbit`ï¼Œå…¶ä»–çš„éƒ½æ˜¾ç¤ºçš„æ˜¯ `undefined`ã€‚

:::


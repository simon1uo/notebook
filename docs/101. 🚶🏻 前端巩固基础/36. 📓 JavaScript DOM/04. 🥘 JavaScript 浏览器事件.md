---
title: ğŸ¥˜ JavaScript æµè§ˆå™¨äº‹ä»¶
date: 2022-05-27 22:09:56
permalink: /pages/9849d9/
categories:
  -  ğŸ“š å‰ç«¯ç¬”è®°
  -  ğŸš¶ åŸºç¡€éƒ¨åˆ†
  -  ğŸ““ JavaScript DOM
tags:
  - 
---



## æµè§ˆå™¨äº‹ä»¶ç®€ä»‹

DOM äº‹ä»¶æ˜¯åœ¨æŸä¸ªæ—¶åˆ»è§¦å‘çš„ä¿¡å·ã€‚

**å¸¸è§çš„äº‹ä»¶åˆ—è¡¨**ï¼š

+ **é¼ æ ‡äº‹ä»¶**ï¼š
  + `click` ï¼šé¼ æ ‡ç‚¹å‡»ä¸€ä¸ªå…ƒç´ æ—¶ï¼ˆæˆ–è€…è§¦æ‘¸å±ç‚¹å‡»å…ƒç´ ï¼‰ã€‚
  + `contextmenu` ï¼šå½“é¼ æ ‡å³é”®ç‚¹å‡»ä¸€ä¸ªå…ƒç´ æ—¶ã€‚
  + `mouseover` / `mouseout`ï¼š å½“é¼ æ ‡æŒ‡é’ˆç§»å…¥/ç¦»å¼€ä¸€ä¸ªå…ƒç´ æ—¶ã€‚
  + `mousedown` / `mouseup`ï¼šå½“åœ¨å…ƒç´ ä¸ŠæŒ‰ä¸‹/é‡Šæ”¾é¼ æ ‡æŒ‰é’®æ—¶ã€‚
  + `mousemove`ï¼šå½“é¼ æ ‡ç§»åŠ¨æ—¶ã€‚

+ **é”®ç›˜äº‹ä»¶**ï¼š
  + `keydown` å’Œ `keyup` ï¼šå½“æŒ‰ä¸‹å’Œæ¾å¼€ä¸€ä¸ªæŒ‰é”®æ—¶ã€‚

+ è¡¨å•äº‹ä»¶ï¼š
  + `submit` ï¼šå½“è®¿æäº¤äº†ä¸€ä¸ª `<form>` æ—¶ã€‚
  + `focus` ï¼šå½“è®¿é—®è€…èšç„¦äºä¸€ä¸ªè¡¨å•å…ƒç´ æ—¶ï¼Œä¾‹å¦‚èšç„¦äºä¸€ä¸ª `<input>`ã€‚
+ æ–‡æ¡£äº‹ä»¶ï¼š
  + `DOMContentLoaded`ï¼šå½“ HTML çš„åŠ è½½å’Œå¤„ç†å‡å®Œæˆï¼ŒDOM è¢«å®Œå…¨æ„å»ºå®Œæˆæ—¶ã€‚
+ CSS äº‹ä»¶ï¼š
  + `transitionend`ï¼šå½“ä¸€ä¸ª CSS åŠ¨ç”»å®Œæˆæ—¶ã€‚



## äº‹ä»¶å¤„ç†

è¦å¯¹äº‹ä»¶å“åº”ï¼Œå¯ä»¥åˆ†é…ä¸€ä¸ªå¤„ç†äº‹ä»¶çš„ç¨‹åºï¼š**ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶è¿è¡Œçš„å‡½æ•°**ã€‚

### å¯¹äº HTML ç‰¹æ€§

ğŸŒ° ä¾‹å­ / ç‚¹å‡»æŒ‰é’®äº‹ä»¶ï¼š
```js
<input value="Click me" onclick="alert('Click!')" type="button">
```



ğŸŒ° ä¾‹å­ / äº‹ä»¶å¤„ç†å‡½æ•°ï¼š
```html
<script>
  function countRabbits() {
    for(let i=1; i<=3; i++) {
      alert("Rabbit number " + i);
    }
  }
</script>

<input type="button" onclick="countRabbits()" value="Count rabbits!">
```



ç”±äº HTML ä¸­æ ‡ç­¾ç‰¹æ€§ **å¤§å°å†™ä¸æ•æ„Ÿ**ï¼Œæ‰€ä»¥äº‹ä»¶ç‰¹æ€§å‘½åå¯ä»¥éšæ„ï¼Œä½†æ˜¯ä¸€èˆ¬å°å†™ï¼Œä¾‹å¦‚ `onclick`ã€‚

### å¯¹äº DOM å±æ€§

ä½¿ç”¨ DOM å±æ€§  `on<event>` åˆ†é…äº‹ä»¶å¤„ç†ç¨‹åºã€‚

ğŸŒ° ä¾‹å­ï¼š
```html
<input id="elem" type="button" value="Click me">
<script>
  let elem = document.querySelector("#elem")
  elem.onclick = function() {
    alert('Thank you');
  };
</script>
```

> å¦‚æœä¸€ä¸ªå¤„ç†ç¨‹åºæ˜¯é€šè¿‡ HTML ç‰¹æ€§åˆ†é…çš„ï¼Œé‚£ä¹ˆéšåæµè§ˆå™¨è¯»å–å®ƒï¼Œå¹¶ä»ç‰¹æ€§çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œå¹¶å°†è¿™ä¸ªå‡½æ•°å†™å…¥ DOM å±æ€§ã€‚

::: warning

æ³¨æ„ **DOM å±æ€§æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚**

:::

åˆå§‹åŒ–çš„é¡ºåºï¼š

ğŸŒ° ä¾‹å­ï¼š

```html
<input type="button" id="elem" onclick="alert('Before')" value="Click me">
<script>
  elem.onclick = function() { // è¦†ç›–äº†ç°æœ‰çš„å¤„ç†ç¨‹åº
    alert('After'); // åªä¼šæ˜¾ç¤ºæ­¤å†…å®¹
  };
</script>
```

> è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ JavaScript æ·»åŠ äº†ä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œè¦†ç›–äº†ç°æœ‰çš„å¤„ç†ç¨‹åºã€‚

æ‰€ä»¥å¦‚æœè¦æº¢å‡ºè¿™ä¸ªå¤„ç†ç¨‹åºï¼Œèµ‹å€¼ `elem.onclick = null`ã€‚



### å…ƒç´  `this`

å¤„ç†ç¨‹åºä¸­çš„ `this` çš„å€¼æ˜¯å¯¹åº”çš„å…ƒç´ ã€‚å°±æ˜¯å¤„ç†ç¨‹åºæ‰€åœ¨çš„é‚£ä¸ªå…ƒç´ ã€‚

ğŸŒ° ä¾‹å­ï¼š
```html
<button onclick="alert(this.innerHTML)">Click me</button>
```

::: demo[vanilla]

```html
<button onclick="alert(this.innerHTML)">Click me</button>
```

:::



### æ³¨æ„é—®é¢˜

+ åœ¨è„šæœ¬ä¸­ï¼Œä½¿ç”¨ç°å­˜çš„å‡½æ•°ä½œä¸ºäº‹ä»¶çš„å¤„ç†ç¨‹åºæ—¶ï¼Œèµ‹å€¼æ—¶åº”è¯¥ä½¿ç”¨ å‡½æ•°åä¸å¸¦ `()` çš„å½¢å¼ã€‚

  ğŸŒ° ä¾‹å­ï¼š
  ```js
  // æ­£ç¡®
  button.onclick = sayThanks;
  
  // é”™è¯¯
  button.onclick = sayThanks();
  ```

  > å¦‚æœæ·»åŠ äº† `()`ï¼Œé‚£ä¹ˆå°±å˜æˆäº† å‡½æ•°çš„è°ƒç”¨ï¼Œèµ‹å€¼çš„æ˜¯ **å‡½æ•°è¿è¡Œä¹‹åçš„ç»“æœï¼ˆæ²¡æœ‰è¿”å›å€¼åˆ™ä¸º `undefined` ï¼‰**ï¼Œå¹¶æ²¡æœ‰èµ‹å€¼ä»»ä½•çš„äº‹ä»¶å¤„ç† `handler`ã€‚



+ åœ¨ HTML ç‰¹æ€§ä¸­ï¼Œ**åˆ†é…äº‹ä»¶å¤„ç†ç¨‹åºéœ€è¦åŠ  `()`**ã€‚

  ğŸŒ° ä¾‹å­ï¼š

  ```html
  <input type="button" id="button" onclick="sayThanks()">
  ```

  > å› ä¸ºç»™ç‰¹æ€§èµ‹å€¼ï¼Œç›¸å½“äºç»™ å±æ€§èµ‹å€¼ï¼š
  >
  > ```js
  > button.onclick = function() {
  >   sayThanks(); // <-- ç‰¹æ€§ï¼ˆattributeï¼‰ä¸­çš„å†…å®¹å˜åˆ°äº†è¿™é‡Œ
  > };
  > ```
  >
  > æ‰€ä»¥è¿™é‡Œéœ€è¦ äº‹ä»¶å¤„ç†ç¨‹åºçš„æ‰§è¡Œã€‚



+ ä¸è¦å¯¹å¤„ç†ç¨‹åºä½¿ç”¨ `setAttribute`ï¼š

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  document.body.setAttribute('onclick', function() { alert(1) }); // æ— æ•ˆ
  ```



### äº‹ä»¶ç›‘å¬ `addEventListener`

è¦ä¸ºäº‹ä»¶ **åˆ†é…å¤šä¸ªå¤„ç†ç¨‹åºæ—¶**ï¼Œä½¿ç”¨ `addEventListener` å’Œ `removeEventListener` ç®¡ç†å¤„ç†ç¨‹åºã€‚

+ å¯¹å…ƒç´ æ·»åŠ å¤„ç†ç¨‹åºï¼š

  ```js
  element.addEventListener(event, handler[, options]);
  ```

  + `event`ï¼šäº‹ä»¶åç§°ã€‚ï¼ˆä¾‹å¦‚ `click` ï¼‰
  + `handler`ï¼šå¤„ç†ç¨‹åºã€‚
  + `options`ï¼šé™„åŠ å¯é€‰å¯¹è±¡ï¼š
    + `once`ï¼šå¦‚æœä¸º `true`ï¼Œé‚£ä¹ˆä¼šåœ¨è¢«è§¦å‘åè‡ªåŠ¨åˆ é™¤ç›‘å¬å™¨ã€‚**ä¸€æ¬¡æ€§äº‹ä»¶å¤„ç†**ã€‚
    + `capture`ï¼šäº‹ä»¶å¤„ç†çš„é˜¶æ®µ
    + `passive`ï¼šå¦‚æœä¸º `true`ï¼Œé‚£ä¹ˆå¤„ç†ç¨‹åºå°†ä¸ä¼šè°ƒç”¨ `preventDefault()`ï¼ˆæµè§ˆå™¨é»˜è®¤è¡Œä¸ºï¼‰ã€‚

+ å¯¹å…ƒç´ ç§»é™¤å¤„ç†ç¨‹åºï¼š

  ```js
  element.removeEventListener(event, handler[, options]);
  ```

  > ç§»é™¤çš„ç¨‹åºå¿…é¡»ç›¸åŒã€‚æ‰€ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚

+ å¯¹å…ƒç´ æ·»åŠ å¤šä¸ªå¤„ç†ç¨‹åºï¼š
  å¤šæ¬¡è°ƒç”¨ `addEventListener`:

  ```html
  <input id="elem" type="button" value="Click me"/>
  
  <script>
    function handler1() {
      alert('Thanks!');
    };
  
    function handler2() {
      alert('Thanks again!');
    }
  
    elem.onclick = () => alert("Hello");
    elem.addEventListener("click", handler1); // Thanks!
    elem.addEventListener("click", handler2); // Thanks again!
  </script>
  ```

  > å¯ä»¥ **åŒæ—¶** ä½¿ç”¨ DOM å±æ€§å’Œ `addEventListener` æ¥è®¾ç½®å¤„ç†ç¨‹åºã€‚é€šå¸¸æˆ‘ä»¬åªä½¿ç”¨å…¶ä¸­ä¸€ç§æ–¹å¼ã€‚

  

> å¯¹äºæŸäº›äº‹ä»¶åªèƒ½ä½¿ç”¨ `addEventListener` æ·»åŠ å¤„ç†ç¨‹åºï¼š
>
> ğŸŒ° ä¾‹å­ / `DOMContentLoaded` äº‹ä»¶ï¼Œè¯¥äº‹ä»¶åœ¨æ–‡æ¡£åŠ è½½å®Œæˆå¹¶ä¸” DOM æ„å»ºå®Œæˆæ—¶è§¦å‘ã€‚ï¼š
>
> ```js
> document.addEventListener("DOMContentLoaded", function() {
>   alert("DOM built");
> });
> ```



## äº‹ä»¶å¯¹è±¡

å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæµè§ˆå™¨ä¼šåˆ›å»ºä¸€ä¸ª **`event` å¯¹è±¡**ï¼Œå°†è¯¦ç»†ä¿¡æ¯æ”¾å…¥å…¶ä¸­ï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¤„ç†ç¨‹åºã€‚



ğŸŒ° ä¾‹å­ / ä» `event` å¯¹è±¡è·å–é¼ æ ‡æŒ‡é’ˆçš„åæ ‡ï¼š

```html
<input type="button" value="Click me" id="elem">
<script>
  elem.onclick = function(event) {
    // æ˜¾ç¤ºäº‹ä»¶ç±»å‹ã€å…ƒç´ å’Œç‚¹å‡»çš„åæ ‡
    alert(event.type + " at " + event.currentTarget);
    alert("Coordinates: " + event.clientX + ":" + event.clientY);
  };
</script>
```



äº‹ä»¶å¯¹è±¡çš„ä¸€èˆ¬å±æ€§ï¼š

+ `event.type`ï¼š äº‹ä»¶çš„ç±»å‹ã€‚
+ `event.currentTarget`ï¼šå¤„ç†äº‹ä»¶çš„å…ƒç´ ã€‚ä¸ `this` ç›¸åŒï¼Œé™¤éå¤„ç†ç¨‹åºæ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œæˆ–è€…å®ƒçš„ `this` è¢«ç»‘å®šåˆ°äº†å…¶ä»–ä¸œè¥¿ä¸Šï¼Œä¹‹åå¯ä»¥ä» `event.currentTarget` è·å–å…ƒç´ äº†ã€‚
+ `event.clientX` / `event.clientY` ï¼šæŒ‡é’ˆäº‹ä»¶çš„æŒ‡é’ˆçš„çª—å£ç›¸å¯¹åæ ‡ã€‚



## å¯¹è±¡å¤„ç†ç¨‹åº

å¤„ç†äº‹ä»¶çš„ç¨‹åºé™¤äº†å¯ä»¥åˆ†é…å‡½æ•°ï¼Œè¿˜å¯ä»¥å°†ä¸€ä¸ª **å¯¹è±¡** åˆ†é…ä¸ºäº‹ä»¶å¤„ç†ç¨‹åºã€‚å›è°ƒç”¨å¯¹è±¡ä¸­çš„ `handleEvent` æ–¹æ³•ã€‚

ğŸŒ° ä¾‹å­ï¼š

```html
<button id="elem">Click me</button>

<script>
  let obj = {
    handleEvent(event) {
      alert(event.type + " at " + event.currentTarget);
    }
  };

  elem.addEventListener('click', obj);
</script>
```



ğŸŒ° ä¾‹å­ / ä½¿ç”¨ä¸€ä¸ªç±»ï¼š
```html
<button id="elem">Click me</button>

<script>
  class Menu {
    handleEvent(event) {
      switch(event.type) {
        case 'mousedown':
          elem.innerHTML = "Mouse button pressed";
          break;
        case 'mouseup':
          elem.innerHTML += "...and released.";
          break;
      }
    }
  }

  let menu = new Menu();
  elem.addEventListener('mousedown', menu);
  elem.addEventListener('mouseup', menu);
</script>
```



ğŸŒ° ä¾‹å­ / `handleEvent` è°ƒç”¨å…¶ä»–ç‰¹å®šäºäº‹ä»¶çš„æ–¹æ³•ï¼š 

```html
<button id="elem">Click me</button>

<script>
  class Menu {
    handleEvent(event) {
      // mousedown -> onMousedown
      let method = 'on' + event.type[0].toUpperCase() + event.type.slice(1);
      this[method](event);
    }

    onMousedown() {
      elem.innerHTML = "Mouse button pressed";
    }

    onMouseup() {
      elem.innerHTML += "...and released.";
    }
  }

  let menu = new Menu();
  elem.addEventListener('mousedown', menu);
  elem.addEventListener('mouseup', menu);
</script>

```

> å°†äº‹ä»¶å¤„ç†ç¨‹åºæ˜ç¡®åœ°åˆ†ç¦»äº†å‡ºæ¥ï¼Œè¿™æ ·æ›´å®¹æ˜“è¿›è¡Œä»£ç ç¼–å†™å’Œåç»­ç»´æŠ¤ã€‚





## å†’æ³¡

 ğŸŒ° ä¾‹å­ / å¼•å…¥ï¼š

```html
<div onclick="alert('The handler!')">
  <em>If you click on <code>EM</code>, the handler on <code>DIV</code> runs.</em>
</div>
```

::: demo [vanilla]

```html
<html>
  <div onclick="alert('The handler!')">
  <em>If you click on <code>EM</code>, the handler on <code>DIV</code> runs.</em>
  </div>
</html>
```

:::

> äº‹ä»¶å¤„ç†ç¨‹åºåˆ†é…ç»™æ ‡ç­¾ `<div>`ã€‚ä½†æ˜¯ç‚¹å‡»å…¶ä¸­åµŒå¥—çš„æ ‡ç­¾ï¼ˆ`<em>` æˆ– `<code>`ï¼‰ éƒ½ä¼šè§¦å‘è¯¥äº‹ä»¶å¤„ç†ç¨‹åºã€‚



å†’æ³¡çš„åŸç†ï¼ˆBubblingï¼‰ï¼šå½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œå®ƒä¼šé¦–å…ˆè¿è¡Œåœ¨è¯¥å…ƒç´ ä¸Šçš„å¤„ç†ç¨‹åºï¼Œç„¶åè¿è¡Œå…¶çˆ¶å…ƒç´ ä¸Šçš„å¤„ç†ç¨‹åºï¼Œç„¶åä¸€ç›´å‘ä¸Šåˆ°å…¶ä»–ç¥–å…ˆä¸Šçš„å¤„ç†ç¨‹åºã€‚

ğŸŒ° ä¾‹å­ï¼š

::: demo[vanilla]

```html
<style>
  #example * {
    margin: 10px;
    border: 1px solid blue;
  }
</style>
<html>
  <form id="example" onclick="alert('form')"> FORM
    <div onclick="alert('div')">DIV
      <p onclick="alert('p')">P</p>
    </div>
  </form>
</html>
```

:::

> ç‚¹å‡»å†…éƒ¨çš„ `<p>` ä¼šé¦–å…ˆè¿è¡Œ `onclick`ï¼š
>
> 1. åœ¨è¯¥ `<p>` ä¸Šçš„ã€‚
> 2. ç„¶åæ˜¯å¤–éƒ¨ `<div>` ä¸Šçš„ã€‚
> 3. ç„¶åæ˜¯å¤–éƒ¨ `<form>` ä¸Šçš„ã€‚
> 4. ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€åçš„ `document` å¯¹è±¡ã€‚
>
> è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å†’æ³¡ã€‚



**å‡ ä¹æ‰€æœ‰äº‹ä»¶éƒ½ä¼šå†’æ³¡ã€‚**ä¾‹å¤–ï¼š`focus` äº‹ä»¶ä¸ä¼šå†’æ³¡ã€‚



### ç›®æ ‡å…ƒç´  `event.target`

çˆ¶å…ƒç´ ä¸Šçš„å¤„ç†ç¨‹åºå§‹ç»ˆå¯ä»¥è·å–äº‹ä»¶å®é™…å‘ç”Ÿä½ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚**å¼•å‘äº‹ä»¶çš„é‚£ä¸ªåµŒå¥—å±‚çº§æœ€æ·±çš„å…ƒç´ è¢«ç§°ä¸ºç›®æ ‡å…ƒç´ ** ï¼Œé€šè¿‡ `event.target` è®¿é—®ã€‚

`this` ä¸ `event.target` çš„åŒºåˆ«ï¼š

+ `event.target`ï¼šå¼•å‘äº‹ä»¶çš„ç›®æ ‡å…ƒç´ ã€‚å†’æ³¡è¿‡ç¨‹ä¸ä¼šå˜åŒ–ã€‚
+ `this`ï¼š**å½“å‰å…ƒç´ **ã€‚éšç€å†’æ³¡è¿‡ç¨‹ï¼Œæ˜¯å½“å‰æ­£åœ¨è¿è¡Œçš„å¤„ç†ç¨‹åºçš„å…ƒç´ ã€‚



ğŸŒ° ä¾‹å­ï¼š

::: demo [vanilla] 

```html
<style>
  #example2 {
  background-color: green;
  position: relative;
  width: 150px;
  height: 150px;
  text-align: center;
  cursor: pointer;
}

#example2 div {
  background-color: blue;
  position: absolute;
  top: 25px;
  left: 25px;
  width: 100px;
  height: 100px;
}

#example2 p {
  background-color: red;
  position: absolute;
  top: 25px;
  left: 25px;
  width: 50px;
  height: 50px;
  line-height: 50px;
  margin: 0;
}
</style>
<html>
  <body>
  A click shows both <code>event.target</code> and <code>this</code> to compare:

  <form id="example2">FORM
    <div>DIV
      <p>P</p>
    </div>
  </form>

</body>
</html>
<script>
example2.onclick = function(event) {
  event.target.style.backgroundColor = 'yellow';

  // chrome needs some time to paint yellow
  setTimeout(() => {
    alert("target = " + event.target.tagName + ", this=" + this.tagName);
    event.target.style.backgroundColor = ''
  }, 0);
};
</script>
```

:::

> è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¤„ç†ç¨‹åº `form.onclick`ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ•è·è¡¨å•å†…çš„æ‰€æœ‰ç‚¹å‡»ã€‚æ‰€ä»¥æ— è®ºç‚¹å‡»å‘ç”Ÿåœ¨å“ªä¸ªå…ƒç´ ï¼Œéƒ½ä¼šå†’æ³¡åˆ°è¿™ä¸ªå¤„ç†ç¨‹åºï¼Œæ‰€ä»¥æ­¤æ—¶ï¼š
>
> + `event.target`ï¼šå®é™…è¢«ç‚¹å‡»çš„å…ƒç´ ï¼›
> + `this`ï¼š`<form>` å…ƒç´ ï¼Œå› ä¸ºå¤„ç†ç¨‹åºåœ¨å®ƒä¸Šé¢è¿è¡Œã€‚
>
> ï¼ˆ`event.target` å¯ä»¥ç­‰äº `this` ï¼Œåœ¨ç‚¹å‡»å‘ç”Ÿåœ¨ `<form>` æ—¶ï¼‰



### åœæ­¢å†’æ³¡

ç”¨äºåœæ­¢å†’æ³¡çš„æ–¹æ³•æ˜¯ `event.stopPropagation()`ã€‚

> äº‹ä»¶çš„å†’æ³¡ä¸€æ—¦å‘ç”Ÿï¼Œé€šå¸¸ä¼šä¸€ç›´ä¸Šå‡åˆ° `<html>` å†åˆ° `document`ï¼Œç”šè‡³åˆ°è¾¾ `window`ï¼Œå›è°ƒç”¨è·¯å¾„ä¸Šæ‰€æœ‰çš„å¤„ç†ç¨‹åºã€‚
>
> ä½†æ˜¯ä»»æ„å¤„ç†ç¨‹åºéƒ½å¯ä»¥å†³å®šäº‹ä»¶å·²ç»è¢«å®Œå…¨å¤„ç†ï¼Œå¹¶åœæ­¢å†’æ³¡ã€‚

ğŸŒ° ä¾‹å­ï¼š
```html
<body onclick="alert(`the bubbling doesn't reach here`)">
  <button onclick="event.stopPropagation()">Click me</button>
</body>
```

::: demo [vanilla]

```html
<html>
  <body onclick="alert(`the bubbling doesn't reach here`)">
  <button onclick="event.stopPropagation()">Click me</button>
</body>
</html>
```

:::

> è¿™é‡Œçš„æŒ‰é’®çš„ `body.onclick` äº‹ä»¶ä¼šåœæ­¢å·¥ä½œã€‚



`event.stopImmediatePropagation()` å¯ä»¥ç”¨äº åœæ­¢å†’æ³¡ï¼Œå¹¶ä¸”é˜»æ­¢å½“å‰å…ƒç´ ä¸Šçš„å¤„ç†ç¨‹åºè¿è¡Œï¼Œï¼ˆæ„å‘³ç€ï¼Œå…¶ä»–å¤„ç†ç¨‹åºä¸ä¼šæ‰§è¡Œï¼‰ã€‚



::: warning

éå¿…è¦ï¼Œä¸é˜»æ­¢ã€‚é˜»æ­¢å†’æ³¡åå¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼š

+ å½“åˆ›å»ºäº†ä¸€ä¸ªåµŒå¥—èœå•ï¼Œæ¯ä¸ªå­èœå•å„è‡ªå¤„ç†å¯¹è‡ªå·±çš„å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ `stopPropagation`ï¼Œä»¥ä¾¿ä¸ä¼šè§¦å‘å¤–éƒ¨èœå•ï¼›å½“åœ¨å¤–éƒ¨è¦æ•è·çª—å£çš„ ç”¨æˆ·çš„ç‚¹å‡»æ—¶ï¼Œé˜»æ­¢å†’æ³¡åï¼Œè¿™ä¸ªåŒºåŸŸä¸èƒ½è¢«æ•è·åˆ°ã€‚

é€šå¸¸ï¼Œæ²¡æœ‰çœŸæ­£çš„å¿…è¦å»é˜»æ­¢å†’æ³¡ã€‚å¦‚æœçœŸçš„è¦é˜»æ­¢å†’æ³¡ï¼Œé€šå¸¸ä½¿ç”¨å…¶ä»–æ–¹æ³• **å¦‚è‡ªå®šä¹‰äº‹ä»¶**ï¼›è¿˜å¯ä»¥æ•°æ®å†™å…¥ä¸€ä¸ªå¤„ç†ç¨‹åºä¸­çš„ `event` å¯¹è±¡ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªå¤„ç†ç¨‹åºä¸­è¯»å–è¯¥æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥å‘çˆ¶å¤„ç†ç¨‹åºä¼ é€’æœ‰å…³ä¸‹å±‚å¤„ç†ç¨‹åºçš„ä¿¡æ¯ã€‚

:::

## æ•è·

> DOM æè¿°äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µï¼š
>
> + æ•è·é˜¶æ®µï¼šäº‹ä»¶ï¼ˆä» windowï¼‰èµ°è¿›å…ƒç´ 
> + ç›®æ ‡é˜¶æ®µï¼šäº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ ï¼›
> + å†’æ³¡é˜¶æ®µï¼šäº‹ä»¶ä»å…ƒç´ ä¸Šå¼€å§‹å†’æ³¡ã€‚



**æ•è·é˜¶æ®µä¸€èˆ¬å¾ˆå°‘ç”¨åˆ°ï¼Œæ‰€ä»¥é€šå¸¸çœ‹ä¸è§ã€‚**

ä¸ºäº†åœ¨æ•è·é˜¶æ®µæ•è·äº‹ä»¶ï¼Œéœ€è¦å°†å¤„ç†ç¨‹åºçš„ `capture` é€‰é¡¹è®¾ç½®ä¸º `true`ï¼ˆ `addEventListener` ä¸­çš„é€‰é¡¹å‚æ•°ï¼‰ï¼š

+ ä¸º `false`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™åœ¨å†’æ³¡é˜¶æ®µè®¾ç½®å¤„ç†ç¨‹åºã€‚
+ ä¸º `true`ï¼Œåˆ™åœ¨æ•è·é˜¶æ®µè®¾ç½®å¤„ç†ç¨‹åºã€‚

> è™½ç„¶å½¢å¼ä¸Šæœ‰ä¸‰ä¸ªé˜¶æ®µï¼Œä½†å®é™…ä¸Šç¬¬äºŒé˜¶æ®µæ²¡æœ‰è¢«å•ç‹¬å¤„ç†ï¼Œæ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µçš„å¤„ç†ç¨‹åºéƒ½åœ¨è¯¥é˜¶æ®µè¢«è§¦å‘ã€‚



ğŸŒ° ä¾‹å­ï¼š

```html
<style>
  body * {
    margin: 10px;
    border: 1px solid blue;
  }
</style>

<form>FORM
  <div>DIV
    <p>P</p>
  </div>
</form>

<script>
  for(let elem of document.querySelectorAll('*')) {
    elem.addEventListener("click", e => alert(`Capturing: ${elem.tagName}`), true);
    elem.addEventListener("click", e => alert(`Bubbling: ${elem.tagName}`));
  }
</script>
```

::: demo [vanilla]

```html
<style>
	#example3 * {
    margin: 10px;
    border: 1px solid blue
  }
</style>
<html>
  <body>
    <div id="example3">
      <form>FORM
        <div>DIV
          <p>P</p>
        </div>
       </form>
    </div>
  </body>
</html>
<script>
  for(let elem of document.querySelectorAll('#example3 *')) {
    elem.addEventListener("click", e => alert(`Capturing: ${elem.tagName}`), true);
    elem.addEventListener("click", e => alert(`Bubbling: ${elem.tagName}`));
  }
</script>
```

:::

> ä¾‹å­ä¸­ï¼Œä¸ºæ–‡æ¡£ä¸­çš„ **æ¯ä¸ª** å…ƒç´ éƒ½è®¾ç½®äº†ç‚¹å‡»å¤„ç†ç¨‹åºï¼Œç‚¹å‡» `<p>` æ—¶ï¼š
>
> +  `HTML` â†’ `BODY` â†’ `FORM` â†’ `DIV`ï¼ˆæ•è·é˜¶æ®µç¬¬ä¸€ä¸ªç›‘å¬å™¨ï¼‰ï¼š
> + `P`ï¼ˆç›®æ ‡é˜¶æ®µï¼Œè§¦å‘ä¸¤æ¬¡ï¼Œå› ä¸ºè®¾ç½®äº†ä¸¤ä¸ªç›‘å¬å™¨ï¼šæ•è·å’Œå†’æ³¡ï¼‰
> + `DIV` â†’ `FORM` â†’ `BODY` â†’ `HTML`ï¼ˆå†’æ³¡é˜¶æ®µï¼Œç¬¬äºŒä¸ªç›‘å¬å™¨ï¼‰ã€‚



`event.eventPhase` å¯ä»¥è·å¾—äº‹ä»¶çš„é˜¶æ®µæ•°ã€‚ä½†å®ƒå¾ˆå°‘è¢«ä½¿ç”¨ï¼Œå› ä¸ºé€šå¸¸æ˜¯ä»å¤„ç†ç¨‹åºä¸­äº†è§£åˆ°å®ƒã€‚

::: tip

+ **è¦ç§»é™¤å¤„ç†ç¨‹åºï¼Œ**`removeEventListener` **éœ€è¦åŒä¸€é˜¶æ®µ**ã€‚å¦‚æœ `addEventListener(..., true)`ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨ `removeEventListener(..., true)` ä¸­æåˆ°åŒä¸€é˜¶æ®µï¼Œä»¥æ­£ç¡®åˆ é™¤å¤„ç†ç¨‹åºã€‚

+ **åŒä¸€å…ƒç´ çš„åŒä¸€é˜¶æ®µçš„ç›‘å¬å™¨æŒ‰å…¶è®¾ç½®é¡ºåºè¿è¡Œ**ã€‚å¦‚æœåœ¨åŒä¸€é˜¶æ®µæœ‰å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶é€šè¿‡ `addEventListener` åˆ†é…ç»™äº†ç›¸åŒçš„å…ƒç´ ï¼Œåˆ™å®ƒä»¬çš„è¿è¡Œé¡ºåºä¸åˆ›å»ºé¡ºåºç›¸åŒï¼š

  ```js
  elem.addEventListener("click", e => alert(1)); // ä¼šå…ˆè¢«è§¦å‘
  elem.addEventListener("click", e => alert(2));
  ```

:::



## äº‹ä»¶å§”æ‰˜

äº‹ä»¶çš„æ•è·ä¸å†’æ³¡é˜¶æ®µ å…è®¸äº† äº‹ä»¶çš„å§”æ‰˜æ¨¡å¼ã€‚

> æ€è·¯ï¼šå¦‚æœæœ‰ç±»ä¼¼çš„æ–¹å¼å¤„ç†çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¸ç”¨ä¸ºæ¯ä¸€ä¸ªå…ƒç´ éƒ½åˆ†é…ä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œè€Œæ˜¯è¦å°†å•ä¸ªå¤„ç†ç¨‹åºæ”¾åœ¨å…±åŒçš„ç¥–å…ˆã€‚



ğŸŒ° ä¾‹å­ï¼š

::: demo [vanilla]

```html
<style>
  #bagua-table th {
  text-align: center;
  font-weight: bold;
}

#bagua-table td {
  width: 150px;
  white-space: nowrap;
  text-align: center;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 12px;
}

#bagua-table .nw {
  background: #999;
}

#bagua-table .n {
  background: #03f;
  color: #fff;
}

#bagua-table .ne {
  background: #ff6;
}

#bagua-table .w {
  background: #ff0;
}

#bagua-table .c {
  background: #60c;
  color: #fff;
}

#bagua-table .e {
  background: #09f;
  color: #fff;
}

#bagua-table .sw {
  background: #963;
  color: #fff;
}

#bagua-table .s {
  background: #f60;
  color: #fff;
}

#bagua-table .se {
  background: #0c3;
  color: #fff;
}

#bagua-table .highlight {
  background: red;
}
</style>
<html>
  <table id="bagua-table">
    <tbody>
      <tr>
        <th colspan="3"><em>Bagua</em> Chart: Direction, Element, Color, Meaning</th>
      </tr>
      <tr>
        <td class="nw"><strong>Northwest</strong>
          <br>Metal
          <br>Silver
          <br>Elders
        </td>
        <td class="n"><strong>North</strong>
          <br>Water
          <br>Blue
          <br>Change
        </td>
        <td class="ne"><strong>Northeast</strong>
          <br>Earth
          <br>Yellow
          <br>Direction
        </td>
      </tr>
      <tr>
        <td class="w"><strong>West</strong>
          <br>Metal
          <br>Gold
          <br>Youth
        </td>
        <td class="c"><strong>Center</strong>
          <br>All
          <br>Purple
          <br>Harmony
        </td>
        <td class="e"><strong>East</strong>
          <br>Wood
          <br>Blue
          <br>Future
        </td>
      </tr>
      <tr>
        <td class="sw"><strong>Southwest</strong>
          <br>Earth
          <br>Brown
          <br>Tranquility
        </td>
        <td class="s"><strong>South</strong>
          <br>Fire
          <br>Orange
          <br>Fame
        </td>
        <td class="se highlight"><strong>Southeast</strong>
          <br>Wood
          <br>Green
          <br>Romance
        </td>
      </tr>
  	</tbody>
  </table>
</html>
  <script>
    let table = document.getElementById('bagua-table');

    let selectedTd;

    table.onclick = function(event) {
      let target = event.target;

      while (target != this) {
        if (target.tagName == 'TD') {
          highlight(target);
          return;
        }
        target = target.parentNode;
      }
    }

    function highlight(node) {
      if (selectedTd) {
        selectedTd.classList.remove('highlight');
      }
      selectedTd = node;
      selectedTd.classList.add('highlight');
    }
</script>
```

:::

> è¦å®ç°å¦‚ä¸Šçš„ åœ¨ç‚¹å‡»æ—¶é«˜äº®æ˜¾ç¤ºè¯¥å•å…ƒæ ¼ã€‚æ— è®ºæœ‰å¤šå°‘ä¸ªå•å…ƒæ ¼ï¼Œéƒ½å¯ä»¥åˆ†é…å¤„ç†çš„ç¨‹åºã€‚

å¯ä»¥åœ¨ `table` å…ƒç´ ä¸Šè®¾ç½®ä¸€ä¸ª æ•è·æ‰€æœ‰ç‚¹å‡» çš„å¤„ç†ç¨‹åºï¼ˆåˆ©ç”¨äº‹ä»¶çš„æ•è·é˜¶æ®µï¼‰ï¼Œè¿™æ ·ä¸ç”¨æ‹…å¿ƒè¡¨æ ¼æœ‰å¤šå°‘ä¸ªå•å…ƒæ ¼ï¼Œä¹Ÿå¯ä»¥éšæ—¶åŠ¨æ€å¢åŠ /ç§»é™¤ `<td>` å…ƒç´ ï¼Œç‚¹å‡»é«˜ç²±ä¾ç„¶æœ‰æ•ˆï¼š

```js
let selectedTd;
table.onclick = function(event) {
  let target = event.target
  if(target.tagName != 'TD') {
    return // ä¸å¤„ç†æ²¡æœ‰ç‚¹åœ¨tdä¸Šçš„äº‹ä»¶
  }
  highlisht(target)
}

function highlight(td) {
  if (selectedTd) { // ç§»é™¤ç°æœ‰çš„é«˜äº®æ˜¾ç¤ºï¼Œå¦‚æœæœ‰çš„è¯
    selectedTd.classList.remove('highlight');
  }
  selectedTd = td;
  selectedTd.classList.add('highlight'); // é«˜äº®æ˜¾ç¤ºæ–°çš„ td
}
```

> ä½†ç”±äº `<td>` å†…éƒ¨è¿˜æœ‰è®¸å¤šåµŒå¥—çš„å…ƒç´ æ ‡ç­¾ï¼Œæ‰€ä»¥å¦‚æœç‚¹å‡»ä¾‹å¦‚ `<strong>` å…ƒç´ æ—¶ï¼Œ`strong` å…ƒç´ ç§°ä¸º `event.target`ï¼Œè¿™æ ·ä¹Ÿè¦è€ƒè™‘åœ¨ `td` çš„èŒƒå›´å†…ï¼Œæ”¹è¿›ä¸ºï¼š
> ```js
> table.onclick = function(event) {
>   let td = event.target.closest('td'); // (1)
> 
>   if (!td) return; // (2)
> 
>   if (!table.contains(td)) return; // (3)
> 
>   highlight(td); // (4)
> };
> ```
>
> > ä½¿ç”¨å…ƒç´ çš„ `closet` å±æ€§ï¼Œæ‰¾åˆ°æœ€è¿‘çš„ç¥–å…ˆå…ƒç´ ã€‚



### äº‹ä»¶å§”æ‰˜ç»™ æ ‡è®°çš„è¡Œä¸º

ğŸŒ° ä¾‹å­ / å¦‚æœè¦ç¼–å†™ä¸€ä¸ªæœ‰â€œä¿å­˜â€ã€â€œåŠ è½½â€å’Œâ€œæœç´¢â€ç­‰æŒ‰é’®çš„èœå•ã€‚å¹¶ä¸”ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå…·æœ‰ `save`ã€`load` å’Œ `search` ç­‰æ–¹æ³•çš„å¯¹è±¡ã€‚

è¦åŒ¹é…å®ƒä»¬å¯¹åº”åˆ°çš„äº‹ä»¶ï¼Œå¦‚æœæ¯æ¬¡å•ç‹¬åˆ†é…å¤„ç†ç¨‹åºè¿‡äºéº»çƒ¦ã€‚å¯ä»¥è€ƒè™‘ç»™æ•´ä¸ªèœå•æ·»åŠ ä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œå¹¶ä¸”ä¸ºå…·æœ‰æ–¹æ³•è°ƒç”¨çš„æŒ‰é’®æ·»åŠ  `data-action` ç‰¹æ€§ï¼š

```js
<button data-action="save">Click to Save</button>
```

å®Œæ•´ä»£ç ï¼š

::: demo [vanilla]

```html
<html>
  <div id="menu">
    <button data-action="save">Save</button>
    <button data-action="load">Load</button>
    <button data-action="search">Search</button>
    </div>
</html>

<script>
  class Menu {
    constructor(elem) {
      this._elem = elem;
      elem.onclick = this.onClick.bind(this); // (*)
    }

    save() {
      alert('saving');
    }

    load() {
      alert('loading');
    }

    search() {
      alert('searching');
    }

    onClick(event) {
      let action = event.target.dataset.action;
      if (action) {
        this[action]();
      }
    };
  }

  new Menu(menu);
</script>
```

:::

> æ³¨æ„ï¼š `this.onclick.bind(this)` è¦ç»‘å®š`Menu` å¯¹è±¡çš„ `this` ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¦åˆ™åœ¨å¤„ç†ç¨‹åºå†…éƒ¨ å¼•ç”¨çš„æ˜¯ `element` å¯¹è±¡è€Œä¸æ˜¯ `Menu` å¯¹è±¡ã€‚



::: tip

**ä½¿ç”¨äº‹ä»¶å§”æ‰˜çš„å¥½å¤„**ï¼š

+ ä¸éœ€è¦ç¼–å†™ä»£ç ç»™æ¯ä¸€ä¸ªæŒ‰é’®åˆ†é…å•ç‹¬çš„å¤„ç†ç¨‹åºã€‚åªéœ€è¦åˆ›å»ºä¸€ä¸ªå¤„ç†ç¨‹åºè·å–è¯¥å…ƒç´ çš„æ ‡è®°ï¼Œä»¥åˆ†é…å¯¹åº”çš„è¡Œä¸ºï¼›
+ å¹¶ä¸”å¯ä»¥éšæ—¶çµæ´»ç§»é™¤/å¢åŠ æŒ‰é’®ã€‚

:::



### è¡Œä¸ºæ¨¡å¼

äº‹ä»¶å§”æ‰˜å°†è¡Œä¸ºä»¥ **å£°æ˜çš„æ–¹å¼** æ·»åŠ åˆ°å…·æœ‰ç‰¹æ®Šç‰¹æ€§å’Œç±»çš„å…ƒç´ ä¸­ã€‚

è¡Œä¸ºæ¨¡å¼çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼š

+ å°†è‡ªå®šä¹‰ç‰¹æ€§æ·»åŠ åˆ°æè¿°å…¶è¡Œä¸ºçš„å…ƒç´ ã€‚
+ ç”¨æ–‡æ¡£èŒƒå›´çº§çš„å¤„ç†ç¨‹åºè¿½è¸ªäº‹ä»¶ï¼Œ**å¦‚æœäº‹ä»¶å‘ç”Ÿåœ¨å…·æœ‰ç‰¹å®šç‰¹æ€§çš„å…ƒç´ ä¸Š**ï¼Œåˆ™æ‰§è¡Œè¡Œä¸ºã€‚



ğŸŒ° ä¾‹å­ / è®¡æ•°å™¨ï¼š
::: demo [vanilla] 

```html
<html>
  Counter: <input type="button" value="1" data-counter>
  <br>One more counter: <input type="button" value="2" data-counter>
</html>
<script>
  document.addEventListener('click', function(event) {

    if (event.target.dataset.counter != undefined) { // å¦‚æœè¿™ä¸ªç‰¹æ€§å­˜åœ¨...
      event.target.value++;
    }

  });
</script>
```

:::

> å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ `data-counter` ç‰¹æ€§åˆ°ç›¸åº”çš„å…ƒç´ ä¸Šã€‚ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¯ä»¥æ ¹æ®è¯¥è¡Œä¸ºç‰¹æ€§å¤„ç†äº‹ä»¶ã€‚

::: tip

**å¯¹äºæ–‡æ¡£çº§çš„å¤„ç†ç¨‹åº**ï¼Œ **å§‹ç»ˆä½¿ç”¨çš„æ˜¯ `addEventListener`**ï¼š

å°†äº‹ä»¶å¤„ç†ç¨‹åºåˆ†é…ç»™ `document` å¯¹è±¡æ—¶ï¼Œåº”è¯¥å§‹ç»ˆä½¿ç”¨ `addEventListener`ï¼Œè€Œä¸æ˜¯ `document.on<event>`ï¼Œå› ä¸ºåè€…ä¼šå¼•èµ·å†²çªï¼š**æ–°çš„å¤„ç†ç¨‹åºä¼šè¦†ç›–æ—§çš„å¤„ç†ç¨‹åº**ã€‚

å¯¹äºå®é™…é¡¹ç›®æ¥è¯´ã€‚åœ¨ `document` ä¸Šæœ‰è®¸å¤šç”±ä»£ç çš„ä¸åŒéƒ¨åˆ†è®¾ç½®çš„å¤„ç†ç¨‹åºï¼Œè¿™æ˜¯å¾ˆæ­£å¸¸çš„ã€‚

:::



ğŸŒ° ä¾‹å­ / æ˜¾ç¤ºéšè—åˆ‡æ¢å™¨ toggleï¼š

::: demo [vanilla]

```html
<html>
  <button data-toggle-id="subscribe-mail">
  Show the subscription form
</button>

  <form id="subscribe-mail" hidden>
    Your mail: <input type="email">
  </form>
</html>

<script>
	document.addEventListener('click', function(event) {
    let id = event.target.dataset.toggleId;
    if (!id) return;

    let elem = document.getElementById(id);

    elem.hidden = !elem.hidden;
  });
</script>
```

:::

> å› ä¸ºæ·»åŠ äº†å¯¹ `toggleId` çš„è¡Œä¸ºçš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚æ‰€ä»¥ç°åœ¨å‘å…ƒç´ æ·»åŠ åŠŸèƒ½ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªè¡Œä¸ºæ¨¡å¼çš„ç‰¹æ€§ `data-toggle-id`ï¼Œ æ— éœ€ä¸ºæ¯ä¸ªè¿™æ ·çš„å…ƒç´ ç¼–å†™ JavaScriptã€‚åªéœ€è¦ä½¿ç”¨è¡Œä¸ºã€‚æ–‡æ¡£çº§å¤„ç†ç¨‹åºä½¿å…¶é€‚ç”¨äºé¡µé¢çš„ä»»æ„å…ƒç´ ã€‚



::: tip

äº‹ä»¶å§”æ‰˜çš„ä½¿ç”¨ï¼Œé€šå¸¸ç”¨äºä¸ºè®¸å¤šç›¸ä¼¼çš„å…ƒç´ æ·»åŠ ç›¸åŒçš„å¤„ç†ï¼Œä½†ä¸ä»…é™äºæ­¤ã€‚

å¥½å¤„ï¼š

+ ç®€åŒ–åˆå§‹åŒ–å¹¶èŠ‚çœå†…å­˜ï¼šæ— éœ€æ·»åŠ è®¸å¤šå¤„ç†ç¨‹åºã€‚
+ æ›´å°‘çš„ä»£ç ï¼šæ·»åŠ æˆ–ç§»é™¤å…ƒç´ æ—¶ï¼Œæ— éœ€æ·»åŠ /ç§»é™¤å¤„ç†ç¨‹åºã€‚

å±€é™ï¼š

+ é¦–å…ˆï¼Œäº‹ä»¶å¿…é¡»å†’æ³¡ã€‚è€Œæœ‰äº›äº‹ä»¶ä¸ä¼šå†’æ³¡ã€‚æ­¤å¤–ï¼Œä½çº§åˆ«çš„å¤„ç†ç¨‹åºä¸åº”è¯¥ä½¿ç”¨ `event.stopPropagation()`ã€‚
+ å…¶æ¬¡ï¼Œå§”æ‰˜å¯èƒ½ä¼šå¢åŠ  CPU è´Ÿè½½ï¼Œå› ä¸ºå®¹å™¨çº§åˆ«çš„å¤„ç†ç¨‹åºä¼šå¯¹å®¹å™¨ä¸­ä»»æ„ä½ç½®çš„äº‹ä»¶åšå‡ºååº”ï¼Œè€Œä¸ç®¡æˆ‘ä»¬æ˜¯å¦å¯¹è¯¥äº‹ä»¶æ„Ÿå…´è¶£ã€‚ä½†æ˜¯ï¼Œé€šå¸¸è´Ÿè½½å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸è€ƒè™‘å®ƒã€‚

:::



## æµè§ˆå™¨äº‹ä»¶é»˜è®¤è¡Œä¸º



å¸¸è§çš„é»˜è®¤è¡Œä¸ºï¼š

+ ç‚¹å‡»ä¸€ä¸ªé“¾æ¥ï¼Œè§¦å‘å¯¼èˆªåˆ°è¯¥ URLï¼›
+ ç‚¹å‡»è¡¨å•çš„æäº¤æŒ‰é’®ï¼Œè§¦å‘æäº¤åˆ°æœåŠ¡å™¨çš„è¡Œä¸ºï¼›
+ åœ¨æ–‡æœ¬ä¸ŠæŒ‰ä¸‹é¼ æ ‡æŒ‰é’®å¹¶ç§»åŠ¨ï¼Œé€‰ä¸­æ–‡æœ¬ï¼›



### é˜»æ­¢æµè§ˆå™¨çš„é»˜è®¤è¡Œä¸º

ä¸¤ç§æ–¹æ³•ï¼š

+ ä½¿ç”¨ `event` å¯¹è±¡ã€‚æœ‰ä¸€ä¸ª `event.preventDefault()` æ–¹æ³•ã€‚
+ ä½¿ç”¨ `on<event>`ï¼ˆè€Œä¸æ˜¯ `addEventListener`ï¼‰åˆ†é…çš„ï¼Œé‚£è¿”å› `false` ä¹ŸåŒæ ·æœ‰æ•ˆã€‚



ğŸŒ° ä¾‹å­ï¼š

::: demo [vanilla]

```html
<html>
  <a href="/" onclick="return false">Click here</a>
	or
	<a href="/" onclick="event.preventDefault()">here</a>
</html>
```

:::

> äº‹ä»¶å¤„ç†ç¨‹åºè¿”å›çš„å€¼é€šå¸¸ä¼šè¢«å¿½ç•¥ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯ä»ä½¿ç”¨ `on<event>` åˆ†é…çš„å¤„ç†ç¨‹åºä¸­è¿”å›çš„ `return false`ã€‚
>
> åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œ`return` å€¼éƒ½ä¼šè¢«å¿½ç•¥ã€‚å¹¶ä¸”ï¼Œè¿”å› `true` æ²¡æœ‰æ„ä¹‰ã€‚



ğŸŒ° ä¾‹å­ / å¤„ç†å¯¼èˆªèœå•çš„é»˜è®¤è¡Œä¸ºï¼š

::: demo [vanilla]

```html
<style>
#menu li {
  display: inline-block;
  margin: 0;
}

#menu > li a {
  display: inline-block;
  margin: 0 2px;
  outline: none;
  text-align: center;
  text-decoration: none;
  font: 14px/100% sans-serif;
  padding: .5em 2em .55em;
  text-shadow: 0 1px 1px rgba(0, 0, 0, .3);
  border-radius: .5em;
  box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
  color: #d9eef7;
  border: solid 1px #0076a3;
  background: #0095cd;
}

#menu > li:hover a {
  text-decoration: none;
  background: #007ead;
}
</style>
<html>
    <ul id="menu" class="menu">
      <li><a href="/html">HTML</a></li>
      <li><a href="/javascript">JavaScript</a></li>
      <li><a href="/css">CSS</a></li>
  	</ul>
</html>
<script>
  let menu = document.querySelector("#menu")
	menu.onclick = function(event) {
    if(event.target.nodeName != 'A') return;
    
    let href = event.target.getAttribute('href')
    alert(href);
    
    return false; 
  }
</script>
```

:::

```html
<script>
  let menu = document.querySelector("#menu")
	menu.onclick = function(event) {
    if(event.target.nodeName != 'A') return;
    
    let href = event.target.getAttribute('href')
    alert(href);
    
    return false; 
  }
</script>
```



### `passive` 

`addEventListener` çš„å¯é€‰é¡¹ `passive: true` å‘æµè§ˆå™¨å‘å‡ºä¿¡å·ï¼Œè¡¨æ˜å¤„ç†ç¨‹åºå°†ä¸ä¼šè°ƒç”¨ `preventDefault()`ã€‚

> ç§»åŠ¨è®¾å¤‡ä¸Šä¼šå‘ç”Ÿä¸€äº›äº‹ä»¶ï¼Œä¾‹å¦‚ `touchmove`ï¼ˆå½“ç”¨æˆ·åœ¨å±å¹•ä¸Šç§»åŠ¨æ‰‹æŒ‡æ—¶ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¯¼è‡´æ»šåŠ¨ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨å¤„ç†ç¨‹åºçš„ `preventDefault()` æ¥é˜»æ­¢æ»šåŠ¨ã€‚
>
> å› æ­¤ï¼Œå½“æµè§ˆå™¨æ£€æµ‹åˆ°æ­¤ç±»äº‹ä»¶æ—¶ï¼Œå®ƒå¿…é¡»é¦–å…ˆå¤„ç†æ‰€æœ‰å¤„ç†ç¨‹åºï¼Œç„¶åå¦‚æœæ²¡æœ‰ä»»ä½•åœ°æ–¹è°ƒç”¨ `preventDefault`ï¼Œåˆ™é¡µé¢å¯ä»¥ç»§ç»­æ»šåŠ¨ã€‚ä½†è¿™å¯èƒ½ä¼šå¯¼è‡´ UI ä¸­ä¸å¿…è¦çš„å»¶è¿Ÿå’Œâ€œæŠ–åŠ¨â€ã€‚
>
> `passive: true` é€‰é¡¹å‘Šè¯‰æµè§ˆå™¨ï¼Œå¤„ç†ç¨‹åºä¸ä¼šå–æ¶ˆæ»šåŠ¨ã€‚ç„¶åæµè§ˆå™¨ç«‹å³æ»šåŠ¨é¡µé¢ä»¥æä¾›æœ€å¤§ç¨‹åº¦çš„æµç•…ä½“éªŒï¼Œå¹¶é€šè¿‡æŸç§æ–¹å¼å¤„ç†äº‹ä»¶ã€‚
>
> æŸäº›æµè§ˆå™¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ`touchstart` å’Œ `touchmove` äº‹ä»¶çš„ `passive` ä¸º `true`ã€‚



### é˜»æ­¢äº‹ä»¶å†’æ³¡

å¯ä»¥ä½¿ç”¨ `event.defaultPrevented` æ¥ä»£æ›¿ `event.stopPropagation()`ï¼Œæ¥é€šçŸ¥å…¶ä»–äº‹ä»¶å¤„ç†ç¨‹åºï¼Œè¯¥äº‹ä»¶å·²ç»è¢«å¤„ç†ã€‚

ğŸŒ° ä¾‹å­ï¼š

é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨åœ¨ `contextmenu` äº‹ä»¶ï¼ˆå•å‡»é¼ æ ‡å³é”®ï¼‰æ—¶ï¼Œæ˜¾ç¤ºå¸¦æœ‰æ ‡å‡†é€‰é¡¹çš„ä¸Šä¸‹æ–‡èœå•ã€‚å¯ä»¥é˜»æ­¢å®ƒå¹¶æ˜¾ç¤ºæˆ‘ä»¬è‡ªå®šä¹‰çš„èœå•ï¼š

::: demo [vanilla]

```html
<html>
  <button>Right-click shows browser context menu</button>

<button oncontextmenu="alert('Draw our menu'); return false">
  Right-click shows our context menu
</button>
</html>
```

:::



é™¤äº†å¯¹äºç‰¹å®šçš„å…ƒç´ ï¼Œè¿˜å¯ä»¥å®ç°æ–‡æ¡£èŒƒå›´å†…çš„ï¼š

```html
<p>Right-click here for the document context menu</p>

<button id="elem">Right-click here for the button context menu</button>

  <script>
  elem.oncontextmenu = function(event) {
    event.preventDefault();
    alert("Button context menu");
  };

  document.oncontextmenu = function(event) {
    event.preventDefault();
    alert("Document context menu");
  };
</script>
```

> è¿™ä¸ªä¾‹å­ä¸­ï¼Œç‚¹å‡» `elem` æ—¶ï¼Œä¼šå¾—åˆ°ä¸¤ä¸ªèœå•ï¼šæŒ‰é’®çº§å’Œæ–‡æ¡£çº§ï¼ˆäº‹ä»¶å†’æ³¡ï¼‰çš„èœå•ã€‚
>
> è§£å†³æ–¹æ¡ˆï¼Œé˜»æ­¢äº‹ä»¶å†’æ³¡ï¼š
>
> ```html
> <script>
>   elem.oncontextmenu = function(event) {
>     event.preventDefault();
>     event.stopPropagation();
>     alert("Button context menu");
>   };
> 
>   document.oncontextmenu = function(event) {
>     event.preventDefault();
>     alert("Document context menu");
>   };
> </script>
> ```
>
> ä½†æ˜¯é˜»æ­¢äº‹ä»¶å†’æ³¡å­˜åœ¨ä»£ä»·ï¼Œç°åœ¨ å³é”®ç‚¹å‡»ä¿¡æ¯ ç›¸å…³çš„äº‹ä»¶ï¼Œéƒ½æ˜¯è¢«å–æ¶ˆçš„ã€‚



é‡‡ç”¨å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»è¢«é˜»æ­¢äº†é»˜è®¤è¡Œä¸ºå³å¯ï¼Œå¦‚æœå·²ç»é˜»æ­¢å°±ä¸ç”¨å¤„ç†ï¼š
```html
<script>
  elem.oncontextmenu = function(event) {
    event.preventDefault();
    alert("Button context menu");
  };

  document.oncontextmenu = function(event) {
    if (event.defaultPrevented) return;

    event.preventDefault();
    alert("Document context menu");
  };
</script>
```

> ç°åœ¨ï¼Œå¦‚æœæœ‰åµŒå¥—çš„å…ƒç´ ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡èœå•ï¼Œé‚£ä¹ˆè¿™ä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„ã€‚åªéœ€ç¡®ä¿æ£€æŸ¥æ¯ä¸ª `contextmenu` å¤„ç†ç¨‹åºä¸­çš„ `event.defaultPrevented`ã€‚



## è‡ªå®šä¹‰äº‹ä»¶

è‡ªå®šä¹‰äº‹ä»¶å¯ç”¨äºåˆ›å»ºå›¾å½¢ç»„ä»¶ã€‚ä¾‹å¦‚ï¼ŒåŸºäº JavaScript çš„èœå•çš„æ ¹å…ƒç´ å¯èƒ½ä¼šè§¦å‘ `open`ï¼ˆæ‰“å¼€èœå•ï¼‰ï¼Œ`select`ï¼ˆæœ‰ä¸€é¡¹è¢«é€‰ä¸­ï¼‰ç­‰äº‹ä»¶æ¥å‘Šè¯‰èœå•å‘ç”Ÿäº†ä»€ä¹ˆã€‚å¦ä¸€ä¸ªä»£ç å¯èƒ½ä¼šç›‘å¬äº‹ä»¶ï¼Œå¹¶è§‚å¯Ÿèœå•å‘ç”Ÿäº†ä»€ä¹ˆã€‚

ä¸ä»…å¯ä»¥å‡ºäºè‡ªèº«ç›®çš„è€Œåˆ›å»ºçš„å…¨æ–°äº‹ä»¶ï¼Œè¿˜å¯ä»¥ç”Ÿæˆä¾‹å¦‚ `click` å’Œ `mousedown` ç­‰å†…å»ºäº‹ä»¶ã€‚è¿™å¯èƒ½ä¼šæœ‰åŠ©äºè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚



### äº‹ä»¶çš„æ„é€ å™¨

```js
let evnet = new Event(type[, options])
```

+ `type`ï¼šäº‹ä»¶ç±»å‹ï¼›

+ `options`ï¼šä¸¤ä¸ªå¯é€‰å±æ€§å¯¹è±¡é…ç½®ï¼š

  + `bubbles: true/false` ï¼šå¦‚æœä¸º `true`ï¼Œé‚£ä¹ˆäº‹ä»¶ä¼šå†’æ³¡ã€‚
  + `cancelable: true/false` ï¼šå¦‚æœä¸º `true`ï¼Œé‚£ä¹ˆé»˜è®¤è¡Œä¸ºå°±ä¼šè¢«é˜»æ­¢ã€‚

  é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªé…ç½®éƒ½ä¸º `false`ï¼Œå³äº‹ä»¶ä¸å†’æ³¡å¹¶ä¸”ä¸é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚



### è°ƒç”¨è‡ªå®šä¹‰äº‹ä»¶

ä½¿ç”¨ `elem.dispatchEvent(event)` è°ƒç”¨åœ¨å…ƒç´ ä¸Šè¿è¡Œ `event`ã€‚ç„¶åï¼Œå¤„ç†ç¨‹åºä¼šå¯¹å®ƒåšå‡ºååº”ï¼Œå°±å¥½åƒå®ƒæ˜¯ä¸€ä¸ªå¸¸è§„çš„æµè§ˆå™¨äº‹ä»¶ä¸€æ ·ã€‚

ğŸŒ° ä¾‹å­ï¼š

```html
<button id="elem" onclick="alert('Click!');">Autoclick</button>

<script>
  let elem = document.querySelector("#elem")
  let event = new Event("click");
  elem.dispatchEvent(event);
</script>
```

> è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`click` äº‹ä»¶æ˜¯ç”¨ JavaScript åˆå§‹åŒ–åˆ›å»ºçš„ã€‚å¤„ç†ç¨‹åºå·¥ä½œæ–¹å¼å’Œç‚¹å‡»æŒ‰é’®çš„æ–¹å¼ç›¸åŒã€‚



### åŒºåˆ†è‡ªå®šä¹‰äº‹ä»¶

ä½¿ç”¨ `event.isTrusted` åŒºåˆ†çœŸå®ç”¨æˆ·äº‹ä»¶å’Œ é€šè¿‡è„šæœ¬ç”Ÿæˆçš„è‡ªå®šä¹‰äº‹ä»¶ï¼š

+ å¯¹äºæ¥è‡ªçœŸå®ç”¨æˆ·æ“ä½œçš„äº‹ä»¶ï¼Œ`event.isTrusted` å±æ€§ä¸º `true`ï¼›
+ å¯¹äºè„šæœ¬ç”Ÿæˆçš„äº‹ä»¶ï¼Œ`event.isTrusted` å±æ€§ä¸º `false`ã€‚



### è‡ªå®šä¹‰äº‹ä»¶çš„å†’æ³¡

ğŸŒ° ä¾‹å­ / åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å†’æ³¡äº‹ä»¶ï¼Œå¹¶åœ¨ `document` ä¸Šæ•è·ï¼š

```html
<h1 id="elem">
  Hello from the script
</h1>

<script>
  // åœ¨ document æ•è· hello äº‹ä»¶
	document.addEventListener("hello", function(event) {
    alert("Hello from" + event.target.tagName)
  })
  
  let event = new Event("hello", {bubbls: true});
  elem.dispatch(event)
</script>
```

> + åº”è¯¥å¯¹è‡ªå®šä¹‰äº‹ä»¶ä½¿ç”¨ `addEventListener`ï¼Œå› ä¸º `on<event>` ä»…å­˜åœ¨äºå†…å»ºäº‹ä»¶ä¸­ï¼Œ`document.onhello` åˆ™æ— æ³•è¿è¡Œã€‚
> + å¿…é¡»è®¾ç½® `bubbles:true`ï¼Œå¦åˆ™äº‹ä»¶ä¸ä¼šå‘ä¸Šå†’æ³¡ã€‚

å†…å»ºäº‹ä»¶ï¼ˆ`click`ï¼‰å’Œè‡ªå®šä¹‰äº‹ä»¶ï¼ˆ`hello`ï¼‰çš„å†’æ³¡æœºåˆ¶ç›¸åŒã€‚è‡ªå®šä¹‰äº‹ä»¶ä¹Ÿæœ‰æ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µã€‚



### è‡ªå®šä¹‰äº‹ä»¶çš„ç±»å‹

é€šå¸¸çš„ UI äº‹ä»¶ç±»æœ‰ï¼š

+ `UIEvent`
+ `FocusEvent`
+ `MouseEvent`
+ `WheelEvent`
+ `KeyboardEvent`
+ â€¦

> ç›¸å…³çš„ UI äº‹ä»¶è§„å®š https://www.w3.org/TR/uievents

è¦åˆ›å»ºè¿™æ ·ç±»å‹çš„äº‹ä»¶ï¼Œä½¿ç”¨å®ƒä»¬è€Œä¸æ˜¯ `new Event`ï¼Œæ­£ç¡®çš„æ„é€ å™¨å…è®¸ä¸ºè¯¥ç±»å‹çš„äº‹ä»¶æŒ‡å®šæ ‡å‡†å±æ€§ã€‚

ğŸŒ° ä¾‹å­ï¼š
```js
let event = new MouseEvent("click", {
  bubbles: true,
  cancelable: true,
  clientX: 100,
  clientY: 100
});

alert(event.clientX);
```



å¯¹äºé€šç”¨çš„ `Event` æ„é€ å™¨ï¼Œä¸å…è®¸è¿™æ ·ï¼š

```js
let event = new Event("click", {
  bubbles: true, // æ„é€ å™¨ Event ä¸­åªæœ‰ bubbles å’Œ cancelable å¯ä»¥å·¥ä½œ
  cancelable: true,
  clientX: 100,
  clientY: 100
});

alert(event.clientX); // undefinedï¼ŒæœªçŸ¥çš„å±æ€§è¢«å¿½ç•¥äº†ï¼
```

> æŠ€æœ¯ä¸Šï¼Œå¯ä»¥é€šè¿‡åœ¨åˆ›å»ºåç›´æ¥åˆ†é… `event.clientX=100` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–¹ä¾¿å’Œéµå®ˆè§„åˆ™çš„é—®é¢˜ã€‚æµè§ˆå™¨ç”Ÿæˆçš„äº‹ä»¶å§‹ç»ˆå…·æœ‰æ­£ç¡®çš„ç±»å‹ã€‚



### è‡ªå®šä¹‰äº‹ä»¶çš„äº‹ä»¶ç±»å‹

è¦å…¨æ–°è‡ªå®šä¹‰äº‹ä»¶ç±»å‹ï¼Œä½¿ç”¨ `new CustomEvent`ã€‚

> ä»æŠ€æœ¯ä¸Šè®²ï¼Œ[CustomEvent](https://dom.spec.whatwg.org/#customevent) å’Œ `Event` ä¸€æ ·ã€‚é™¤äº†ä¸€ç‚¹ä¸åŒã€‚åœ¨ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯¹è±¡ï¼‰ä¸­ï¼Œå¯ä»¥ä¸ºæƒ³è¦ä¸äº‹ä»¶ä¸€èµ·ä¼ é€’çš„ **ä»»ä½•è‡ªå®šä¹‰ä¿¡æ¯æ·»åŠ ä¸€ä¸ªé™„åŠ çš„å±æ€§** `detail`ã€‚

> äº‹ä»¶ç±»æè¿°äº†å®ƒæ˜¯ã€Œä»€ä¹ˆç±»å‹çš„äº‹ä»¶ã€ï¼Œå¦‚æœäº‹ä»¶æ˜¯è‡ªå®šä¹‰çš„ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ `CustomEvent` æ¥æ˜ç¡®å®ƒæ˜¯ä»€ä¹ˆã€‚

ğŸŒ° ä¾‹å­ï¼š

```html
<h1 id="elem">Hello for John!</h1>

<script>
  // äº‹ä»¶é™„å¸¦ç»™å¤„ç†ç¨‹åºçš„å…¶ä»–è¯¦ç»†ä¿¡æ¯
  elem.addEventListener("hello", function(event) {
    alert(event.detail.name);
  });

  elem.dispatchEvent(new CustomEvent("hello", {
    detail: { name: "John" }
  }));
</script>
```

> `detail` å±æ€§å¯ä»¥æœ‰ä»»ä½•æ•°æ®ã€‚
>
> + é€šå¸¸åœ¨åˆ›å»ºåå°†ä»»ä½•å±æ€§åˆ†é…ç»™å¸¸è§„çš„ `new Event` å¯¹è±¡ä¸­ã€‚
> + ä½†æ˜¯ `CustomEvent` æä¾›äº†ç‰¹æ®Šçš„ `detail` å­—æ®µï¼Œä»¥é¿å…ä¸å…¶ä»–äº‹ä»¶å±æ€§çš„å†²çªã€‚



### è‡ªå®šä¹‰äº‹ä»¶çš„é»˜è®¤è¡Œä¸º

å¯¹äºæ–°çš„è‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œç»å¯¹æ²¡æœ‰é»˜è®¤çš„æµè§ˆå™¨è¡Œä¸ºï¼Œä½†æ˜¯åˆ†æ´¾æ­¤ç±»äº‹ä»¶çš„ä»£ç å¯èƒ½æœ‰è‡ªå·±çš„è®¡åˆ’ï¼Œè§¦å‘è¯¥äº‹ä»¶ä¹‹ååº”è¯¥åšä»€ä¹ˆã€‚



ğŸŒ° ä¾‹å­ / 

```html
<pre id="rabbit">
  |\   /|
   \|_|/
   /. .\
  =\_Y_/=
   {>o<}
</pre>
<button onclick="hide()">Hide()</button>
```

```html
<script>
	function hide() {
    let event = new CustomEvent("hide", {
      cancelable: true // æ²¡æœ‰è¿™ä¸ªæ ‡å¿—ï¼ŒpreventDefault å°†ä¸èµ·ä½œç”¨
    });
    if (!rabbit.dispatchEvent(event)) {
      alert('The action was prevented by a handler');
    } else {
      rabbit.hidden = true;
    }
  }

  rabbit.addEventListener('hide', function(event) {
    if (confirm("Call preventDefault?")) {
      event.preventDefault();
    }
  });
</script>
```



### äº‹ä»¶çš„åŒæ­¥äº‹ä»¶

é€šå¸¸äº‹ä»¶æ˜¯åœ¨é˜Ÿåˆ—ä¸­å¤„ç†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šå¦‚æœæµè§ˆå™¨æ­£åœ¨å¤„ç† `onclick`ï¼Œè¿™æ—¶å‘ç”Ÿäº†ä¸€ä¸ªæ–°çš„äº‹ä»¶ï¼Œä¾‹å¦‚é¼ æ ‡ç§»åŠ¨äº†ï¼Œé‚£ä¹ˆå®ƒçš„å¤„ç†ç¨‹åºä¼šè¢«æ’å…¥é˜Ÿåˆ—ï¼Œç›¸åº”çš„ `mousemove` å¤„ç†ç¨‹åºå°†åœ¨ `onclick` äº‹ä»¶å¤„ç†å®Œæˆåè¢«è°ƒç”¨ã€‚

ä¾‹å¤–ï¼šå½“ä¸€ä¸ªäº‹ä»¶æ˜¯åœ¨å¦ä¸€ä¸ªäº‹ä»¶ä¸­å‘èµ·çš„ã€‚ä¾‹å¦‚ä½¿ç”¨ `dispatchEvent`ã€‚è¿™ç±»äº‹ä»¶å°†ä¼šè¢«ç«‹å³å¤„ç†ï¼Œå³åœ¨æ–°çš„äº‹ä»¶å¤„ç†ç¨‹åºè¢«è°ƒç”¨ä¹‹åï¼Œæ¢å¤åˆ°å½“å‰çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚



ğŸŒ° ä¾‹å­ / `menu-open` äº‹ä»¶æ˜¯åœ¨ `onclick` äº‹ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«è°ƒç”¨çš„ã€‚å®ƒä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œè€Œä¸å¿…ç­‰å¾… `onclick` å¤„ç†ç¨‹åºç»“æŸï¼š
```html
<button id="menu">Menu (click me)</button>
<script>
  menu.onclick = function() {
    alert(1);

    menu.dispatchEvent(new CustomEvent("menu-open", {
      bubbles: true
    }));

    alert(2);
  };

  // åœ¨ 1 å’Œ 2 ä¹‹é—´è§¦å‘
  document.addEventListener('menu-open', () => alert('nested'));
</script>
```

> åµŒå¥—äº‹ä»¶ `menu-open` ä¼šåœ¨ `document` ä¸Šè¢«æ•è·ã€‚åµŒå¥—äº‹ä»¶çš„ä¼ æ’­å’Œå¤„ç†å…ˆè¢«å®Œæˆï¼Œç„¶åå¤„ç†è¿‡ç¨‹æ‰ä¼šè¿”å›åˆ°å¤–éƒ¨ä»£ç ï¼ˆ`onclick`ï¼‰ã€‚
>
> è¿™ä¸åªæ˜¯ä¸ `dispatchEvent` æœ‰å…³ï¼Œè¿˜æœ‰å…¶ä»–æƒ…å†µã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨äº†è§¦å‘å…¶ä»–äº‹ä»¶çš„æ–¹æ³• â€”â€” å®ƒä»¬åŒæ ·ä¹Ÿä¼šè¢«ä»¥åµŒå¥—çš„æ–¹å¼åŒæ­¥å¤„ç†ã€‚
>
> å¦‚æœæƒ³è®© `onclick` ä¸å— `menu-open` æˆ–è€…å…¶å®ƒåµŒå¥—äº‹ä»¶çš„å½±å“ï¼Œä¼˜å…ˆè¢«å¤„ç†å®Œæ¯•ã€‚é‚£ä¹ˆå¯ä»¥å°†`dispatchEvent`ï¼ˆæˆ–å¦ä¸€ä¸ªè§¦å‘äº‹ä»¶çš„è°ƒç”¨ï¼‰æ”¾åœ¨ `onclick` æœ«å°¾ï¼Œæˆ–è€…æœ€å¥½å°†å…¶åŒ…è£…åˆ°é›¶å»¶è¿Ÿçš„ `setTimeout` ä¸­ï¼š
>
> ```html
> <script>
>   menu.onclick = function() {
>     alert(1);
> 
>     setTimeout(() => menu.dispatchEvent(new CustomEvent("menu-open", {
>       bubbles: true
>     })));
> 
>     alert(2);
>   };
> 
>   document.addEventListener('menu-open', () => alert('nested'));
> </script>
> ```
>
> ç°åœ¨ï¼Œ`dispatchEvent` åœ¨å½“å‰ä»£ç æ‰§è¡Œå®Œæˆä¹‹åå¼‚æ­¥è¿è¡Œï¼ŒåŒ…æ‹¬ `menu.onclick`ï¼Œå› æ­¤ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºæ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚


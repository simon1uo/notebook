## éœ€æ±‚åˆ†æž

åœ¨ HTTP åè®®ä¸­çš„ Authorization è¯·æ±‚ `header` ä¼šåŒ…å«æœåŠ¡å™¨ç”¨äºŽéªŒè¯ç”¨æˆ·ä»£ç†èº«ä»½çš„å‡­è¯ï¼Œé€šå¸¸ä¼šåœ¨æœåŠ¡å™¨è¿”å›ž `401` ï¼ˆUnauthorized çŠ¶æ€ç ï¼‰ ä»¥åŠ `WWW-Authenticate` æ¶ˆæ¯å¤´ä¹‹åŽåœ¨åŽç»­è¯·æ±‚ä¸­å‘é€æ­¤æ¶ˆæ¯å¤´ã€‚

axios åº“å…è®¸åœ¨è¯·æ±‚é…ç½®ä¸­é…ç½® `auth` å±žæ€§ï¼Œ`auth` æ˜¯ä¸€ä¸ªå¯¹è±¡ç»“æž„ï¼ŒåŒ…å« `username` å’Œ `password` ä¸¤ä¸ªå±žæ€§ã€‚ä¸€æ—¦ç”¨æˆ·åœ¨è¯·æ±‚çš„æ—¶å€™é…ç½®è¿™ä¸¤ä¸ªå±žæ€§ï¼Œå°±ä¼šè‡ªåŠ¨å¾€ HTTP çš„è¯·æ±‚ `header` ä¸­æ·»åŠ ä¸€ä¸ª `Authorization` å±žæ€§ï¼Œå®ƒçš„å€¼ä¸º `Basic` åŠ å¯†ä¸²ï¼ˆ`username:password` base64 åŠ å¯†åŽçš„ç»“æžœï¼‰ã€‚

> ðŸŒ° ä½¿ç”¨ä¾‹å­ï¼š
>
> ```typescript
> axios.post('/more/post', {
>   a: 1
> }, {
>   auth: {
>     username: 'Yee',
>     password: '123456'
>   }
> }).then(res => {
>   console.log(res)
> })
> ```



## ä»£ç å®žçŽ°

ä¿®æ”¹ `AxiosRequestConfig` ç±»åž‹å®šä¹‰ï¼Œ`src/types/index.ts`ï¼š

```typescript
export interface AxiosRequestConfig {
  // ...
  auth?: AxiosBasicCredentials
}

export interface AxiosBasicCredentials {
  username: string
  password: string
}
```



ä¿®æ”¹åˆå¹¶è§„åˆ™ï¼Œå› ä¸º `auth` æ˜¯ä¸€ä¸ªå¯¹è±¡æ ¼å¼ï¼Œå®ƒçš„åˆå¹¶è§„åˆ™åº”è¯¥æ˜¯ `deepMergeStrat` ï¼Œæ·»åŠ åˆ° `stratKeysDeepMerge`ï¼š

ï¼ˆ`src/core/mergeConfig.ts`ï¼‰

```typescript
const stratKeysDeepMerge = ['headers', 'auth']
```



ç„¶åŽä¿®æ”¹å‘é€è¯·æ±‚ä¹‹å‰çš„é€»è¾‘ï¼ˆ`src/core/xhr.ts`ï¼‰ï¼š

```typescript
export default function xhr(config: AxiosRequestConfig): AxiosPromise {
  return new Promise((resolve, reject) => {
    const {
			// ...
      auth
    } = config

    // ...
    
    function configureRequest(): void {
      // ...

      if (auth) {
        headers['Authorization'] = 'Basic' + btoa(auth.username + ':' + auth.password)
      }
    }
  }
}
```



## ç¼–å†™æµ‹è¯• DEMO

`examples/server.js`ï¼š

```js
router.post('/more/post',function(req,res){
  const auth = req.headers.authorization
  const [type,credentials] = auth.split(' ')
  console.log(atob(credentials))
  const [username,password] = atob(credentials).split(':')
  if(type === 'Basic' && username === 'sunib' && password === '123456'){
    res.json(req.body)
  }else{
    res.status(401)
    res.end('UnAuthorization')
  }
})
```

> éœ€è¦å®‰è£… `atob` å®žçŽ° base64 ä¸²çš„è§£ç ã€‚



`examples/more/app.ts` ï¼š

```typescript
axios
  .post(
    '/more/post',
    {
      a: 1
    },
    {
      auth: {
        username: 'simon',
        password: '123456'
      }
    }
  )
  .then(res => {
    console.log(res)
  }
```


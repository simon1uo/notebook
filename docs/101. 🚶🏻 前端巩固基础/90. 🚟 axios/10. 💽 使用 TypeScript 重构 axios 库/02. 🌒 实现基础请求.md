---
title:  ğŸŒ’ å®ç°åŸºç¡€è¯·æ±‚
date: 2022-06-10 21:10:00
permalink: /pages/a6d7da/
categories:
  -  ğŸš¶ğŸ» å‰ç«¯å·©å›ºåŸºç¡€
  - ğŸšŸ axios
  -  ğŸ’½ ä½¿ç”¨ TypeScript é‡æ„ axios åº“
  -  ğŸŒ’ åŸºç¡€åŠŸèƒ½å®ç°
tags:
  - 
---
## åˆ©ç”¨ `XMLHttpRequest` å‘é€è¯·æ±‚

åˆ›å»ºä¸€ä¸ª `xhr.ts` æ–‡ä»¶ï¼Œå¯¼å‡ºä¸€ä¸ª `xhr` æ–¹æ³•ï¼Œæ¥æ”¶ `config` å‚æ•°ã€‚å¹¶ä¸”åœ¨å…¶ä¸­ä½¿ç”¨ `XHLHttpRequest` æ„é€ å™¨åˆ›å»ºè¯·æ±‚å®ä¾‹ï¼Œä» `config` è·å–ç›¸å…³è¯·æ±‚ä¿¡æ¯ï¼š

```ts
import { AxiosRequestConfig } from './types'

export default function xhr(config: AxiosRequestConfig) {
  const { data = null, url, method = 'get' } = config

  const request = new XMLHttpRequest()

  request.open(method.toUpperCase(), url, true)

  request.send(data)
}
```



ç„¶ååœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥ `xhr` æ¨¡å—ï¼š

```ts
import { AxiosRequestConfig } from './types'
import xhr from './xhr'

function axios(config: AxiosRequestConfig) {
  xhr(config)
}

export default axios
```



## DEMO æœåŠ¡



> å®‰è£…ç›¸å…³ä¾èµ–ï¼š
>
> + `webpack` æ˜¯æ‰“åŒ…æ„å»ºå·¥å…·ï¼›
> + `webpack-dev-middleware` å’Œ `webpack-hot-middleware` æ˜¯ 2 ä¸ª `express` çš„ `webpack` ä¸­é—´ä»¶ï¼›
> + `ts-loader` å’Œ `tslint-loader` æ˜¯ `webpack` éœ€è¦çš„ TypeScript ç›¸å…³ loaderï¼Œ`express` æ˜¯ Node.js çš„æœåŠ¡ç«¯æ¡†æ¶ï¼Œ`body-parser` æ˜¯ `express` çš„ä¸€ä¸ªä¸­é—´ä»¶ï¼Œè§£æ `body` æ•°æ®ç”¨çš„ã€‚



åœ¨ `examples` ç›®å½•ä¸‹ï¼š

åˆ›å»º webpack é…ç½®æ–‡ä»¶ï¼š

+ ä¼šåœ¨ examples ç›®å½•ä¸‹å»ºå¤šä¸ªå­ç›®å½•ï¼›ä¼šæŠŠä¸åŒç« èŠ‚çš„ demo æ”¾åˆ°ä¸åŒçš„å­ç›®å½•ä¸­ï¼Œæ¯ä¸ªå­ç›®å½•çš„ä¸‹ä¼šåˆ›å»ºä¸€ä¸ª `app.ts`ï¼Œ`app.ts` ä½œä¸º webpack æ„å»ºçš„å…¥å£æ–‡ä»¶ï¼›`entries` æ”¶é›†äº†å¤šç›®å½•ä¸ªå…¥å£æ–‡ä»¶ï¼Œå¹¶ä¸”æ¯ä¸ªå…¥å£è¿˜å¼•å…¥äº†ä¸€ä¸ªç”¨äºçƒ­æ›´æ–°çš„æ–‡ä»¶ï¼Œ`entries` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ`key` ä¸ºç›®å½•åï¼›
+ `output`ï¼šæ ¹æ®ä¸åŒçš„ç›®å½•åç§°ï¼Œæ‰“åŒ…ç”Ÿæˆç›®æ ‡ `js`ï¼Œåç§°å’Œç›®å½•åä¸€è‡´ã€‚

```js
const fs = require('fs')
const path = require('path')
const webpack = require('webpack')

module.exports = {
  mode: 'development',

  entry: fs.readdirSync(__dirname).reduce((entries, dir) => {
    const fullDir = path.join(__dirname, dir)
    const entry = path.join(fullDir, 'app.ts')
    if (fs.statSync(fullDir).isDirectory() && fs.existsSync(entry)) {
      entries[dir] = ['webpack-hot-middleware/client', entry]
    }

    return entries
  }, {}),

  output: {
    path: path.join(__dirname, '__build__'),
    filename: '[name].js',
    publicPath: '/__build__'
  },

  module: {
    rules: [
      {
        test: /\.ts$/,
        enforce: 'pre',
        use: [{ loader: 'tslint-loader' }]
      },
      {
        test: /\.tsx?$/,
        options: {
          transpileOnly: true
        }
      }
    ]
  },

  resolve: {
    extensions: ['.ts', '.tsx', '.js']
  },

  plugins: [new webpack.HotModuleReplacementPlugin(), new webpack.NoEmitOnErrorsPlugin()]
}
```



åˆ›å»º `server.js` æ–‡ä»¶ï¼š

::: details

```js
const express = require('express')
const bodyParser = require('body-parser')
const webpack = require('webpack')
const webpackDevMiddleware = require('webpack-dev-middleware')
const webpackHotMiddleware = require('webpack-hot-middleware')
const WebpackConfig = require('./webpack.config')

const app = express()
const complier = webpack(WebpackConfig)

app.use(
  webpackDevMiddleware(complier, {
    publicPath: '/__build__/',
    stats: {
      colors: true,
      chunks: false
    }
  })
)

app.use(webpackHotMiddleware(complier))

app.use(express.static(__dirname))

app.use(bodyParser.json())
app.use(bodyParser.urlencoded({ extended: true }))

const port = process.env.PORT || 8080
module.exports = app.listen(port, ()=> {
  console.log('Server listening on http://localhost:${port}, Ctrl+C to stop')
})
```

:::



åˆ›å»º `index.html` / `global.css`ï¼Œä½œä¸ºå…¥å£æ–‡ä»¶ä¸å…¨å±€æ ·å¼æ–‡ä»¶ï¼š

```html
<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>axios-typescript example</title>
</head>
<body style='padding: 0 20px'>
<h1>examples</h1>
<ul>
  <li><a href='simple'>Simple</a></li>
</ul>
</body>
</html>
```

```css
html, body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  color: #2c3e50;
}

ul {
  line-height: 1.5em;
  padding-left: 1.5em;
}

a {
  color: #7f8c8d;
  text-decoration: none;
}

a:hover {
  color: #4fc08d;
}
```



åœ¨ `examples` ç›®å½•ä¸‹åˆ›å»º `simple` ç›®å½•ï¼Œä½œä¸ºæœ¬ç« èŠ‚çš„ demo ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹å†åˆ›å»º `index.html` å’Œ `app.ts` æ–‡ä»¶ï¼š

```html
<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>simple example</title>
</head>
<body>

<script src="/__build__/simple.js"></script>
</body>
</html>
```



```ts
import axios from '../../src/index'

axios({
  method: 'get',
  url: 'simple/get',
  params: {
    a: 1,
    b: 2
  }
})
```



å› ä¸ºæˆ‘ä»¬è¿™é‡Œé€šè¿‡ `axios` å‘é€äº†è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ server ç«¯è¦å®ç°å¯¹åº”çš„è·¯ç”±æ¥å£ï¼Œæˆ‘ä»¬æ¥ä¿®æ”¹ `server.js`ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```js
const router = express.Router()

router.get('/simple/get', function(req,res) {
  res.json({
    msg: 'hello world'
  })
})

app.use(router)
```



åœ¨é¡¹ç›® `package.json` æ·»åŠ è¿è¡Œ `npm run scripts`ï¼š

```json
"dev": "node examples/server.js"
```




## éœ€æ±‚åˆ†æ

axios è¿˜æœ‰ `axios.all` ã€`axios.spread` ç­‰æ–¹æ³•ã€‚

> ğŸŒ° ä½¿ç”¨ä¾‹å­ï¼š
>
> ```typescript
> function getUserAccount() {
>   return axios.get('/user/12345');
> }
> 
> function getUserPermissions() {
>   return axios.get('/user/12345/permissions');
> }
> 
> axios.all([getUserAccount(), getUserPermissions()])
>   .then(axios.spread(function (acct, perms) {
>     // Both requests are now complete
>   }));
> ```
>
> å®é™…ä¸Šï¼Œ`axios.all` å°±æ˜¯ `Promise.all` çš„å°è£…ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª `Promise` æ•°ç»„ï¼Œ`then` å‡½æ•°çš„å‚æ•°æœ¬åº”æ˜¯ä¸€ä¸ªå‚æ•°ä¸º `Promise resolves`ï¼ˆæ•°ç»„ï¼‰çš„å‡½æ•°ï¼Œåœ¨è¿™é‡Œä½¿ç”¨äº† `axios.spread` æ–¹æ³•ã€‚æ‰€ä»¥ `axios.spread` æ–¹æ³•æ˜¯æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ–°å‡½æ•°çš„ç»“æ„æ»¡è¶³ `then` å‡½æ•°çš„å‚æ•°ç»“æ„ã€‚

> å…¶å®ä½¿ç”¨ `Promise` ä¾æ—§å¯ä»¥å®Œæˆè¿™ä¸ªéœ€æ±‚ã€‚
>
> ```typescript
> function getUserAccount() {
>   return axios.get('/user/12345');
> }
> 
> function getUserPermissions() {
>   return axios.get('/user/12345/permissions');
> }
> 
> Promise.all([getUserAccount(), getUserPermissions()])
>   .then(([acct,perms]) {
>     // Both requests are now complete
>   }));
> ```
>
> åœ¨ `Promise.all` çš„ `resolve` å‡½æ•°ä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æ•°ç»„çš„è§£æ„æ‹¿åˆ°æ¯ä¸ªè¯·æ±‚å¯¹åº”çš„å“åº”å¯¹è±¡ã€‚



ä¸ºäº†ä¸ axios åº“èƒ½ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥è¦å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚å¹¶ä¸” axios åº“ä¸­é€šè¿‡ `axios.Axios` å¯¹å¤–æš´éœ²äº† `Axios` ç±»ã€‚è¿˜æœ‰æä¾› `getUri` æ–¹æ³•åœ¨ä¸å‘é€è¯·æ±‚çš„å‰æä¸‹æ ¹æ®ä¼ å…¥çš„é…ç½®è¿”å›ä¸€ä¸ª `url`ï¼š

> ğŸŒ° ä½¿ç”¨ä¾‹å­ï¼š
>
> ```typescript
> const fakeConfig = {
>   baseURL: 'https://www.baidu.com/',
>   url: '/user/12345',
>   params: {
>     idClient: 1,
>     idTest: 2,
>     testString: 'thisIsATest'
>   }
> }
> console.log(axios.getUri(fakeConfig))
> // https://www.baidu.com/user/12345?idClient=1&idTest=2&testString=thisIsATest
> ```



## ä»£ç å®ç°

ä¿®æ”¹ç±»å‹å®šä¹‰ï¼ˆ`types/index.ts`ï¼‰ï¼š

```typescript
export interface AxiosClassStatic {
  new (config: AxiosRequestConfig): Axios
}

export interface AxiosStatic extends AxiosInstance {
  // ...

  all<T>(promises: Array<T | Promise<T>>): Promise<T[]>

  spread<T, R>(callback: (...args: T[]) => R): (arr: T[]) => R

  Axios: AxiosClassStatic
}

export interface Axios {
  // ...

  getUri(config?: AxiosRequestConfig): string
}
```



ç„¶åå®ç°è¿™å‡ ä¸ªé™æ€æ–¹æ³•ï¼š

```typescript
axios.all = function all(promises) {
  return Promise.all(promises)
}

axios.spread = function spread(callback) {
  return function wrap(arr) {
    return callback.apply(null, arr)
  }
}

axios.Axios = axios
```



æœ€åç»™ `Axios` æ·»åŠ å®ä¾‹æ–¹æ³• `getUri` ï¼š

```typescript
getUri(config?: AxiosRequestConfig): string {
  config = mergeConfig(this.defaults, config)
  return transformURL(config)
}
```

> å…ˆä½¿ `config` ä¸é»˜è®¤é…ç½®åˆå¹¶ï¼Œç„¶åå†é€šè¿‡ `transformURL` è¿”å›å®Œæ•´çš„ URLã€‚



## ç¼–å†™æµ‹è¯• DEMO

`examples/more/app.ts`ï¼š

```typescript
function getA() {
  return axios.get('/more/A')
}

function getB() {
  return axios.get('/more/B')
}

axios.all([getA(), getB()]).then(([resA, resB]) => {
  console.log(resA.data)
  console.log(resB.data)
})

const fakeConfig = {
  baseURL: 'https://www.baidu.com/',
  url: '/user/12345',
  params: {
    idClient: 1,
    idTest: 2,
    testString: 'thisIsATest'
  }
}
console.log(axios.getUri(fakeConfig))
```

> é€šè¿‡ `axios.all` åŒæ—¶å‘å‡ºä¸¤ä¸ªè¯·æ±‚ï¼Œè¿”å›äº† `Promise` æ•°ç»„ï¼Œå¯ä»¥åœ¨ `axios.spread` å‚æ•°å‡½æ•°ä¸­è·å¾—ç»“æœï¼Œä¹Ÿå¯ç›´æ¥åœ¨ `then` å‡½æ•°ä¸­æ‹¿åˆ°ç»“æœã€‚


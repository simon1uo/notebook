## éœ€æ±‚åˆ†æ

åœ¨ `aixos` åº“ä¸­ï¼Œé»˜è®¤é…ç½®ä¼šæ·»åŠ  `transformRequest` å’Œ `transformResponse` ä¸¤ä¸ªå­—æ®µï¼Œå®ƒä»¬çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚

+ `transformRequest`ï¼šå…è®¸å°†è¯·æ±‚æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰è¿›è¡Œä¿®æ”¹ï¼Œé€‚ç”¨äº `put`ã€`post` å’Œ `patch` è¯·æ±‚æ–¹æ³•ï¼Œå¦‚æœå€¼æ˜¯æ•°ç»„ï¼Œåˆ™æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² `FormData`ã€`URLSearchParams`ã€`Blob` ç­‰ç±»å‹ä½œä¸º `xhr.send` æ–¹æ³•çš„å‚æ•°ï¼Œè€Œä¸”åœ¨ `transform` è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹ `headers` å¯¹è±¡ï¼›
+ `transfromResponse` å…è®¸åœ¨ç›¸åº”æ•°æ®ä¼ é€’ç»™ `then` æˆ–è€… `catch` ä¹‹å‰å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹ï¼›å½“å€¼ä¸ºæ•°ç»„çš„æ—¶å€™ï¼Œæ•°ç»„çš„æ¯ä¸ªå‡½æ•°éƒ½æ˜¯ä¸€ä¸ªè½¬æ¢å‡½æ•°ï¼Œå‰è€…çš„è¾“å‡ºä½œä¸ºåè€…çš„è¾“å…¥ã€‚



> ğŸŒ° ä¾‹å­ï¼š
> ```typescript
> axios({
>   transfromRequest: [(function(data) {
>     return qs.stringify(data)
>   }), ...axios.defaults.transformRequest],
> 	transformResponse: [axios.defaults.transformResponse, function(data) {
>     if(typeof data === 'object') {
>       data.b = 2
>     }
>     return data
>   }],
>   url: '/config/post',
>   method: 'post',
>   data: {
>     a: 1
>   }
> })
> ```



## ä¿®æ”¹é»˜è®¤é…ç½®

åœ¨ `src/types/index.ts` ä¸­ï¼š

æ·»åŠ ä¸€ä¸ªç±»å‹ `AxiosTransformer` ã€‚

```typescript
export interface AxiosTransformer {
  (data: any, headers?: any):any
}
```

ç„¶åä¿®æ”¹ `AxiosRequestConfig` çš„ç±»å‹å®šä¹‰ï¼š

```typescript
export interface AxiosRequestConfig {
  // ...
  transformRequest?: AxiosTransformer | AxiosTransformer[]
  transformResponse?: AxiosTransformer | AxiosTransformer[]
}
```

> æ·»åŠ ä¸¤ä¸ªå¯é€‰å±æ€§ã€‚



ç„¶åä¿®æ”¹é»˜è®¤é…ç½®ï¼Œåœ¨ `src/defaults.ts` ä¸­ï¼š 

```typescript
import { AxiosRequestConfig } from './types'
import { processHeaders } from './helpers/headers'
import { transformRequest, transformResponse } from './helpers/data'

const defaults: AxiosRequestConfig = {
  method: 'get',
  timeout: 0,
  headers: {
    common: {
      Accept: 'application/json, text/plain, */*'
    }
  },

  transformRequest: [
    function(data: any, headers: any): any {
      processHeaders(headers, data)
      return transformRequest(data)
    }
  ],
  transformResponse: [
    function(data: any): any {
      return transformResponse(data)
    }
  ]
}
```

> å°†ä¹‹å‰å¯¹è¯·æ±‚æ•°æ®å’Œç›¸åº”æ•°æ®çš„å¤„ç†é€»è¾‘ï¼Œæ”¾åˆ°é»˜è®¤é…ç½®ä¸­ã€‚



## `transform` é€»è¾‘é‡æ„ 

é‡æ„ä¹‹å‰å†™çš„ å¯¹è¯·æ±‚æ•°æ®å’Œç›¸åº”æ•°æ®çš„å¤„ç†é€»è¾‘ã€‚å¯èƒ½ä¼šç¼–å†™å¤šä¸ªè½¬æ¢å‡½æ•°ï¼Œå…ˆå®šä¹‰ä¸€ä¸ª `transform` å‡½æ•°å¤„ç†è¿™äº›è½¬æ¢å‡½æ•°çš„è°ƒç”¨é€»è¾‘ã€‚

`src/core/transform.ts`ï¼š

```typescript
import { AxiosTransformer } from '../types'

export default function transform(
  data: any,
  headers: any,
  fns?: AxiosTransformer | AxiosTransformer[]
): any {
  if(!fns) return data
  
  if(!Array.isArray(fns)) fns = [fns]
  
  fns.forEach(fn => {
    data = fn(data, headers)
  })
  
  return data
}
```

> `transform` å‡½æ•°ä¸­æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ `fns` ä»£è¡¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªè½¬æ¢å‡½æ•°ï¼Œå†…éƒ¨é€»è¾‘ä¸º éå† `fns`ï¼Œæ‰§è¡Œè¿™äº›è½¬æ¢å‡½æ•°ï¼Œå¹¶ä¸”æŠŠ `data` å’Œ `headers` ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæ¯ä¸ªè½¬æ¢å‡½æ•°è¿”å›çš„ `data` æˆ–ä½œä¸ºä¸‹ä¸€ä¸ªè½¬æ¢å‡½æ•°çš„å‚æ•° `data` ä¼ å…¥ã€‚



ä¿®æ”¹å¯¹è¯·æ±‚æ•°æ®å’Œç›¸åº”æ•°æ®å¤„ç†çš„é€»è¾‘ï¼š

`src/core/dispatchRequest.ts` ï¼š

```typescript
function processConfig(config: AxiosRequestConfig): void {
  config.url = transformURL(config)
  config.headers = transformRequestHeader(config)
  config.data = transform(config.data, config.headers, config.transformRequest)
  config.headers = flattenHeaders(config.headers, config.method!)
}
```

```typescript
function transformResponseData(res: AxiosResponse): AxiosResponse {
  res.data = transform(res.data, res.headers, res.config.transformResponse)
  return res
}
```

> å°†å¯¹è¯·æ±‚æ•°æ®çš„å¤„ç†å’Œå¯¹å“åº”æ•°æ®çš„å¤„ç†æ”¹æˆé€‚ç”¨ `transform` å‡½æ•°çš„å®ç°ï¼Œå¹¶ä¸”æŠŠé…ç½®ä¸­çš„ `transformRequest` ä»¥åŠ `transformResponse` åˆ†åˆ«ä¼ å…¥ã€‚



## ç¼–å†™æµ‹è¯• DEMO

```typescript
axios({
  transfromRequest: [(function(data) {
    return qs.stringify(data)
  }), ...axios.defaults.transformRequest],
	transformResponse: [axios.defaults.transformResponse, function(data) {
    if(typeof data === 'object') {
      data.b = 2
    }
    return data
  }],
  url: '/config/post',
  method: 'post',
  data: {
    a: 1
  }
})
```


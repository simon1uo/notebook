


ğŸ”— ç›¸å…³é“¾æ¥ï¼š**axios GitHub** [axios/axios: Promise based HTTP client for the browser and node.js (github.com)](https://github.com/axios/axios) 

> + æ˜¯ç›®å‰å‰ç«¯æœ€æµè¡Œçš„ AJAX è¯·æ±‚åº“ã€‚
> + React / Vue å®˜æ–¹æ¨èä½¿ç”¨ axios å‘é€ AJAX è¯·æ±‚ã€‚



> å¯ä»¥ä½¿ç”¨ [json-server](https://github.com/typicode/json-server) æ­å»ºä¸€ä¸ªæµ‹è¯•çš„ http æœåŠ¡ã€‚ï¼ˆåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„ [RESTful é£æ ¼]()çš„è¯·æ±‚ API ï¼‰
>
> + å…¨å±€å®‰è£… json-serverï¼š
>
> ```
> $ npm install -g json-server
> ```
>
> ï¼ˆè¯¦ç»†æ­¥éª¤æŸ¥çœ‹ [json-server Github README](https://github.com/typicode/json-server#readme)ï¼‰

 

### axios ç‰¹ç‚¹

ï¼ˆfeaatures from axios GitHub official docï¼‰

+ **æ˜¯åŸºäº XHR + Promise çš„å¼‚æ­¥ AJAX è¯·æ±‚åº“**
+ æµè§ˆå™¨ç«¯ / node ç«¯éƒ½å¯ä»¥ä½¿ç”¨
+ æ”¯æŒè¯·æ±‚ / å“åº”æ‹¦æˆªå™¨
+ æ”¯æŒè¯·æ±‚å–æ¶ˆ
+ è¯·æ±‚ / å“åº”æ•°æ®è½¬æ¢
+ æ‰¹é‡å‘é€å¤šä¸ªè¯·æ±‚



### axios çš„åŸºæœ¬ä½¿ç”¨

ğŸŒ° ä¾‹å­ï¼š

![image-20220421165550462](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/IyO3jC.png)

+ å‘é€ GET è¯·æ±‚ï¼š

```js
btns[0].onclick = function (){
    // å‘é€AJAXè¯·æ±‚GET
    axios({
     		// è¯·æ±‚æ–¹æ³•
        method: 'GET',
      	// è¯·æ±‚è·¯å¾„url
        url: 'http://localhost:3000/posts/2',
    }).then(response => {
      	// è¿”å›promiseç±»å‹
        console.log(response)
    })
}
```



+ å‘é€ POST è¯·æ±‚ï¼š

```js
btns[1].onclick = function (){
    // å‘é€AJAXè¯·æ±‚POST
    axios({
        method: 'POST',
        url: 'http://localhost:3000/posts',
        // è®¾ç½®è¯·æ±‚ä½“
        data: {
            title: 'testAddPosts',
            author: 'Simon'
        }
    }).then(response => {
        console.log(response)
    })
}
```



+ å‘é€ PUT è¯·æ±‚ï¼š

```js
btns[2].onclick = function (){
    // å‘é€AJAXè¯·æ±‚PUT æ›´æ–°æ•°æ®
    axios({
        method: 'PUT',
        url: 'http://localhost:3000/posts/3',
        // è®¾ç½®è¯·æ±‚ä½“
        data: {
            title: 'testAddPosts',
            author: 'Nomis'
        }
    }).then(response => {
        console.log(response)
    })
}
```



+ å‘é€ DELETE è¯·æ±‚ï¼š

```js
btns[3].onclick = function (){
    // å‘é€AJAXè¯·æ±‚PUT æ›´æ–°æ•°æ®
    axios({
        method: 'DELETE',
        url: 'http://localhost:3000/posts/4',
    }).then(response => {
        console.log(response)
    })
}
```



### axios **è¯­æ³•**

**å‘é€è¯·æ±‚çš„æ–¹æ³•**ï¼š

+ `axios(config)`ï¼š é€šç”¨ / æœ€æœ¬è´¨çš„å‘ä»»æ„ç±»å‹è¯·æ±‚çš„æ–¹å¼

+ `axios(url[, config])`ï¼šå¯ä»¥åªæŒ‡å®š url å‘ get è¯·æ±‚
+ `axios.request(config)`ï¼šç­‰åŒäº `axios(config)` 
+ `axios.get(url[, config])`ï¼š å‘ get è¯·æ±‚
+ `axios.delete(url[, config])`ï¼š å‘ delete è¯·æ±‚
+ `axios.post(url[, data, config])`ï¼šå‘ post è¯·æ±‚
+ `axios.put(url[, data, config])`ï¼š å‘ put è¯·æ±‚



ğŸŒ° ä¾‹å­ï¼ˆä½¿ç”¨ `axios.request(config)ï¼‰`ï¼‰ï¼š

```js
// å‘é€getè¯·æ±‚
btns[0].onclick = function (){
    axios.request({
        method: 'GET',
        url: 'http://localhost:3000/posts'
    }).then(response=>{
        console.log(response)
    })
}
```



ğŸŒ° ä¾‹å­ï¼ˆä½¿ç”¨ `axios.post()` å‘é€ post è¯·æ±‚ï¼‰ï¼š

```js
btns[1].onclick = function () {
    axios.post(
        'http://localhost:3000/posts', {
            title: 'testAddPosts',
            author: 'Simon'
        }
    ).then(response => {
        console.log(response)
    })
}
```

ï¼ˆ`axios.put()`ã€`axios.delete()` çš„ä½¿ç”¨ä¸ä¸Šå¤§åŒå°å¼‚ï¼‰



### axios å“åº”å¯¹è±¡

![image-20220421190035100](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/NIzdMO.png)

å“åº”å¯¹è±¡ `response` å¯¹è±¡

+ `config` ï¼šé…ç½®å¯¹è±¡çš„å±æ€§ã€‚
+ `data`ï¼šå“åº”ä½“çš„ç»“æœï¼ˆæœåŠ¡å™¨è¿”å›çš„ç»“æœï¼‰ï¼ˆaxios è‡ªåŠ¨å°†æœåŠ¡å™¨è¿”å›çš„ç»“æœè½¬åŒ–ä¸ºå¯¹è±¡æ–¹ä¾¿å¤„ç†ï¼‰ã€‚
+ `headers` ï¼šå“åº”å¤´ä¿¡æ¯ã€‚
+ `request` ï¼šAJAX åŸç”Ÿè¯·æ±‚å¯¹è±¡ï¼ˆaxios å‘é€è¯·æ±‚æ—¶åˆ›å»ºçš„ï¼‰ã€‚
+ `status`ï¼šå“åº”çŠ¶æ€ç  / `status`ï¼š å“åº”å­—ç¬¦ä¸²ã€‚



### axios è¯·æ±‚å¯¹è±¡

axios å‘é€è¯·æ±‚æ—¶çš„é…ç½®å¯¹è±¡ `config` ï¼š

```js
{
  url: '/user', // è¯·æ±‚çš„è·¯å¾„
  method: 'get', // è¯·æ±‚æ–¹æ³•ï¼Œé»˜è®¤ä¸ºget
  baseURL: 'https://localhost:3000/api', // åŸºç¡€ç»“æ„ï¼Œåœ¨è®¾ç½®urlåªè®¾ç½®è·¯å¾„å³å¯ï¼Œaxiosè‡ªåŠ¨æ‹¼æ¥ä¸ºå®Œæ•´çš„è¯·æ±‚è·¯å¾„
  transformRequest: [function (data, headers) {
    // Do whatever you want to transform the data

    return data;
  }], // å¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œå¤„ç†å†å‘é€åˆ°æœåŠ¡å™¨
  transformResponse: [function (data) {
    // Do whatever you want to transform the data

    return data;
  }], // å¯¹æœåŠ¡å™¨å“åº”çš„ç»“æœè¿›è¡Œå¤„ç†å†æ¥æ”¶

  headers: {'X-Requested-With': 'XMLHttpRequest'}, // è¯·æ±‚å¤´ä¿¡æ¯è‡ªå®šä¹‰æ§åˆ¶

  params: {
    id: 1,
    name: simon
  }, // è®¾ç½®å‘é€è¯·æ±‚æ—¶ä¼ é€’çš„å‚æ•°ï¼Œåœ¨å¯¹è±¡ä¸­è®¾ç½®

  // (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)
  paramsSerializer: function (params) {
    return Qs.stringify(params, {arrayFormat: 'brackets'})
  }, // å‚æ•°åºåˆ—åŒ–ï¼ˆå¯¹è¯·æ±‚çš„å‚æ•°å¤„ç†æ ¼å¼ï¼‰

  data: {
    firstName: 'Fred'
  }, // è¯·æ±‚ä½“è®¾ç½®ï¼Œå‚æ•°ä¸ºå¯¹è±¡ä¼šè½¬ä¸ºjsonï¼Œå­—ç¬¦ä¸²ç›´æ¥ä¼ é€’

	timeout: 1000, // default is `0` (no timeout)
  // ... æ›´å¤šå‰å¾€å®˜æ–¹æ–‡æ¡£ä¸­å‚è€ƒ
}
```



### axios æ›´å¤š API

#### **axios çš„é»˜è®¤é…ç½®**

 `axios.defalut.*`ï¼ˆå°†å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•ï¼Œè¯·æ±‚è·¯å¾„ä¸­è®¾ç½®ä¸ºé»˜è®¤åï¼Œåé¢è°ƒä½¿ç”¨ `axios` è¯·æ±‚æ–¹æ³•æ—¶å¯ä»¥è°ƒç”¨ä¸ºé»˜è®¤é…ç½®ä½¿ç”¨ã€‚ï¼‰

ğŸŒ° ä¾‹å­ï¼š

```js
axios.default.method = 'GET' // è®¾ç½®é»˜è®¤è¯·æ±‚ç±»å‹ä¸ºget
axios.default.baseURL = 'http://localhost:3000' // è®¾ç½®åŸºç¡€çš„URL
axios.default.params = {id: 1} // è®¾ç½®é»˜è®¤çš„è¯·æ±‚å‚æ•°
axios.default.timeout = 3000; // è®¾ç½®é»˜è®¤çš„è¶…æ—¶æ—¶é—´

btns[0].onclick = function () {
    axios.request({
        url: '/posts'
    }).then(response => {
        console.log(response)
    })
}
```



#### **axios åˆ›å»ºå®ä¾‹å¯¹è±¡**

 `axios.create({config})` ã€‚ä½œç”¨ï¼šå¦‚æœæœåŠ¡å™¨çš„æ¥å£ï¼ˆç«¯å£ï¼‰æœ‰å¤šä¸ªï¼Œåœ¨æ¯æ¬¡åˆ›å»ºè¯·æ±‚æ—¶åˆ›å»ºçš„è¯·æ±‚å¯¹è±¡å¯ä»¥æ ¹æ®ä¸åŒçš„æœåŠ¡å™¨è¿›è¡Œä¸åŒçš„é…ç½®ã€‚

```js
// åˆ›å»ºaxioså®ä¾‹å¯¹è±¡, ä¸aixosçš„åŠŸèƒ½è¿‘ä¹ä¸€æ ·
const getDuanzi = axios.create({
    baseURL: 'https://api.apiopen.top',
    timeout: 2000
})

// è¯·æ±‚
/*getDuanzi({
    url: '/getJoke'
}).then(response=>{
    console.log(response)
})*/

getDuanzi.get('/getJoke').then(response=>{
    console.log(response.data)
})
```



#### **axios æ‹¦æˆªå™¨**

`axios.interceptors.*.use` å®è´¨ä¸Šæ˜¯å‡½æ•°ï¼Œåˆ†ä¸ºä¸¤ç§ï¼šè¯·æ±‚æ‹¦æˆªå™¨ã€å“åº”æ‹¦æˆªå™¨ï¼Œå†…éƒ¨åŸç†ä¸ Promise æœ‰å…³ï¼š

+ è¯·æ±‚æ‹¦æˆªå™¨ï¼šå‘é€è¯·æ±‚ä¹‹å‰ï¼Œå€ŸåŠ©æŒ‡å®šå›è°ƒï¼ˆå‡½æ•°ï¼‰å¯¹è¯·æ±‚çš„å‚æ•°è¿›è¡Œé¢„å¤„ç†ï¼ˆæ£€æµ‹ï¼‰ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜åˆ™å‘é€è¯·æ±‚ï¼Œæœ‰é—®é¢˜åˆ™æ‹¦æˆªã€‚
+ å“åº”æ‹¦æˆªå™¨ï¼šæœåŠ¡å™¨è¿”å›ç»“æœï¼Œå€ŸåŠ©çš„å›è°ƒå¯¹è¿”å›çš„ç»“æœè¿›è¡Œé¢„å¤„ç†ï¼Œç»“æœæ ¼å¼åŒ–æˆ–è€…ç»“æœé—®é¢˜ç›‘æµ‹ã€‚



ğŸŒ° ä¾‹å­ï¼ˆè¯·æ±‚æ‹¦æˆªå™¨ä¸å“åº”æ‹¦æˆªå™¨çš„é…ç½®ï¼‰ï¼š

```js
// é…ç½®è¯·æ±‚æ‹¦æˆªå™¨
axios.interceptors.request.use(function (config) {
    // è¯·æ±‚å‘é€ä¹‹å‰å¯¹è¯·æ±‚çš„æ“ä½œ
    console.log('request success')
    return config;
}, function (error) {
    console.log('request fail')
    return Promise.reject(error);
});
```

```js
// é…ç½®å“åº”æ‹¦æˆªå™¨
axios.interceptors.response.use(function (response) {
    // æˆåŠŸå“åº”å(å“åº”ç åœ¨200ä»¥å†…)å¯¹å“åº”è¿›è¡Œçš„æ“ä½œ
    console.log('response success')
    return response;
}, function (error) {
    // å“åº”å‡ºé”™(å“åº”ç 200ä»¥å¤–)å¯¹å“åº”çš„æ“ä½œ
    console.log('response  fail')
    return Promise.reject(error);
});
```



è¯·æ±‚ / å“åº”æˆåŠŸåï¼Œæ‹¦æˆªå™¨è¿›è¡Œçš„é¡ºåºå¦‚ä¸‹ï¼š

![image-20220421200650883](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/BThrJe.png)



å½“è¯·æ±‚ä¸­å‡ºç°é”™è¯¯æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæ‹¦æˆªå™¨æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š

![image-20220421200951532](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/YCOR0I.png)



æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåºï¼š

+ è¯·æ±‚æ‹¦æˆªå™¨æœ€åå£°æ˜çš„å…ˆæ‰§è¡Œã€‚
+ å“åº”æ‹¦æˆªå™¨çš„å…ˆå£°æ˜çš„å…ˆæ‰§è¡Œã€‚



ğŸŒ° è¯·æ±‚æ‹¦æˆªå™¨å¤„ç†è¯·æ±‚å‚æ•°é…ç½® `config` ï¼š

```js
axios.interceptors.request.use(function (config) {
    // è¯·æ±‚å‘é€ä¹‹å‰å¯¹è¯·æ±‚çš„æ“ä½œ
    config.params = {a: 100}
    config.timeout = 2000
    console.log('request interceptors success')
    return config;
}, function (error) {
    console.log('request interceptors fail')
    return Promise.reject(error);
});
```



ğŸŒ° å“åº”æ‹¦æˆªå™¨å¤„ç†å“åº”å‚æ•° `response` ï¼š

```js
axios.interceptors.response.use(function (response) {
    console.log('response interceptors success')
    console.log(response) // Promiseåˆ›å»ºçš„å“åº”ç»“æœå¯¹è±¡
    console.log(response.data) // åªæœ‰å“åº”ä½“
    return response;
}, function (error) {
    console.log('response interceptors  fail')
    return Promise.reject(error);
});
```



#### axios å–æ¶ˆè¯·æ±‚

`axios.CancelToken()`



> åœ¨ **json-server** ä¸­å¼€å¯å»¶æ—¶å“åº”ï¼š
>
> ```
> $ json-server --watch db.json -d 2000
> ```

ğŸŒ° ä¾‹å­ï¼š

```js
//è·å–æŒ‰é’®
const btns = document.querySelectorAll('button');
//2.å£°æ˜å…¨å±€å˜é‡
let cancel = null;
//å‘é€è¯·æ±‚
btns[0].onclick = function(){
    //æ£€æµ‹ä¸Šä¸€æ¬¡çš„è¯·æ±‚æ˜¯å¦å·²ç»å®Œæˆ
    if(cancel !== null){
        //å–æ¶ˆä¸Šä¸€æ¬¡çš„è¯·æ±‚
        cancel();
    }
    axios({
        method: 'GET',
        url: 'http://localhost:3000/posts',
        //1. æ·»åŠ é…ç½®å¯¹è±¡çš„å±æ€§
        cancelToken: new axios.CancelToken(function(c){
            //3. å°† c çš„å€¼èµ‹å€¼ç»™ cancel
            cancel = c;
        })
    }).then(response => {
        console.log(response);
        //å°† cancel çš„å€¼åˆå§‹åŒ–
        cancel = null;
    })
}

//ç»‘å®šç¬¬äºŒä¸ªäº‹ä»¶å–æ¶ˆè¯·æ±‚
btns[1].onclick = function(){
    cancel();
}
```




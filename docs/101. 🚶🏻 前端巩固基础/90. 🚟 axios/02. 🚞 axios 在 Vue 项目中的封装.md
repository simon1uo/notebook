---
title:  ğŸš axios åœ¨ Vue é¡¹ç›®ä¸­çš„å°è£…
date: 2022-06-24 22:11:28
permalink: /pages/2626b9/
categories:
  -  ğŸš¶ğŸ» å‰ç«¯å·©å›ºåŸºç¡€
  -  ğŸšŸ axios
tags:
  - 
---
> `axios` æ‹¥æœ‰å‹å¥½çš„ API è°ƒç”¨ï¼Œå¯ä»¥è½»æ¾åœ¨é¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯éšç€é¡¹ç›®è§„æ¨¡è¶Šå¤§ï¼Œå¦‚æœæ¯å‘èµ·ä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œéƒ½è¦è¿›è¡Œä¸€éä¸€éå¦‚ è¶…æ—¶æ—¶é—´ã€è¯·æ±‚å¤´ã€è¯·æ±‚åœ°å€ã€é”™è¯¯å¤„ç†ç­‰çš„é‡å¤é…ç½®ï¼Œä¸ä»…æµªè´¹æ—¶é—´è€Œä¸”è®©ä»£ç å˜å¾—å†—ä½™ã€‚



## å°è£…çš„å†…å®¹

åœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œåº”è¯¥è¦ä¸åç«¯åå•†å¥½ è¯·æ±‚å¤´ã€åè®®ã€è¯·æ±‚åœ°å€ã€è¯·æ±‚è¶…æ—¶æ—¶é—´çš„çº¦å®šã€‚ä»¥ä¾¿å¯¹ axios è¿›è¡Œè¿›ä¸€æ­¥çš„å°è£…ä¸€ä¸‹å†…å®¹ï¼š

+ **è®¾ç½®æ¥å£è¯·æ±‚çš„å‰ç¼€**ã€‚ æ ¹æ®å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§çš„ä¸‰ç§ä¸åŒç¯å¢ƒï¼Œåˆ†åˆ«é…ç½®ä¸åŒçš„è¯·æ±‚åœ°å€å‰ç¼€ã€‚
+ **è¯·æ±‚å¤´**ã€‚ä¾‹å¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€çš„éªŒè¯ï¼Œåœ¨æ¯æ¬¡å‘é€è¯·æ±‚ä¸­çš„è¯·æ±‚å¤´ä¸­æ·»åŠ  tokenï¼›æˆ–è€…åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ä¸€äº›å‚æ•°ã€‚
+ çŠ¶æ€ç ã€‚æ ¹æ®æ¥å£è¿”å›ä¸åŒçš„ `status` ï¼Œæ‰§è¡Œä¸åŒçš„ä¸šåŠ¡ã€‚
+ è¯·æ±‚æ–¹æ³•ã€‚å¯¹ `get`ã€`post` ç­‰æ–¹æ³•è¿›è¡Œå†ä¸€æ¬¡å°è£…ã€‚
+ è¯·æ±‚æ‹¦æˆªå™¨ï¼šæ ¹æ®è¯·æ±‚çš„è¯·æ±‚å¤´å†³å®šï¼Œå†³å®šå“ªäº›è¯·æ±‚å¯ä»¥è®¿é—®ã€‚
+ å“åº”æ‹¦æˆªå™¨ï¼šæ ¹æ®åç«¯è¿”å›çš„çŠ¶æ€ç åˆ¤æ–­æ‰§è¡Œä¸åŒçš„ä¸šåŠ¡ã€‚



### è®¾ç½®æ¥å£çš„å‰ç¼€

é€šå¸¸æ–¹æ³•ã€‚æ ¹æ® `node` ç¯å¢ƒå˜é‡åˆ¤æ–­åŒºåˆ†å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒã€‚

```js
if (process.env.NODE_ENV === 'development') {
  axios.defaults.baseURL = 'http://dev.xxx.com'
} else if (process.env.NODE_ENV === 'production') {
  axios.defaults.baseURL = 'http://prod.xxx.com'
}
```

> åœ¨æœ¬åœ°å¼€å‘è°ƒè¯•æ—¶ï¼Œé…ç½®ä»£ç†æœåŠ¡å™¨ `devServer` ï¼š
>
> ```javascript
> devServer: {
>     proxy: {
>       '/proxyApi': {
>         target: 'http://dev.xxx.com',
>         changeOrigin: true,
>         pathRewrite: {
>           '/proxyApi': ''
>         }
>       }
>     }
>   }
> }
> ```



### è®¾ç½®è¯·æ±‚å¤´ä¸è¶…æ—¶æ—¶é—´

å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯·æ±‚å¤´éƒ½æ˜¯å›ºå®šçš„ï¼Œåªæœ‰å°‘éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¼šéœ€è¦ä¸€äº›ç‰¹æ®Šçš„è¯·æ±‚å¤´ã€‚è¿™é‡Œè®¾ç½®çš„æ˜¯åŸºç¡€çš„è¯·æ±‚å¤´ã€‚å½“éœ€è¦ç‰¹æ®Šçš„è¯·æ±‚å¤´æ—¶ï¼Œå†å°†ç‰¹æ®Šçš„è¯·æ±‚å¤´ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¦†ç›–åŸºç¡€é…ç½®ã€‚

```javascript
const service = axios.create({
    ...
    timeout: 30000,  // è¯·æ±‚ 30s è¶…æ—¶
	  headers: {
        get: {
          'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'
          // åœ¨å¼€å‘ä¸­ï¼Œä¸€èˆ¬è¿˜éœ€è¦å•ç‚¹ç™»å½•æˆ–è€…å…¶ä»–åŠŸèƒ½çš„é€šç”¨è¯·æ±‚å¤´ï¼Œå¯ä»¥ä¸€å¹¶é…ç½®è¿›æ¥
        },
        post: {
          'Content-Type': 'application/json;charset=utf-8'
          // åœ¨å¼€å‘ä¸­ï¼Œä¸€èˆ¬è¿˜éœ€è¦å•ç‚¹ç™»å½•æˆ–è€…å…¶ä»–åŠŸèƒ½çš„é€šç”¨è¯·æ±‚å¤´ï¼Œå¯ä»¥ä¸€å¹¶é…ç½®è¿›æ¥
        }
  },
})
```



### å°è£…è¯·æ±‚æ–¹æ³•

```javascript
// get è¯·æ±‚
export function httpGet({
  url,
  params = {}
}) {
  return new Promise((resolve, reject) => {
    axios.get(url, {
      params
    }).then((res) => {
      resolve(res.data)
    }).catch(err => {
      reject(err)
    })
  })
}
```

```javascript
export function httpPost({
  url,
  data = {},
  params = {}
}) {
  return new Promise((resolve, reject) => {
    axios({
      url,
      method: 'post',
      transformRequest: [function (data) {
        let ret = ''
        for (let it in data) {
          ret += encodeURIComponent(it) + '=' + encodeURIComponent(data[it]) + '&'
        }
        return ret
      }],
      // å‘é€çš„æ•°æ®
      data,
      // urlå‚æ•°
      params

    }).then(res => {
      resolve(res.data)
    })
  })
}
```

```js
import { httpGet, httpPost } from './http'
export const getorglist = (params = {}) => httpGet({ url: 'apps/api/org/list', params })
```

### è¯·æ±‚æ‹¦æˆªå™¨

è¿™é‡Œä»¥åœ¨æ¯æ¬¡è¯·æ±‚ä¹‹å‰æ·»åŠ  `token` ä¸ºä¾‹å­ã€‚è®¾ç½®å¦‚ä¸‹çš„æ‹¦æˆªå™¨ï¼š

```js
axios.interceptors.request.use(
  config => {
    // æ¯æ¬¡å‘é€è¯·æ±‚ä¹‹å‰åˆ¤æ–­æ˜¯å¦å­˜åœ¨token
    // å¦‚æœå­˜åœ¨ï¼Œåˆ™ç»Ÿä¸€åœ¨httpè¯·æ±‚çš„headeréƒ½åŠ ä¸Štokenï¼Œè¿™æ ·åå°æ ¹æ®tokenåˆ¤æ–­ä½ çš„ç™»å½•æƒ…å†µï¼Œæ­¤å¤„tokenä¸€èˆ¬æ˜¯ç”¨æˆ·å®Œæˆç™»å½•åå‚¨å­˜åˆ°localstorageé‡Œçš„
    token && (config.headers.Authorization = token)
    return config
  },
  error => {
    return Promise.error(error)
  })
```



### å“åº”æ‹¦æˆªå™¨

å“åº”æ‹¦æˆªå™¨å¯ä»¥åœ¨æ¥æ”¶åˆ°å“åº”ä¹‹åå…ˆå®Œæˆä¸€ç³»åˆ—çš„é€»è¾‘ã€‚

è¿™é‡Œä»¥æ ¹æ®çŠ¶æ€ç åˆ¤æ–­ç™»å½•çŠ¶æ€ã€æˆæƒï¼Œå¤„ç†é”™è¯¯ä¸ºä¾‹ï¼š

```js
// å“åº”æ‹¦æˆªå™¨
axios.interceptors.response.use(response => {
  // å¦‚æœè¿”å›çš„çŠ¶æ€ç ä¸º200ï¼Œè¯´æ˜æ¥å£è¯·æ±‚æˆåŠŸï¼Œå¯ä»¥æ­£å¸¸æ‹¿åˆ°æ•°æ®
  // å¦åˆ™çš„è¯æŠ›å‡ºé”™è¯¯
  if (response.status === 200) {
    if (response.data.code === 511) {
      // æœªæˆæƒè°ƒå–æˆæƒæ¥å£
    } else if (response.data.code === 510) {
      // æœªç™»å½•è·³è½¬ç™»å½•é¡µ
    } else {
      return Promise.resolve(response)
    }
  } else {
    return Promise.reject(response)
  }
}, error => {
  // æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå¯¹å¼‚å¸¸çŠ¶æ€ä½œç»Ÿä¸€å¤„ç†
  if (error.response.status) {
    // å¤„ç†è¯·æ±‚å¤±è´¥çš„æƒ…å†µ
    // å¯¹ä¸åŒè¿”å›ç å¯¹ç›¸åº”å¤„ç†
    return Promise.reject(error.response)
  }
})
```
---
title:  âš½ï¸ JavaScript ç±»çš„åŸºæœ¬è¯­æ³•
date: 2022-05-16 17:36:50
permalink: /pages/14c9f8/
categories:
  -  ğŸ“™ JavaScript ç±»
tags:
  - JavaScript æ·±å…¥éƒ¨åˆ†
---
JavaScript ä¸­ï¼Œè¦åˆ›å»ºè®¸å¤šç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚ç”¨æˆ·ï¼ˆusersï¼‰ã€å•†å“ï¼ˆgoodsï¼‰æˆ–è€…ä»»ä½•å…¶ä»–ä¸œè¥¿ã€‚

æ„é€ å™¨ å’Œ æ“ä½œç¬¦ `new` ï¼Œå¯ä»¥å®ç°è¿™ç§éœ€æ±‚ã€‚

ä½†åœ¨ç°ä»£ JavaScript ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´é«˜çº§çš„ã€Œç±»ï¼ˆclassï¼‰ã€æ„é€ æ–¹å¼ï¼Œå®ƒå¼•å…¥è®¸å¤šéå¸¸æ£’çš„æ–°åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¯¹äºé¢å‘å¯¹è±¡ç¼–ç¨‹å¾ˆæœ‰ç”¨ã€‚



## åŸºæœ¬è¯­æ³•

åˆ›å»ºä¸€ä¸ªç±»çš„è¯­æ³•
```js
class myClass {
  constructor() { ... }
  
  method1() { ... }
  method2() { ... }
  method3() { ... }
}
```

ç„¶åä½¿ç”¨ `new MyClass()` æ¥åˆ›å»ºå…·æœ‰ä¸Šè¿°åˆ—å‡ºçš„æ‰€æœ‰æ–¹æ³•çš„æ–°å¯¹è±¡ã€‚`new` ä¼šè‡ªåŠ¨è°ƒç”¨ `constructor()` æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥åœ¨ `constructor()` ä¸­åˆå§‹åŒ–å¯¹è±¡ã€‚



ğŸŒ° ä¾‹å­ / ä½¿ç”¨ä¾‹å­ã€‚ï¼š

```js
class User {

  constructor(name) {
    this.name = name;
  }

  sayHi() {
    alert(this.name);
  }

}
```

```js
let user = new User("John");
user.sayHi();
```

> `new User("John")` ï¼š
>
> + ä¸€ä¸ªæ–°å¯¹è±¡è¢«åˆ›å»ºã€‚
> + `constructor` ä½¿ç”¨ç»™å®šçš„å‚æ•°è¿è¡Œï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ `this.name`ã€‚
> + ç„¶åå°±å¯ä»¥è°ƒç”¨ **å¯¹è±¡** ä¸­çš„æ–¹æ³• `sayHi()`



::: warning

**ç±»çš„æ–¹æ³•ä¹‹é—´æ²¡æœ‰é€—å·**ã€‚ä¸è¦æŠŠè¿™é‡Œçš„ç¬¦å·ä¸å¯¹è±¡å­—é¢é‡ç›¸æ··æ·†ã€‚åœ¨ç±»ä¸­ï¼Œä¸éœ€è¦é€—å·ã€‚

:::



## ç†è§£ `class`

`class` çš„ç±»å‹ï¼š

```js
class User {
  constructor(name) { this.name = name; }
  sayHi() { alert(this.name); }
}

alert(typeof User); // function
```

> åœ¨ JavaScript ä¸­ï¼Œ**ç±»æ˜¯ä¸€ç§å‡½æ•°**ã€‚



å®é™…ä¸Šï¼Œ`class User {...}` æ„é€ æœ‰ä»¥ä¸‹å·¥ä½œï¼š

+ åˆ›å»ºä¸€ä¸ªåä¸º `User` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ç§°ä¸ºç±» **å£°æ˜** çš„ç»“æœã€‚è¯¥å‡½æ•°çš„ä»£ç æ¥è‡ªäº `constructor` æ–¹æ³•ï¼ˆå¦‚æœæ²¡æœ‰åˆ™å‡å®šä¸ºç©ºï¼‰ã€‚
+ å­˜å‚¨ç±»ä¸­çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `User.prototype` ä¸­çš„ `sayHi`ã€‚

**ç±»è¢«åˆ›å»ºä»¥å**ï¼Œå½“è°ƒç”¨å…¶æ–¹æ³•æ—¶ï¼Œå®ƒä¼šä»åŸå‹ä¸­è·å–å¯¹åº”çš„æ–¹æ³•ï¼ˆ ç±»ä¼¼ `F.prototype` ï¼‰ï¼Œå› æ­¤ï¼Œé€šè¿‡ `new User` åˆ›å»ºçš„å¯¹è±¡å¯ä»¥ **è®¿é—®ç±»ä¸­çš„æ–¹æ³•**ï¼š

```js
console.log(User = User.prototyope.constructor) // true

cosole.log(User.prototype.sayHi) // å‡½æ•°

console.log(Object.getOwnPropertyNames(User.prototype)) // constructor, sayHi
```





## ç±»çš„ä½¿ç”¨ä¸ä»…ä»…æ˜¯ è¯­æ³•ç³–

å…¶å®ç±»å®Œæˆçš„å·¥ä½œï¼Œç›¸å½“äºå£°æ˜å‡½æ•°ï¼Œå°†æ–¹æ³•æ·»åŠ åˆ°å‡½æ•°ï¼Œä½¿ç”¨ `new` åˆ›å»ºå¯¹è±¡ï¼š
```js
// 1. åˆ›å»ºæ„é€ å™¨å‡½æ•°
function User(name) {
  this.name = name;
}
// å‡½æ•°çš„åŸå‹ï¼ˆprototypeï¼‰é»˜è®¤å…·æœ‰ "constructor" å±æ€§ï¼Œ
// æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºå®ƒ

// 2. å°†æ–¹æ³•æ·»åŠ åˆ°åŸå‹
User.prototype.sayHi = function() {
  alert(this.name);
};

// ç”¨æ³•ï¼š
let user = new User("John");
user.sayHi();
```



ä½†æ˜¯ æ‰‹åŠ¨åˆ›å»º ä¸ ç±»åˆ›å»º çš„å‡½æ•° æœ‰ç€é‡å¤§å·®å¼‚ï¼š

+ é€šè¿‡ `class` åˆ›å»ºçš„å‡½æ•°å…·æœ‰ç‰¹æ®Šçš„å†…éƒ¨å±æ€§æ ‡è®° `[[IsClassConstructor]]: true`ã€‚å› æ­¤ï¼Œå®ƒä¸æ‰‹åŠ¨åˆ›å»ºå¹¶ä¸å®Œå…¨ç›¸åŒã€‚

  `class` åˆ›å»ºçš„å‡½æ•°å¿…é¡»è¦ä½¿ç”¨ `new` è°ƒç”¨ï¼š

  ```js
  class User {
    constructor() {}
  }
  
  console.log(typeof User); // function
  User(); //  Error: Class constructor User cannot be invoked without 'new'
  ```

  å¤§å¤šæ•° JavaScript å¼•æ“ä¸­çš„ **ç±»æ„é€ å™¨çš„å­—ç¬¦ä¸²** è¡¨ç¤ºå½¢å¼éƒ½ä»¥ `classâ€¦` å¼€å¤´ï¼š

  ```js
  class User {
    constructor() {}
  }
  
  console.log(User) // class User { ... }
  ```

+ ç±»çš„æ–¹æ³• **ä¸å¯æšä¸¾**ã€‚ç±»å®šä¹‰å°† `"prototype"` ä¸­çš„æ‰€æœ‰æ–¹æ³•çš„ `enumerable` æ ‡å¿—è®¾ç½®ä¸º `false`ã€‚

  æ‰€ä»¥å¦‚æœå¯¹ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ `for ...  in`ï¼Œ `class` æ–¹æ³•ä¸ä¼šå‡ºç°ã€‚

+ ç±»æ€»æ˜¯ä½¿ç”¨ `use strict`ã€‚ åœ¨ç±»æ„é€ ä¸­çš„æ‰€æœ‰ä»£ç éƒ½å°†è‡ªåŠ¨è¿›å…¥ä¸¥æ ¼æ¨¡å¼ã€‚



## ç±»çš„è¡¨è¾¾å¼

ä¸å‡½æ•°è¡¨è¾¾å¼ä¸€æ ·ï¼Œç±»å¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªè¡¨è¾¾å¼ä¸­è¢«å®šä¹‰ï¼Œè¢«ä¼ é€’ï¼Œè¢«è¿”å›ï¼Œè¢«èµ‹å€¼ç­‰ã€‚

ğŸŒ° ä¾‹å­ï¼š
```js
let User = class {
  sayHi() {
    alert("Hello");
  }
};
```



ğŸŒ° ä¾‹å­ / ç±»ä¼¼äºå‘½åå‡½æ•°è¡¨è¾¾å¼ï¼Œç±»è¡¨è¾¾å¼ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªåå­—ï¼š

```js
let User = class MyClass {
  sayHi() {
    alert(MyClass); // MyClass è¿™ä¸ªåå­—ä»…åœ¨ç±»å†…éƒ¨å¯è§
  }
};

new User().sayHi();
console.log(MyClass) // å¤–éƒ¨ä¸å¯è§
```



ğŸŒ° ä¾‹å­ / åŠ¨æ€åˆ›å»ºç±»ï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªç±»ï¼š

```js
function makeClass(phrase) {
  // å£°æ˜ä¸€ä¸ªç±»å¹¶è¿”å›å®ƒ
  return class {
    sayHi() {
      alert(phrase);
    }
  };
}

// åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»
let User = makeClass("Hello");

new User().sayHi(); 
```



## ç±»çš„ `getters` / `setters`

å°±åƒ **å¯¹è±¡å­—é¢é‡**ï¼Œç±»å¯èƒ½åŒ…æ‹¬ getters/settersï¼Œè®¡ç®—å±æ€§ç­‰ã€‚

ğŸŒ° ä¾‹å­ï¼š 

```js
class User {

  constructor(name) {
    // è°ƒç”¨ setter
    this.name = name;
  }

  get name() {
    return this._name;
  }

  set name(value) {
    if (value.length < 4) {
      console.log("Name is too short.");
      return;
    }
    this._name = value;
  }

}

let user = new User("John");
console.log(user.name); // getters
user.name = "" // "Name is too short." setters
```

> ä»æŠ€æœ¯ä¸Šæ¥è®²ï¼Œè¿™æ ·çš„ç±»å£°æ˜å¯ä»¥é€šè¿‡åœ¨ `User.prototype` ä¸­åˆ›å»º getters å’Œ setters æ¥å®ç°ã€‚



## ç±»çš„è®¡ç®—å±æ€§



ğŸŒ° ä¾‹å­ / ä½¿ç”¨ä¸­æ‹¬å· `[...]` çš„è®¡ç®—æ–¹æ³•åï¼š

```js
class User {
  ['say' + 'Hi']() {
    console.log("Hello");
  }
}

new User().sayHi(); // Hello
```





## ç±»çš„å­—æ®µ

ç±»çš„å­—æ®µæ˜¯ä¸€ç§å…è®¸æ·»åŠ ä»»ä½•å±æ€§çš„è¯­æ³•ã€‚åªéœ€åœ¨è¡¨è¾¾å¼ä¸­å†™ `=`ã€‚ 

ğŸŒ° ä¾‹å­ / å‘ç±»æ·»åŠ ä¸€ä¸ªå±æ€§ï¼š

```js
class User {
  name = "John";

  sayHi() {
    console.log(`Hello, ${this.name}!`);
  }
}

new User().sayHi();
```



ç±»å­—æ®µé‡è¦çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä»¬ä¼šåœ¨æ¯ä¸ªç‹¬ç«‹å¯¹è±¡ä¸­è¢«è®¾å¥½ï¼Œè€Œä¸æ˜¯è®¾åœ¨ `User.prototype`ï¼š

```js
class User {
  name = "John";
}

let user = new User();
console.log(user.name); // John
console.log(User.prototype.name); // undefined
```



ğŸŒ° ä¾‹å­ / åœ¨èµ‹å€¼æ—¶ä½¿ç”¨æ›´å¤æ‚çš„è¡¨è¾¾å¼å’Œå‡½æ•°è°ƒç”¨ï¼š

```js
class User {
  name = prompt("Name, please?", "John");
}

let user = new User();
console.log(user.name); // John
```



### åˆ©ç”¨ç±»å­—æ®µç»‘å®šæ–¹æ³•



åœ¨ å‡½æ•°ç»‘å®š ä¸­ï¼ŒJavaScript ä¸­çš„å‡½æ•°å…·æœ‰åŠ¨æ€çš„ `this`ã€‚å®ƒå–å†³äºè°ƒç”¨ä¸Šä¸‹æ–‡ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ–¹æ³•è¢«ä¼ é€’åˆ°æŸå¤„ï¼Œæˆ–è€…åœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è¢«è°ƒç”¨ï¼Œåˆ™ `this` å°†ä¸å†æ˜¯å¯¹å…¶å¯¹è±¡çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š
```js
class Button {
  constructor(value) {
    this.value = value;
  }

  click() {
    console.log(this.value);
  }
}

let button = new Button("hello");

setTimeout(button.click, 1000); // undefined
```

> åœ¨ `setTimeout` ä¸­ä¸¢å¤±äº† `this`ã€‚

å¯ä»¥é€šè¿‡ï¼š

+ ä¼ é€’ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œä¾‹å¦‚ `setTimeout(() => button.click(), 1000)`ã€‚
+ å°†æ–¹æ³•ç»‘å®šåˆ°å¯¹è±¡ï¼Œä¾‹å¦‚åœ¨ constructor ä¸­ã€‚



ç±»å­—æ®µ å¯ä»¥æ›´åŠ ä¼˜é›…åœ°è§£å†³ï¼š

```js
class Button {
  constructor(value) {
    this.value = value;
  }
  click = () => {
    console.log(this.value);
  }
}

let button = new Button("hello");
setTimeout(button.click, 1000);
```

> ç±»å­—æ®µ `click = () => {...}` æ˜¯ **åŸºäºæ¯ä¸€ä¸ªå¯¹è±¡** è¢«åˆ›å»ºçš„ï¼Œåœ¨è¿™é‡Œå¯¹äºæ¯ä¸€ä¸ª `Button` å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•ï¼Œåœ¨å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘æ­¤å¯¹è±¡çš„ `this`ã€‚
>
> æ‰€ä»¥å¯ä»¥æŠŠ `button.click` ä¼ é€’åˆ°ä»»ä½•åœ°æ–¹ï¼Œè€Œä¸” `this` çš„å€¼æ€»æ˜¯æ­£ç¡®çš„ã€‚




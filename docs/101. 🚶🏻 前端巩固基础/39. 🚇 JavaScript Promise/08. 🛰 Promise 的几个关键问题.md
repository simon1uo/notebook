---
title: ðŸ›° Promise çš„å‡ ä¸ªå…³é”®é—®é¢˜
date: 2022-04-20 23:57:03
permalink: /pages/94e89a/
categories:
  -  ðŸš‡ JavaScript Promise
tags:
  - JavaScript æ·±å…¥éƒ¨åˆ†
---
1âƒ£ï¸ æ”¹å˜ Promise çš„çŠ¶æ€çš„ä¸‰ä¸ªæ–¹æ³•ï¼š

+ `resolve(value)`ï¼šå¦‚æžœå½“å‰æ˜¯ pending å°±ä¼šå˜ä¸º resolvedï¼› 

+ `reject(reason)`ï¼šå¦‚æžœå½“å‰æ˜¯ pending å°±ä¼šå˜ä¸º rejectedï¼› 

+ æŠ›å‡ºå¼‚å¸¸ï¼š å¦‚æžœå½“å‰æ˜¯ pending å°±ä¼šå˜ä¸º rejectedï¼›



ðŸŒ° ä¾‹å­ï¼š

```js
let p = new Promise((resolve, reject) => {
    resolve('ok');
});
//æ‰§è¡Œ then æ–¹æ³•çš„ç»“æžœ
let result = p.then(value => {
    // console.log(value);
    //1. æŠ›å‡ºé”™è¯¯
    // throw 'å‡ºäº†é—®é¢˜';
    //2. è¿”å›žç»“æžœæ˜¯éž Promise ç±»åž‹çš„å¯¹è±¡
    // return 521;
    //3. è¿”å›žç»“æžœæ˜¯ Promise å¯¹è±¡
    return new Promise((resolve, reject) => {
        // resolve('success');
        reject('error');
    });
}, reason => {
    console.warn(reason);
});

console.log(result);
```





2âƒ£ï¸ æŒ‡å®šå¤šä¸ªæˆåŠŸ/ å¤±è´¥å›žè°ƒå‡½æ•°ï¼Œéƒ½ä¼šè°ƒç”¨å—ï¼Ÿ

+ å½“ Promise **æ”¹å˜ä¸ºå¯¹åº”çš„çŠ¶æ€æ—¶éƒ½ä¼šè°ƒç”¨**ã€‚



ðŸŒ° ä¾‹å­ï¼š

```js
let p = new Promise((resolve, reject) => {
    // resolve('OK'); // å…ˆæ”¹å˜çŠ¶æ€åŽè¿è¡Œå›žè°ƒ
    setTimeout(()=>{
        resolve('OK')
    },1000)
});

///æŒ‡å®šå›žè°ƒ - 1
p.then(value => {
    console.log(value);
});

//æŒ‡å®šå›žè°ƒ - 2
/*p.then(value => {
    alert(value);
});*/
```



3âƒ£ï¸ **æ”¹å˜ Promise çŠ¶æ€å’ŒæŒ‡å®šå›žè°ƒå‡½æ•°çš„å…ˆåŽé¡ºåº**ï¼š

+ **éƒ½æœ‰å¯èƒ½**ã€‚æ­£å¸¸æƒ…å†µä¸‹æ˜¯å…ˆæŒ‡å®šå›žè°ƒå‡½æ•°å†æ”¹å˜ Promise çš„çŠ¶æ€ï¼Œä½†ä¹Ÿå¯ä»¥å…ˆæ”¹çŠ¶æ€å†æŒ‡å®šå›žè°ƒå‡½æ•°ã€‚
+ å…ˆæ”¹çŠ¶æ€å†æŒ‡å®šå›žè°ƒçš„æƒ…å†µï¼š
  + åœ¨æ‰§è¡Œå…¶ä¸­ç›´æŽ¥è°ƒç”¨ `resolve()` / `reject()` 
  + å»¶è¿Ÿæ›´é•¿æ—¶é—´æ‰è°ƒç”¨ `then()` 
+ ä»€ä¹ˆæ—¶å€™æ‰èƒ½å¾—åˆ°æ•°æ®ï¼š
  + å¦‚æžœå…ˆæŒ‡å®šçš„å›žè°ƒï¼Œé‚£å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå›žè°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®ï¼›
  + å¦‚æžœå…ˆæ”¹å˜çš„çŠ¶æ€ï¼Œé‚£å½“æŒ‡å®šå›žè°ƒæ—¶ï¼Œå›žè°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®ï¼›

ï¼ˆä¸»è¦å…³æ³¨ Promise æž„é€ æ—¶é‡Œé¢æ˜¯åŒæ­¥æˆ–å¼‚æ­¥ä»»åŠ¡ï¼‰



ðŸŒ° ä¾‹å­

```js
let p = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve('OK');
    }, 1000);
});

p.then(value => {
    console.log(value);
},reason=>{
 		console.warn(reason)   
})
```



4âƒ£ï¸ `promise.then()` è¿”å›žçš„æ–° Promise çš„ç»“æžœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®š? 

+ ç®€å•è¡¨è¾¾ï¼šç”± `then()` **æŒ‡å®šçš„å›žè°ƒå‡½æ•°æ‰§è¡Œçš„ç»“æžœå†³å®š**ã€‚

+ è¯¦ç»†è¡¨è¾¾ï¼š
  + å¦‚æžœæŠ›å‡ºå¼‚å¸¸ï¼Œæ–° Promise å˜ä¸º `rejected`ï¼Œ`reason`ä¸ºæŠ›å‡ºçš„å¼‚å¸¸ã€‚
  + å¦‚æžœè¿”å›žçš„æ˜¯éž Promise çš„**ä»»æ„å€¼**ï¼Œæ–° Promise å˜ä¸º `resolved`ï¼Œ `value` ä¸ºè¿”å›žçš„å€¼
  + å¦‚æžœè¿”å›žçš„æ˜¯å¦ä¸€ä¸ªæ–° Promiseï¼Œ**æ­¤ Promise çš„ç»“æžœå°±ä¼šæˆä¸ºæ–° Promise çš„ç»“æžœã€‚**



ðŸŒ° ä¾‹å­ï¼š

```js
let p = new Promise((resolve, reject) => {
    resolve('ok');
});
//æ‰§è¡Œ then æ–¹æ³•çš„ç»“æžœ
let result = p.then(value => {
    // console.log(value);
    //1. æŠ›å‡ºé”™è¯¯
    // throw 'å‡ºäº†é—®é¢˜';
    //2. è¿”å›žç»“æžœæ˜¯éž Promise ç±»åž‹çš„å¯¹è±¡
    // return 521;
    //3. è¿”å›žç»“æžœæ˜¯ Promise å¯¹è±¡
    return new Promise((resolve, reject) => {
        // resolve('success');
        reject('error');
    });
}, reason => {
    console.warn(reason);
});

console.log(result);
```



5âƒ£ï¸ Promise å¦‚ä½•ä¸²è¿žå¤šä¸ªæ“ä½œä»»åŠ¡ï¼Ÿ

+ Promise çš„ `then()` è¿”å›žä¸€ä¸ªæ–°çš„ Promiseï¼Œå¯ä»¥å¼€æˆ **`then()` çš„é“¾å¼è°ƒç”¨**ã€‚
+ é€šè¿‡ `then` çš„é“¾å¼è°ƒç”¨**ä¸²è¿žå¤šä¸ªåŒæ­¥/å¼‚æ­¥ä»»åŠ¡ã€‚**



ðŸŒ° ä¾‹å­ï¼š

```js
let p = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve('OK');
    }, 1000);
});

p.then(value => {
    return new Promise((resolve, reject) => {
        resolve("success");
    });
}).then(value => {
    console.log(value);
}).then(value => {
    console.log(value); // undefined ä¸Šä¸€ä¸ª Promiseæ— è¿”å›žå€¼
})
```



6âƒ£ï¸ Promise å¼‚å¸¸ä¼ é€ï¼š

+ å½“ä½¿ç”¨ Promise çš„ `then` é“¾å¼è°ƒç”¨æ—¶ï¼Œ**å¯ä»¥åœ¨æœ€åŽæŒ‡å®šå¤±è´¥çš„å›žè°ƒ**ã€‚
+ å‰é¢**ä»»ä½•æ“ä½œå‡ºäº†å¼‚å¸¸**ï¼Œ**éƒ½ä¼šä¼ åˆ°æœ€åŽå¤±è´¥çš„å›žè°ƒä¸­å¤„ç†**ã€‚



ðŸŒ° ä¾‹å­ï¼š

```js
let p = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve('OK');
        // reject('Err');
    }, 1000);
});

p.then(value => {
    // console.log(111);
    throw 'å¤±è´¥å•¦!';
}).then(value => {
    console.log(222);
}).then(value => {
    console.log(333);
}).catch(reason => {
    console.warn(reason);
});
```



7âƒ£ï¸ ä¸­æ–­ Promise é“¾ï¼š

+ å½“ä½¿ç”¨ Promise çš„ `then` é“¾å¼è°ƒç”¨æ—¶ï¼Œ**åœ¨ä¸­é—´ä¸­æ–­ï¼Œä¸å†è°ƒç”¨åŽé¢çš„å›žè°ƒå‡½æ•°**ã€‚

+ åŠžæ³•ï¼šåœ¨å›žè°ƒå‡½æ•°ä¸­**è¿”å›žä¸€ä¸ª pendding çŠ¶æ€çš„ Promise å¯¹è±¡**ã€‚ï¼ˆæœ‰ä¸”åªæœ‰ä¸€ç§æ–¹å¼ï¼‰



ðŸŒ° ä¾‹å­ï¼š

```js
let p = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve('OK');
    }, 1000);
});

p.then(value => {
    console.log(111);
    //æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ–¹å¼
    return new Promise(() => {});
}).then(value => {
    console.log(222);
}).then(value => {
    console.log(333);
}).catch(reason => {
    console.warn(reason);
});
```
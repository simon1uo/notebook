---
title: ğŸ›’ Vue ä¸­çš„ AJAX
date: 2022-03-12 23:31:28
permalink: /pages/b2106c/
categories: 
  - ğŸ“š å‰ç«¯ç¬”è®°
  - ğŸƒ æ ¸å¿ƒéƒ¨åˆ†
  - â›ˆ Vue ç»„ä»¶åŒ–ç¼–ç¨‹
tags: 
  - Vue
author: 
  name: Simon
  link: https://github.com/simon1uo
---



### è§£å†³å¼€å‘ç¯å¢ƒ AJAX è·¨åŸŸé—®é¢˜

å¼•å…¥é—®é¢˜ï¼š

+ ä½¿ç”¨ `node` é…ç½®ä¸¤ä¸ªæ¨¡æ‹Ÿçš„æœåŠ¡å™¨ï¼š

::: details

+ `server1.js`

```js
const express = require('express')
const app = express()

app.use((request,response,next)=>{
   console.log('æœ‰äººè¯·æ±‚æœåŠ¡å™¨1äº†');
   // console.log('è¯·æ±‚æ¥è‡ªäº',request.get('Host'));
   // console.log('è¯·æ±‚çš„åœ°å€',request.url);
   next()
})

app.get('/students',(request,response)=>{
   const students = [
      {id:'001',name:'tom',age:18},
      {id:'002',name:'jerry',age:19},
      {id:'003',name:'tony',age:120},
   ]
   response.send(students)
})

app.listen(5050,(err)=>{
   if(!err) console.log('æœåŠ¡å™¨1å¯åŠ¨æˆåŠŸäº†,è¯·æ±‚å­¦ç”Ÿä¿¡æ¯åœ°å€ä¸ºï¼šhttp://localhost:5050/students');
})
```

+ `server2.js`

```js
const express = require('express')
const app = express()

app.use((request,response,next)=>{
   console.log('æœ‰äººè¯·æ±‚æœåŠ¡å™¨2äº†');
   next()
})

app.get('/cars',(request,response)=>{
   const cars = [
      {id:'001',name:'å¥”é©°',price:199},
      {id:'002',name:'é©¬è‡ªè¾¾',price:109},
      {id:'003',name:'æ·è¾¾',price:120},
   ]
   response.send(cars)
})

app.listen(5051,(err)=>{
   if(!err) console.log('æœåŠ¡å™¨2å¯åŠ¨æˆåŠŸäº†,è¯·æ±‚æ±½è½¦ä¿¡æ¯åœ°å€ä¸ºï¼šhttp://localhost:5051/cars');
})
```

:::

+ åœ¨ Vue ç»„ä»¶ä½¿ç”¨ `axios` è¯·æ±‚æœåŠ¡å™¨ï¼š

é¦–å…ˆå¼•å…¥ `axios`ï¼š

```js
import axios from 'axios'
```

ç„¶åç¼–å†™æƒ³æœåŠ¡å™¨è¯·æ±‚ä¿¡æ¯çš„æ–¹æ³•ï¼š

```js
getStudentInfo(){
  axios.get('http://localhost:5050/students').then(
      response => {
        console.log('è¯·æ±‚æˆåŠŸäº†', response.data)
      },
      error => {
        console.log('è¯·æ±‚å¤±è´¥', error)
      }
  )
}
```

è¿è¡Œåï¼Œæ­¤æ—¶å‡ºç°è·¨åŸŸé—®é¢˜ï¼š

+ æ²¡æœ‰éµå¾ªåŒæºç­–ç•¥ï¼ˆåè®®åã€ä¸»æœºåã€ç«¯å£å·è¦ä¸€è‡´ï¼‰ï¼ˆç”±äº Vue ç»„ä»¶åŸºäº `http://localhost:8080` è¿è¡Œï¼Œè€ŒæœåŠ¡å™¨åŸºäº `http://localhost:5050`ï¼‰

+ è™½ç„¶å¼•èµ·äº†è·¨åŸŸä½†æ˜¯è¯·æ±‚æœ‰æˆåŠŸå‘é€ã€‚å‘é€è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¹Ÿæ”¶åˆ°äº†è¯·æ±‚ï¼Œå¹¶ä¸”è¿”å›äº†å“åº”ï¼Œä½†æ˜¯æµè§ˆå™¨å‘ç°äº†è·¨åŸŸé—®é¢˜å¯¼è‡´æŠ¥é”™ã€‚

![image-20220404164541243](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/qXPATW.png)

ä¸€èˆ¬æœ‰ä¸‰ç§è§£å†³çš„æ–¹æ³•ï¼š

+ `cors` ï¼šæœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶æºå¸¦ç‰¹æ®Šçš„ç›¸åº”å¤´ã€‚ï¼ˆçœŸæ­£æ„ä¹‰ä¸Šè§£å†³è·¨åŸŸï¼Œä½†æ˜¯å“åº”å¤´ä¸èƒ½è½»æ˜“æºå¸¦ï¼‰
+ `jsonp`ï¼šå·§å¦™å€ŸåŠ© `script` çš„ `src` **å±æ€§åœ¨å¼•å…¥å¤–éƒ¨èµ„æºæ—¶ä¸å—åŒæºç­–ç•¥å®ç°**ã€‚ä½†æ˜¯åœ¨çœŸæ­£å¼€å‘ä¸­ï¼Œå¾—åœ¨å‰ç«¯ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•ï¼Œåç«¯åŒæ—¶é…åˆï¼›å¹¶ä¸”åªèƒ½å¯¹ `get` è¯·æ±‚æœ‰æ•ˆã€‚
+ **é…ç½®ä»£ç†æœåŠ¡å™¨**ï¼šæœ¬èº«ä¹Ÿæ˜¯æœåŠ¡å™¨ï¼Œä¸å‰å°æ‰€å¤„çš„ä½ç½®ï¼ˆæ„æ€æ˜¯ç«¯å£ï¼‰ä¸€è‡´ï¼Œè¦å‘é€è¯·æ±‚æ—¶ï¼Œä»£ç†æœåŠ¡å™¨ä½œä¸ºä¸­ä»‹å¸®åŠ©å‰å°å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ ï¼ŒæœåŠ¡å™¨è¿”å›çš„è¯·æ±‚ä¹Ÿé€šè¿‡ä»£ç†æœåŠ¡å™¨ä½œä¸ºä¸­ä»‹è¿”å›ç»™å‰å°ã€‚åˆ©ç”¨æœåŠ¡å™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ä¸ä½¿ç”¨ `ajax` è€Œä½¿ç”¨ `http` è¯·æ±‚è¿™ä¸€ç‚¹ã€‚
  + åç«¯ `nginx` å¼€å¯ä»£ç†æœåŠ¡å™¨ã€‚
  + å€ŸåŠ© `vue-cli` å¼€å¯ä»£ç†æœåŠ¡å™¨ã€‚



### å€ŸåŠ© Vue-CLI é…ç½®ä»£ç†æœåŠ¡å™¨

ğŸ”— `devServer-proxy`ï¼š[Configuration Reference | Vue CLI (vuejs.org)](https://cli.vuejs.org/config/#devserver-proxy)



ç¬¬ä¸€ç§æ–¹æ³•ï¼š

+ åœ¨ `vue.js.config` é…ç½®æ–‡ä»¶ä¸­é…ç½® `devServer`ï¼š

```js
// å¼€å¯ä»£ç†æœåŠ¡å™¨
devServer: {
    proxy: 'http://localhost:5050'
}
```

+ **ä¿®æ”¹åŸæ¥è¯·æ±‚çš„è·¯å¾„çš„ç«¯å£ä¸ºä»£ç†æœåŠ¡å™¨çš„ç«¯å£**ï¼Œå¹¶ä¸”æ³¨æ„è¯·æ±‚çš„è·¯å¾„è¦æ˜ç¡®ï¼š

```js
getStudentInfo(){
  axios.get('http://localhost:8080/students').then(
      response => {
        console.log('è¯·æ±‚æˆåŠŸäº†', response.data)
      },
      error => {
        console.log('è¯·æ±‚å¤±è´¥', error)
      }
  )
}
```

> è¿è¡Œåï¼Œè¯·æ±‚æˆåŠŸå¹¶è·å¾—äº†å“åº”çš„æ•°æ®ã€‚

::: tip

**ä½¿ç”¨ä¸Šè¿°æ–¹æ³•é…ç½®ä»£ç†æœåŠ¡å™¨æœ‰ä¸¤ä¸ªç¼ºé™·**ï¼š

+ **ä¼˜å…ˆåŒ¹é…å‰ç«¯èµ„æº**ï¼šä»£ç†æœåŠ¡å™¨**å¹¶ä¸æ˜¯å°†æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°æœåŠ¡å™¨**ï¼Œå½“ä»£ç†æœåŠ¡å™¨ä¸­å·²ç»å­˜åœ¨çš„èµ„æºï¼ˆåœ¨ `public` ç›®å½•ä¸‹ï¼Œåªè¦è¯·æ±‚è·¯å¾„åŒåï¼‰ï¼Œåˆ™ä¸ä¼šå‘æœåŠ¡å™¨è¯·æ±‚èµ„æºã€‚
+ é€šè¿‡åœ¨ `vue.config.js` ä¸­çš„ `devServer` ä¸­**ä¸å¯ä»¥é…ç½®å¤šä¸ªä»£ç†æœåŠ¡å™¨**ã€‚

:::



ç¬¬äºŒç§æ–¹æ³•ï¼š

+ åœ¨ `vue.config.js` é…ç½®æ–‡ä»¶ä¸­é…ç½® `devServer`ï¼š

```js
devServer: {
    proxy: {
        '/server1': { // è¯·æ±‚å‰ç¼€ï¼Œè¯·æ±‚åœ°å€ä¾‹å­ï¼šhttp://localhost:8080/server1/students
            target: 'http://localhost:5050', // ä»£ç†ç›®æ ‡æœåŠ¡å™¨çš„åŸºç¡€å†ç»
            pathRewrite: {'^/server1': ''}, // é‡å†™è·¯å¾„ï¼ŒåŒ¹é…ä»¥ /server1å¼€å¤´çš„è¯·æ±‚è·¯å¾„
            ws: true, // ç”¨äºæ”¯æŒwebsocket
            changeOrigin: true // ç”¨äºæ§åˆ¶è¯·æ±‚å¤´ä¸­çš„hostå€¼ ä¾‹å­ falseä¸º8080ï¼Œtrueä¸º5050
        },
        '/server2': { // è¯·æ±‚å‰ç¼€ï¼Œè¯·æ±‚åœ°å€ä¾‹å­ï¼šhttp://localhost:8080/server2/cars
            target: 'http://localhost:5051', 
            pathRewrite: {'^/server2': ''}, 
        }
    }
}
```



::: tip

è§£å†³äº†å†æ–¹æ³•ä¸€ä¸­çš„ç¼ºç‚¹ï¼š

+ å¯ä»¥é…ç½®å¤šä¸ªæœåŠ¡å™¨
+ è¯·æ±‚æ—¶åŠ ä¸Šå‰ç¼€ï¼Œè§£å†³äº†å½“ä»£ç†æœåŠ¡å™¨å¯èƒ½æœ‰é‡å¤å‘½åçš„æ–‡ä»¶å¯¼è‡´è¯·æ±‚ä¸èƒ½è½¬å‘åˆ°æœåŠ¡å™¨çš„é—®é¢˜ã€‚

ä½†æ˜¯ä½¿ç”¨è¯¥æ–¹æ³•é…ç½®ç•¥çƒ¦çï¼Œå¹¶ä¸”è¯·æ±‚èµ„æºæ—¶å¿…é¡»è¦æ·»åŠ å‰ç¼€ã€‚

:::



## é…ç½®ä»£ç†æ¡ˆä¾‹ï¼ˆæœç´¢æ¡ˆä¾‹ï¼‰



+ æŒ‰ç…§ç»„ä»¶åŒ–ç¼–ç¨‹ï¼Œåˆ’åˆ†å¥½ç»„ä»¶ï¼Œå®ç°é¡µé¢æ•ˆæœï¼š

![image-20220406124911501](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/G593GL.png)



+ åœ¨æœç´¢ç»„ä»¶ä¸­å®Œæˆè¯·æ±‚æœç´¢ï¼š

ğŸ”— **GitHub** æä¾›çš„ç”¨æˆ·æœç´¢æ¥å£ï¼š

```
https://api.github.com/search/users?q=userName
```



åœ¨æœç´¢è¾“å…¥æ¡†ä¸­ä½¿ç”¨ `v-model` ç»‘å®šè¾“å…¥çš„å…³é”®è¯ï¼Œæœç´¢æŒ‰é’®ç»‘å®šæœç´¢äº‹ä»¶æ–¹æ³•ï¼š

```vue
<div>
  <input type="text" placeholder="enter the name you search" v-model="keyword"/>
  <button @click="searchUsers">Search</button>
</div>
```

ä½¿ç”¨ `axios` å‘é€è¯·æ±‚ï¼š

```js
data() {
  return {
    keyword: ''
  }
}, methods: {
  searchUsers() {
    axios.get(`https://api.github.com/search/users?q=${this.keyword}`).then(
        response => {
          console.log('è¯·æ±‚æˆåŠŸ', response.data)
        },
        error => {
          console.log('è¯·æ±‚å‡ºé”™', error.massage)
        }
    )
  }
}
```

> + è¦åœ¨è¯·æ±‚é“¾æ¥ä¸­æ’å…¥è¡¨è¾¾å¼ï¼Œè¦ä½¿ç”¨ ` `` ` ç¬¦å·ã€‚
> + ä¸ç”¨è€ƒè™‘è·¨åŸŸé—®é¢˜ï¼Œå› ä¸º Github åç«¯å·²ç»è§£å†³äº† CORS å¼•èµ·çš„è·¨åŸŸé—®é¢˜ï¼ˆæ·»åŠ ç‰¹æ®Šçš„å“åº”å¤´ï¼‰ã€‚  åŒæ—¶ `incomplete_results` æ„æ€æ˜¯ä»…å±•ç¤ºéƒ¨åˆ†ç»“æœï¼Œ æœç´¢ç»“æœä¿å­˜åœ¨ `items` ä¸­ã€‚
> + æ³¨æ„ä¸èƒ½è¿‡äºé¢‘ç¹è¯·æ±‚æ¥å£ï¼Œå¦åˆ™ä¼šè¢«è¯¯è®¤ä¸ºæ”»å‡»ç„¶åè¢«å°é” IPã€‚
>
> ![image-20220406130342246](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/aAhv8m.png)



+ é€šè¿‡å…¨å±€äº‹ä»¶æ€»çº¿åœ¨ `Search` ç»„ä»¶å’Œ `List` ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚

åœ¨ `List` ç»„ä»¶ä¸­ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼š

```js
mounted() {
  this.$bus.$on('getUserResults', (users) => {
    console.log('List received data,', users)
    this.users = users
  })
}
```

åœ¨ `Search` ç»„ä»¶ä¸­è§¦å‘ï¼Œå¹¶ä¼ å…¥æ•°æ®ï¼š

```js
searchUsers() {
  axios.get(`https://api.github.com/search/users?q=${this.keyword}`).then(
      response => {
        console.log('è¯·æ±‚æˆåŠŸ', response.data.items)
        this.$bus.$emit('getUserResults', response.data.items)
      },
      error => {
        console.log('è¯·æ±‚å‡ºé”™', error.massage)
      }
  )
}
```

å°†è·å–åˆ°çš„æ•°æ®åº”ç”¨åˆ°æ¨¡ç‰ˆï¼Œä½¿ç”¨ `v-for` å¾ªç¯ï¼š

```vue
<div class="row">
  <div class="card" v-for="user in users" :key="user.login">
    <a :href="user.html_url" target="_blank">
      <img :src="user.avatar_url" style='width: 100px'/>
    </a>
    <p class="card-text">{{ user.login }}</p>
  </div>
```





## Vue-resource



+ å®‰è£… `vue-resource`ï¼š

```
$ npm i vue-resource
```

+ åœ¨å…¥å£æ–‡ä»¶ `main.js` å¼•å…¥ï¼š

```js
// å¼•å…¥ vue-resource
import VueResource from 'vue-resource'

// ä½¿ç”¨æ’ä»¶
Vue.use(VueResource)
```


ğŸŒ° ä½¿ç”¨çš„æ–¹æ³•ä¸ `axios` ç±»ä¼¼ï¼š

```js
searchUsers() {
  this.$bus.$emit('updateListData', {isFirst: false, isLoading: true, errMsg: '', users: []})
  this.$http.get(`https://api.github.com/search/users?q=${this.keyword}`).then(
      response => {
        console.log('è¯·æ±‚æˆåŠŸ', response.data.items)
        this.$bus.$emit('updateListData', {isLoading: false, errMsg: '', users: response.data.items})
      },
      error => {
        console.log('è¯·æ±‚å‡ºé”™', error.message)
        this.$bus.$emit('updateListData', {isLoading: false, errMsg: error.message, users: []})

      }
  )
}
```



::: tip 

ä¸€èˆ¬åœ¨ Vue çš„æ—©æœŸç‰ˆæœ¬è¾ƒå¤šä½¿ç”¨æ¥å®ç°å¼‚æ­¥åŠ è½½ï¼ŒVue 2.0 ç‰ˆæœ¬åï¼Œä¸€èˆ¬æ¨èä½¿ç”¨ `axios` å®ç° `AJAX` è¯·æ±‚ã€‚

ğŸ”— [Vue.js Ajax(vue-resource) | èœé¸Ÿæ•™ç¨‹ (runoob.com)](https://www.runoob.com/vue2/vuejs-ajax.html)

:::
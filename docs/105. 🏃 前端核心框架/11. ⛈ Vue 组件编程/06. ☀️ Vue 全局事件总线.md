---
title: â˜€ï¸ Vue å…¨å±€äº‹ä»¶æ€»çº¿
date: 2022-04-02 23:02:17
permalink: /pages/2a073b/
categories: 
  - ğŸ“š å‰ç«¯ç¬”è®°
  - ğŸƒ æ ¸å¿ƒéƒ¨åˆ†
  - â›ˆ Vue è„šæ‰‹æ¶
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---
**å…¨å±€äº‹ä»¶æ€»çº¿** GlobalEventBusï¼šä¸€ç§**ç»„ä»¶é—´é€šä¿¡**çš„æ–¹å¼ï¼Œé€‚ç”¨äº**ä»»æ„ç»„ä»¶é—´é€šä¿¡**ã€‚ï¼ˆè¿™ä¸æ˜¯ Vue ä¸­çš„ APIï¼Œæ˜¯åˆ©ç”¨ç°æœ‰çš„åŠŸèƒ½ç»„åˆï¼‰

> è¦å®ç°è¿™ä¸ªèƒ½ç»™ä»»æ„ç»„ä»¶é€šä¿¡çš„æ€»çº¿ä¸­é—´ä»¶ï¼Œå¿…é¡»è¦å®ç°ä¸¤ä¸ªæ¡ä»¶ï¼š
>
> + æ‰€æœ‰çš„ç»„ä»¶éƒ½èƒ½çœ‹è§å®ƒã€‚
> + å¿…é¡»è¦ä¿è¯å®ƒèƒ½å¤Ÿè°ƒç”¨ `$on` ã€`$off`ã€`$emit`ã€‚
>
> è¦ä¿è¯å®ç°å‰è¿°çš„ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå¯ä»¥è€ƒè™‘è¦ä½¿ `vc`  ç»„ä»¶å®ä¾‹åŸå‹å¯¹è±¡ä¸­èƒ½å¤Ÿæ‰¾åˆ°ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨å‰è¿°çš„ä¸€ä¸ªé‡è¦å…³ç³»ï¼š[ç»„ä»¶å®ä¾‹åŸå‹ä¸ Vue å®ä¾‹åŸå‹çš„å…³ç³»](/pages/5935fd/)ã€‚
>
> è¦ä¿è¯å®ç°ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œåˆ©ç”¨ç”Ÿå‘½å‘¨æœŸ `beforeCreate` ï¼Œåœ¨åŸå‹ä¸­èµ‹å€¼ä¸ºç»„ä»¶å®ä¾‹å¯¹è±¡ã€‚ä¸€èˆ¬å†™ä¸º `Vue.prototrype.$bus = this`ï¼ˆ`this` ä¸ºå½“å‰åˆ›å»ºçš„ `vm`ï¼‰ ã€‚

+ ä½¿ç”¨å…¨å±€äº‹ä»¶æ€»çº¿ï¼šï¼ˆåœ¨å…¥å£æ–‡ä»¶ `main.js` çš„ `beforeCreate` ï¼‰**å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿**ï¼š

  ```js
  new Vue({
  	......
  	beforeCreate() {
  		Vue.prototype.$bus = this //å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿ï¼Œ$buså°±æ˜¯å½“å‰åº”ç”¨çš„vm
  	},
      ......
  }) 
  ```

  + ä½¿ç”¨äº‹ä»¶æ€»çº¿ï¼š

    + æ¥æ”¶æ•°æ®ï¼šA ç»„ä»¶æƒ³è¦**æ¥æ”¶æ•°æ®**ï¼Œå°±åœ¨ A ç»„ä»¶ä¸­ç»™ `$bus` ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼Œäº‹ä»¶çš„å›è°ƒç•™åœ¨ A ç»„ä»¶è‡ªèº«ï¼ˆè°ç»‘å®šäº‹ä»¶ï¼Œå›è°ƒåœ¨è°èº«ä¸Šï¼‰ï¼š

      ```js
      methods() {
        demo(data) { ... }
      },
      ...
      , mounted() {
        this.$bus.on('xxx', this.demo) // å‘å…¨å±€äº‹ä»¶æ€»çº¿ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ xxx
      }
      ```

    + æä¾›æ•°æ®ï¼ˆè°æä¾›æ•°æ®è°å°±è§¦å‘äº‹ä»¶ï¼‰ï¼š

      ```js
      this.$bus.$emit('xxx', æ•°æ®)
      ```

    + âš ï¸ æœ€å¥½åœ¨**æ¥æ”¶å®Œæ•°æ®ä¹‹å**ï¼Œåœ¨ `beforeDestory` ä¸­ç”¨ `$off` å»è§£ç»‘å½“å‰ç»„ä»¶æ‰€ç”¨åˆ°çš„äº‹ä»¶ï¼š

      ```js
      beforeDestroy() {
          this.$bus.$off('xxx')
      },
      ```

> + ç»‘å®šåœ¨ `$bus` ä¸­çš„è‡ªå®šä¹‰äº‹ä»¶å‘½åå¯èƒ½ä¼šæœ‰å†²çªï¼Œæ‰€ä»¥è¦æ³¨æ„ä¸è¦ä½¿ç”¨å·²ç»å®šä¹‰çš„è‡ªå®šä¹‰äº‹ä»¶çš„å‘½åï¼›å¹¶ä¸”æœ€å¥½ä¸å ç”¨è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œä½¿ç”¨å®Œåå°±ï¼ˆåœ¨ç»‘å®šå¤„ï¼‰è§£ç»‘è¯¥è‡ªå®šä¹‰äº‹ä»¶ã€‚
> + ä¸ºä»€ä¹ˆåœ¨ `beforeDestory` ä¸­é”€æ¯ï¼Ÿç»„ä»¶ä¸ä½¿ç”¨åé”€æ¯åï¼Œæœ‰å¯èƒ½åœ¨ `vc` å®ä¾‹ä¸­çš„è‡ªå®šä¹‰äº‹ä»¶æ²¡æœ‰è¢«é”€æ¯ï¼



ğŸŒ° **å®ç°å…¨å±€äº‹ä»¶æ€»çº¿ä¾‹å­**ï¼š

+ é¦–å…ˆåœ¨å…¥å£æ–‡ä»¶å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿ã€‚
+ ç°åœ¨åœ¨ `School` ç»„ä»¶ä¸­æƒ³è¦æ¥æ”¶æ¥è‡ª `Student` ç»„ä»¶çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨ `School` ç»„ä»¶ä¸­ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ `hello` ï¼Œå¹¶å°†å›è°ƒå†™åœ¨ `School` ç»„ä»¶ä¸­ï¼šï¼ˆä¸‹é¢ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼‰

```js
mounted() {
  this.$bus.$on('hello', (data) => {
    console.log('School receiving StudentName: ', data)
  })
}
```

+ åœ¨ `Student` ç»„ä»¶æƒ³è¦æä¾›æ•°æ®ï¼Œåˆ™åœ¨ `Student` ä¸­è§¦å‘è¯¥è‡ªå®šä¹‰äº‹ä»¶ `hello`ï¼Œå¹¶ä¸”ä¼ é€’æ•°æ®åˆ°å‚æ•°ä¸­ã€‚

```vue
<button @click="sendStudentName">æŠŠå­¦ç”Ÿåç»™Schoolç»„ä»¶</button>
```

```js
methods: {
  sendStudentName() {
    this.$bus.$emit('hello', this.name)
  }
}
```

+ åœ¨ `School` ç»„ä»¶æ¥å—å®Œæ•°æ®ï¼Œè§£ç»‘è¯¥è‡ªå®šä¹‰äº‹ä»¶ï¼š

```js
 beforeDestroy() {
  this.$bus.$off('hello')
}
```


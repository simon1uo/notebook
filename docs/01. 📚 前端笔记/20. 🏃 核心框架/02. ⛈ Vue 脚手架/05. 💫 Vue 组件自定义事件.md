---
title: ğŸ’« Vue ç»„ä»¶è‡ªå®šä¹‰äº‹ä»¶
date: 2022-03-11 16:25:03
permalink: /pages/19709c/
categories: 
  - ğŸ“š å‰ç«¯ç¬”è®°
  - ğŸƒ æ ¸å¿ƒéƒ¨åˆ†
  - â›ˆ Vue ç»„ä»¶åŒ–ç¼–ç¨‹
tags: 
  - Vue
author: 
  name: Simon
  link: https://github.com/simon1uo
---
## è‡ªå®šä¹‰äº‹ä»¶

è‡ªå®šä¹‰äº‹ä»¶æ˜¯åŒºåˆ«äº Vue ä¸­çš„å†…ç½®äº‹ä»¶çš„äº‹ä»¶ï¼Œå†…ç½®äº‹ä»¶ä¸€èˆ¬æ˜¯æä¾›ç»™ HTML  DOMä½¿ç”¨ï¼Œè‡ªå®šä¹‰äº‹ä»¶ä¸€èˆ¬æä¾›ç»™ç»„ä»¶ä½¿ç”¨çš„ã€‚

+ é€‚ç”¨äºç»„ä»¶çš„é€šä¿¡ï¼š **å­ç»„ä»¶ ==> çˆ¶ç»„ä»¶**ã€‚

+ ä½¿ç”¨åœºæ™¯ï¼šA æ˜¯çˆ¶ç»„ä»¶ï¼ŒB æ˜¯å­ç»„ä»¶ï¼ŒB æƒ³ç»™ A ä¼ æ•°æ®ï¼Œé‚£ä¹ˆå°±è¦**åœ¨ A ä¸­ç»™ B ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶**ï¼ˆäº‹ä»¶å›è°ƒåœ¨çˆ¶ç»„ä»¶ä¸­ï¼‰ï¼›

+ **ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶**ï¼ˆå¦‚åœ¨çˆ¶ç»„ä»¶ï¼‰ï¼š

  + æ–¹æ³•ä¸€ï¼šåœ¨çˆ¶ç»„ä»¶ä¸­ï¼š`<Demo @get=â€œtestâ€ />` æˆ–è€… `<Demo v-on:get="test" />`ï¼ˆ`Demo` ä¸ºå­ç»„ä»¶åï¼Œç»™è¯¥å®ä¾‹å¯¹è±¡ `vc` ç»‘å®š äº†æŸäº‹ä»¶ï¼‰

  + æ–¹å¼äºŒï¼šåœ¨çˆ¶ç»„ä»¶ä¸­é€šè¿‡ `ref` å†™æ³•ï¼ˆçµæ´»æ€§å¼ºï¼Œå¯ä»¥ä½¿ç”¨ç­‰å¾…ä¿®é¥°ç­‰ã€‚ï¼‰
  
  + âš ï¸ï¼š ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥åŠ ä¸Šäº‹ä»¶çš„ä¿®é¥°ç¬¦ï¼ˆå¦‚ `once` è§¦å‘ä¸€æ¬¡å°±ä¸å†è§¦å‘äº†ï¼‰ï¼› 
  
    âš ï¸âš ï¸ï¼š é€šè¿‡ `$refs` æ–¹æ³•ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶æ—¶ï¼Œ**å›è°ƒå‡½æ•°ä¸­è¦ä¹ˆé…ç½®åœ¨ `methods` ä¸­ï¼Œè¦ä¹ˆä½¿ç”¨ç®­å¤´å‡½æ•°**ï¼Œå¦åˆ™ `this` çš„æŒ‡å‘ä¼šæœ‰é—®é¢˜ï¼ˆè¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ•°æ®ï¼Œåªæœ‰åœ¨ `data`ã€`props`ã€`computed` ä¸­è·å–æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ç°åœ¨ `data` ä¸­å®šä¹‰æ•°æ®å˜é‡ï¼Œç„¶ååœ¨å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨ `this` èµ‹å€¼ï¼‰ã€‚
  



+ **è§¦å‘è‡ªå®šä¹‰äº‹ä»¶**ï¼ˆåœ¨å­ç»„ä»¶ï¼‰ï¼šï¼ˆåŸåˆ™ï¼šç»™è°ç»‘å®šçš„äº‹ä»¶å°±åœ¨è°è§¦å‘ï¼ˆè‡ªå·±ç»‘å®šäº‹ä»¶åªèƒ½è‡ªå·±è§¦å‘ï¼‰ï¼‰`this.$emit(â€˜getâ€™, æ•°æ®)`ï¼Œæ•°æ®ä¸ºå¯ä»¥ä¸ºå¤šä¸ªæ•°æ®å‚æ•°ã€‚

+ **è§£ç»‘è‡ªå®šä¹‰äº‹ä»¶**ï¼ˆåœ¨å­ç»„ä»¶ï¼‰ï¼š

  + `this.$off(â€˜getâ€™)` è§£ç»‘æŒ‡å®šäº‹ä»¶ï¼›
  + `this.$off([â€˜getâ€™, â€˜demoâ€™])` æˆ–è€… `this.$off()`ï¼ˆè§£ç»‘æ‰€æœ‰ï¼‰ è§£ç»‘å¤šä¸ªäº‹ä»¶ã€‚

  ï¼ˆä¸Šè¿°çš„ `get` å‡ä¸ºè‡ªå®šä¹‰äº‹ä»¶åï¼Œ`test` ä¸ºçˆ¶ç»„ä»¶ä¸­æ¥å—æ•°æ®çš„æ–¹æ³•ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼‰

+ é™¤äº†å¯¹äº HTML ä¸Šçš„ DOMï¼Œåœ¨ç»„ä»¶ä¸Šä¹Ÿå¯ä»¥ç»‘å®šåŸç”Ÿçš„ DOM äº‹ä»¶ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨ `native` ä¿®é¥°ç¬¦ï¼›

> åœ¨ Vue çš„ç”Ÿå‘½å‘¨æœŸä¸­çš„ `this.$destroy` ä¹Ÿä¼šå¯¼è‡´ç»„ä»¶ä¸­çš„è‡ªå®šä¹‰äº‹ä»¶å¤±æ•ˆï¼ŒåŸç”Ÿçš„äº‹ä»¶ä¸å—å½±å“ã€‚



::: tip

åœ¨ Vue çš„å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹è‡ªå®šä¹‰äº‹ä»¶ï¼š

![image-20220403130046723](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/0e1FzX.png)

:::



ğŸŒ° **è‡ªå®šä¹‰äº‹ä»¶ä¾‹å­**ï¼š

::: details

+ åœ¨çˆ¶ç»„ä»¶ `App` ä¸­ï¼Œé€šè¿‡ `ref` å†™æ³•ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼š

```vue
<Student ref="student"/>
```

```js
mounted() {
    this.$refs.student.$on('get', this.getStudentName) // ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶
    // this.$refs.student.$once('get', this.getStudentName) // è§¦å‘ä¸€æ¬¡å°±ä¸å†è§¦å‘çš„è‡ªå®šä¹‰äº‹ä»¶
```

+ ç»‘å®šçš„äº‹ä»¶æ–¹æ³• `getStudentName` ï¼š

```js
methods: {
  getStudentName(studentName, ...params) {
      console.log('studentName:', studentName, params)
      this.studentName = studentName // æ­¤å¤„çš„thisä¸ºAppç»„ä»¶å®ä¾‹
    }
}
```

> æ­¤å¤„ `â€¦params` æ˜¯ ES6 ç”¨æ³•ï¼Œè¡¨ç¤ºå¯ä»¥ä¼ å…¥å¤šä¸ªå‚æ•°ã€‚

+ åœ¨å­ç»„ä»¶ `Student` ä¸­ï¼Œè§¦å‘äº‹ä»¶ï¼š

é¦–å…ˆå°†è§¦å‘äº‹ä»¶çš„äº‹ä»¶ç»‘å®šåœ¨ä¸€ä¸ªæŒ‰é’®ä¸Šï¼Œä»¥ä¾¿æµ‹è¯•ï¼š

```vue
<button @click="sendStudentName">æŠŠå­¦ç”Ÿåç»™App</button>
```

ç„¶ååœ¨ `sendStudentName` ä¸­è§¦å‘ï¼š

```js
methods:{
  sendStudentName() {
      // è§¦å‘Studentç»„ä»¶å®ä¾‹èº«ä¸Šçš„getäº‹ä»¶
      this.$emit('get', this.name, 1, 2, 3)
    },
}
```

+ ä»¥ä¸Šæ­¥éª¤ä¾¿å®Œæˆäº†å­ç»„ä»¶ `Student` ä¸çˆ¶ç»„ä»¶ `App` ä¹‹é—´çš„é€šä¿¡ã€‚ 

***

+ è§£ç»‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œåœ¨å“ªé‡Œè§¦å‘åœ¨å“ªé‡Œè§£ç»‘ï¼š

```js
unbind(){
  // è§£ç»‘ä¸€ä¸ªäº‹ä»¶
  this.$off('get')

  // è§£ç»‘å¤šä¸ªè‡ªå®šä¹‰äº‹ä»¶
  // this.$off(['get', 'demoEvent'])

  // è§£ç»‘æ‰€æœ‰è‡ªå®šä¹‰äº‹ä»¶
  // this.$off()
},
```

+ é”€æ¯å®ä¾‹ï¼Œå¯¼è‡´è‡ªå®šä¹‰äº‹ä»¶å¤±æ•ˆï¼š

```js
death(){
  this.$destroy() // é”€æ¯äº†å½“å‰çš„Studentç»„ä»¶çš„å®ä¾‹ï¼Œé”€æ¯åæ‰€æœ‰çš„Studentå®ä¾‹çš„è‡ªå®šä¹‰äº‹ä»¶å…¨éƒ½ä¸å¥æ•ˆ
}
```

***

+ åœ¨å…¥å£æ–‡ä»¶ `main.js` ä¸­é”€æ¯æ•´ä¸ª vm å®ä¾‹ï¼Œå¯¼è‡´è‡ªå®šä¹‰äº‹ä»¶å¤±æ•ˆï¼š

```js
mounted(){
    setTimeout(()=>{
        this.$destroy()
    }, 3000)
}
```

ï¼ˆç¼–å†™äº†ä¸€ä¸ªå®šæ—¶å™¨æµ‹è¯•ï¼Œåœ¨3ç§’åè‡ªå®šä¹‰äº‹ä»¶å¤±æ•ˆï¼‰



ğŸŒ° ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶çš„å¤šç§æ–¹æ³•ä»¥åŠ `this` çš„æŒ‡å‘ï¼š

+ `this` æŒ‡å‘å½“å‰ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶çš„ç»„ä»¶ï¼š

ç¬¬ä¸€ç§ï¼š

```js
mounted() {
  this.$refs.student.$on('get', this.getStudentName) // ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶
}
```

```js
methods: {
  getStudentName(studentName, ...params) {
  	console.log('studentName:', studentName, params)
  	this.studentName = studentName // æ­¤å¤„çš„thisä¸ºAppç»„ä»¶å®ä¾‹
  }
}
```

> åœ¨ Vue ä¸­çš„ `methods` ä¸­ç¼–å†™æ–¹æ³•ï¼Œ`this` ä¼šæŒ‡å‘å½“å‰çš„ç»„ä»¶ã€‚

ç¬¬äºŒç§ï¼Œä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š 

```js
mounted() {
  this.$refs.student.$on('get', (studentName, ...params)=>{
      console.log('studentName:', studentName, params)
      this.studentName = studentName // æ­¤å¤„çš„thisä¸ºAppå®ä¾‹
    	// æ³¨ï¼šç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisä¼šå‘å¤–æ‰¾thisï¼Œæ­¤å¤„å‘å¤–ä¸ºmounted()
      console.log(this)
    })
}
```

+ `this` æŒ‡å‘è§¦å‘è‡ªå®šä¹‰äº‹ä»¶çš„ç»„ä»¶ï¼š

```js
mounted() {
  his.$refs.student.$on('get', function(studentName, ...params) {
      console.log('studentName:', studentName, params)
      this.studentName = studentName // æ­¤å¤„çš„thisä¸ºStudentç»„ä»¶å®ä¾‹ï¼ˆè°è§¦å‘è‡ªå®šä¹‰äº‹ä»¶thisæŒ‡å‘è°ï¼‰
      console.log(this)
    })
}
```



ğŸŒ° åœ¨ç»„ä»¶ä¸­ç»‘å®šåŸç”Ÿ DOM äº‹ä»¶çš„ä¾‹å­ï¼š

+ åœ¨ `App` ç»„ä»¶ä¸­ï¼š

```vue
<Student ref="student" @click.native="show"/>
```

> åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç»‘å®šäº‹ä»¶ï¼Œä¸æ·»åŠ  `.native` ç»„ä»¶ä¼šé»˜è®¤ä¼šè‡ªå®šä¹‰äº‹ä»¶ï¼Œå½¢å¦‚ `<Student @get="getStudentName"/>`ã€‚

```js
methods: {
  show() {
      alert('you clicked Student component')
  }
}
```


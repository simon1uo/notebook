---
title: 🚊 Promise 的基本使用
date: 2022-04-20 21:49:32
permalink: /pages/5468e4/
categories: 
  - 📚 前端笔记
  - 🚶 基础部分
  - 🚇 Promise
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---
### 理解 Promise

从抽象角度看：

+ Promise 是一门 ES6 规范下新的技术；

+ Promise 是 JavaScript 中进行**异步编程的新解决方案**；

>  旧方案是单纯使用回调函数。

从具体角度看：

+ 从语法上来讲： Promise 是一个构造函数；
+ 从功能上来讲： Promise 对象用来封装一个异步操作并且可以获取其成功/失败的结果值。



> 异步编程相关例子（回调函数）：
>
> * fs 文件操作：
>
>   ```js
>   require('fs').readFile('./index.html', (err,data)=>{})
>   ```
>
> * 数据库操作；
>
> * AJAX 请求：
>
>   ```js
>     $.get('/server', (data)=>{})
>   ```
>
> * 定时器：
>
>   ```js
>   setTimeout(()=>{}, 2000);
>   ```
>



### Promise 的简单使用案例

```js
const btn = document.querySelector('#btn');
// 绑定单击事件
btn.addEventListener('click', function () {
    /*setTimeout(() => {
        // 获取从一到一百的随机数
        let n = rand(1, 100);
        // 判断
        if (n <= 30) {
            alert('中奖')
        } else {
            alert('再接再厉')
        }
    }, 1000)*/

    // Promise 实现
    const p = new Promise((resolve, reject) => {
        // 成功时调用resolve，失败时调用reject（函数类型）
        //包含一个函数
        setTimeout(() => {
            // 获取从一到一百的随机数
            let n = rand(1, 100);
            // 判断
            if (n <= 30) {
                resolve(n) // 将Promise对象状态设置为「成功」
            } else {
                reject(n) // 将Promise对象状态设置为「失败」
            }
        }, 1000)
    })

    // 第一个是成功时调用，第二个是失败时调用
    // 在构造p时传给状态的值，不同状态分别为 value / reason
    p.then((value) => {
        alert('成功中奖，中奖数字为' + value)
    }, (reason) => {
        alert('再接再厉，当前号码为'+ reason)
    })
})
```

（更多实践例子，Promise 使用fs模块、）



### Promise 的状态

Promise 状态（PromiseState）是 Promise 实例对象的一个属性，有三个值：pending（初始状态）、resolved / fulfilled、 rejected

（实例对象）从上面简单使用 Promise 的例子中，可以看到 Promise 可以有两种转变：

+ pending ➡️ resolved 
+ pending ➡️ rejected

注意，Promise 只有这两种状态，并且每一个 Promise 对象只能转变一次，无论转为成功还是失败，都会有一个结果数据。「成功（resolved）」的结果为 `value` ，「失败（rejected）」时的结果为 `reason`。



### Promise 的结果

Promise 实例对象中另外一个属性是 PromiseResult（Promise 结果），保存着异步任务「成功/失败」的结果，有两个属性 resolve、reject。



### Promise 的基本流程

分析上述基本使用例子，得出 Promise 的基本流程：

![image-20220420231156529](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/M8C5lh.png)

### Promise 的特点

+ **指定回调函数的方式更加灵活**：

  + 在以前，回调函数必须**在启动异步任务前指定**。

  + Promise 下的流程为：启动异步任务 ➡️ 返回 Promise 对象 ➡️ 给 Promise 对象绑定回调函数 （**甚至可以在异步任务将结束后指定多个**）

+ **支持链式调用**，可以解决「回调地狱」的问题：

  + 「回调地狱」：回调函数嵌套调用，外部回调函数异步**执行的结果**是嵌套的回调**执行的条件**。回调地狱带来了 代码不便于阅读、不便与异常处理的缺点。使用 Promise 链式调用解决。

  + 终极的解决方案： `async / await` 
---
title:  ğŸˆ JavaScript ä¸ JSON
date: 2022-05-05 17:42:19
permalink: /pages/70ef3b/
categories:
  -  ğŸ“š å‰ç«¯ç¬”è®°
  -  ğŸš¶ åŸºç¡€éƒ¨åˆ†
  -  ğŸ“• JavaScript æ·±å…¥æ•°æ®ç±»å‹
tags:
  - 
---



JavaScript æä¾›äº†å¦‚ä¸‹æ–¹æ³•ï¼š

- `JSON.stringify` å°†å¯¹è±¡è½¬æ¢ä¸º JSONã€‚
- `JSON.parse` å°† JSON è½¬æ¢å›å¯¹è±¡ã€‚



## `JSON.stringfy`



ğŸŒ° ä¾‹å­ / å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼š

```js
let student = {
  name: 'John',
  age: 30,
  isAdmin: false,
  courses: ['html', 'css', 'js'],
  wife: null
};

let json = JSON.stringify(student);
console.log(typeof json) // string
```



::: warning

æ³¨æ„ï¼šJSON ç¼–ç çš„å¯¹è±¡ä¸å¯¹è±¡å­—é¢é‡æœ‰å‡ ä¸ªé‡è¦çš„åŒºåˆ«ï¼š

- å­—ç¬¦ä¸²ä½¿ç”¨åŒå¼•å·ã€‚JSON ä¸­æ²¡æœ‰å•å¼•å·æˆ–åå¼•å·ã€‚
- å¯¹è±¡å±æ€§åç§°ä¹Ÿæ˜¯åŒå¼•å·çš„ã€‚è¿™æ˜¯å¼ºåˆ¶æ€§çš„ã€‚

:::



`JSON.stringify` ä¹Ÿå¯ä»¥åº”ç”¨äºåŸæ•°æ®ç±»å‹ã€‚JSON æ”¯æŒä»¥ä¸‹æ•°æ®ç±»å‹ï¼š

- Objects `{ ... }`
- Arrays `[ ... ]`
- åŸå§‹æ•°æ®ç±»å‹ï¼š
  - å­—ç¬¦ä¸²
  - æ•°å€¼
  - å¸ƒå°”
  - `null`



ğŸŒ° ä¾‹å­ / `JSON.stringify`  è½¬æ¢åŸå§‹æ•°æ®ç±»å‹ï¼š
```js
alert( JSON.stringify(1) ) // 1
alert( JSON.stringify('test') ) // "test"
alert( JSON.stringify(true) ); // true
alert( JSON.stringify([1, 2, 3]) ); // [1,2,3]
```



JSON æ˜¯è¯­è¨€æ— å…³çš„çº¯æ•°æ®è§„èŒƒï¼Œå› æ­¤ä¸€äº›ç‰¹å®šäº JavaScript çš„å¯¹è±¡å±æ€§ä¼šè¢« `JSON.stringify` è·³è¿‡ã€‚

+ å‡½æ•°å±æ€§ ï¼ˆæ–¹æ³•ï¼‰ã€‚
+ Symbol ç±»å‹çš„é”®å’Œå€¼ã€‚
+ å­˜å‚¨ `undefined` çš„å±æ€§ã€‚



ğŸŒ° ä¾‹å­ï¼š
```js
let user = {
  sayHi() { // è¢«å¿½ç•¥
    alert("Hello");
  },
  [Symbol("id")]: 123, // è¢«å¿½ç•¥
  something: undefined // è¢«å¿½ç•¥
};

console.log(JSON.stringfy(user)) // {}
```



`JSON.stringify` æ”¯æŒåµŒå¥—å¯¹è±¡è½¬æ¢ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚

ğŸŒ° ä¾‹å­ï¼š
```js
let meetup = {
  title: "Conference",
  room: {
    number: 23,
    participants: ["john", "ann"]
  }
};

console.log(JSON.stringify(meetup))
```



::: warning 

ä¸å…è®¸ **å¾ªç¯å¼•ç”¨çš„å¯¹è±¡**ï¼š

```js
let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: ["john", "ann"]
};

meetup.place = room;       // meetup å¼•ç”¨äº† room
room.occupiedBy = meetup; // room å¼•ç”¨äº† meetup

JSON.stringify(meetup);  //  Error: Converting circular structure to JSON
```

:::



### `replacer`

`JSON.stringify` çš„å®Œæ•´è¯­æ³•æ˜¯ï¼š

```js
JSON.stringify(value[, replacer, space])
```

+ `value`ï¼šè¦ç¼–ç çš„å€¼ã€‚
+ `replacer`ï¼šè¦ç¼–ç çš„å±æ€§æ•°ç»„æˆ–æ˜ å°„å‡½æ•° `function(key, value)`ã€‚
+ `space`ï¼šç”¨äºæ ¼å¼åŒ–çš„ç©ºæ ¼æ•°é‡ã€‚



å¤§éƒ¨åˆ†æƒ…å†µï¼Œ`JSON.stringify` ä»… `value` å‚æ•°ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦å¾®è°ƒæ›¿æ¢è¿‡ç¨‹ï¼Œæ¯”å¦‚ **è¿‡æ»¤æ‰å¾ªç¯å¼•ç”¨**ï¼Œå¯ä»¥ä½¿ç”¨ `JSON.stringify` çš„ `replacer` ï¼Œå¦‚æœä¼ é€’ä¸€ä¸ªå±æ€§æ•°ç»„ç»™å®ƒï¼Œé‚£ä¹ˆåªæœ‰è¿™äº›å±æ€§ä¼šè¢«ç¼–ç ã€‚

ğŸŒ° ä¾‹å­ ï¼š

```js
let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: [{name: "John"}, {name: "Alice"}],
  place: room // meetup å¼•ç”¨äº† room
};

room.occupiedBy = meetup; 
console.log(JSON.stringify(meetup, ['title', 'participants'])) // {"title":"Conference","participants":[{},{}]}
```

>  å±æ€§åˆ—è¡¨åº”ç”¨äºæ•´ä¸ªå¯¹è±¡è§£æ„ã€‚`name` ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œæ‰€ä»¥ `participants` ä¸ºç©ºã€‚å³ä¾¿è¿™é‡Œå­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚



ğŸŒ° ä¾‹å­ / æ’é™¤æ‰å¾ªç¯å¼•ç”¨çš„å±æ€§ï¼š

å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ä»£æ›¿æ•°ç»„ä½œä¸º `replacer`ï¼Œè¯¥å‡½æ•°ä¼šä¸ºæ¯ä¸ª `(key,value)` å¯¹è°ƒç”¨å¹¶è¿”å›ã€Œå·²æ›¿æ¢ã€çš„å€¼ï¼Œè¯¥å€¼å°†æ›¿æ¢åŸæœ‰çš„å€¼ã€‚å¦‚æœå€¼è¢«è·³è¿‡äº†ï¼Œåˆ™ä¸º `undefined`ã€‚

```js
console.log(SON.stringify(meetup, function replacer(key, value) {
  alert(`${key}: ${value}`);
  return (key == 'occupiedBy') ? undefined : value;
})))

/* key:value pairs that come to replacer:
:             [object Object]
title:        Conference
participants: [object Object],[object Object]
0:            [object Object]
name:         John
1:            [object Object]
name:         Alice
place:        [object Object]
number:       23
occupiedBy: [object Object]
*/
```

> æ³¨æ„ `replacer` å‡½æ•°ä¼šè·å–æ¯ä¸ªé”®/å€¼å¯¹ï¼ŒåŒ…æ‹¬åµŒå¥—å¯¹è±¡å’Œæ•°ç»„é¡¹ã€‚å®ƒè¢«é€’å½’åœ°åº”ç”¨ã€‚`replacer` ä¸­çš„ `this` çš„å€¼æ˜¯åŒ…å«å½“å‰å±æ€§çš„å¯¹è±¡ã€‚
>
> ç¬¬ä¸€ä¸ªè°ƒç”¨å¾ˆç‰¹åˆ«ã€‚å®ƒæ˜¯ä½¿ç”¨ç‰¹æ®Šçš„ã€ŒåŒ…è£…å¯¹è±¡ã€åˆ¶ä½œçš„ï¼š`{"": meetup}`ã€‚å³ç¬¬ä¸€ä¸ª `(key, value)` å¯¹çš„é”®æ˜¯ç©ºçš„ï¼Œå¹¶ä¸”è¯¥å€¼æ˜¯æ•´ä¸ªç›®æ ‡å¯¹è±¡ã€‚è¿™å°±æ˜¯ä¸Šé¢çš„ç¤ºä¾‹ä¸­ç¬¬ä¸€è¡Œæ˜¯ `":[object Object]"` çš„åŸå› ã€‚
>
> å‡½æ•°æ˜¯ä¸ºäº†ç»™ `replacer` æä¾›å°½å¯èƒ½å¤šçš„åŠŸèƒ½ï¼šå¦‚æœæœ‰å¿…è¦ï¼Œå®ƒæœ‰æœºä¼šåˆ†æå¹¶æ›¿æ¢/è·³è¿‡æ•´ä¸ªå¯¹è±¡ã€‚



## `space` æ ¼å¼åŒ–

`JSON.stringify(value, replacer, spaces)` çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç”¨äºä¼˜åŒ–æ ¼å¼çš„ç©ºæ ¼æ•°é‡ï¼ˆç¼©è¿›ï¼‰ã€‚



## `toJSON`

åƒ `toString` è¿›è¡Œå­—ç¬¦ä¸²è½¬æ¢ï¼Œå¯¹è±¡ä¹Ÿå¯ä»¥æä¾› `toJSON` æ–¹æ³•æ¥è¿›è¡Œ JSON è½¬æ¢ã€‚å¦‚æœå¯ç”¨ï¼Œ`JSON.stringify` ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒã€‚

ğŸŒ° ä¾‹å­ï¼š
```js
let room = {
  number: 23,
  toJSON() {
    return this.number;
  }
};

let meetup = {
  title: "Conference",
  room
};

alert( JSON.stringify(room) ); // 23

alert( JSON.stringify(meetup) );
/*
  {
    "title":"Conference",
    "room": 23
  }
*/
```

> `toJSON` æ—¢å¯ä»¥ç”¨äºç›´æ¥è°ƒç”¨ `JSON.stringify(room)` ä¹Ÿå¯ä»¥ç”¨äºå½“ `room` åµŒå¥—åœ¨å¦ä¸€ä¸ªç¼–ç å¯¹è±¡ä¸­æ—¶ã€‚



## `JSON.parse`

è¯­æ³•ï¼š`JSON.parse(str, [reviver])`

+ `str`ï¼šè¦è§£æçš„å­—ç¬¦ä¸²ã€‚
+ `reviver`ï¼šå¯é€‰å‚æ•°ï¼Œè¯¥å‡½æ•°å°†ä¸ºæ¯ä¸ª `(key, value)` å¯¹è°ƒç”¨ï¼Œå¹¶å¯ä»¥å¯¹å€¼è¿›è¡Œè½¬æ¢ã€‚



ğŸŒ° ä¾‹å­ / å­—ç¬¦ä¸²åŒ–æ•°ç»„ï¼š

```js
let numbers = "[0, 1, 2, 3]";
numbers = JSON.parse(numbers);
```

ğŸŒ° ä¾‹å­ / åµŒå¥—å¯¹è±¡çš„å­—ç¬¦ä¸²ï¼š

```js
let userData = '{ "name": "John", "age": 35, "isAdmin": false, "friends": [0,1,2,3] }';
let user = JSON.parse(userData);
```



JSON å¯èƒ½ä¼šéå¸¸å¤æ‚ï¼Œå¯¹è±¡å’Œæ•°ç»„å¯ä»¥åŒ…å«å…¶ä»–å¯¹è±¡å’Œæ•°ç»„ã€‚ä½†æ˜¯å®ƒä»¬å¿…é¡»éµå¾ªç›¸åŒçš„ JSON æ ¼å¼ã€‚

âš ï¸ JSON ä¸æ”¯æŒæ³¨é‡Šã€‚å‘ JSON æ·»åŠ æ³¨é‡Šæ— æ•ˆã€‚



### `receiver`

ğŸŒ° ä¾‹å­ / å¤„ç† JSON å­—ç¬¦ä¸²ä¸­çš„ç‰¹å®šå±æ€§ç±»å‹ `Date` ï¼š

```js
let str = '{"title":"Conference","date":"2017-11-30T12:00:00.000Z"}';

let meetup = JSON.parse(str, function(key, value) {
  if (key == 'date') return new Date(value);
  return value;
});
console.log(meetup.date.getDate())
```

ğŸŒ° ä¾‹å­ / åŒæ ·é€‚ç”¨äºåµŒå¥—çš„å¯¹è±¡ï¼š

```js
let schedule = `{
  "meetups": [
    {"title":"Conference","date":"2017-11-30T12:00:00.000Z"},
    {"title":"Birthday","date":"2017-04-18T12:00:00.000Z"}
  ]
}`;

schedule = JSON.parse(schedule, function(key, value) {
  if (key == 'date') return new Date(value);
  return value;
});

console.log( schedule.meetups[1].date.getDate() );
```



## JSON æ€»ç»“

- JSON æ˜¯ä¸€ç§æ•°æ®æ ¼å¼ï¼Œå…·æœ‰è‡ªå·±çš„ç‹¬ç«‹æ ‡å‡†å’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€çš„åº“ã€‚
- JSON æ”¯æŒå¯¹è±¡ã€æ•°ç»„å’ŒåŸå§‹æ•°æ®ç±»å‹ã€‚
- JavaScript æä¾›åºåˆ—åŒ–æˆ JSON çš„æ–¹æ³• [JSON.stringify](https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) å’Œè§£æ JSON çš„æ–¹æ³• [JSON.parse](https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse)ã€‚
  - æ”¯æŒ `replacer` / `receiver` è°ƒç”¨æ™ºèƒ½ è¯»/å†™ è½¬æ¢å‡½æ•°

---
title:  ðŸ• JavaScript åŽŸç”Ÿçš„åŽŸåž‹
date: 2022-05-14 12:59:26
permalink: /pages/c73165/
categories:
  -  ðŸ“š å‰ç«¯ç¬”è®°
  -  ðŸš¶ åŸºç¡€éƒ¨åˆ†
  -  ðŸ“˜ JavaScript åŽŸåž‹ä¸Žç»§æ‰¿
tags:
  - 
---
`prototype` å±žæ€§åœ¨ JavaScript **è‡ªèº«çš„æ ¸å¿ƒéƒ¨åˆ†ä¸­è¢«å¹¿æ³›åœ°åº”ç”¨**ã€‚æ‰€æœ‰çš„å†…å»ºæž„é€ å‡½æ•°éƒ½ç”¨åˆ°äº†å®ƒã€‚



## `Object.prototype`

ðŸŒ° ä¾‹å­ / **è¾“å‡ºä¸€ä¸ªç©ºç™½å¯¹è±¡**ï¼š
```js
let obj = {}
console.log(obj) // [object Object]
```

> `obj = {}` ç›¸å½“äºŽ `obj = new Object()`ã€‚å…¶ä¸­ `Object` å°±æ˜¯ä¸€ä¸ª **å†…å»ºçš„å¯¹è±¡æž„é€ å‡½æ•°**ï¼Œå…¶è‡ªèº«çš„ `prototype` æŒ‡å‘ä¸€ä¸ªå¸¦æœ‰ `toString` å’Œå…¶ä»–æ–¹æ³•çš„ä¸€ä¸ªå·¨å¤§çš„å¯¹è±¡ã€‚
>
> ![image-20220514130153731](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/qfKy2d.png)
>
> å½“ åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆ`new Object()` è¢«è°ƒç”¨ï¼‰ï¼ŒæŒ‰ç…§å‰é¢çš„ æž„é€ åŽŸåž‹ï¼Œè¿™ä¸ªæ–°çš„å¯¹è±¡çš„ `[[prototype]]` å±žæ€§ä¼šè¢«è®¾ç½®ä¸º `Object.prototype`ï¼š
>
> ![image-20220514130858908](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/3i29l0.png)
>
> æ‰€ä»¥å½“ è¿™ä¸ªæ–°çš„å¯¹è±¡ï¼ˆå¦‚ä¸Šç©ºç™½å¯¹è±¡ï¼‰è¦è¢«è¾“å‡ºæ—¶ï¼Œè°ƒç”¨ `obj.toString()` æ–¹æ³•æ˜¯æ¥è‡ª `Object.toString()` æ–¹æ³•ã€‚
>
> å¯ä»¥éªŒè¯ï¼š
> ```js
> console.log(obj.__proto__ === Object.prototype) // true
> console.log(obj.toString === obj.__proto__.toString) // true
> console.log(obj.toString === Object.prototype.toString) // true
> ```
>
> å¯¹äºŽ `Object` å·²ç»æ˜¯åŽŸåž‹é“¾çš„æœ«ç«¯ï¼Œä¸Šæ–¹æ²¡æœ‰æ›´å¤šçš„ `[[prototype]]`ã€‚
>
> ```js
> console.log(Object.prototype.__proto__) // null
> ```



## å…¶ä»–å†…å»ºå¯¹è±¡çš„åŽŸåž‹

åœ¨ JavaScript ä¸­çš„å…¶ä»–å†…å»ºå¯¹è±¡ä¸­ï¼Œå¦‚ `Array`ã€`Date`ã€`Function` åŠå…¶ä»–ï¼Œéƒ½åœ¨ prototype ä¸ŠæŒ‚è½½äº†æ–¹æ³•ã€‚



ðŸŒ° ä¾‹å­ / æ•°ç»„ï¼š

å½“åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œä¼šåœ¨ **å†…éƒ¨é»˜è®¤ä½¿ç”¨ `new Array()`** æž„é€ å™¨ã€‚å› æ­¤ï¼Œ`Array.prototype` å˜æˆäº†è¿™ä¸ªæ•°ç»„çš„ prototypeï¼Œå¹¶ä¸ºè¿™ä¸ªæ•°ç»„æä¾›æ•°ç»„çš„æ“ä½œæ–¹æ³•ã€‚è¿™æ ·å†…å­˜çš„å­˜å‚¨æ•ˆçŽ‡æ˜¯å¾ˆé«˜çš„ã€‚



**å¹¶ä¸”ï¼Œæ‰€æœ‰å†…å»ºåŽŸåž‹é¡¶ç«¯éƒ½æ˜¯ `Object.prototype`ã€‚**

å¦‚ä¸‹å›¾ï¼š
![image-20220514131340973](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/zuzTPb.png)



æ‰‹åŠ¨éªŒè¯å¦‚ä¸‹ï¼š

```js
let arr = [1, 2, 3]

console.log(arr.__proto__ === Array.prototype) // true
console.log(arr.__proto__.__proto__ === Object.prototype) // true
console.log(arr.__proto__.__proto__.__proto__) // null
```



å¯¹äºŽå¯èƒ½é‡å çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `toString()` æ–¹æ³•ï¼š

ðŸŒ° ä¾‹å­ï¼š

åœ¨æ•°ç»„ä¸­ `Array.prototype` æœ‰è‡ªå·±çš„ `toString` æ–¹æ³•åˆ—ä¸¾å‡ºæ•°ç»„çš„æ‰€æœ‰å…ƒç´ ã€‚è™½ç„¶ `Object.prototype` ä¹Ÿå­˜åœ¨ `toString` æ–¹æ³•ï¼Œä½†æ˜¯ **åœ¨åŽŸåž‹é“¾ä¸­**ï¼Œæ˜¾ç„¶ `Array.prototype` æ›´è¿‘ï¼Œæ‰€ä»¥è¾“å‡ºä¸€ä¸ªæ•°ç»„æ—¶ï¼Œæ•°ç»„å¯¹è±¡åŽŸåž‹ä¸Šçš„æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚

åœ¨æµè§ˆå™¨çš„å¼€å‘å·¥å…·å¯ä»¥çœ‹åˆ° å¯¹è±¡çš„ åŽŸåž‹ç»§æ‰¿ã€‚ï¼ˆå†…å»ºå¯¹è±¡ä½¿ç”¨ `console.dir` ï¼‰



ðŸŒ° ä¾‹å­ï¼š

å¯¹äºŽå‡½æ•° ï¼Œå®ƒä»¬æ˜¯å†…å»ºæž„é€ å™¨ `Function` çš„å¯¹è±¡ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ–¹æ³•ï¼ˆ`call`/`apply` åŠå…¶ä»–ï¼‰éƒ½å–è‡ª `Function.prototype`ã€‚å‡½æ•°ä¹Ÿæœ‰è‡ªå·±çš„ `toString` æ–¹æ³•ã€‚

```js
function f() {}
console.log(f.__proto__ === Function.prototype) // true
console.log(f.__proto__.proto === Object.prototype)) // true
```



## åŸºæœ¬æ•°æ®ç±»åž‹çš„åŽŸåž‹

å¯¹äºŽ **å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼**ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯å¯¹è±¡ï¼Œå¦‚æžœè¯•å›¾è®¿é—®å®ƒä»¬çš„å±žæ€§ï¼Œé‚£ä¹ˆä¸´æ—¶åŒ…è£…å™¨å¯¹è±¡å°†ä¼šé€šè¿‡å†…å»ºçš„æž„é€ å™¨ `String`ã€`Number` å’Œ `Boolean` è¢«åˆ›å»ºã€‚å®ƒä»¬æä¾›ç»™æ“ä½œå­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”å€¼çš„æ–¹æ³•ç„¶åŽæ¶ˆå¤±ã€‚ï¼ˆ `null` **å’Œ** `undefined` **æ²¡æœ‰å¯¹è±¡åŒ…è£…å™¨**ï¼Œä»–ä»¬æ²¡æœ‰æ–¹æ³•å’Œå±žæ€§ï¼Œä¹Ÿæ²¡æœ‰ç›¸åº”çš„åŽŸåž‹ï¼‰

è¿™äº›å¯¹è±¡æ˜¯ **æ— å½¢åœ°** åˆ›å»ºå‡ºæ¥çš„ã€‚è¿™äº›å¯¹è±¡çš„æ–¹æ³•ä¹Ÿé©»ç•™åœ¨å®ƒä»¬çš„ prototype ä¸­ï¼Œå¯ä»¥é€šè¿‡ `String.prototype`ã€`Number.prototype` å’Œ `Boolean.prototype` è¿›è¡ŒèŽ·å–ã€‚



### æ›´æ”¹åŽŸåž‹åŽŸåž‹

ðŸŒ° ä¾‹å­ / å‘ `String.prototype` ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ—¶è¿™ä¸ªæ–¹æ³•å°†å¯¹æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯å¯ç”¨çš„ï¼š

```js
String.prototype.show = function() {
  console.log(this);
};

"BOOM!".show(); // BOOM!
```

::: tip

åœ¨å¼€å‘ä¸­ä¸å»ºè®®å°†æ–°çš„æ–¹æ³•æ·»åŠ åˆ° åŽŸç”ŸåŽŸåž‹ä¸­ï¼šåŽŸåž‹æ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é€ æˆå†²çªã€‚å¦‚æžœæœ‰ä¸¤ä¸ªåº“éƒ½æ·»åŠ äº† `String.prototype.show` æ–¹æ³•ï¼Œé‚£ä¹ˆå…¶ä¸­çš„ä¸€ä¸ªæ–¹æ³•å°†è¢«å¦ä¸€ä¸ªè¦†ç›–ã€‚

:::



ðŸŒ° ä¾‹å­ / polyfills ä¿®æ”¹å†…å»ºåŽŸåž‹ï¼š**åœ¨çŽ°ä»£ç¼–ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ç§æƒ…å†µä¸‹å…è®¸ä¿®æ”¹åŽŸç”ŸåŽŸåž‹ã€‚é‚£å°±æ˜¯ polyfillingã€‚**
```js
if (!String.prototype.repeat) { // å¦‚æžœè¿™å„¿æ²¡æœ‰è¿™ä¸ªæ–¹æ³•
  // é‚£å°±åœ¨ prototype ä¸­æ·»åŠ å®ƒ

  String.prototype.repeat = function(n) {
    // é‡å¤ä¼ å…¥çš„å­—ç¬¦ä¸² n æ¬¡

    // å®žé™…ä¸Šï¼Œå®žçŽ°ä»£ç æ¯”è¿™ä¸ªè¦å¤æ‚ä¸€äº›ï¼ˆå®Œæ•´çš„æ–¹æ³•å¯ä»¥åœ¨è§„èŒƒä¸­æ‰¾åˆ°ï¼‰
    // ä½†å³ä½¿æ˜¯ä¸å¤Ÿå®Œç¾Žçš„ polyfill ä¹Ÿå¸¸å¸¸è¢«è®¤ä¸ºæ˜¯è¶³å¤Ÿå¥½çš„
    return new Array(n + 1).join(this);
  };
}

console.log("La".reapeat(3))
```



### ä»ŽåŽŸåž‹ä¸­å€Ÿç”¨

æ–¹æ³•å€Ÿç”¨æŒ‡ ä»Žä¸€ä¸ªå¯¹è±¡ä¸­èŽ·å–ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚**ä¸€äº›åŽŸç”Ÿçš„æ–¹æ³•é€šå¸¸ä¼šè¢«å€Ÿç”¨**ã€‚

ðŸŒ° ä¾‹å­ï¼š

```js
let obj = {
  0: 'hello',
  1: 'world',
  length: 2
}

obj.join = Array.prototype.join
console.log(obj.join(','))
```

> ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œä»Žæ•°ç»„æ–¹æ³•ä¸­å€Ÿç”¨äº† `join`ï¼Œå› ä¸º `obj` å¯¹è±¡ä¸Žæ•°ç»„å¾ˆç±»ä¼¼ï¼Œéƒ½æœ‰æ­£ç¡®çš„ç´¢å¼•å’Œ `length` å±žæ€§ã€‚æ‰€ä»¥å†…å»ºæ–¹æ³• `join` å¯ä»¥é€‚ç”¨è¿™ä¸ªå¯¹è±¡å€Ÿç”¨ï¼Œè€Œä¸ä¼šæ£€æŸ¥è¿™ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯çœŸæ­£çš„æ•°ç»„ã€‚
>
> å…¨é¢å€Ÿç”¨æ•°ç»„æ–¹æ³•ï¼Œå¯ä»¥å°† `obj.__proto__` è®¾ç½®ä¸º `Array.prototype` ï¼Œè¿™æ · `Array` ä¸­çš„æ–¹æ³•å°±å¯ä»¥åœ¨ `obj` ä¸­ä½¿ç”¨ã€‚
>
> ä½†æ˜¯å¦‚æžœ `obj` å·²ç»ä»Žå¦ä¸€ä¸ªå¯¹è±¡è¿›è¡Œäº†ç»§æ‰¿ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•å°±ä¸å¯è¡Œäº†ï¼ˆå› ä¸ºè¿™æ ·ä¼šè¦†ç›–æŽ‰å·²æœ‰çš„ç»§æ‰¿ã€‚æ­¤å¤„ `obj`å…¶å®žå·²ç»ä»Ž `Object` è¿›è¡Œäº†ç»§æ‰¿ï¼Œä½†æ˜¯ `Array` ä¹Ÿç»§æ‰¿è‡ª `Object`ï¼Œæ‰€ä»¥æ­¤å¤„çš„æ–¹æ³•å€Ÿç”¨ä¸ä¼šå½±å“ `obj` å¯¹åŽŸæœ‰ç»§æ‰¿çš„ç»§æ‰¿ï¼Œå› ä¸º `obj` é€šè¿‡åŽŸåž‹é“¾ä¾æ—§ç»§æ‰¿äº† `Object`ï¼‰ã€‚**å› ä¸ºä¸€æ¬¡åªèƒ½ç»§æ‰¿ä¸€ä¸ªå¯¹è±¡**ã€‚

**æ–¹æ³•å€Ÿç”¨å¾ˆçµæ´»ï¼Œå®ƒå…è®¸åœ¨éœ€è¦æ—¶æ··åˆæ¥è‡ªä¸åŒå¯¹è±¡çš„æ–¹æ³•ã€‚**



## æ€»ç»“

+ æ‰€æœ‰çš„å†…å»ºå¯¹è±¡éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š
  - æ–¹æ³•éƒ½å­˜å‚¨åœ¨ prototype ä¸­ï¼ˆä¾‹å¦‚ï¼Œ`Array.prototype`ã€`Object.prototype`ã€`Date.prototype` ç­‰ï¼‰ã€‚
  - å¯¹è±¡æœ¬èº«åªå­˜å‚¨æ•°æ®ï¼ˆæ•°ç»„å…ƒç´ ã€å¯¹è±¡å±žæ€§ã€æ—¥æœŸï¼‰ã€‚
+ åŽŸå§‹æ•°æ®ç±»åž‹ä¹Ÿå°†æ–¹æ³•å­˜å‚¨åœ¨åŒ…è£…å™¨å¯¹è±¡çš„ prototype ä¸­ï¼š`Number.prototype`ã€`String.prototype` å’Œ `Boolean.prototype`ã€‚åªæœ‰ `undefined` å’Œ `null` æ²¡æœ‰åŒ…è£…å™¨å¯¹è±¡ã€‚

+ å†…å»ºåŽŸåž‹å¯ä»¥è¢«ä¿®æ”¹æˆ–è¢«ç”¨æ–°çš„æ–¹æ³•å¡«å……ã€‚ä½†æ˜¯ä¸å»ºè®®æ›´æ”¹å®ƒä»¬ã€‚å”¯ä¸€å…è®¸çš„æƒ…å†µå¯èƒ½æ˜¯ï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè¿˜æ²¡æœ‰è¢« JavaScript å¼•æ“Žæ”¯æŒï¼Œä½†å·²ç»è¢«åŠ å…¥ JavaScript è§„èŒƒçš„æ–°æ ‡å‡†æ—¶ï¼Œæ‰å¯èƒ½å…è®¸è¿™æ ·åšã€‚



## å®žä¾‹

### ç»™å‡½æ•°çš„åŽŸåž‹æ·»åŠ æ–¹æ³•

> åœ¨æ‰€æœ‰å‡½æ•°çš„åŽŸåž‹ä¸­æ·»åŠ  `derfer(ms)` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†åœ¨ `ms` æ¯«ç§’åŽè¿è¡Œè¯¥å‡½æ•°ï¼š
> ```js
> function f() {
>   alert("Hello!");
> }
> 
> f.defer(1000);
> ```

::: details

```js
Function.prototype.defer = function(ms) {
  setTimeout(this, ms)
}

function f() {
alert("Hello!");
}

f.defer(1000);
```
:::



### ç»™å‡½æ•°çš„åŽŸåž‹æ·»åŠ è£…é¥°å™¨æ–¹æ³•

> åœ¨æ‰€æœ‰å‡½æ•°çš„åŽŸåž‹ä¸­æ·»åŠ  `defer(ms)` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›žä¸€ä¸ªåŒ…è£…å™¨ï¼Œå°†å‡½æ•°è°ƒç”¨å»¶è¿Ÿ `ms` æ¯«ç§’ã€‚æ³¨æ„å‚æ•°åº”è¯¥ä¼ ç»™åŽŸå§‹å‡½æ•°ï¼š
>
> ```js
> function f(a, b) {
>   alert( a + b );
> }
> 
> f.defer(1000)(1, 2); 
> ```

::: details

```js
Function.prototype.defer = function(ms) {
  let f = this
  return function(...args) {
    setTimeout(() => f.apply(this, args), ms)
  }
}
```

åœ¨ `f.apply` ä¸­ä½¿ç”¨ `this` ä»¥ä½¿è£…é¥°å™¨é€‚ç”¨äºŽå¯¹è±¡æ–¹æ³•ã€‚

ä¾‹å¦‚ï¼š
```js
let user = {
  name: "John",
  sayHi() {
    alert(this.name);
  }
}

user.sayHi = user.sayHi.defer(1000);
user.sayHi()
```

:::
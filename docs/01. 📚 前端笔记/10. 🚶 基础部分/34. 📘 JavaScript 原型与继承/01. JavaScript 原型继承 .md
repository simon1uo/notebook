å½“å·²ç»å­˜åœ¨ä¸€ä¸ª `user` å¯¹è±¡ä»¥åŠå…¶å±žæ€§ä¸Žæ–¹æ³•ï¼Œæƒ³è¦å°† `admin` å’Œ `guest` ä½œä¸ºåŸºäºŽ `user` ç¨åŠ ä¿®æ”¹çš„å˜ä½“ï¼Œåœ¨ `user` åŸºç¡€ä¹‹ä¸Šæž„å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚

JavaScript çš„ **åŽŸåž‹ç»§æ‰¿**ï¼ˆPrototype inheritanceï¼‰ ç‰¹æ€§å¸®åŠ©å®žçŽ°è¿™ä¸ªéœ€æ±‚ã€‚



## `[[Prototype]]` å±žæ€§

åœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ **éšè—å±žæ€§** `[[Prototype]]`ï¼š

+ è¦ä¹ˆä¸º `null`ï¼›

+ è¦ä¹ˆå°±æ˜¯å¯¹å¦ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚è¯¥å¯¹è±¡è¢«ç§°ä¸ºã€ŒåŽŸåž‹ã€ã€‚

  

å½“å°è¯•ä»Žä¸€ä¸ªå¯¹è±¡ `object` ä¸­èŽ·å–ä¸€ä¸ª **ç¼ºå¤±çš„å±žæ€§** æ—¶ï¼Œ JavaScript ä¼šè‡ªåŠ¨ä»Ž **åŽŸåž‹** ä¸­èŽ·å–è¯¥å±žæ€§ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸ºã€ŒåŽŸåž‹ç»§æ‰¿ã€ã€‚

å¯¹è±¡çš„ `[[Prototype]]` å±žæ€§æ˜¯ **åœ¨å†…éƒ¨çš„** å¹¶ä¸”æ˜¯ **éšè—çš„**ã€‚



ðŸŒ° ä¾‹å­ï¼š

```js
let animal = {
  eats: true
};
let rabbit = {
  jumps: true
};

rabbit.__proto__ = animal; 
```

å½“ä»Ž `rabbit` ä¸­è¯»å–ä¸€ä¸ªå®ƒä¸å­˜åœ¨çš„å±žæ€§ï¼ŒJavaScript ä¼šä»Ž `animal` ä¸­èŽ·å–ï¼š

```js
console.log(rabbit.eats) // true
```

> è¿™ä¸ªä¾‹å­ä¸­çš„ `rabbit__proto__ = animal` å°† `animal` è®¾ç½®ä¸º `rabbit` çš„ **åŽŸåž‹**ã€‚åŽŸæ¥çš„ `rabbit` å¯¹è±¡å¹¶ä¸å­˜åœ¨ `eats` å±žæ€§ï¼ŒJavaScript ä¼šé¡ºç€ **`[[Prototype]]` å¼•ç”¨** åœ¨ `animal` ä¸­æŸ¥æ‰¾ï¼ˆè‡ªä¸‹è€Œä¸Šï¼‰ã€‚
>
> è¿™ä¸ªä¾‹å­å¯ä»¥ç§° ã€Œ `animal` æ˜¯ `rabbit` çš„åŽŸåž‹ã€ æˆ–è€… ã€Œ`rabbit` çš„åŽŸåž‹æ˜¯ä»Ž `animal` ç»§æ‰¿è€Œæ¥çš„ ã€ã€‚å½“ `animal` ä¸­æœ‰çš„å±žæ€§å’Œæ–¹æ³•ï¼Œéƒ½ä¼šè‡ªåŠ¨å˜ä¸ºåœ¨ `rabbit` ä¸­å¯ä»¥ä½¿ç”¨ï¼ˆç»§æ‰¿å±žæ€§å’Œæ–¹æ³•ï¼‰ã€‚

å½“ `animal` ä¸­æœ‰æ–¹æ³•ï¼š

```js
let animal = {
  eats: true,
  walk() {
    console.log('animal walk')
  }
}  
```

```js
rabbit.walk() // animal walk
```



### åŽŸåž‹é“¾

ðŸŒ° ä¾‹å­ï¼š
```js
let animal = {
  eats: true,
  walk() {
    alert("Animal walk");
  }
};

let rabbit = {
  jumps: true,
  __proto__: animal
};

let longEar = {
  earLength: 10,
  __proto__: rabbit
};
```

> çŽ°åœ¨ï¼Œå¦‚æžœä»Ž `longEar` ä¸­è¯»å–ä¸€äº›å®ƒä¸å­˜åœ¨çš„å†…å®¹ï¼ŒJavaScript ä¼šå…ˆåœ¨ `rabbit` ä¸­æŸ¥æ‰¾ï¼Œç„¶åŽåœ¨ `animal` ä¸­æŸ¥æ‰¾ã€‚
>
> ä½†æ˜¯è¦éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
>
> + å¼•ç”¨ä¸èƒ½å½¢æˆé—­çŽ¯ã€‚è¯•å›¾åœ¨é—­çŽ¯å†…åˆ†é… `__prototype__` ä¼šæŠ¥é”™ã€‚
> + `__proto__` çš„å€¼å¯ä»¥æ˜¯ **å¯¹è±¡**ï¼Œä¹Ÿå¯ä»¥æ˜¯ `null`ã€‚è€Œå…¶ä»–çš„ç±»åž‹éƒ½ä¼šè¢«å¿½ç•¥ã€‚
> + æ˜¾ç„¶ï¼Œ**ä¸€ä¸ªå¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ª `[[prototype]]`**ã€‚ä¸€ä¸ªå¯¹è±¡ä¸èƒ½ä»Žå…¶ä»–ä¸¤ä¸ªå¯¹è±¡ä¸­å³æˆã€‚

> `__proto__` æ˜¯ `[[prototype]]` çš„è®¿é—®å™¨ï¼ˆ`getter` / `setter`ï¼‰ï¼ˆ`__proto__` ä¸Ž `[[prototype]]` è¦åŒºåˆ«å¼€ï¼‰ï¼š
>
> + `__proto__` å±žæ€§æœ‰ç‚¹è¿‡æ—¶äº†ï¼Œå®ƒçš„å­˜åœ¨æ˜¯å‡ºäºŽåŽ†å²çš„åŽŸå› ã€‚çŽ°ä»£ç¼–ç¨‹è¯­è¨€å»ºè®®åº”è¯¥ä½¿ç”¨å‡½æ•° `Object.getPrototypeOf` /  `Object.setPrototypeOf` æ¥å–ä»£ `__proto__` åŽ» get/set åŽŸåž‹ã€‚



### åŽŸåž‹ä»…ç”¨äºŽè¯»å–å±žæ€§

ðŸŒ° ä¾‹å­ï¼š

```js
let animal = {
  eats: true,
  walk() {
		// ... 
  }
};

let rabbit = {
  __proto__: animal
};

rabbit.walk = function() {
  alert("Rabbit! Bounce-bounce!");
};

rabbit.walk() // Rabbit! Bounce-bounce!
```

> è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`rabbit` ä¸­åˆ†é…äº†è‡ªå·±çš„ `walk` æ–¹æ³•ã€‚
>
> å°½ç®¡ `rabbit` çš„åŽŸåž‹æ˜¯ `animal`ã€‚ä½†æ˜¯å› ä¸º `rabbit` æœ¬èº«å°±æœ‰ `walk` æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¯¹è±¡ä¸­æ‰¾åˆ°è¯¥æ–¹æ³•æ— éœ€ä½¿ç”¨åŽŸåž‹ã€‚

å°½ç®¡è®¾ç½®äº†åŽŸåž‹åœ¨å…ˆï¼Œä½†æ˜¯åŽæ¥çš„ æ·»åŠ æ–¹æ³• æ“ä½œï¼Œæ˜¯åœ¨å¯¹è±¡å­èº«ä¸Šè¿›è¡Œçš„ï¼Œä¸ä¼šå†åŽŸåž‹ä¸Šè¿›è¡Œï¼ˆå¯¹äºŽåˆ é™¤å±žæ€§åŒç†ï¼‰ã€‚

å¯ä»¥çœ‹å‡ºï¼ŒåŽŸåž‹ä»…ç”¨äºŽè¯»å–å±žæ€§ã€‚



ðŸŒ° ä¾‹å­ / è®¿é—®å™¨å±žæ€§æ˜¯ **ä¾‹å¤–**ã€‚å› ä¸ºåˆ†é…æ“ä½œæ˜¯é€šè¿‡ `setter` å‡½æ•°å¤„ç†çš„ï¼Œæ‰€ä»¥å†™å…¥æ­¤å±žæ€§çš„æ“ä½œç›¸å½“äºŽ **è¯»å–è¯¥å±žæ€§**ã€‚

```js
let user = {
  name: "John",
  surname: "Smith",

  set fullName(value) {
    [this.name, this.surname] = value.split(" ");
  },

  get fullName() {
    return `${this.name} ${this.surname}`;
  }
};

let admin = {
  __proto__: user,
  isAdmin: true
};

console.log(admin.fullName) // John Smith
admin.fullName = "Alice Cooper"

console.log(admin.fullName) // Alice Cooper
console.log(user.fullName) // John Smith
```

> `admin.fullName = "Alice Cooper"` å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå› ä¸ºå®ƒçš„åŽŸåž‹å¯¹è±¡ä¸­æœ‰ `fullName` çš„ `setter` å‡½æ•°ã€‚
>
> å¹¶ä¸”ä¿®æ”¹çš„æ˜¯ `admin` åŽŸåž‹å¯¹è±¡çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ åŽŸæ¥çš„å¯¹è±¡ï¼ˆè¢«ä¿æŠ¤ï¼‰ã€‚



### `this` çš„å€¼

**`this` ä¸å—åŽŸåž‹çš„å½±å“**ï¼šæ— è®ºåœ¨å“ªé‡Œæ‰¾åˆ°è¯¥æ–¹æ³•ï¼ˆåœ¨ä¸€ä¸ªå¯¹è±¡æˆ–è€…åœ¨åŽŸåž‹ä¸­ï¼‰ï¼Œåœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œ`this` å§‹ç»ˆæŒ‡å‘çš„æ˜¯ `.` å‰é¢çš„å¯¹è±¡ï¼ˆè°ƒç”¨çš„è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼‰ã€‚

ä»Žä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çŸ¥é“ï¼Œåœ¨ `setter` è¢«è°ƒç”¨æ—¶ï¼Œ`admin.fullName = '...'` æ˜¯ `admin` è°ƒç”¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥ `this` æŒ‡å‘çš„æ˜¯ `admin`ã€‚

::: tip

æ¸…æ¥š `this` çš„å€¼ã€‚æœ‰å¯èƒ½æœ‰ä¸€ä¸ªå¸¦æœ‰å¾ˆå¤šæ–¹æ³•çš„å¤§å¯¹è±¡ï¼Œå¹¶ä¸”è¿˜æœ‰ä»Žå…¶ç»§æ‰¿çš„å¯¹è±¡ã€‚å½“ç»§æ‰¿çš„å¯¹è±¡è¿è¡Œæ–¹æ³•æ—¶ï¼Œå®ƒä»¬åº”è¯¥åªä¿®æ”¹è‡ªèº«çš„çŠ¶æ€è€Œä¸ä¿®æ”¹å¤§å¯¹è±¡çš„çŠ¶æ€ã€‚

:::

ðŸŒ° ä¾‹å­ / æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯å­˜å‚¨å±žæ€§ï¼š
```js
let animal = {
  walk() {
    if (!this.isSleeping) {
      alert(`I walk`);
    }
  },
  sleep() {
    this.isSleeping = true;
  }
};

let rabbit = {
  name: "White Rabbit",
  __proto__: animal
};

rabbit.sleep();
console.log(rabbit.isSleeping)  // true
console.log(animal.isSleeping) // undefined
```



> åŽŸåž‹æ–¹æ³•å…±äº«ï¼Œä½†æ˜¯å¯¹è±¡çŠ¶æ€ä¸æ˜¯ã€‚



### å¾ªçŽ¯

ðŸŒ° ä¾‹å­ï¼š
```js
let animal = {
  eats: true
};

let rabbit = {
  jumps: true,
  __proto__: animal
};

// å¯¹äºŽ Object.keys
console.log(Object.keys(rabbit)) // jumps

// å¯¹äºŽ for...in
for(let prop in rabbit) console.log(prop) // jumps, eats
```

> å¯ä»¥çœ‹å‡º `for ... in `å¾ªçŽ¯ä¼šè¿­ä»£ **ç»§æ‰¿çš„å±žæ€§**ã€‚



å¦‚æžœæƒ³ **æŽ’é™¤ç»§æ‰¿çš„å±žæ€§** æˆ–è€…åˆ©ç”¨å®ƒä»¬è¿›è¡Œå…¶ä»–æ“ä½œï¼Œ å¯ä»¥ä½¿ç”¨ `obj.hasOwnProperty(key)` åˆ¤æ–­ï¼šå¦‚æžœ `obj` å…·æœ‰è‡ªå·±çš„ï¼ˆéžç»§æ‰¿çš„ï¼‰`key` å±žæ€§åˆ™è¿”å›ž `true`ã€‚

```js
for(let prop in rabbit) {
  let isOwn = rabbit.hasOwnProperty(prop)
  
  if(isOwn) {
    console.log(`our: ${prop}`)
  } else {
    console.log(`inherited: ${prop}`)
  }
}
```

> `hasOwnProperty` æ–¹æ³•æ˜¯ `rabbit` ä»Ž `Object.prototype` ä¸­ç»§æ‰¿çš„ï¼ˆè¯¥æ–¹æ³•æ˜¯ `Object.prototype.hasOwnProperty` æä¾›çš„ï¼‰ã€‚å¹¶ä¸”è¯¥æ–¹æ³•æ˜¯ä¸å¯æžšä¸¾çš„ï¼Œæ‰€ä»¥ `for ... in ` æ²¡æœ‰åˆ—å‡ºã€‚

::: tip

å‡ ä¹Žæ‰€æœ‰çš„ **å…¶ä»–é”®/å€¼èŽ·å–æ–¹æ³•** éƒ½å¿½ç•¥ç»§æ‰¿çš„å±žæ€§ï¼ˆä¾‹å¦‚ `Object.keys` å’Œ `Object.values` ç­‰ï¼‰ã€‚å®ƒä»¬åªä¼šå¯¹å¯¹è±¡ **è‡ªèº«** è¿›è¡Œæ“ä½œã€‚**ä¸è€ƒè™‘** ç»§æ‰¿è‡ªåŽŸåž‹çš„å±žæ€§ã€‚

:::



## æ€»ç»“

+ `[[prototype]]` æ˜¯ å¯¹è±¡ çš„éšè—å±žæ€§ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¦ä¹ˆä¸º `null`ã€‚å¯ä»¥é€šè¿‡ `obj.__proto__` è®¿é—®ã€‚
+ é€šè¿‡ `[[Prototype]]` å¼•ç”¨çš„å¯¹è±¡è¢«ç§°ä¸ºã€ŒåŽŸåž‹ã€ã€‚
+ å½“è¯»å– `obj` çš„ä¸€ä¸ªå±žæ€§æˆ–è€…è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å®ƒä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ JavaScript å°±ä¼šå°è¯•åœ¨åŽŸåž‹ä¸­æŸ¥æ‰¾å®ƒã€‚
  + å†™/åˆ é™¤æ“ä½œç›´æŽ¥åœ¨ å¯¹è±¡è‡ªèº« ä¸Šè¿›è¡Œï¼Œä¸ä½¿ç”¨åŽŸåž‹ã€‚
  + `this`çš„å€¼æ˜¯ è°è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°±æ˜¯å“ªä¸ªå¯¹è±¡ã€‚
+ `for ... in` å¾ªçŽ¯æ—¶ï¼Œé™¤äº†è‡ªèº«çš„å±žæ€§ï¼Œç»§æ‰¿çš„å±žæ€§ä¹Ÿä¼šè¿­ä»£åˆ—å‡ºã€‚æ‰€æœ‰å…¶ä»–çš„é”®/å€¼èŽ·å–æ–¹æ³•ä»…å¯¹å¯¹è±¡æœ¬èº«èµ·ä½œç”¨ã€‚



## å®žä¾‹



### æœç´¢é“¾

> ```js
> let head = {
>   glasses: 1
> };
> 
> let table = {
>   pen: 3
> };
> 
> let bed = {
>   sheet: 1,
>   pillow: 2
> };
> 
> let pockets = {
>   money: 2000
> };
> ```
>
> 1. ä½¿ç”¨ `__proto__` æ¥åˆ†é…åŽŸåž‹ï¼Œä»¥ä½¿å¾—ä»»ä½•å±žæ€§çš„æŸ¥æ‰¾éƒ½éµå¾ªä»¥ä¸‹è·¯å¾„ï¼š`pockets` â†’ `bed` â†’ `table` â†’ `head`ã€‚ä¾‹å¦‚ï¼Œ`pockets.pen` åº”è¯¥æ˜¯ `3`ï¼ˆåœ¨ `table` ä¸­æ‰¾åˆ°ï¼‰ï¼Œ`bed.glasses` åº”è¯¥æ˜¯ `1`ï¼ˆåœ¨ `head` ä¸­æ‰¾åˆ°ï¼‰ã€‚
> 2. é€šè¿‡ `pockets.glasses` æˆ– `head.glasses` èŽ·å– `glasses`ï¼Œå“ªä¸ªæ›´å¿«ï¼Ÿå¿…è¦æ—¶éœ€è¦è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚

::: details 

+ åœ¨çŽ°ä»£å¼•æ“Žä¸­ï¼Œä»Žæ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œ**æ˜¯ä»Žå¯¹è±¡è¿˜æ˜¯ä»ŽåŽŸåž‹é“¾èŽ·å–å±žæ€§éƒ½æ˜¯æ²¡åŒºåˆ«çš„**ã€‚å®ƒä»¬ï¼ˆå¼•æ“Žï¼‰ä¼šè®°ä½åœ¨å“ªé‡Œæ‰¾åˆ°çš„è¯¥å±žæ€§ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡è¯·æ±‚ä¸­é‡ç”¨å®ƒã€‚
+ å¯¹äºŽ `pockets.glasses` æ¥è¯´ï¼Œå®ƒä»¬ï¼ˆå¼•æ“Žï¼‰ä¼šè®°å¾—åœ¨å“ªé‡Œæ‰¾åˆ°çš„ `glasses`ï¼ˆåœ¨ `head` ä¸­ï¼‰ï¼Œè¿™æ ·ä¸‹æ¬¡å°±ä¼š **ç›´æŽ¥åœ¨è¿™ä¸ªä½ç½®è¿›è¡Œæœç´¢**ã€‚å¹¶ä¸”å¼•æ“Žè¶³å¤Ÿèªæ˜Žï¼Œä¸€æ—¦æœ‰å†…å®¹æ›´æ”¹ï¼Œå®ƒä»¬å°±ä¼šè‡ªåŠ¨æ›´æ–°å†…éƒ¨ç¼“å­˜ï¼Œå› æ­¤ï¼Œè¯¥ä¼˜åŒ–æ˜¯å®‰å…¨çš„ã€‚

:::



### ä»“é¼ ä¾‹å­

> æœ‰ä¸¤åªä»“é¼ ï¼š`speedy` å’Œ `lazy` éƒ½ç»§æ‰¿è‡ªæ™®é€šçš„ `hamster` å¯¹è±¡ã€‚
>
> å½“æˆ‘ä»¬å–‚å…¶ä¸­ä¸€åªçš„æ—¶å€™ï¼Œå¦ä¸€åªä¹Ÿåƒé¥±äº†ã€‚ä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•ä¿®å¤å®ƒï¼Ÿ
>
> ```js
> let hamster = {
>   stomach: [],
> 
>   eat(food) {
>     this.stomach.push(food);
>   }
> };
> 
> let speedy = {
>   __proto__: hamster
> };
> 
> let lazy = {
>   __proto__: hamster
> };
> 
> // è¿™åªä»“é¼ æ‰¾åˆ°äº†é£Ÿç‰©
> speedy.eat("apple");
> console.log(speedy.stomach) // apple
> console.log(lazy.stomach) // apple
> ```
>
> 
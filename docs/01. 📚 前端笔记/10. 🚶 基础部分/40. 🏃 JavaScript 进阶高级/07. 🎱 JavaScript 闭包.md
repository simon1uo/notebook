---
title: ğŸ± JavaScript é—­åŒ…
date: 2022-03-19 11:26:14
permalink: /pages/46b9da/
categories: 
  - ğŸ“š å‰ç«¯ç¬”è®°
  - ğŸš¶ åŸºç¡€éƒ¨åˆ†
  - ğŸƒ JavaScript è¿›é˜¶é«˜çº§
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---


ğŸŒ° ä¾‹å­å¼•å…¥ï¼šå¾ªç¯éå†åŠ ç›‘å¬ï¼š

åˆå§‹ï¼š
::: demo [vanilla]

```html
<html>
  <button class="btns1">æµ‹è¯•1</button>
  <button class="btns1">æµ‹è¯•2</button>
  <button class="btns1">æµ‹è¯•3</button>
</html>
<script>
var btns = document.getElementsByClassName("btns1");

for (var i = 0, length = btns.length; i < length; i++) {
  var btn = btns[i];
  btn.index = i;
  btn.onclick = function () {
    alert("ç¬¬" + (this.index + 1) + "ä¸ª");
  };
}
</script>
```

:::

ä½¿ç”¨**é—­åŒ…**æ”¹è¿›åˆå§‹æ€è·¯ï¼š

::: demo [vanilla]

```html
<html>
  <button class="btns2">æµ‹è¯•1</button>
  <button class="btns2">æµ‹è¯•2</button>
  <button class="btns2">æµ‹è¯•3</button>
</html>
<script>
var btns = document.getElementsByClassName("btns2");

for (var i = 0, length = btns.length; i < length; i++) {
  (function (i) {
    var btn = btns[i];
    btn.onclick = function () {
      alert("ç¬¬" + (i + 1) + "ä¸ª");
    };
  })(i);
}
</script>
```

:::



### é—­åŒ…çš„æ¦‚å¿µ

+ å¦‚ä½•äº§ç”Ÿé—­åŒ…ï¼šå½“ä¸€ä¸ªåµŒå¥—çš„**å†…éƒ¨**ï¼ˆå­ï¼‰å‡½æ•°**å¼•ç”¨**äº†åµŒå¥—çš„**å¤–éƒ¨**ï¼ˆçˆ¶ï¼‰å‡½æ•°çš„å˜é‡ï¼ˆå‡½æ•°ï¼‰æ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ã€‚

+ **é—­åŒ…çš„ç†è§£**ï¼šï¼ˆé€šè¿‡ `devTools` æŸ¥çœ‹ `closure`ï¼‰

  1. é—­åŒ…æ˜¯**åµŒå¥—çš„å†…éƒ¨å‡½æ•°**ã€‚ï¼ˆæå¤§éƒ¨åˆ†çš„äººçš„ç†è§£ï¼‰
  2. åŒ…å«è¢«å¼•ç”¨å˜é‡ï¼ˆå‡½æ•°ï¼‰çš„å¯¹è±¡ã€‚ï¼ˆå°‘æ•°äººç†è§£ï¼‰

  :warning: æ³¨æ„ï¼š**é—­åŒ…å­˜åœ¨äºåµŒå¥—çš„å†…éƒ¨å‡½æ•°ä¸­**ã€‚

+ **äº§ç”Ÿé—­åŒ…çš„æ¡ä»¶**ï¼š

  + **å‡½æ•°åµŒå¥—**ã€‚
  + **å†…éƒ¨å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„æ•°æ®**ã€‚ï¼ˆæ‰§è¡Œå¤–éƒ¨å‡½æ•°å®šä¹‰å°±ä¼šäº§ç”Ÿé—­åŒ…ï¼Œä¸å¿…è°ƒç”¨å†…éƒ¨å‡½æ•°ï¼‰



ğŸŒ°ï¼š ä¾‹å­

```js
function fn1 (){
  var a = 2 
  function fn2 (){
    console.log(a)
  }
}
fn1()
```



**å¸¸è§çš„é—­åŒ…**ï¼š

ğŸŒ° ä¾‹å­ :one:ï¼š**å°†å‡½æ•°ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼**ï¼š
```js
function fn1(){
  var a = 2
  function fn2() {
  	a++  
    console.log(a)
  }
  return fn2
}
var f = fn1()
f() // 3
f() // 4
```





ğŸŒ° ä¾‹å­ :two:ï¼š**å°†å‡½æ•°ä½œä¸ºå®å‚ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨**ï¼š
```js
function showDelay(msg, time){
  setTimeout(function (){
  	alert(msg)
	}, time)
}

showDelay('msg', 2000)
```



### é—­åŒ…çš„ä½œç”¨

+ ä½¿ç”¨**å‡½æ•°å†…éƒ¨çš„å˜é‡**åœ¨å‡½æ•°æ‰§è¡Œå®Œåï¼Œä»ç„¶å­˜æ´»åœ¨å†…å­˜ä¸­ï¼ˆå»¶é•¿äº†å±€éƒ¨å˜é‡çš„**ç”Ÿå‘½å‘¨æœŸ**ï¼‰ã€‚
+ **è®©å‡½æ•°å¤–éƒ¨å¯ä»¥æ“ä½œï¼ˆè¯»/å†™ï¼‰åˆ°å‡½æ•°å†…éƒ¨çš„æ•°æ®**ï¼ˆå˜é‡æˆ–è€…å‡½æ•°ï¼‰

> :question:ç›¸å…³é—®é¢˜ï¼›
>
> 1. **å‡½æ•°æ‰§è¡Œå®Œåï¼Œå‡½æ•°å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡æ˜¯å¦è¿˜å­˜åœ¨ï¼Ÿ**
>
>    ä¸€èˆ¬ä¸å­˜åœ¨å­˜åœ¨ã€‚å½“å­˜åœ¨é—­åŒ…æ—¶ï¼Œå¯èƒ½è¿˜å­˜åœ¨ï¼Œå› ä¸ºè¯¥å±€éƒ¨å˜é‡è¢«åŒ…å«åœ¨é—­åŒ…å†…ã€‚ç”±äºå¤–éƒ¨å£°æ˜äº†ä¸€ä¸ªå˜é‡æŠŠå†…éƒ¨çš„ä¸€ä¸ªé—­åŒ…ä¸€ç›´å…³è”ç€æ‰€ä»¥é—­åŒ…ä¼šä¸€ç›´å­˜åœ¨ï¼ˆä¾‹å¦‚ä¸Šé¢ç¬¬ä¸€ä¸ªä¾‹å­ `var f = fn1()` ï¼‰
>
> 2. åœ¨å‡½æ•°å¤–éƒ¨èƒ½**ç›´æ¥**è®¿é—®å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡å—ï¼Ÿ
>
>    ä¸èƒ½ã€‚ä½†æ˜¯é€šè¿‡é—­åŒ…å¯ä»¥è®©å¤–éƒ¨æ“ä½œå®ƒã€‚ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ `return xx() `ï¼Œå¯è¢«å¤–éƒ¨æ“ä½œã€‚ï¼‰



### é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸ

+ äº§ç”Ÿï¼šåœ¨åµŒå¥—å†…éƒ¨å‡½æ•°**å®šä¹‰æ‰§è¡Œå®Œ**å°±äº§ç”Ÿäº†ï¼ˆ:warning: ä¸æ˜¯åœ¨è°ƒç”¨æ—¶ï¼‰ã€‚ï¼ˆä¾‹å¦‚ä¸Šç¬¬ä¸€ä¸ªä¾‹å­ `fn1() ` è¢«å®šä¹‰å®Œï¼Œå‡½æ•°æå‡ï¼Œå†…éƒ¨å‡½æ•°å¯¹è±¡å·²ç»åˆ›å»ºäº†ã€‚ï¼‰

+ æ­»äº¡ï¼šåœ¨åµŒå¥—çš„å†…éƒ¨å‡½æ•°æˆä¸º**åƒåœ¾å¯¹è±¡**æ—¶ï¼ˆå³åŒ…å«é—­åŒ…çš„å‡½æ•°å¯¹è±¡ç§°ä¸ºåƒåœ¾å¯¹è±¡ï¼‰ã€‚ï¼ˆä¾‹å¦‚ä¸Šç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨è¦æŠ›å¼ƒé—­åŒ…æ—¶ï¼Œå°† `f = null` å³å¯ã€‚ï¼‰



::: warning

å®åœ¨æ³¨æ„é—­åŒ…çš„äº§ç”Ÿã€‚å¯¹æ¯”ä¸‹é¢çš„ä¾‹å­ï¼š
```js
function fn1(){
  var a = 2
  var f2 = fn2() { // æ­¤æ—¶æ‰äº§ç”Ÿé—­åŒ…
  	a++  
    console.log(a)
  }
  return fn2
}
var f = fn1()
f() // 3
f() // 4
```

:::

### é—­åŒ…çš„åº”ç”¨

å¯ä»¥ä½¿ç”¨é—­åŒ…å®šä¹‰ **JavaScript æ¨¡å—**ã€‚

> JavaScript æ¨¡å—ï¼š
>
> + å…·æœ‰ç‰¹å®šåŠŸèƒ½çš„ `.js` æ–‡ä»¶ã€‚
> + å°†æ‰€æœ‰çš„æ•°æ®å’ŒåŠŸèƒ½éƒ½å°è£…åœ¨ä¸€ä¸ª**å‡½æ•°å†…éƒ¨**ï¼ˆ**ç§æœ‰çš„**ï¼‰ã€‚
> + åªå‘å¤–æš´éœ²ä¸€ä¸ª**åŒ…å« n ä¸ªæ–¹æ³•**çš„**å¯¹è±¡æˆ–è€…å‡½æ•°ï¼ˆå°è£…ä¸ºå¯¹è±¡ï¼‰**ã€‚
> + æ¨¡å—çš„ä½¿ç”¨è€…åªéœ€è¦**é€šè¿‡æ¨¡å—**çš„å¯¹è±¡è°ƒç”¨æ–¹æ³•æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚



ğŸŒ° ä¾‹å­ï¼š 

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab ç¬¬ä¸€ç§

+ åˆ›å»ºæ¨¡å— `MyModule.js` æ–‡ä»¶ï¼š

```js
function myModule1() {
    // ä¼¼æœ‰æ•°æ®
    var msg = "test"

    // æ“ä½œæ•°æ®çš„å‡½æ•°
    function doUpperCase() {
        console.log("test")
        console.log("doUpperCase: " + msg.toUpperCase());
    }

    function doLowerCase(){
        console.log("doLowerCase: " + msg.toLowerCase());
    }

    // å‘å¤–æš´éœ²å¯¹è±¡ï¼ˆç»™å¤–éƒ¨ä½¿ç”¨çš„æ–¹æ³•ï¼‰
    return {
        doUpperCase: doUpperCase,
        doLowerCase: doLowerCase
    }
}
```

+ åœ¨æµ‹è¯•ç”¨ `.html` æ–‡ä»¶ä¸­ï¼Œå¼•å…¥å¹¶ä½¿ç”¨ï¼š

```html
<script type="text/javascript" src="myModule1.js"></script>
<script type="text/javascript">
var module = myModule1()
module.doUpperCase()
module.doLowerCase()
</script>
```

:::

::: tab :star: ç¬¬äºŒç§

+ åˆ›å»ºæ¨¡å— `MyModule.js` æ–‡ä»¶ï¼šï¼ˆä¿®æ”¹ä¸ºä½¿ç”¨åŒ¿åå‡½æ•°ï¼‰

```js
(function (window) {
    // ç§æœ‰æ•°æ®
    var msg = "test"

    // æ“ä½œæ•°æ®çš„å‡½æ•°
    function doUpperCase() {
        console.log("doUpperCase: " + msg.toUpperCase());
    }

    function doLowerCase() {
        console.log("doLowerCase: " + msg.toLowerCase());
    }

    // å‘å¤–æš´éœ²å¯¹è±¡ï¼ˆç»™å¤–éƒ¨ä½¿ç”¨çš„æ–¹æ³•ï¼‰
    window.myModule2 = {
        doUpperCase: doUpperCase,
        doLowerCase: doLowerCase
    }
})(window)
```

+ åœ¨æµ‹è¯•ç”¨ `.html` æ–‡ä»¶ä¸­ï¼Œå¼•å…¥å¹¶ä½¿ç”¨ï¼š

```html
<script type="text/javascript" src="myModule2.js"></script>
<script type="text/javascript">
myModule2.doLowerCase()
myModule2.doUpperCase()
</script>
```

:::

:::: 

### é—­åŒ…çš„ç¼ºç‚¹ä¸è§£å†³

+ é—­åŒ…çš„ç¼ºç‚¹ï¼š
  + å‡½æ•°æ‰§è¡Œå®Œåï¼Œå‡½æ•°å†…çš„å±€éƒ¨å˜é‡æ²¡æœ‰é‡Šæ”¾ï¼Œå ç”¨å†…å­˜çš„æ—¶é—´ä¼šå˜é•¿ã€‚
  + å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚
+ è§£å†³é—­åŒ…çš„ç¼ºç‚¹ï¼š
  + èƒ½ä¸ä½¿ç”¨å°±ä¸ä½¿ç”¨é—­åŒ…ã€‚
  + åŠæ—¶é‡Šæ”¾ä½¿ç”¨è¿‡åçš„é—­åŒ…ã€‚



ğŸŒ° ä¾‹å­ï¼š

```js
function fn1() {
	var arr = new Array[1000]
  function fn2(){
    console.log(arr.length)
  }
  return fn2
}

var f = fn1()
f()
f = null // è®©å†…éƒ¨å‡½æ•°ç§°ä¸ºåƒåœ¾å¯¹è±¡ï¼Œâ™»ï¸å›æ”¶é—­åŒ…ã€‚
```



::: tip 

+ å†…å­˜æº¢å‡ºï¼š
  + ä¸€ç§ç¨‹åºè¿è¡Œå‡ºç°çš„é”™è¯¯ã€‚
  + å½“ç¨‹åºè¿è¡Œéœ€è¦çš„å†…å­˜è¶…è¿‡äº†å‰©ä½™çš„å†…å­˜æ—¶ï¼ˆå¯¼è‡´å´©æºƒå†…å­˜ä¸è¶³ï¼‰ï¼Œå°±ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºçš„é”™è¯¯ã€‚

ğŸŒ° ä¾‹å­ï¼š

```js
var obj = {}
for(var i = 0;i< 1000; i++){
  obj[i] = new Array(100000) // æ˜æ˜¾å†…å­˜ä¸è¶³ä»¥æ”¯æŒå¤„ç†å¦‚æ­¤åºå¤§çš„æ•°æ®
}
```



+ å†…å­˜æ³„æ¼ï¼š
  + å ç”¨çš„å†…å­˜æ²¡æœ‰åŠæ—¶é‡Šæ”¾ã€‚
  + å†…å­˜æ³„æ¼ç§¯ç´¯å¤šäº†å°±å®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡ºã€‚
  + **å¸¸è§çš„å†…å­˜æ³„æ¼**ï¼š
    + æ„å¤–çš„å…¨å±€å˜é‡ã€‚
    + æ²¡æœ‰åŠæ—¶æ¸…ç†çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°ã€‚
    + é—­åŒ…ã€‚

ğŸŒ° ä¾‹å­ï¼š

```js
// æ„å¤–çš„å…¨å±€å˜é‡
function fn() {
  a = new Array(100000) // å®šä¹‰åæ²¡æœ‰å¤„ç†
  console.log(a) 
}
```

```js
var intervalId = setInterval(function (){
  console.log('-')
}, 1000)
// clearInterval(intervalId) // è¦åŠæ—¶æ¸…ç†å¾ªç¯å®šæ—¶å™¨
```

ï¼ˆé—­åŒ…æ˜¯ä½¿ç”¨åæ²¡æœ‰å›æ”¶å¯å‚è€ƒä¹‹å‰æåˆ°çš„ ğŸŒ° ä¾‹å­ï¼‰

:::



### é¢è¯•é¢˜

âš ï¸ ï¼šhttps://www.bilibili.com/video/BV14s411E7qf?p=36&spm_id_from=pageDriver

:one: 

```js
var name = 'The Window'
var object = {
  name: 'My Object',
  getNameFunc: function() {
    return this.name
  }
}
alert(object.getNameFunc()())
```

::: details

```js
'The Window'
```

:::



:two:

```js
var name2 = 'The Window'
var object2 = {
  name2: 'My Object',
  getNameFunc: function() {
    var that = this
    return function(){
      return that.name2
    }
  }
}
alert(object2.getNameFunc()())
```

::: details

```js
"My Object"
```

:::
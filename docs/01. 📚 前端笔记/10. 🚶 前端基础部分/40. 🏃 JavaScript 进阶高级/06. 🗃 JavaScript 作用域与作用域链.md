---
title: 🗃 JavaScript 作用域与作用域链
date: 2022-03-17 15:05:21
permalink: /pages/3ed441/
categories: 
  - 📚 前端笔记
  - 🚶 基础部分
  - 🏃 JavaScript 进阶高级
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---
## 作用域

+ 作用域：一个代码段所在的区域。它是静态的（相当于上下文对象），在编写代码时就确定了。

+ 作用域分类：
  + **全局作用域**
  + 函数作用域
  + 没有块作用域
+ 作用：**隔离变量**，**不同作用域下同名变量不会有冲突**。



🌰 例子：没块作用域（Java 有块作用域）

```js
if(true) {
  var c = 3
}
console.log(c) // 3
```



🌰 例子

```js
var a = 10, b = 20
function fn(x) {
  var a = 100, c = 300;
  console.log('fn()', a, b, c, x)
  function bar(x) {
    var a = 1000, d = 400
    console.log('bar()', a, b, c, d, x)
  }
  
  bar(100)
  bar(200)
}
fn(10)
```





## 作用域与执行上下文

+ **区别** :one: ：
	+ 全局作用域之外，每个函数都会创建自己的作用域，**作用域在函数定义时就已经确定了**，而不是在函数调用时。
	+ 全局执行上下文环境是在全局作用域确定之后， JavaScript **代码马上执行之前创建**。
	+ 函数执行上下文环境是在**调用函数时**，**函数体代码执行之前创建**。
+ **区别** :two: ：
  + 作用域是**静态的**，只要函数定义好了就一直存在并且不会再变化。
  + 上下文环境**是动态的**，调用函数时创建，**函数调用结束时上下文环境就会被释放**。
+ **联系**：
  + 上下文环境（对象） 是从属于所在的**作用域**。
  + 全局上下文环境从属于全局作用域。
  + 函数上下文环境从属于对应的函数使用域。

::: warning 

两个 $n+1$：

+ 在判断**执行上下文**个数中：$n$ 为**调用的函数个数**。
+ 在判断**作用域**个数中：$n$ 为**定义的函数个数**。

:::

## 作用域链

+ 是多个上下级关系的作用域形成的链，它的方向时从下向上的（从内到外）。

+ 查找变量就是沿着作用链来查找的。

  查找一个变量的查找规则：

  1. 在当前作用域下的执行上下文中查找对应的属性，如果有直接返回，否则进入 2.

  2. 在上一级作用域的执行上下文中查找相应的属性，如果有直接返回，否则进入 3.
  3. 再次执行 2. 的相同操作，直到全局作用域，如果还找不到就抛出找不到变量的异常。

🌰 例子：

```js
var a = 2
function fn1() {
  var b = 3
  function fn2() {
    var c = 4
    console.log(c) // 4
    console.log(b) // 3
    console.log(a) // 2
    console.log(d) // ReferenceError: Can't find variable: d 
  }
  fn2()
}
fn1()
```





## 面试题

:one: 

```js
var x = 10
function fn(){
  console.log(x)
}
function show(f){
  var x = 20
  f()
}
show(fn) // 10
```



:two: 

```js
var fn = function () {
	console.log(fn)
}
fn()

var obj = {
  fn2: function (){
    console.log(fn2) //ReferenceError: Can't find variable: fn2 
    // console.log(this.fn2)
  }
}
obj.fn2()
```


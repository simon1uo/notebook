---
title:  ğŸ¤ Vue 3 + TypeScript åå°ç®¡ç†ç³»ç»Ÿ
date: 2022-04-29 13:32:54
permalink: /pages/3027d6/
categories:
  -  ğŸ“š å‰ç«¯ç¬”è®°
  -  â›½ï¸ é¡¹ç›®ç›¸å…³
tags:
  - 
author: 
  name: Simon
  link: https://github.com/simon1uo
---
## ç™»å½•åŠŸèƒ½å®ç°

### ç™»å½•ç»„ä»¶ç›¸å…³

+ å®ç°åˆ¤æ–­å½“å‰çš„ Tab æ˜¯ ã€Œè´¦å·ç™»å½•ã€è¿˜æ˜¯æ‰‹æœºç™»å½•ï¼Œä½¿ç”¨ Element-Plus æä¾›çš„å±æ€§ï¼š

  + åœ¨ `<el-tabs>` æ ‡ç­¾ä¸Šæ·»åŠ  `v-model` å±æ€§ï¼ŒåŒå‘ç»‘å®šä¸€ä¸ªä¿å­˜å½“å‰ Tabs ä¿¡æ¯çš„å€¼ï¼š
    ```vue
    <el-tabs type="border-card" class="login-tabs" stretch v-model="currentTab">
    ```

    ```typescript
    // è·å–å½“å‰tab, æ³¨æ„è¦è®¾ç½®é»˜è®¤å€¼
    const currentTab = ref<string>('phone')
    ```

  + åœ¨ä¸¤ä¸ª tab çš„ `<el-tab-pane>` æ ‡ç­¾ä¸‹æ·»åŠ ä¸€ä¸ª `name` å±æ€§ç”¨ä½œæ ‡è¯†ï¼Œæ˜¯ `currentTab` ä¿å­˜çš„å€¼ï¼š

    ```vue
    <el-tab-pane name="account">
    ```

    ```vue
    <el-tab-pane name="phone">
    ```

â€‹	ä»¥æ­¤å®ç°åç»­ç‚¹å‡»ç™»å½•æ—¶ï¼Œç”¨åˆ¤æ–­åŒºåˆ«å¼€ã€Œè´¦å·ç™»å½•ã€ä¸ã€Œæ‰‹æœºç™»å½•ã€ä¸åŒçš„ç™»å½•é€»è¾‘ã€‚

### ç™»å½•é€»è¾‘

<img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/74rHji.png" alt="image-20220429133516420" style="zoom:33%;" />

ä¸ºäº†æ–¹ä¾¿åŒºåˆ† ã€Œè´¦å·ç™»å½•ã€ æˆ–è€… ã€Œæ‰‹æœºç™»å½•ã€ï¼ŒçœŸæ­£çš„ç™»å½•é€»è¾‘åº”è¯¥æ”¾è¿›å“åº”çš„é¢æ¿ç»„ä»¶å½“ä¸­ï¼Œè€Œå¤–é¢çš„ LoginPanel ç»„ä»¶çš„ç™»å½•æŒ‰é’®è°ƒç”¨ç›¸åº”çš„ã€ŒçœŸæ­£ç™»å½•é€»è¾‘ã€ã€‚

+ `LoginPanel` ç»„ä»¶ä½¿ç”¨ `ref` è°ƒç”¨å­ç»„ä»¶ä¸­çš„ç™»å½•é€»è¾‘ï¼š

 ```typescript
 // è·å–è¯¥ç»„ä»¶çš„Refå¹¶ä¸”å¯¹ç»„ä»¶çš„ç±»å‹è¦è·å–
     const accountRef = ref<InstanceType<typeof LoginAccount>>()
 ```

> å¦‚æœä¸ç»™å¯¹åº”çš„ `ref()` æ·»åŠ ç›¸åº”çš„æ³›å‹ç±»å‹ï¼ˆå½“å‰åº”è¯¥æ˜¯ `LoginAccount` è¯¥ç»„ä»¶çš„ç±»å‹ï¼Œä½¿ç”¨ `typeof` è·å–ï¼‰ï¼Œ`ref()` é»˜è®¤ç”Ÿæˆçš„å¯¹è±¡ç±»å‹ä¸º `any` ã€‚TypeScript è¯†åˆ«è¯¥å¯¹è±¡ä¸º `any` åï¼Œè¿™ä¸ªå¯¹è±¡è¦ä½¿ç”¨æ—¶ä¾¿ä¼šä¸å®‰å…¨ï¼Œä¸ä¼šæŠ¥å‡ºè¯¦ç»†çš„é”™è¯¯ã€‚
>
> ä½†æ˜¯ç±»å‹ä¸èƒ½ç›´æ¥å†™ã€Œç»„ä»¶åç§°ã€ï¼Œã€Œç»„ä»¶åç§°ã€åªæ˜¯ä¸€ä¸ªç»„ä»¶æè¿°ï¼ˆç»„ä»¶å®ä¾‹ï¼‰ï¼Œ**è¦ä½¿ç”¨ `InstanceType<typeof >` æ‹¿åˆ°è¯¥ç»„ä»¶æ‹¥æœ‰æ„é€ å‡½æ•°çš„å®ä¾‹**ï¼Œæ‰èƒ½ç¡®å®šè¿™ä¸ªç»„ä»¶çš„ç±»å‹ã€‚ [TypeScript: Documentation - Utility Types (typescriptlang.org - InstanceType<T>)](https://www.typescriptlang.org/docs/handbook/utility-types.html#instancetypetype)

+ :star: åœ¨è°ƒç”¨ `LoginAccount` ç»„ä»¶å¤„æ·»åŠ ç»‘å®š`ref` å±æ€§ï¼š

```vue
<LoginAccount ref="accountRef" />
```

> å°† `LoginAccount` ç»„ä»¶ `defineComponent` è¿”å›çš„ã€Œå¯¹è±¡ã€çœ‹åšæˆä¸€ä¸ªã€Œç»„ä»¶çš„æè¿°ã€â€”â€”ç±»ã€‚è€Œåœ¨ `LoginPanel` ä¸­ï¼ˆä¸æ˜¯ç›´æ¥ä½¿ç”¨è¿”å›çš„å¯¹è±¡ï¼‰è€Œæ˜¯æ ¹æ®å¯¹è±¡æè¿°åˆ›å»ºå‡ºæ¥ä¸€ä¸ªçœŸæ­£çš„ç»„ä»¶å®ä¾‹ï¼ˆè¦ä½¿ç”¨æ—¶åˆ›å»ºï¼Œæ‰€ä»¥å¤šä¸ªï¼‰ã€‚

+ éšååœ¨ç‚¹å‡»ã€Œç«‹å³ç™»å½•ã€ç»‘å®šäº‹ä»¶ï¼š

```typescript
const handleLoginClick = () => {
  console.log('ç«‹å³ç™»å½•')
  accountRef.value?.loginAction()
}
```



### è®°ä½å¯†ç åŠŸèƒ½

è¦å­˜å‚¨æ•°æ®å°±è¦è€ƒè™‘ï¼Œæ˜¯ç¼“å­˜åˆ°ã€Œæµè§ˆå™¨æœ¬åœ°ç¼“å­˜ã€ï¼Œè¿˜æ˜¯ã€Œä¼šè¯ã€ã€ã€ŒæœåŠ¡å™¨æ•°æ®åº“ã€ã€‚è¦ç¼“å­˜æ•°æ®å°±è¦å°è£…ä¸€ä¸ªä¸ç¼“å­˜ç›¸å…³çš„ã€Œç±»ã€ï¼Œå¯ä»¥è°ƒç”¨å…¶å®ä¾‹çš„æ–¹æ³•å®ç°ç¼“å­˜ã€æ¸…é™¤ç­‰åŠŸèƒ½ã€‚

+ å°è£… `@/utils/cache.ts` ï¼š

```typescript
class LocalCache {
  setCache(key: string, value: any) {
    window.localStorage.setItem(key, JSON.stringify(value))
  }

  getCache(key: string) {
    const value = window.localStorage.getItem(key)
    if (value) {
      return JSON.parse(value)
    }
  }

  deleteCache(key: string) {
    const value = window.localStorage.getItem(key)
    if (value) {
      window.localStorage.removeItem(key)
    }
  }

  clearCache() {
    window.localStorage.clear()
  }
}

export default new LocalCache()
```

> æ³¨æ„ `key` ã€`value` çš„ç±»å‹ï¼›æ³¨æ„å­˜å‚¨æ•°æ®è¦ä½¿ç”¨ `JSON.stringfy()` è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œè¯»å–æ•°æ®è¦ä½¿ç”¨ `JSON.parse()` è½¬æ¢ä¸ºå¯¹è±¡ã€‚



+ åœ¨ç‚¹å‡»ç™»å½•æ—¶æ·»åŠ ç›¸åº”çš„ä¿å­˜ç™»å½•æ•°æ®åˆ°ç¼“å­˜é€»è¾‘ï¼Œå¹¶ä¸”è¦åœ¨åˆå§‹åŒ–æ•°æ®æ—¶ä»ç¼“å­˜ä¸­è¯»å–ä¹‹å‰æœ‰ã€Œè®°ä½å¯†ç ã€æ—¶çš„æ•°æ®ï¼š

```typescript
const loginAction = () => {
  accountFormRef.value?.validate((valid, filed) => {
    if (valid) {
      console.log('éªŒè¯é€šè¿‡')
      if (isKeepPassword.value) {
        localCache.setCache('name', account.name)
        localCache.setCache('password', account.password)
      } else {
        // ä¸è®°ä½å¯†ç åˆ™æ¸…é™¤ç¼“å­˜
        localCache.deleteCache('name')
        localCache.deleteCache('password')
      }
    } else {
      console.log('éªŒè¯å¤±è´¥', filed)
    }
  })
}
```

```typescript
const account = reactive({
  name: localCache.getCache('name') ?? '',
  password: localCache.getCache('password') ?? ''
})
```



### è¯·æ±‚ç™»å½•

> + è¯·æ±‚ç™»å½•åï¼Œè·å–ç™»å½•çš„ä¿¡æ¯
>   + ç¡®å®šè¦è·å–çš„æ•°æ® `token` ã€`userInfo`ã€`userMenu` 
> + æŠŠç™»å½•çš„æ•°æ®ä¿å­˜
> + è¯·æ±‚ç”¨æˆ·çš„ä¿¡æ¯
> + è¯·æ±‚ç”¨æˆ·çš„èœå•ä¿¡æ¯
> + è·³è½¬è·¯ç”±åˆ°é¦–é¡µ
>
> ä½¿ç”¨ Vuex å®ç°ã€‚



+ Vuex Login æ¨¡å—ï¼š

  æ³¨æ„ç‚¹ï¼š

  + è¦ç¡®å®š `LoginModule` çš„ç±»å‹æ˜¯ `Module`ï¼Œå¹¶ä¸” `Module` å¿…é¡»ä¼ å…¥ä¸¤ä¸ªæ³›å‹ï¼ˆè§„èŒƒå…¶ä¸­ store ä¸­ state çš„ç±»å‹ï¼‰ï¼š

    ```typescript
    const LoginModule: Module<ILoginState, IRootSate> = {
    	state() {
        return {
          ...
        }
      },
      getters: {},
      mutations: {},
      actions: {},
    }
    ```

    > `ILoginState` åº”å½“åŒ…å« `state` ä¸­çš„æ•°æ®çš„ç›¸å…³ç±»å‹ï¼Œå¦‚ä¸‹ï¼š
    >
    > ```js
    > export interface ILoginState {
    >   token: string
    >   userInfo: any
    >   userMenu: any
    > }
    > ```

  

  + åˆ›å»ºå®Œæ¨¡å—ä»¥åï¼Œè¦åœ¨ store æ€»æ–‡ä»¶ `createStore` ä¸­å¼•å…¥ç™»å½•æ¨¡å—çš„ storeï¼Œä½¿ç”¨ `modules`ï¼š

    ```typescript
    const store = createStore<IRootSate>({
      modules: {
        login
      }
    })
    ```



+ å¼€å‘é˜¶æ®µè¦è§£å†³è·¨åŸŸè®¿é—®ï¼Œé…ç½® `webpack` ä»£ç†æœåŠ¡å™¨ `devServer`ï¼šï¼ˆ`vue.config.js` ï¼‰

  ```js
  devServer: {
    proxy: {
      '/api': {
        target: '****',
        pathRewrite: {
          '^api': ''
        },
        changeOrigin: true
      }
    }
  },
  ```

+ ç™»å½•è¯·æ±‚ç›¸å…³ï¼š

  + å®šä¹‰è¯·æ±‚æ¥å—çš„ç»“æœçš„ç±»å‹æ¥å£ï¼š

  ```js
  export interface IAccount {
    name: string
    password: string
  }
  
  export interface ILoginResult {
    id: number
    name: string
    token: string
  }
  
  // dataçš„ç±»å‹ä¸èƒ½ç¡®å®šï¼Œæœ‰å¯èƒ½æ˜¯æ˜¯ç™»å½•ç»“æœã€ç™»å½•èœå•
  export interface IDataType<T = any> {
    code: number
    data: T
  }
  ```

  + å¤„ç†ç™»å½•è¯·æ±‚çš„æ–¹æ³•ï¼š

  ```typescript
  // æšä¸¾ç™»å½•ç›¸å…³çš„api URL
  enum LoginAPI {
    accountLogin = '/login',
    LoginUserInfo = '/users/', // users/1 é€šè¿‡id
    UserMenus = '/role/' // /role/menu
  }
  
  // è¯·æ±‚ç™»å½•
  // ä¼ å…¥å‚æ•°ï¼Œç±»å‹è¦è§„èŒƒ IAccount
  // è¿”å›ç±»å‹å¯ä»¥æ¨å¯¼
  export function requestAccountLogin(account: IAccount) {
    return axRequest.post<IDataType<ILoginResult>>({
      url: LoginAPI.accountLogin,
      data: account
    })
  }
  
  // æ ¹æ®idè¯·æ±‚ç”¨æˆ·ä¿¡æ¯
  export function requestUserInfoById(id: number) {
    return axRequest.get<IDataType>({
      url: LoginAPI.LoginUserInfo + id,
      showLoading: false // ç™»å½•æ¶‰åŠå¤šä¸ªè¯·æ±‚æ–¹æ³•ï¼Œé¿å…å¤šæ¬¡åŠ è½½åŠ¨ç”»
    })
  }
  
  // è·å–ç”¨æˆ·èœå•
  export function requestUserMenuByRoleId(id: number) {
    return axRequest.get<IDataType>({
      url: LoginAPI.UserMenus + id + '/menu',
      showLoading: false
    })
  ```

  > æ³¨æ„å¤„ç† `axRequest.get/post` åçš„ç±»å‹



+ Login çš„ store ä¸­çš„ç›¸å…³ `mutations `ã€ `actions` ç…§å¸¸ä»è¯·æ±‚ä¸­å¼‚æ­¥è·å–æ•°æ®åï¼Œä¿å­˜åˆ° `state` ä¸­ï¼ˆåŒæ—¶é€šè¿‡ç¼“å­˜çš„ `utils` ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ï¼‰ã€‚ 

+ æœ€åä½¿ç”¨ `router` è·³è½¬è·¯ç”±ã€‚



### æœªç™»å½•çš„è·¯ç”±å¤„ç†

åœ¨è·¯ç”±é…ç½®ä¸­ï¼Œè®¾ç½® `/` æ ¹è·¯å¾„ä¸º `/main` ï¼Œä½†æ˜¯æœªç™»å½•æ—¶è¦è·³è½¬åˆ° `/login` è¿›è¡Œç™»å½•ã€‚

```js
router.beforeEach((to) => {
  if (to.path !== '/login') {
    // åªè¦ä¸æ˜¯è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè·³è½¬ä¹‹å‰éƒ½è¦æ£€éªŒä¸€ä¸‹æ˜¯å¦æœ‰ç™»å½•
    const token = localCache.getCache('token')
    if (!token) {
      return '/login'
    }
  }
})
```



### ã€æ—¶ä¿ç•™Vuexä¸­çš„æ•°æ®

ç™»å½•åè·³è½¬è·¯ç”±ä¼šå†…å­˜ä¸­ä¼šä¿ç•™ Vuex ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·åœ¨é¡µé¢ä¸­è·³è½¬ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡è·¯ç”±å™¨è¾“å…¥è·¯å¾„è¿›å…¥é¡µé¢ï¼ŒVuex çš„æ•°æ®ä¼šæ¶ˆå¤±ã€‚

+ å°è£…ä¸€ä¸ªåœ¨æ¯æ¬¡åˆå§‹åŒ– Vue æ—¶ï¼ŒåŠ è½½æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ç™»å½•ä¿¡æ¯çš„å‡½æ•°ï¼š

  ```js
  export function setUpStore() {
    store.dispatch('login/loadLocalLoginInfo')
  }
  ```

+ åœ¨ç™»å½• store çš„ actioins ä¸­ï¼Œæ·»åŠ åŠ è½½æ•°æ®çš„æ–¹æ³•ï¼š

  ```js
  // åŠ è½½æµè§ˆå™¨å­˜å‚¨ä¸­è·å–ç™»å½•ä¿¡æ¯
    loadLocalLoginInfo({ commit }) {
      const token = localCache.getCache('token')
      if (token) {
        commit('CHANGE_TOKEN', token)
      }
  
      const userInfo = localCache.getCache('userInfo')
      if (userInfo) {
        commit('CHANGE_USER_INFO', userInfo)
      }
  
      const userMenu = localCache.getCache('userInfo')
      if (userMenu) {
        commit('CHANGE_USER_MENU', userMenu)
      }
    }
  }
  ```

 

## é¦–é¡µç®¡ç†é¢æ¿

   

### Vuex ä¸­å–æ•°æ®çš„ç±»å‹é™åˆ¶æŠ€å·§

å¦‚æœç›´æ¥ä½¿ç”¨ Vux æä¾›çš„ `useStore` æ–¹æ³•è¯»å– storeï¼Œæ²¡æœ‰æ•°æ®ç±»å‹æ£€æµ‹ã€‚

+ åœ¨ store ä¸»æ–‡ä»¶ä¸­å°è£…ä¸€ä¸ª `useStore` æ–¹æ³•ï¼š

  ```typescript
  export function useStore(): Store<IStoreType> {
    return useVuexStore()
  }
  ```

+ `IStoreType` ç±»å‹ï¼š

  ```js
  import { ILoginState } from '@/store/login/type'
  
  export interface IRootSate {
    name: string
    age: number
  }
  
  export interface IRootWithModule {
    login: ILoginState
  }
  
  export type IStoreType = IRootSate & IRootWithModule
  ```

+ ä½¿ç”¨è‡ªå®šä¹‰å°è£…çš„ `useStore` ï¼š

  ```typescript
  setup() {
    const store = useStore() // è‡ªå®šä¹‰å°è£…çš„useStore
    const userMenu = computed(() => store.state.login.userMenu)
  
    return {
      userMenu
    }
  }
  ```



### å®ç°å¯¼èˆªèœå•æ•°æ®å±•ç¤º

### å®ç°å¯¼èˆªèœå•æŠ˜å æ•ˆæœ





### åŠ¨æ€è·¯ç”±

æ ¹æ®ç”¨æˆ·è§’è‰²çš„åŠ¨æ€å±•ç¤ºèœå•

ï¼ˆæƒé™æ§åˆ¶çš„å‰åç«¯è®¾è®¡ï¼‰

ç”±äºä¸åŒçš„è§’è‰²æœ‰ä¸åŒçš„èœå•æ•°æ®ï¼Œè·¯ç”±çš„æ˜ å°„å…³ç³»ä¸èƒ½å†™æ­»ï¼Œå¹¶ä¸”æ²¡æœ‰ç›¸åº”æƒé™çš„è§’è‰²ä¸åº”è¯¥æ‹¥æœ‰æŸä¸ªè·¯ç”±æ˜ å°„å…³ç³»ã€‚æœ‰å¤šç§æ€è·¯ï¼š

+ å…¨éƒ¨æƒ…å†µéƒ½å®Œå…¨æ³¨å†Œï¼Œä½†æ˜¯å­˜åœ¨å®‰å…¨éšæ‚£ã€‚
+ å°†ä¸åŒçš„è§’è‰²æ³¨å†Œä¸åŒçš„è·¯ç”±ï¼ˆæ ¹æ®åç«¯å·²ç»é…ç½®å¥½çš„è§’è‰²ä¿¡æ¯ï¼‰ï¼Œä»åç«¯è·å–åˆ°çš„ä¸åŒè§’è‰²çš„åŠ¨æ€è·¯ç”±æ•°æ®ï¼ŒåŠ è½½åˆ°è·¯ç”±çš„é…ç½®ä¸­ã€‚å­˜åœ¨å¼Šç«¯ï¼šä¸€æ—¦æ–°å¢è§’è‰²ï¼Œè¦é‡æ–°éƒ¨ç½²å¯¹äºæ–°è§’è‰²çš„è·¯ç”±ã€‚

+ :star: æ ¹æ®èœå•åŠ¨æ€ç”Ÿæˆè·¯ç”±æ˜ å°„ï¼ˆèœå• â€“> è·¯ç”±æ˜ å°„ï¼‰ï¼Œåå°ä¼ é€çš„èœå•æ•°æ®ä¸­å·²ç»æœ‰åŒ…å«è·¯ç”±è·¯å¾„çš„ä¿¡æ¯ï¼Œç›´æ¥æ ¹æ®èœå•çš„æ•°æ®åŠ è½½åŠ¨æ€è·¯ç”±çš„æ˜ å°„å…³ç³»å³å¯ã€‚
  + åœ¨èœå•æ•°æ®ä¸­å°±æœ‰åŠ è½½ç»„ä»¶çš„åç§°ï¼ˆå­—æ®µï¼‰ï¼Œè¦ä¿è¯ç»„ä»¶åç§°ä¸è·¯å¾„ä¸åå°æ•°æ®å¿…é¡»è¦ä¸€è‡´
  + :star: åœ¨èœå•æ•°æ®æ ¹æ®è·¯å¾„ `url` åŠ¨æ€åŠ è½½å‰ç«¯ä¸­å†™å¥½çš„è·¯ç”±æ˜ å°„å…³ç³»ï¼Œç”Ÿæˆåçš„æ˜ å°„å…³ç³»å†åŠ è½½åˆ°è·¯ç”±ä¸­ã€‚ï¼ˆæ›´åŠ çµæ´»ï¼‰





+ ä½¿ç”¨ `coderwhy` å·¥å…·ç”Ÿæˆè·¯ç”±ç»„ä»¶é¡µé¢+è·¯ç”±æ˜ å°„ï¼š[coderwhy - npm (npmjs.com)](https://www.npmjs.com/package/coderwhy)

  ![image-20220430133945918](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/cCK7Oy.png)

+ åœ¨è·å–åˆ° `userMenu`  ç”¨æˆ·èœå•ä¿¡æ¯ï¼ˆæ¥è‡ªåç«¯æˆ–è€…æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ï¼‰åï¼Œæ‰å°†è¯¥èœå•ä¿¡æ¯å­˜å…¥åˆ° state ä¸­çš„åŒæ—¶ï¼Œå°† `userMenu` è·¯ç”±æ˜ å°„ä¿¡æ¯æ·»åŠ åˆ°è·¯ç”±ä¸­ï¼š

  + å°è£…ä¸€ä¸ªå¤„ç†åç«¯èœå•ä¿¡æ¯çš„æ–¹æ³•ï¼š

    ```js
    export function mapMenusToRoutes(userMenu: any[]): RouteRecordRaw[] {
      const routes: RouteRecordRaw[] = []
    
      // åŠ è½½é»˜è®¤æ‰€æœ‰çš„routes
      const allRoutes: RouteRecordRaw[] = []
      // åŠ è½½æ–‡ä»¶è·¯å¾„
      const routeFiles = require.context('../router/main', true, /\.ts/)
      routeFiles.keys().forEach((key) => {
        const route = require('../router/main' + key.split('.')[1])
        allRoutes.push(route.default)
      })
    
      // æ ¹æ®èœå•è·å–éœ€è¦æ·»åŠ çš„ routes
      const _recurseGetRoute = (menus: any[]) => {
        for (const menu of menus) {
          if (menu.type === 2) {
            const route = allRoutes.find((route) => route.path === menu.url)
            if (route) {
              routes.push(route)
            }
          } else {
            _recurseGetRoute(menu.children)
          }
        }
      }
    
      _recurseGetRoute(userMenu)
      return routes
    }
    ```

  + åœ¨ mutations ä¸­è°ƒç”¨è¯¥æ–¹æ³•ï¼š

    ```typescript
    CHANGE_USER_MENU(state, userMenu: any) {
          state.userMenu = userMenu
    
          // userMenuæ·»åŠ åˆ°routes
          const routes = mapMenusToRoutes(userMenu)
          routes.forEach((route) => {
            router.addRoute('main', route)
          })
        }
    }
    ```

+ å®Œå–„ç‚¹å‡»è·³è½¬è·¯ç”±åŠŸèƒ½ï¼š

  + åœ¨ç›¸åº”ä½ç½®æ·»åŠ è·¯ç”±è§†å›¾ã€‚

  + åˆ›å»ºå¤„ç†ç‚¹å‡»é“¾æ¥çš„æ–¹æ³•äº‹ä»¶ï¼š

    ```js
    const handleMenuItemClick = (item: any) => {
      router.push({
        path: item.url ?? '/404'
      })
    }
    ```

  + åœ¨ç›¸åº”çš„ä½ç½®ç»‘å®šäº‹ä»¶å³å¯ã€‚



+ è§£å†³åˆ·æ–° 404 é—®é¢˜ã€‚

  + å‡ºç°é—®é¢˜åˆ†æï¼šVue åŠ è½½è·¯ç”±çš„è¿‡ç¨‹ï¼š `app.use(router)` â¡ï¸ `install()` â¡ï¸ è·å–å½“å‰çš„è·¯ç”±è·¯å¾„ â¡ï¸ `router.routes` å¯»æ‰¾è·¯ç”±æ˜ å°„ â¡ï¸ ä¸èƒ½æ‰¾åˆ°è·¯ç”±æ˜ å°„ä¿¡æ¯ â¡ï¸ 404 â¡ï¸ **è·³è½¬è·¯ç”±æ—¶ï¼Œæ‰æ‰§è¡Œè·¯ç”±å®ˆå«çš„å›è°ƒå‡½æ•°** â¡ï¸ useStore  â€¦ â¡ï¸ `to()` å·²ç»ç¡®å®šäº†æ˜¯è¦è·³è½¬åˆ° 404 ç»„ä»¶ã€‚

  + å°† `setupStore()`  è°ƒæ•´åˆ° `app.use(router)` å‰ã€‚

+ åˆ·æ–°å ï¼Œå¯¼èˆªæ²¡æœ‰å®æ—¶æ›´æ–°ä¸ºå½“å‰çš„ `active` çš„ç»„ä»¶ï¼Œå› ä¸ºæ²¡æœ‰åŠ¨æ€è®¾ç½® `default-active` çš„é…ç½®ã€‚

  + è·å–å½“å‰çš„è·¯å¾„ï¼ˆè·¯ç”±è·¯å¾„ï¼‰
  + æ ¹æ®è·¯å¾„åŒ¹é… `userMenu` æ•°æ®
  + æ ¹æ® `userMenu` æ•°æ®è·å– `userMenu` å¯¹åº”çš„èœå•ä¿¡æ¯ `id` ï¼ˆæ³¨æ„ `main` çš„å¤„ç†ï¼Œè¦é‡å®šå‘ï¼Œä¿å­˜è·å–å»åˆ°çš„ç¬¬ä¸€ä¸ªèœå•è·¯å¾„ï¼Œç„¶åå†åœ¨è·¯ç”±å®ˆå«ä¸­é‡å®šå‘ä¸ºç¬¬ä¸€ä¸ªèœå•è·¯å¾„ï¼‰


## ç›¸å…³é¡µé¢

### ç”¨æˆ·ç®¡ç†é¡µé¢æœç´¢è¡¨å•

> ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­æ¶‰åŠåˆ°ä¸¤ä¸ªéƒ¨åˆ†ï¼šã€Œè¡¨å•å¡«å†™ã€æœç´¢åŠŸèƒ½éƒ¨åˆ†å’Œã€Œè¡¨æ ¼å±•ç¤ºã€ç”¨æˆ·æ•°æ®çš„éƒ¨åˆ†ã€‚è¿™ä¸¤ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½å®é™…ä¸Šå¯ä»¥å°è£…ä¸ºå…¬å…±çš„ UI ç»„ä»¶ï¼Œä½¿ç”¨é…ç½®é©±åŠ¨ï¼Œå®Œæˆç»„ä»¶çš„å¤ç”¨ã€‚



å®ç°è¡¨å•æ€»ç»“ï¼š

+ å®ç°é€šè¿‡ä¼ å…¥è¡¨å•é…ç½®ï¼ˆä¾‹å¦‚ï¼Œæ ‡é¢˜ã€è¡¨è¾¾è§„åˆ™ç­‰ï¼‰åˆ°å°è£…å¥½çš„ç»„ä»¶ï¼Œå®Œæˆç»„ä»¶çš„å¤ç”¨ã€‚
+ è¦æ³¨æ„è¡¨å•é…ç½®ç±»å‹è§„èŒƒã€‚

+ è¦æŒ‰ç…§é…ç½®é©±åŠ¨è¡¨å•ç»„ä»¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„æ•°æ®åŒºåˆ†ä¸åŒçš„è¡¨å•ç±»å‹ã€‚æ‰€ä»¥æœ€ç»ˆåªè¦ä¸€ä¸ªè¾“å…¥è¡¨å•çš„ç»„ä»¶ï¼Œæ ¹æ®ä¸åŒçš„è¡¨å•ç±»å‹ï¼Œæœ‰ä¸åŒçš„æ¨¡ç‰ˆã€‚

åŸºæœ¬ç»“æ„

æ ·å¼

â€‹	å“åº”å¼å¸ƒå±€

ç»‘å®šåŒå‘æ•°æ®

â€‹	æ³¨æ„ä¸è¦ä¿®æ”¹ `props` æ•°æ®ã€‚





### ç”¨æˆ·ç®¡ç†é¡µé¢æ•°æ®è¡¨æ ¼

### åˆ©ç”¨åŠ¨æ€æ’æ§½

ä½œç”¨åŸŸæ’æ§½

#### è¡¨æ ¼æ•°æ®

#### æ—¶é—´æ ¼å¼åŒ–

#### Element-plus å›½é™…åŒ–ï¼ˆä¸­æ–‡ï¼‰



### ç”¨æˆ·é¡µé¢è¿›ä¸€æ­¥å°è£…



#### ç½‘ç»œè¯·æ±‚æ•°æ®åˆ°åº•ç”±è°è¯·æ±‚

:star: è°ƒç”¨ Vuex çš„ acitons å‘é€è¯·æ±‚æ•°æ®ï¼Œå¹¶ä¸”å­˜å‚¨åˆ° store çš„é€»è¾‘åº”è¯¥å†™åœ¨ä¸­é—´è¦å¤„ç†æ•°æ®çš„åœ°æ–¹ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·ç®¡ç†é¡µé¢ç»„ä»¶ -> pageContent ç»„ä»¶ï¼ˆä¸­é—´ï¼‰-> å±•ç¤ºæ•°æ®è¡¨æ ¼ç»„ä»¶ï¼‰ ï¼Œè€Œç”¨æˆ·ç®¡ç†é¡µé¢ç»„ä»¶åªè¦ä¼ è¾“ä¸€ä¸ªä¿¡æ¯åˆ°ä¸­é—´äººå³å¯ï¼ˆ*æ€æƒ³ï¼‰ã€‚

![image-20220502215254127](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/9CFCc0.png)



#### æä¾›é¡µé¢åç§°ï¼ˆä¿¡æ¯ï¼‰æ‰¾åˆ°è¦è¯·æ±‚çš„è·¯å¾„

å¦‚æœæœåŠ¡å™¨åç«¯å¼€å‘è§„èŒƒï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„åç§°ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²ä¸ºä¸€ä¸ªè¯·æ±‚çš„è·¯å¾„ï¼Œï¼ˆ*å¯ä»¥é€šè¿‡ `switch` æˆ–è€… `map` æ˜ å°„ï¼Œå®šä¹‰åç§°å¯¹åº”çš„è¯·æ±‚è·¯å¾„ ï¼‰ï¼Œä»¥å®ç°ä¼ å…¥ä¸€ä¸ªåç§°ï¼Œå®ç°è¯·æ±‚ä¸åŒçš„æ•°æ®ã€‚



#### åˆ†å±‚ä»£ç å¤ç”¨çš„é‡æ„æ€æƒ³



#### æœç´¢ç»„ä»¶ä¸æœç´¢è¡¨å•çš„æ•°æ®åŒå‘ç»‘å®šé—®é¢˜

+ ä¸¤ç§æ€è·¯ï¼š

  





#### å®Œå–„æœç´¢æŒ‰é’®åŠŸèƒ½

å…ˆå‰è¦å±•ç¤ºç”¨æˆ·çš„æ•°æ®ï¼Œè¯·æ±‚æ•°æ®çš„éƒ¨åˆ†å…¶å®åªèƒ½å‘é€è¯·æ±‚ä¸€æ¬¡ã€‚æ‰€ä»¥åº”è¯¥å°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œä»¥ä¾¿ä¹‹åå¤ç”¨è¯·æ±‚æ•°æ®ã€‚



#### å°†æœç´¢ã€é‡ç½®å°è£…ä¸º hook



### å•†å“ç®¡ç†é¡µé¢



#### è·¨ç»„ä»¶æ’æ§½

åŠ¨æ€è·å–æ’æ§½ï¼š

`props.contentConfig.propList` -> slotName



### èœå•ç®¡ç†é¡µé¢

#### å¤šçº§æ ‘çŠ¶è¡¨æ ¼çš„å®ç°

æ·»åŠ é…ç½®



### æŒ‰é’®æƒé™è®¾ç½®

æœåŠ¡å™¨çš„æ•°æ®ä¸­ï¼Œèœå•æ•°æ®æŒ‰é’®çš„ç›¸å…³æƒé™æ•°ç»„ï¼Œå°è£…ä¸€ä¸ª hook æ–¹æ³• `usePersmisson(pageName, 'ç›¸å…³æŒ‰é’®')` åˆ¤æ–­æ˜¯å¦æœ‰æƒé™ï¼Œç„¶åæ˜¯å¦å±•ç¤ºè¯¥æŒ‰é’®å†…å®¹ã€‚



### æŒ‰é’®åŠŸèƒ½å®ç°

è¯·æ±‚åˆ é™¤ã€ç¼–è¾‘ã€æ–°å¢æŒ‰é’®ã€‚



+ å¼¹çª—æœ€å¥½è¦ä½¿ç”¨ã€Œå…³é—­æ—¶é”€æ¯ DOMã€ï¼Œä¿è¯ä¸‹ä¸€æ¬¡çš„æ•°æ®æ˜¯é‡æ–°æ¸²æŸ“çš„ã€‚



### å…¶ä»–æ•°æ®

socket å®æ—¶æ›´æ–°ï¼Ÿè¯·æ±‚å…¨å±€çš„æ•°æ®



åˆ·æ–°è¿˜æ²¡è·å–åˆ°å…¨å±€è¯·æ±‚çš„å¼‚æ­¥æ•°æ®ï¼Ÿä½¿ç”¨ `computed` çš„ `getter` å¤„ç† 



### æ–°å»ºè§’è‰²çš„åˆ†é…æƒé™



å¤„ç†ï¼ˆä¿®æ”¹ï¼‰çš„æ ‘çŠ¶æ•°æ®ï¼Œå›æ˜¾æ—¶ï¼Œ

+ åªå¤„ç†å¶å­ç»“ç‚¹



### æ•°æ®å¯è§†åŒ–



æœ€ç»ˆåˆ†å±‚ï¼š

![image-20220504134439779](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/0bnoNf.png)
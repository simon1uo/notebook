---
title: ğŸ· SpringMVC è¯·æ±‚å‚æ•°
date: 2022-03-17 19:50:43
permalink: /pages/d57de7/
categories: 
  - _pages
  - ğŸ§‹ JavaEE
  - ğŸšSpringMVC
tags: 
  - SpringMVC
author: 
  name: Simon
  link: https://github.com/simon1uo
---


## Spring MVC è·å–è¯·æ±‚å‚æ•°

### é€šè¿‡ servlet API è·å–ï¼ˆ*å°‘ç”¨ï¼‰

+ å°† `HttpServletRequest` ä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ï¼Œæ­¤æ—¶ `HttpServletRequest` ç±»å‹çš„å‚æ•°è¡¨ç¤ºå°è£…äº†å½“å‰è¯·æ±‚çš„**è¯·æ±‚æŠ¥æ–‡å¯¹è±¡**ã€‚



ğŸŒ° ä¾‹å­ï¼š ä½¿ç”¨ `HttpServletRequest` è·å–å‚æ•°ï¼š

```java
@RequestMapping("testServletAPI")
public String testServletAPI(HttpServletRequest request) {
    // å½¢å‚ä½ç½®çš„requestè¡¨ç¤ºå½“å‰çš„è¯·æ±‚
    String username = request.getParameter("username");
    String password = request.getParameter("password");
    System.out.println("username: " + username + ", password: " + password);
    return "success";
}
```

```html
<a th:href="@{/param}">æµ‹è¯•å‚æ•°Param</a>
```



> æ­¤å¤„ SpringMVC çš„ **IOC å®¹å™¨**ä¸ºæˆ‘ä»¬æ³¨å…¥äº† `HttpServletRequest` è¯·æ±‚å¯¹è±¡ï¼ŒåŒæ—¶ `DispatcherServlet` ä¸ºæˆ‘ä»¬è°ƒç”¨ `testServletAPI()` æ–¹æ³•æ—¶ï¼Œè‡ªåŠ¨ç»™ `request` å‚æ•°èµ‹äº†å€¼ï¼Œå› æ­¤å¯ä»¥åœ¨æ–¹æ³•å½¢å‚çš„ä½ç½®ä¼ å…¥è¯·æ±‚å¯¹è±¡ `HttpServletRequest` ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å…¶æ–¹æ³• `getParameter` æ–¹æ³•è·å–å‚æ•°ã€‚
>
> ä½†æ˜¯å°½ç®¡ Servlet API åŸç”Ÿæ–¹æ³•å¹¶æ²¡æœ‰ç›¸æ¯”ä¸‹é¢çš„æ–¹æ³•ç®€æ˜“ï¼Œæ‰€ä»¥å¹¶ä¸å¸¸ç”¨ã€‚



### é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•

+ åœ¨æ§åˆ¶å™¨çš„å½¢å‚ä½ç½®ï¼Œè®¾ç½®å’Œè¯·æ±‚å‚æ•° :warning: **åŒåçš„å½¢å‚**ï¼Œå½“æµè§ˆå™¨å‘é€è¯·æ±‚åŒ¹é…åˆ°è¯·æ±‚æ˜ å°„æ—¶ï¼Œåœ¨ `DispatcherServlet` ä¸­å°±ä¼šå°†è¯·æ±‚å‚æ•°èµ‹å€¼ç»™ç›¸åº”çš„å½¢å‚ï¼š

+ è‹¥è¯·æ±‚å‚æ•°ä¸­å‡ºç°**å¤šä¸ªåŒåè¯·æ±‚å‚æ•°**ï¼Œå¯ä»¥åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„**å½¢å‚ä½ç½®**è®¾ç½®å­—ç¬¦ä¸²ç±»å‹æˆ–è€…å­—ç¬¦ä¸²æ•°ç»„æ¥æ¥å—æ­¤è¯·æ±‚å‚æ•°ã€‚ï¼ˆå¦‚ä¸‹ä¾‹å­ä¸­çš„  `hobby`ï¼‰

  ï¼ˆå¦‚æœä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹çš„å½¢å‚ï¼Œæœ€ç»ˆç»“æœä¸ºè¯·æ±‚å‚æ•°çš„æ¯ä¸€ä¸ªå€¼ä¹‹é—´ä½¿ç”¨**é€—å·**è¿›è¡Œæ‹¼æ¥ã€‚ï¼‰

ğŸŒ° ä¾‹å­ï¼š

```java
@RequestMapping("/testParam")
public String testParam(String username, String password, String[] hobby) {
    System.out.println("username: " + username + ", password: " + password + ", hobby" +  Arrays.toString(hobby));
    return "success";
}
```

```html
<form th:action="@{/testParam}" method="get">
    ç”¨æˆ·åï¼š<input type="text" name="username" value="admin"><br>
    å¯†ç ï¼š<input type="text" name="password" value="123456"><br>
    çˆ±å¥½ï¼š<input type="checkbox" name="hobby" value="a" checked>a
    <input type="checkbox" name="hobby" value="b" checked>b
    <input type="checkbox" name="hobby" value="c">c
    <input type="submit" value="æµ‹è¯•ä½¿ç”¨æ§åˆ¶å™¨çš„å½¢å‚è·å–è¯·æ±‚å‚æ•°">
</form>
```



> æ³¨æ„ï¼šåŒåå½¢å‚ç›¸å…³é—®é¢˜ï¼š
> åœ¨ `@RequestMapping` æ³¨è§£çš„è·¯å¾„å ä½ç¬¦ç›¸å…³å†…å®¹ä¸­ï¼Œè¦ä½¿ç”¨ `@PathVariable` æ‰èƒ½è·å–å‚æ•°ï¼Œè€Œä¸èƒ½ä½¿ç”¨åŒåå½¢å‚è§†å›¾è·å–å ä½ç¬¦çš„å€¼ã€‚ 



### `RequestParam`

+ å°†è¯·æ±‚å‚æ•°å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³»ã€‚

+ åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š

  + `value` ï¼šåˆ¶å®šä¸ºå½¢å‚èµ‹å€¼çš„è¯·æ±‚å‚æ•°çš„å‚æ•°åã€‚
  + `required` ï¼šè®¾ç½®æ˜¯å¦å¿…é¡»ä¼ è¾“æ­¤è¯·æ±‚å‚æ•°ï¼Œé»˜è®¤å€¼ `true`ã€‚ï¼ˆå½“æ­¤è¯·æ±‚å‚æ•°ä¸ºå¿…é¡»è¦æ±‚è·å–æ—¶ï¼Œå¹¶ä¸”æ²¡æœ‰è®¾ç½® `defaultValue` å±æ€§ï¼Œåˆ™æŠ¥é”™ `400:Required String parameter 'xxx' is not present` ï¼‰ï¼Œå½“è®¾ç½®ä¸º `false` æ—¶æ²¡æœ‰ä¼ è¾“å‚æ•°ï¼Œåˆ™æ³¨è§£æ‰€æ ‡è¯†çš„å½¢å‚å€¼ä¸º `null`ã€‚
  + `defaultValue`ï¼šä¸ç®¡ `required` å€¼ä¸º `true | false` ï¼Œå½“ `value` æ‰€åˆ¶å®šçš„è¯·æ±‚å‚æ•°æ²¡æœ‰ä¼ è¾“æ—¶ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ä¸ºå½¢å‚èµ‹å€¼ã€‚

  

ğŸŒ° ä¾‹å­ï¼š

```java
@RequestMapping("/testParam")
public String testParam(
        @RequestParam(value = "username", required = false, defaultValue = "defaultUsername") String username,
        String password,
        String[] hobby) {
    System.out.println("username: " + username + ", password: " + password + ", hobby" + Arrays.toString(hobby));
    return "success";
}
```



> å½“å‰å° `name=username` ä¿®æ”¹ä¸º `name=user_name` æ—¶ï¼Œåå°å¹¶ä¸èƒ½è·å–å‰å°ä¼ è¾“è¿‡æ¥çš„å‚æ•°æ•°æ®ã€‚
>
> è¿™é‡Œä¾§é¢è¯æ˜ä¸€ä»¶äº‹ï¼ŒSpringMVC ä¸­å¯¹è¯·æ±‚å‚æ•°çš„èµ‹å€¼æ˜¯æ ¹æ®æ˜¯å¦åŒåæ¥å†³å®šçš„ï¼Œè€Œä¸ä¼šæ ¹æ®å‚æ•°åœ¨æ–¹æ³•ä¸Šçš„ç¬¬å‡ ä¸ªä½ç½®å†³å®šï¼Œä¹Ÿå°±æ˜¯è¯´ SpringMVC æ²¡æœ‰è€ƒè™‘å°†*è¯·æ±‚å‚æ•°ä¸ªæ•°ã€ç±»å‹ä¸é¡ºåº*ä¸*æ§åˆ¶å™¨æ–¹æ³•å½¢å‚ä¸ªæ•°ã€ç±»å‹ä¸é¡ºåº*è¿›è¡Œç»‘å®šã€‚å¦‚æœæˆ‘ä»¬æ¥è®¾è®¡ SpringMVCï¼Œåº”è¯¥è€ƒè™‘è¿™ç§æ–¹æ¡ˆä¹ˆï¼Ÿ
>
> ä¸ªäººè§‰å¾—ï¼Œè¿™ç§æ–¹æ¡ˆè™½ç„¶å¯ä»¥å®ç°ä¸ Java é‡è½½æ–¹æ³•çš„ä¸€ä¸€ç»‘å®šå…³ç³»ï¼Œä½†å®é™…æ“ä½œèµ·æ¥æœ‰ä¸€å®šéš¾åº¦ï¼š
>
> - æ¯”å¦‚æ•°å­—ç±»å‹å¯ä»¥å½“ä½œ String å¤„ç†ï¼Œä¹Ÿå¯ä»¥å½“ä½œ Integer å¤„ç†ï¼Œä¸å¥½åŒºåˆ†
>
> - é€€ä¸€æ­¥æ¥è®²ï¼Œå¦‚æœè€ƒè™‘é‡è½½æ–¹æ³•ï¼ŒSpringMVC åº•å±‚åŠ¿å¿…è¦å¯¹ç±»ä¸­æ‰€æœ‰é‡è½½æ–¹æ³•è¿›è¡Œå¾ªç¯ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³ä¸ªæ•°ã€ç±»å‹å’Œé¡ºåºçš„è¦æ±‚ï¼Œæ€§èƒ½ä¸Šä¸€å®šæœ‰æ‰€å½±å“
>
> è€Œé™åˆ¶è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚æ–¹å¼ä¸èƒ½å®Œå…¨ç›¸åŒçš„è¯ï¼Œå°±æ²¡æœ‰è¿™ç§è‹¦æ¼äº†ã€‚å³ä½¿æ˜¯é‡è½½æ–¹æ³•ï¼Œé€šè¿‡ä¸åŒè¯·æ±‚è·¯å¾„æˆ–è¯·æ±‚æ–¹æ³•æ¥ç•Œå®šåˆ°åº•è®¿é—®å“ªä¸ªæ–¹æ³•å°±å¯ä»¥äº†ã€‚



### `@RequestHeader`

+ å°†è¯·æ±‚å¤´ä¿¡æ¯å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³»ï¼›
+ åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š`value`ã€`required`ã€`defaultValue`ï¼Œç”¨æ³•åŒ `@RequestParam` ã€‚



ğŸŒ° ä¾‹å­ï¼š

```java
@RequestMapping("/testParam")
public String testParam(
        @RequestParam(value = "user_name", required = false, defaultValue = "defaultUsername") String username,
        String password,
        String[] hobby,
        @RequestHeader(value = "HeaderTest", required = true, defaultValue = "headerTest") String HeaderTest
        ) {
    System.out.println("username: " + username + ", password: " + password + ", hobby" + Arrays.toString(hobby));
    System.out.println(HeaderTest);
    return "success";
}
```



### `@CookieValue`

+ å°† cookie æ•°æ®å€¼å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³»ã€‚
+ åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š`value`ã€`required`ã€`defaultValue`ï¼Œç”¨æ³•åŒ `@RequestParam` ã€‚



ğŸŒ° ä¾‹å­ï¼š

é¦–å…ˆåˆ›å»ºæ–°çš„ `session`ï¼Œä»¥è·å– cookie å€¼ï¼š
```java
@RequestMapping("/testServletAPI")
public String testServletAPI(HttpServletRequest request) {
    HttpSession session = request.getSession();
    // ...
}
```

åé¢æ¯æ¬¡å‘é€è¯·æ±‚ï¼Œ`JSESSIONID`çš„`Cookie`å°†ä¼šæ”¾åœ¨*è¯·æ±‚æŠ¥æ–‡*ä¿¡æ¯ã€‚

```java
@RequestMapping("/testCookie")
public String testCookie(
    @CookieValue(value = "JSESSIONID") String jSessionId,
    @CookieValue(value = "Test", required = false, defaultValue = "CookieValue") String test) {
    System.out.println("jSessionId=" + jSessionId + ", test=" + test);
    return "success";
}
```



>ğŸ”— `JSESSIONID` ç›¸å…³ï¼š
>
>- åœ¨ JavaWeb ä¸­ï¼Œ`Session`ä¾èµ–äº`Cookie`ï¼Œ`Session`æ˜¯æœåŠ¡å™¨ç«¯çš„ä¼šè¯æŠ€æœ¯ï¼Œ`Cookie`æ˜¯å®¢æˆ·ç«¯çš„ä¼šè¯æŠ€æœ¯ã€‚
>
>- ä¼šè¯æŠ€æœ¯é»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æµè§ˆå™¨å¼€å¯å’Œæµè§ˆå™¨å…³é—­ï¼Œåªè¦æµè§ˆå™¨ä¸å…³é—­ï¼Œ`Cookie`å°†ä¸€ç›´å­˜åœ¨ã€‚
>
>- è°ƒç”¨`getSession()`æ–¹æ³•æ—¶ï¼Œé¦–å…ˆä¼šæ£€æµ‹è¯·æ±‚æŠ¥æ–‡ä¸­æ˜¯å¦æœ‰æºå¸¦`JSESSIONID`çš„`Cookie`ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯´æ˜å½“å‰ä¼šè¯æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»º`Session`å¯¹è±¡ï¼Œåˆ™ 
>
>- - åœ¨æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ª`Cookie`ï¼Œä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨ã€‚é”®æ˜¯å›ºå®šçš„`JSESSIONID`ï¼Œå€¼æ˜¯ä¸€ä¸ª UUID éšæœºåºåˆ—
>
>- - åœ¨æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ª`HttpSession`å¯¹è±¡ï¼Œå¹¶æ”¾åœ¨æœåŠ¡å™¨æ‰€ç»´æŠ¤çš„ Map é›†åˆä¸­ã€‚Map çš„é”®æ˜¯`JSESSIONID`çš„å€¼ï¼Œå€¼å°±æ˜¯`HttpSession`å¯¹è±¡
>
>- - æœ€åæŠŠ`Cookie`ç›¸åº”ç»™æµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶`JSESSIONID`çš„`Cookie`å­˜åœ¨äºå“åº”æŠ¥æ–‡ä¸­ã€‚æ¯æ¬¡æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚éƒ½ä¼šæºå¸¦`Cookie`ï¼Œæ­¤å`JSESSIONID`çš„`Cookie`å°†å­˜åœ¨äºè¯·æ±‚æŠ¥æ–‡ä¸­

### é€šè¿‡å®ä½“ç±»è·å–è¯·æ±‚å‚æ•°

å¯ä»¥åœ¨æ§åˆ¶å™¨çš„å½¢å‚ä½ç½®è®¾ç½®ä¸€ä¸ª**å®ä½“ç±»å‹çš„çš„å½¢å‚**ï¼Œæ­¤æ—¶è‹¥æµè§ˆå™¨ä¼ è¾“çš„è¯·æ±‚å‚æ•°çš„å‚æ•°åå’Œå®ä½“ç±»ä¸­çš„å±æ€§å**ä¸€è‡´**ï¼Œé‚£ä¹ˆè¯·æ±‚å‚æ•°å°±ä¼šä¸ºæ­¤å±æ€§èµ‹å€¼ã€‚



ğŸŒ° ä¾‹å­ï¼š

```java
@RequestMapping("/testPOJO")
public String testPOJO(User user){
    System.out.println(user);
    return "success";
}
```

```html
<form th:action="@{/testPOJO}" method="get">
    ç”¨æˆ·åï¼š<input type="text" name="username" value="admin"><br>
    å¯†ç ï¼š<input type="text" name="password" value="123456"><br>
    æ€§åˆ«ï¼š <input type="radio" name="sex" value="ç”·">ç”·
    <input type="radio" name="sex" value="å¥³">å¥³<br>
    å¹´é¾„ï¼š<input type="text" name="age"><br>
    é‚®ç®±ï¼š<input type="text" name="email"><br>
    <input type="submit" value="æµ‹è¯•é€šè¿‡å®ä½“ç±»è·å–è¯·æ±‚å‚æ•°">
</form>
```



### è§£å†³è·å–è¯·æ±‚å‚æ•°çš„ä¹±ç é—®é¢˜

å¦‚ä¸Šä¾‹å­é€šè¿‡å®ä½“ç±»è·å–è¯·æ±‚å‚æ•°ï¼Œå½“å‰å°ä½¿ç”¨ `POST` æ–¹æ³•ç›¸åº”è¯·æ±‚æ—¶ï¼Œè¿”å›çš„ä¸­æ–‡å­—ç¬¦ä¼šå‡ºç°å­—ç¬¦ã€‚

> è¦å¤„ç†ä¹±ç é—®é¢˜æœ‰ä¸¤ç§æ€è·¯ï¼š
>
> + å‘é€è¯·æ±‚ä¹‹åï¼Œæ‰‹åŠ¨è§£ç ç¼–ç ã€‚
> + å‘é€è¯·æ±‚ä¹‹å‰ï¼Œ`Servlet` å¤„ç†è¯·æ±‚ä¹‹å‰å¤„ç†ä¹±ç ã€‚
>
> JavaWeb æœåŠ¡å™¨ä¸­ä¸‰å¤§ç»„ä»¶ï¼šç›‘å¬å™¨ã€è¿‡æ»¤å™¨ã€`Servlet`ã€‚å¾ˆæ˜¾ç„¶ï¼Œç›‘å¬å™¨å’Œè¿‡æ»¤å™¨éƒ½åœ¨`Servlet`ä¹‹å‰
>
> - `ServletContextListener`ç›‘å¬å™¨ï¼šåªæ˜¯æ¥ç›‘å¬`ServletContext`çš„åˆ›å»ºå’Œé”€æ¯ï¼Œéƒ½æ˜¯åªæ‰§è¡Œä¸€æ¬¡
>
> - `Filter`è¿‡æ»¤å™¨ï¼šåªè¦è®¾ç½®äº†è¿‡æ»¤è·¯å¾„ï¼Œåªè¦å½“å‰æ‰€è®¿é—®çš„è¯·æ±‚åœ°å€æ»¡è¶³è¿‡æ»¤è·¯å¾„ï¼Œé‚£ä¹ˆéƒ½ä¼šè¢«è¿‡æ»¤å™¨è¿‡æ»¤
>
> å¾ˆæ˜¾ç„¶ï¼Œç”¨è¿‡æ»¤å™¨å°±å¯ä»¥åšåˆ°åœ¨å‘é€è¯·æ±‚ä¹‹å‰â€œåšæ‰‹è„šâ€ï¼Œè¿™æ ·æ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œå†äº¤ç»™`DispatherServlet`å¤„ç†ã€‚
>
> ä½†æ˜¯ï¼Œè¿™ä¸ªè¿‡æ»¤ä¸éœ€è¦æˆ‘ä»¬å†™ï¼ŒSpringMVC å·²ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº†ï¼Œåªè¦å†`web.xml`ä¸­è¿›è¡Œé…ç½®å³å¯ï¼Œ



è§£å†³è·å–è¯·æ±‚å‚æ•°çš„ä¹±ç é—®é¢˜å¯ä»¥ä½¿ç”¨ SpringMVC æä¾›çš„**ç¼–ç è¿‡æ»¤å™¨ `CharacterEncodingFilter`** ï¼Œä½†æ˜¯å¿…é¡»è¦åœ¨ `web.xml` é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œï¼š

é…ç½® `UTF-8`ï¼š

```xml
<filter>
    <filter-name>CharacterEncodingFilter</filter-name>
    <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
        <param-name>forceResponseEncoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
</filter>
<filter-mapping>
    <filter-name>CharacterEncodingFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```


---
0title: ğŸš² MyBatis åŠ¨æ€ SQL
date: 2022-03-21 09:27:22
permalink: /pages/a1647a/
categories: 
  - _pages
  - ğŸ§‹ JavaEE
  - ğŸ—º MyBatis
tags: 
  - null
title: ğŸš² MyBatis åŠ¨æ€ SQL
author: 
  name: Simon
  link: https://github.com/simon1uo
---
MyBatis æ¡†æ¶çš„åŠ¨æ€ SQL æŠ€æœ¯æ˜¯ä¸€ç§æ ¹æ®**ç‰¹å®šæ¡ä»¶**åŠ¨æ€æ‹¼è£… SQL è¯­å¥çš„åŠŸèƒ½ï¼Œå®ƒå­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†**è§£å†³æ‹¼æ¥ SQL è¯­å¥å­—ç¬¦ä¸²æ—¶çš„ç—›ç‚¹é—®é¢˜**ã€‚

## æ˜ å°„æ–‡ä»¶å®ç°åŠ¨æ€ SQL

### `if` æ ‡ç­¾

`if` æ ‡ç­¾å¯ä»¥é€šè¿‡ `test` å±æ€§çš„è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¡¨è¾¾å¼çš„ç»“æœä¸º `true` ï¼Œåˆ™æ ‡ç­¾ä¸­çš„å†…å®¹ä¼šæ‰§è¡Œï¼Œ**åä¹‹æ ‡ç­¾ä¸­çš„å†…å®¹ä¸ä¼šæ‰§è¡Œ**ã€‚

ğŸŒ° ä¾‹å­ï¼šæ ¹æ®å‘˜å·¥ä¿¡æ¯æ¡ä»¶æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼š

```xml
<!--List<Emp> getEmpByCondition(Emp emp);-->
<select id="getEmpByCondition" resultType="Emp">
    select *
    from emp
    where 1 = 1
    <if test="empName != null and empName != ''">
        emp_name = #{empName}
    </if>
    <if test="age != null and age != ''">
        and age = #{age}
    </if>
    <if test="sex != null and sex != ''">
        and sex = #{sex}
    </if>
    <if test="email != null and email != ''">
        and email = #{email}
    </if>
</select>
```

> æ³¨æ„ `where 1=1` æ¡ä»¶çš„ä½¿ç”¨ï¼š**ä½¿å¾—whereæ¡ä»¶è¯­å¥æ°¸è¿œä¸ºçœŸ**ã€‚æœ¬è´¨ä¸Šå°±æ˜¯è™½ç„¶åŠ äº†whereæ¡ä»¶ï¼Œä½†å®é™…ä¸Šæ°¸è¿œä¸ºçœŸï¼Œä¹Ÿå°±ç›¸å½“äºæ²¡æœ‰åŠ ä»»ä½•çº¦æŸæ¡ä»¶ã€‚
>
> ğŸ”— ç›¸å…³é˜…è¯»ï¼š[ä¸è¦å†ä½¿ç”¨ where 1=1 äº†ï¼Œæœ‰æ›´å¥½çš„å†™æ³•](https://segmentfault.com/a/1190000041474982)



### `where` æ ‡ç­¾

é€šå¸¸ä¸ `if` æ ‡ç­¾ç»“åˆä½¿ç”¨ï¼š

+ å½“ `where` æ ‡ç­¾ä¸­çš„ `if` æ¡ä»¶éƒ½ä¸æ»¡è¶³æ—¶ï¼Œåˆ™ `where` æ ‡ç­¾ä¸­æ²¡æœ‰ä»»ä½•åŠŸèƒ½ï¼Œå³ä¸ä¼šæ·»åŠ  `where`  å…³é”®å­—åˆ° SQL è¯­å¥ä¸­ã€‚
+ è‹¥ `where` æ ‡ç­¾ä¸­çš„ `if` æ¡ä»¶æ»¡è¶³ï¼Œåˆ™ `where` æ ‡ç­¾ä¼šè‡ªåŠ¨æ·»åŠ  `where` å…³é”®å­—ï¼Œå¹¶**å°†æ¡ä»¶æœ€å‰æ–¹å¤šä½™çš„ `and` æˆ–è€… `or`å»æ‰**ã€‚ï¼ˆno more `where 1=1` ï¼‰
  + âš ï¸ æ³¨æ„ï¼š`where` æ ‡ç­¾ä¸èƒ½å»æ‰**æ¡ä»¶æœ€å**å¤šä½™çš„ `and`ã€‚æ‰€ä»¥æœ€å¥½å†™åœ¨æ¡ä»¶å‰ã€‚

ğŸŒ° ä¾‹å­ï¼šç”¨ `where` æ ‡ç­¾æ¡ä»¶æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼š
:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab code

```xml
<!--List<Emp> getEmpByCondition(Emp emp);-->
<select id="getEmpByCondition" resultType="Emp">
    select *
    from emp
    <where>
        <if test="empName != null and empName != ''">
            emp_name = #{empName}
        </if>
        <if test="age != null and age != ''">
            or age = #{age}
        </if>
        <if test="sex != null and sex != ''">
            and sex = #{sex}
        </if>
        <if test="email != null and email != ''">
            and email = #{email}
        </if>
    </where>
</select>
```

```java
@Test
public void getEmpByCondition(){
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    DynamicSQLMapper mapper = sqlSession.getMapper(DynamicSQLMapper.class);
    List<Emp> empByCondition = mapper.getEmpByCondition(new Emp(null, null, null, "", ""));
    empByCondition.forEach(emp -> System.out.println(emp));
}
```

:::

::: tab result

```sql
DEBUG 03-09 12:27:32,409 ==>  Preparing: select * from emp (BaseJdbcLogger.java:137) 
DEBUG 03-09 12:27:32,445 ==> Parameters:  (BaseJdbcLogger.java:137) 
DEBUG 03-09 12:27:32,471 <==      Total: 5 (BaseJdbcLogger.java:137) 
Emp{eid=1, empName='å¼ ä¸‰', age=20, sex='ç”·', email='123@qq.com', dept=null}
Emp{eid=2, empName='æå››', age=18, sex='å¥³', email='455@163.com', dept=null}
Emp{eid=3, empName='ç‹äº”', age=18, sex='å¥³', email='455@163.com', dept=null}
Emp{eid=4, empName='èµµå…­', age=18, sex='ç”·', email='455@163.com', dept=null}
Emp{eid=5, empName='ç”°ä¸ƒ', age=20, sex='å¥³', email='455@163.com', dept=null}
```

:::

::::



### `trim` æ ‡ç­¾

å¸¸ç”¨äº**å»æ‰æˆ–è€…æ·»åŠ æ ‡ç­¾ä¸­çš„å†…å®¹**ï¼Œå¸¸ç”¨å±æ€§ï¼š

> + `prefix` ï¼šåœ¨ `trim` æ ‡ç­¾ä¸­çš„å†…å®¹**å‰é¢æ·»åŠ **æŸäº›å†…å®¹ã€‚
> + `prefixOverriders`ï¼šåœ¨ `trim` æ ‡ç­¾ä¸­çš„å†…å®¹**å‰é¢å»æ‰**æŸäº›å†…å®¹ã€‚
> + `suffix` ï¼šåœ¨ `trim` æ ‡ç­¾ä¸­çš„å†…å®¹**åé¢æ·»åŠ **æŸäº›å†…å®¹ã€‚
> + `suffixOverrides` ï¼šåœ¨ `trim` æ ‡ç­¾ä¸­çš„å†…å®¹**åé¢å»æ‰**æŸäº›å†…å®¹ã€‚

è‹¥æ ‡ç­¾ä¸­æ²¡æœ‰å†…å®¹æ—¶ï¼Œ`trim` æ ‡ç­¾ä¸­æ²¡æœ‰æ•ˆæœã€‚

ğŸŒ° ä¾‹å­ï¼š

```xml
<!--List<Emp> getEmpByCondition(Emp emp);-->
<select id="getEmpByCondition" resultType="Emp">
    select *
    from emp
    <trim prefix="where" suffixOverrides="and|or">
        <if test="empName != null and empName != ''">
            emp_name = #{empName}
        </if>
        <if test="age != null and age != ''">
            and age = #{age}
        </if>
        <if test="sex != null and sex != ''">
            sex = #{sex} and
        </if>
        <if test="email != null and email != ''">
            email = #{email} and
        </if>
    </trim>
</select>
```



### `choose` / `when` / `otherwise` 

ç›¸å½“äº Java ä¸­çš„ `if ... else ... if ... else ` ã€‚åªè¦å…¶ä¸­ä¸€ä¸ª `when` æ ‡ç­¾ç¬¦åˆï¼Œä¸ç¬¦åˆåˆ™æ‰§è¡Œ `otherwise` ä¸­çš„å†…å®¹ã€‚å…¶ä¸­ `when` æ ‡ç­¾è‡³å°‘æœ‰ä¸€ä¸ªï¼Œ`otherwise` æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªã€‚

ğŸŒ° ä¾‹å­ï¼šæ¡ä»¶æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼š

```xml
<!--List<Emp> getEmpByChoose(Emp emp);-->
<select id="getEmpByChoose" resultType="Emp">
    select * from emp
    <where>
        <choose>
            <when test="empName != null and empName != ''">
                emp_name = #{empName}
            </when>
            <when test="age != null and age != ''">
                age = #{age}
            </when>
            <when test="sex != null and sex != ''">
                sex = #{sex}
            </when>
            <when test="email != null and email != ''">
                email = #{email}
            </when>
            <otherwise>
                did = 1
            </otherwise>
        </choose>
    </where>
</select>
```



ğŸŒ° ä¾‹å­ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆäº’æ–¥é€‰é¡¹ï¼‰

::: details

+ `UserMapper`ï¼š

```xml
<!--List<User> findByChoose(User user);-->
<select id="findByChoose" parameterType="User" resultType="User">
    SELECT * FROM user WHERE 1 = 1
    <choose>
        <when test="name!=null">
            AND name LIKE #{name}
        </when>
        <otherwise>
            AND sex = #{sex}
        </otherwise>
    </choose>
</select>
```

+ æµ‹è¯•ç±»ï¼š

```java
@Test
public void testFindByChoose() {
    User user = new User();
    // user.setName("%æ%");
    user.setSex("F");
    List<User> users = userMapper.findByChoose(user);
    users.forEach(userout -> System.out.println(userout));
}
```

:::





### `foreach` 

`foreach` å…ƒç´ æ˜¯ä¸€ä¸ªå¾ªç¯è¯­å¥ï¼Œ**å®ƒçš„ä½œç”¨æ˜¯éå†é›†åˆ**ï¼Œå®ƒèƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒæ•°ç»„å’Œ `List`ã€`Set` æ¥å£çš„é›†åˆï¼Œå¯¹æ­¤æä¾›éå†åŠŸèƒ½ã€‚å®ƒå¾€å¾€ç”¨äº SQL ä¸­çš„ `in` å…³é”®å­—ã€‚

`foreach` æ ‡ç­¾ä¸‹çš„å±æ€§ï¼š

+ `collection` ï¼šè®¾ç½®è¦å¾ªç¯çš„æ•°ç»„ `Array` æˆ–è€…é›†åˆ `List` ã€`Map` æˆ–è€… `Collection` ã€‚æ³¨æ„è¦åœ¨ mapper æ¥å£ä¸­ç¼–å†™æ–¹æ³•æ—¶ç”¨**æ³¨è§£æ³•æ³¨è§£å‚æ•°åç§°**ï¼Œå¦åˆ™åªèƒ½ä½¿ç”¨ MyBatis é¢„è®¾å‚æ•°åç§°è¯»å–æ•°ç»„æˆ–é›†åˆã€‚
+ `item` ï¼šè¡¨ç¤º**é›†åˆæˆ–æ•°ç»„**ä¸­çš„æ¯ä¸€æ•°æ®ã€‚
+ `sparator`ï¼šè®¾ç½®å¾ªç¯ä½“ä¹‹é—´çš„åˆ†éš”ç¬¦å·ã€‚ï¼ˆMyBatis ä¼šè‡ªåŠ¨åœ¨å‰åæ·»åŠ ç©ºæ ¼ï¼‰ï¼ˆä¾‹å¦‚ï¼Œåœ¨ `in (..., ...)` ä¸­çš„ `,`ï¼›`or`ï¼‰
+ `open`ï¼šè®¾ç½® `foreach` æ ‡ç­¾ä¸­çš„å†…å®¹çš„**å¼€å§‹ç¬¦å·**ï¼›
+ `close` ï¼šè®¾ç½® `foreach` æ ‡ç­¾ä¸­çš„å†…å®¹çš„**ç»“æŸç¬¦å·**ï¼›



ğŸŒ° ä¾‹å­ï¼šæ‰¹é‡æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š

+ `UserMapper` ï¼š

```xml
<!--List<User> findByIds(List<Integer> ids);-->
<select id="findByIds" resultType="User">
    SELECT * FROM user WHERE id IN
    <foreach collection="list" index="index" item="id" open="(" close=")" separator=",">#{id}</foreach>
</select>
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testFindByIds(){
    ArrayList<Integer> ids = new ArrayList<>();
    ids.add(1);
    ids.add(2);
    List<User> userList = userMapper.findByIds(ids);
    userList.forEach(user -> System.out.println(user));
}
```



ğŸŒ° ä¾‹å­ï¼šæ‰¹é‡åˆ é™¤å‘˜å·¥ä¿¡æ¯ï¼š

æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `in (â€¦, â€¦, â€¦)`ï¼š

```xml
<!--int deleteMoreByArray(@Param("eids") Integer[] eids);-->
<delete id="deleteMoreByArray">
    delete from emp where eid in
        <foreach collection="eids" item="eid" separator="," open="(" close=")">
        #{eid}
        </foreach>
</delete>
```

æ–¹æ³•äºŒï¼šä½¿ç”¨ `or` ï¼š

```xml
<delete id="deleteMoreByArray">
    delete from emp where
    <foreach collection="eids" item="eid" separator="or">
       eid = #{eid}
    </foreach>
</delete>
```



ğŸŒ° ä¾‹å­ï¼šæ‰¹é‡æ·»åŠ å‘˜å·¥ä¿¡æ¯ï¼š

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab code

+ `EmpMapper` 

```xml
<!--int insertMoreByList(@Param("emps") List<Emp> emps);-->
<insert id="insertMoreByList">
    insert into emp
    values
    <foreach collection="emps" item="emp" separator=",">
        (null, #{emp.empName}, #{emp.age},#{emp.sex}, #{emp.email},null)
    </foreach>
</insert>
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testInsertByMoreByList() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    DynamicSQLMapper mapper = sqlSession.getMapper(DynamicSQLMapper.class);
    Emp emp1 = new Emp(null, "a1", 23, "ç”·", "123@qq.com");
    Emp emp2 = new Emp(null, "a2", 23, "ç”·", "123@qq.com");
    Emp emp3 = new Emp(null, "a3", 23, "ç”·", "123@qq.com");
    List<Emp> emps = Arrays.asList(emp1, emp2, emp3);
    int result = mapper.insertMoreByList(emps);
    System.out.println(result);
}
```

:::

::: tab result

```sql
DEBUG 03-09 13:15:35,443 ==>  Preparing: insert into emp values (null, ?, ?,?, ?,null) , (null, ?, ?,?, ?,null) , (null, ?, ?,?, ?,null) (BaseJdbcLogger.java:137) 
DEBUG 03-09 13:15:35,483 ==> Parameters: a1(String), 23(Integer), ç”·(String), 123@qq.com(String), a2(String), 23(Integer), ç”·(String), 123@qq.com(String), a3(String), 23(Integer), ç”·(String), 123@qq.com(String) (BaseJdbcLogger.java:137) 
DEBUG 03-09 13:15:35,494 <==    Updates: 3 (BaseJdbcLogger.java:137) 
3
```

:::

::::



### `set` æ ‡ç­¾

å¯ä»¥ä½¿ç”¨ `set` å…ƒç´ é¿å…å°†è¦åœ¨ä¿®æ”¹æŸä¸ªå¯¹è±¡çš„æŸä¸ªå­—æ®µæ—¶æ—¶ï¼Œå‘é€æ‰€æœ‰çš„å­—æ®µç»™æŒä¹…åŒ–å¯¹è±¡çš„é—®é¢˜ã€‚**åªæŠŠä¸»é”®å’Œè¦æ›´æ–°çš„å­—æ®µçš„å€¼ä¼ é€’ç»™ SQL å»æ›´æ–°**ã€‚

ğŸŒ° ä¾‹å­ï¼š

+ `UserMapper`ï¼š

```xml
<!--int updateBySet(User user);-->
<update id="updateBySet" parameterType="User">
    UPDATE user
    <set>
        <if test="name!=null">
            name = #{name},
        </if>
        <if test="sex!=null">
            sex = #{sex}
        </if>
    </set>
    WHERE id = #{id}
</update>
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testUpdateBySet(){
    User user = new User();
    user.setId(5);
    // user.setName("è€èµµ");
    user.setSex("F");
    userMapper.updateBySet(user);
}
```



### `bind` æ ‡ç­¾

`bind` å…ƒç´ å¯ä»¥ä» OGNL è¡¨è¾¾å¼ä¸­åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å˜é‡ï¼Œè¿™æ ·æ›´æ–¹ä¾¿ä½¿ç”¨ã€‚

`bind` å…ƒç´ ä¸­çš„å±æ€§è¯´æ˜ï¼š

+ `name` ï¼šè‡ªå®šä¹‰çš„å˜é‡åã€‚
+ `value` ï¼šå˜é‡çš„è¡¨è¾¾å¼ã€‚

+ `_parameter` ï¼šæŒ‡ä¼ å…¥çš„å‚æ•°ã€‚



ğŸŒ° ä¾‹å­ï¼šæ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·

+ `UserMapper` ä¸­å®šä¹‰æ¨¡ç³ŠæŸ¥è¯¢å˜é‡çš„è¡¨è¾¾å¼ï¼š

```xml
<!--List<User> findByName(String name);-->
<select id="findByName" parameterType="String" resultType="User">
    <bind name="pattern" value="'%'+_parameter+'%'"/>
    SELECT * FROM user WHERE name LIKE #{pattern}
</select>
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testFindByName(){
    List<User> userList = userMapper.findByName("å¼ ");
    userList.forEach(user -> System.out.println(user));
}
```



## æ³¨è§£å®ç°åŠ¨æ€ SQL

ä½¿ç”¨ XML èƒ½å¤Ÿå®Œæˆçš„ä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼å®Œæˆï¼Œè€Œä¸”æ›´ä¸ºä¾¿æ·ã€‚

åœ¨ MyBatis ä½¿ç”¨æ³¨è§£ `@InsertProvider`ã€`@UpdateProvider`ã€`@DeleteProvider`ã€`@SelectProvider` æ¥å¸®åŠ©æ„å»ºåŠ¨æ€SQLè¯­å¥ã€‚

æ³¨è§£ä¸­çš„å‚æ•°ï¼š

+ `type` å‚æ•°ï¼šæŒ‡å®šç±»çš„ `class` å±æ€§ï¼Œè¯¥ç±»å¿…é¡»è¦é€šè¿‡æ— å‚çš„æ„é€ å‡½æ•°æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œ
+ `method` å‚æ•°ï¼šæŒ‡å®šçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¿…é¡»æ˜¯ `public` å±æ€§çš„ï¼Œè€Œä¸”è¿”å›å€¼å¿…é¡»ä¸º `String` ï¼Œå¯ä»¥ä¸ºé `static` æˆ–è€… `static`ã€‚



ğŸŒ° ä¾‹å­ï¼šé€šè¿‡æ³¨è§£ `SelectProvider` å®ç°åŠ¨æ€ SQLï¼š

+ åˆ›å»ºç±» `UserProvider` ï¼Œæ–¹æ³• `selectAllUser()` ï¼š

```java
public class UserProvider {
    public String selectAllUser(){
        return "select * from user";
    }
}
```

+ `UserMapper` æ¥å£ï¼š

```java
@SelectProvider(type = UserProvider.class, method = "selectAllUser")
List<User> findAllUser();
```



ğŸŒ° ä¾‹å­ï¼šé€šè¿‡ `SelectByProvider` å®ç°æ¡ä»¶åŠ¨æ€ SQL æŸ¥è¯¢ï¼š

+ å»¶ç»­ä¸Šè¿°ä¾‹å­ä¸­çš„ï¼Œåœ¨ `UserProvider` ç±»ä¸­åˆ›å»ºæ–¹æ³• `SelectByIf` ï¼š

```java
public String selectByIf(User user) {
    String sql = "select * from user where 1 = 1";
    if(user.getName() != null) {
        sql += "and name like '%" + user.getName() +"%'";
    } 
    if(user.getSex() != null) {
        sql += "and sex ='" + user.getSex() + "'";
    }
    return sql;
}
```

+ `UserMapper` æ¥å£ï¼š

```java
@SelectProvider(type = UserProvider.class, method = "selectByIf")
List<User> findByIf(User user);
```



ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ SQL çš„æ–¹æ³•æœ‰æ—¶ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼ŒMyBatis æä¾›äº†ä¸€ä¸ª SQL å·¥å…·ç±»ï¼Œå¯ä»¥ä½¿ç”¨ç»™ç±»æä¾›çš„æ–¹æ³•æ¥æ„é€ SQLè¯­å¥ã€‚å¸¸è§çš„æ–¹æ³•æœ‰ï¼š 

+ `INSERT_INTO(String)`
+ `VALUES(String, String)`
+ `UPDATE(String)`
+ `SET (String)`
+ `WHERE(String)`
+ `DELETE_FROM (String)`
+ `SELECT(String)`
+ `FROM (String)`
+ `GROUP BY (String)`
+ `ORDER_ BY (String)`


### `@InsertProvider` æ³¨è§£

ä½¿ç”¨  `@InsertProvider` çš„æ˜ å°„æ–‡ä»¶ä»¥åŠä½¿ç”¨ `INSERT_INTO`ã€`VALUES` æ–¹æ³•çš„ `Provider` ç±»å®ŒæˆåŠ¨æ€ SQL æ·»åŠ è®°å½•ï¼š

æ ¼å¼ï¼š

+ `INSERT_INTO(è¡¨å)`
+ `VALUES(å±æ€§å, å±æ€§å€¼)` 



ğŸŒ° ä¾‹å­ï¼šåœ¨ `user` è¡¨ä¸­ `id` ä¸ºé€æ¸å¯è‡ªåŠ¨æ·»åŠ å€¼ï¼Œä½†æ˜¯ `name` ä¸å¯ä»¥ä¸ºç©ºå¹¶ä¸”æ²¡æœ‰é»˜è®¤å€¼ï¼Œè¿™æ˜¯å¦‚æœ `name` æ²¡æœ‰è®¾å€¼æ·»åŠ è®°å½•å°±ä¸ä¼šæˆåŠŸã€‚å¯ä»¥ä½¿ç”¨ åŠ¨æ€ SQL è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

+ åœ¨ `UserProvider` ç±»ä¸­æ·»åŠ æ–¹æ³• `insertBySQLCls`ï¼š

```java
public String insertBySQLCls(final User user) {
    return new SQL(){
        {
            INSERT_INTO("user");
            if (user.getName() != null) {
                VALUES("name", "#{name}");
            } else {
                VALUES("name", "'anonymous'");
            }
            VALUES("age", "#{age}");
            VALUES("sex", "#{sex}");
            VALUES("address", "#{address}");
        }
    }.toString();
}
```

+ `UserMapper` æ¥å£ï¼š

```java
@InsertProvider(type = UserProvider.class, method = "insertBySQLCls")
int addBySQLCls(User user);
```



### `@UpdateProvider` æ³¨è§£

ä½¿ç”¨ `@UpdateProvider` çš„æ˜ å°„æ–‡ä»¶åŠä½¿ç”¨ `UPDATE`ã€`SET`ã€`WHERE` æ–¹æ³•çš„ `Provider` ç±»å®ŒæˆåŠ¨æ€ SQL ä¿®æ”¹è®°å½•ã€‚

æ ¼å¼ï¼š

+ `UPDATE( è¡¨åï¼‰`
+ `SETï¼ˆ å±æ€§å=å±æ€§å€¼ï¼‰`
+ `WHERE(æ¡ä»¶ï¼‰`



ğŸŒ° ä¾‹å­ï¼šåœ¨ `user` è¡¨ä¸­ä¿®æ”¹ æ— åæ°çš„ä¿¡æ¯ï¼Œå¯èƒ½ä¿®æ”¹å§“åï¼Œå¯èƒ½ä¿®æ”¹å¹´é¾„ï¼Œåœ¨ä¿®æ”¹å“ªä¸ªå±æ€§ä¸ç¡®å®šçš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ SQL è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

+ åœ¨ `UserProvider` ç±»ä¸­æ·»åŠ æ–¹æ³• `updateBySQLCls`ï¼š

```java
public String updateBySQLCls(@Param("puser") final User user,
                             @Param("pcondi") final String condi) {
    return new SQL() {
        {
            UPDATE("user");
            if(user.getName() != null)
                SET("name=#{puser.name}");
            if(user.getAge() != 0)
                SET("age=#{puser.age}");
            if(user.getSex() != null)
                SET("sex=#{puser.sex}");
            if(user.getAddress() != null)
                SET("address=#{puser.address}");
            WHERE("name=#{pcondi}");
        }
    }.toString();

}
```

+ `UserMapper` æ¥å£ï¼š

```java
@UpdateProvider(type = UserProvider.class, method = "updateBySQLCls")
int alterBySQLCls(@Param("puser") User user, @Param("pcondi") String condi);
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testAlterBySQLCls(){
    User user = new User();
    user.setAge(60);
    user.setSex("F");
    user.setAddress("æ·±åœ³");
    String str = "anonymous";
    System.out.println(userMapper.alterBySQLCls(user, str));
}
```



### `@DeleteProvider` æ³¨è§£

ä½¿ç”¨ `@DeleteProvider` çš„æ˜ å°„æ–‡ä»¶åŠä½¿ç”¨ `DELETE FROM` ã€`WHERE` æ–¹æ³•çš„ `Provider` ç±»å®ŒæˆåŠ¨æ€ SQL åˆ é™¤è®°å½•ã€‚

æ ¼å¼ï¼š

+ DELETE_ FROM( è¡¨åï¼‰
+ WHEREï¼ˆæ¡ä»¶ï¼‰



ğŸŒ° ä¾‹å­ï¼šåœ¨ `use` rè¡¨ä¸­åˆ é™¤å¹´é¾„ä¸º `60` ï¼ŒåŒæ—¶ æ€§åˆ¥ä¸º `F` çš„è®°å½•ï¼ˆå³æ— å
æ°çš„è®°å½•ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ SQL è§£å†³ï¼š

+ åœ¨ `UserProvider` ç±»ä¸­æ·»åŠ æ–¹æ³• `deleteBySQLCls`ï¼š

```java
public String deleteBySQLCls(@Param("page") int age, @Param("psex") String sex) {
    return new SQL(){
        {
            DELETE_FROM("user");
            WHERE("sex={psex} AND age={page}");
        }
    }.toString();
}
```

+ `UserMapper` æ¥å£ï¼š

```java
@DeleteProvider(type = UserProvider.class, method = "deleteBySQLCls")
int removeBySQLCls(@Param("page") int age, @Param("psex") String sex);
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testRemoveBySQLCls(){
    int age = 60;
    String sex = "F";
    System.out.println(userMapper.removeBySQLCls(age, sex));
}
```



### `@SelectProvider` æ³¨è§£

ä½¿ç”¨ `@SelectProvider` çš„æ˜ å°„æ–‡ä»¶åŠä½¿ç”¨ `SELECT FROM`ã€
`WHERE`ã€ `GROUP_ BY`ã€ `ORDER_BY` æ–¹æ³•çš„ `Provider` ç±»å®ŒæˆåŠ¨æ€ SQL æŸ¥æ‰¾è®°å½•ã€‚

æ ¼å¼ï¼š

+ `SELECT(å±æ€§)`
+ `FROM(è¡¨å)`
+ `WHERE(æ¡ä»¶)`
+ `GROUP_BY(å±æ€§)`
+ `ORDER_ BY(å±æ€§)`



ğŸŒ° ä¾‹å­ï¼šåœ¨ `user` è¡¨ä¸­æŸ¥æ‰¾å¹´é¾„ä¸º `18` å²ä»¥ä¸Šçš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§
å¹´é¾„æ’åºåè¾“å‡ºã€‚å¯ä»¥ä½¿ç”¨åŠ¨æ€SQLå®Œæˆã€‚

+ åœ¨ `UserProvider` ç±»ä¸­æ·»åŠ æ–¹æ³• `selectBySQLCls`ï¼š

```java
public String selectBySQLCls(final int age, final String ord){
    return new SQL(){
        {
            SELECT("*");
            FROM("user");
            WHERE("age>#{param1}");
            ORDER_BY(ord);
        }
    }.toString();
}
```

+ `UserMapper` æ¥å£ï¼š

```java
@SelectProvider(type = UserProvider.class, method = "selectBySQLCls")
List<User> findBySQLCls(int age, String ord);
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testFindBySQLCls() {
    List<User> userList = userMapper.findBySQLCls(18, "age");
    userList.forEach(user -> System.out.println(user));
}
```



ğŸŒ° ä¾‹å­ï¼šæŒ‰ç…§åŸå¸‚ `address` è¿›è¡Œåˆ†ç»„èšé›†æŸ¥è¯¢ï¼š

+ åœ¨ `UserProvider` ç±»ä¸­æ·»åŠ æ–¹æ³• `selectBySQLCls`ï¼š

```java
public String selectByGroupSQLCls(){
    return new SQL(){
        {
            SELECT("count(*), address");
            FROM("user");
            GROUP_BY("address");
        }
    }.toString();
}
```

+ `UserMapper` æ¥å£ï¼š

```java
@SelectProvider(type = UserProvider.class, method = "selectByGroupSQLCls")
List<Map> findByGroupSQLCls();
```

+ æµ‹è¯•ï¼š

```java
@Test
public void testFindByGroupSQLCls(){
    List<Map> mapList = userMapper.findByGroupSQLCls();
    for (Map map : mapList) {
        System.out.println(map.get("address") + ":" + map.get("count(*)"));
    }
}
```




---
title: ğŸ” MyBatis è¿›é˜¶æŸ¥è¯¢
date: 2022-03-21 10:40:56
permalink: /pages/991773/
categories: 
  - _pages
  - ğŸ§‹ JavaEE
  - ğŸ—º MyBatis
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---
::: warning

+ è‹¥æŸ¥è¯¢å‡ºçš„æ•°æ®åªæœ‰**ä¸€æ¡**ï¼Œ åˆ™å¯ä»¥é€šè¿‡å®ä½“ç±»å¯¹è±¡ / `List` é›†åˆæ¥æ”¶ã€‚æˆ–è€…ç”¨ `Map` é›†åˆæ¥æ”¶ï¼ˆæ²¡æœ‰å®ä½“ç±»ä¸æŸ¥è¯¢ç»“æœå¯¹åº”æ—¶ï¼‰ ï¼›
+ è‹¥æŸ¥è¯¢å‡ºçš„æ•°æ®æœ‰**å¤šæ¡**ï¼Œå¯ä»¥é€šè¿‡ `List` é›†åˆæ¥å—ï¼Œæˆ–è€…ä½¿ç”¨ `Map` é›†åˆæ¥æ”¶ï¼ˆåœ¨æ¥å£ä¸­çš„æ–¹æ³•ä¸Šæ·»åŠ ä¸Š `@MapKey` æ³¨è§£ï¼‰ï¼Œ**ä¸€å®šä¸èƒ½é€šè¿‡å®ä½“ç±»å¯¹è±¡æ¥å—ï¼Œå¦åˆ™ä¼šæŠ›å‡º `TooManyResultsException` å¼‚å¸¸ã€‚**

:::

æŒ‰å¼€å‘éœ€æ±‚ä½¿ç”¨ä»¥ä¸‹ä¸åŒçš„æŸ¥è¯¢æ–¹æ³•ï¼š

### æŸ¥è¯¢ä¸€ä¸ªå®ä½“ç±»å¯¹è±¡

ğŸŒ° ä¾‹å­ï¼šé€šè¿‡ `id` æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š

mapper æ¥å£ `SelectMapper` ä¸­ï¼š

```java
public interface SelectMapper {
    User getUserById(@Param("id") Integer id);
}
```

mapper é…ç½® `SelectMapper.xml` ï¼š

```xml
<!--User getUserById(@Param("id") Integer id);-->
<select id="getUserById" resultType="User">
    select *
    from user
    where id = #{id}
</select>
```

æµ‹è¯•ç±»ï¼š

```java
@Test
public void testGetUserById() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    SelectMapper mapper = sqlSession.getMapper(SelectMapper.class);
    User user = mapper.getUserById(2);
    System.out.println(user);
}
```



### æŸ¥è¯¢ä¸€ä¸ªé›†åˆ `List`



ğŸŒ° ä¾‹å­ï¼šé€šè¿‡ `id` æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š

mapper æ¥å£ `SelectMapper` ä¸­ï¼š

```java
public interface SelectMapper {
    List<User> getAllUser();
}
```

mapper é…ç½® `SelectMapper.xml` ï¼š

```xml
<!--List<User> getAllUser();-->
<select id="getAllUser" resultType="User">
    select * from user;
</select>
```

æµ‹è¯•ç±»ï¼š

```java
public void testGetAllUser() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    SelectMapper mapper = sqlSession.getMapper(SelectMapper.class);
    List<User> userList = mapper.getAllUser();
    userList.forEach(user -> System.out.println(user));
}
```







### æŸ¥è¯¢å•ä¸ªæ•°æ®



ğŸŒ° ä¾‹å­ï¼šæŸ¥è¯¢ç”¨æˆ·çš„æ€»è®°å½•æ•°ï¼šmapper æ¥å£ `SelectMapper` ä¸­ï¼š

```java
public interface SelectMapper {
    Integer getCount();
}
```

mapper é…ç½® `SelectMapper.xml` ï¼š

```xml
<!--Integer getCount();-->
<select id="getCount" resultType="Integer">
    select count(*) from user
</select>

```

è¿”å›ç±»å‹ä¸º `Integer` ã€‚

æµ‹è¯•ç±»ï¼š

```java
@Test	
public void testGetCount() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    SelectMapper mapper = sqlSession.getMapper(SelectMapper.class);
    Integer count = mapper.getCount();
    System.out.println(count);
}
```



> ç›¸å…³ï¼š[ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰](https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases)
>
> MyBatis é»˜è®¤ç±»å‹åˆ«åå¸¸ç”¨ï¼š
>
> + `java.lang.Integer` -> `int`, `integer`
> + `int`-> `_int`, `_integer`
> + `Map` -> `map`
> + `String` -> `string` 

### æŸ¥è¯¢ä¸€æ¡æ•°æ®ä¸º `Map` é›†åˆ

 å¸¸ç”¨äºï¼šæŸ¥è¯¢å‡ºæ¥çš„ç»“æœæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå®ä½“ç±»èƒ½ä¸ç»“æœç›¸å¯¹åº”ï¼Œä½†å¯ä»¥å­˜å‚¨åœ¨ä¸€ä¸ª `Map` é›†åˆï¼ˆä»¥å­—æ®µä¸ºé”®ï¼Œå­—æ®µçš„å€¼ä¸ºå€¼ï¼‰ä¸­ä¾›ä½¿ç”¨çš„æƒ…å†µã€‚

ğŸŒ° ä¾‹å­ï¼šæ ¹æ®ç”¨æˆ· `id` æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ä¸ºä¸€ä¸ª `Map` é›†åˆï¼š

```java
public interface SelectMapper {
    Map<String, Object> getUserByIdToMap(@Param("id") Integer id);
}
```

mapper é…ç½® `SelectMapper.xml` ï¼š

```xml
<!--Map<String, Object> getUserByIdToMap(@Param("id") Integer id);-->
<select id="getUserByIdToMap" resultType="Map">
    select * from user where id = #{id}
</select>
```

è¿”å›ç±»å‹ä¸º `Map` ã€‚

æµ‹è¯•ç±»ï¼š

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab java 

```java
@Test
public void testGetUserByIdToMap() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    SelectMapper mapper = sqlSession.getMapper(SelectMapper.class);
    Map<String, Object> user = mapper.getUserByIdToMap(2);
    System.out.println(user);
}
```

:::

::: tab result

```
DEBUG 03-04 13:28:17,088 ==>  Preparing: select * from user where id = ? (BaseJdbcLogger.java:137) 
DEBUG 03-04 13:28:17,119 ==> Parameters: 2(Integer) (BaseJdbcLogger.java:137) 
DEBUG 03-04 13:28:17,138 <==      Total: 1 (BaseJdbcLogger.java:137) 
{password=123456, id=2, username=admin}
```

:::

::::

### æŸ¥è¯¢å¤šæ¡æ•°æ®ä¸º `Map` é›†åˆ

å°†è¡¨ä¸­çš„æ•°æ®ä»¥ `Map` é›†åˆçš„æ–¹å¼æŸ¥è¯¢ï¼Œä¸€æ¡æ•°æ®å¯¹åº”ä¸€ä¸ª `Map`ã€‚æ­¤æ—¶è‹¥æœ‰**å¤šæ¡æ•°æ®**ï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ª `Map` é›†åˆï¼Œå¹¶ä¸”æœ€ç»ˆè¦ä»¥ä¸€ä¸ª `Map` é›†åˆçš„æ–¹å¼è¿”å›æ•°æ®ï¼Œ**æ­¤æ—¶éœ€è¦é€šè¿‡ `@MapKey` æ³¨è§£è®¾ç½® `Map` é›†åˆçš„é”®ï¼Œå€¼æ˜¯æ¯æ¡æ•°æ®æ‰€å¯¹åº”çš„ `Map` é›†åˆã€‚ **ï¼ˆäº¦å¯ä»¥ç”¨ä»¥`Map` ç±»å‹çš„  `List` ä½œä¸ºç»“æœçš„è¿”å›ç±»å‹ ï¼‰



ğŸŒ° ä¾‹å­ï¼šè¿”å›æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ä¸ºä¸€ä¸ª `Map` é›†åˆï¼š

```java
public interface SelectMapper {
  @MapKey("id")
  Map<String, Object> getAllUserToMap();
	// List<Map<String, Object>> getAllUserToMap();
}
```

mapper é…ç½® `SelectMapper.xml` ï¼š

```xml
<!--Map<String, Object> getAllUserToMap();-->
<select id="getAllUserToMap" resultType="Map">
    select * from user
</select>
```

è¿”å›ç±»å‹ä¸º `Map` ã€‚

æµ‹è¯•ç±»ï¼š

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab java 

```java
@Test
public void testGetAllUserToMap() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    SelectMapper mapper = sqlSession.getMapper(SelectMapper.class);
    Map<String, Object> user = mapper.getAllUserToMap();
    System.out.println(user);
}
```

:::

::: tab result

```sql
DEBUG 03-04 14:10:52,284 ==>  Preparing: select * from user (BaseJdbcLogger.java:137) 
DEBUG 03-04 14:10:52,312 ==> Parameters:  (BaseJdbcLogger.java:137) 
DEBUG 03-04 14:10:52,330 <==      Total: 3 (BaseJdbcLogger.java:137) 
{2={password=123456, id=2, username=admin}, 3={id=3, username=å¼ ä¸‰}, 5={password=123456, id=5, username=æå››}}
```

:::

::::



### æ¨¡ç³ŠæŸ¥è¯¢

::: tip

+ `${}` ä¸è‡ªåŠ¨è¡¥å•å¼•å· `â€˜â€™`ï¼›
+ `#{}` è‡ªåŠ¨è¡¥å•å¼•å· `â€˜â€™`ã€‚

:::

+ ä½¿ç”¨`${}`ï¼Œä¾‹å¦‚ï¼š`like â€˜%${username}%â€™ `ï¼›
+ ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¾‹å¦‚ï¼š`like concat(â€˜%â€™, #{username},â€™%â€™)` ï¼›
+ :star: ç›´æ¥åŠ  ï¼Œä¾‹å¦‚ï¼š`like '%'#{username}'%'`ã€‚

ğŸŒ° ä¾‹å­ï¼šæ ¹æ®ç”¨æˆ·å**æ¨¡ç³ŠæŸ¥è¯¢**ç”¨æˆ·ä¿¡æ¯ï¼š

mapper æ¥å£ `SQLMapper`ï¼š

```java
public interface SQLMapper {
    List<User> getUserByLike(String username);
}
```

mapper é…ç½® `SQLMapper.xml` ï¼š

```xml
<!--List<User> getUserByLike(String username);-->
<select id="getUserByLike" resultType="User">
    <!--select * from user where username like '%${username}%'-->
    <!--select * from user where username like concat('%', #{username}, '%')-->
    select * from user where username like '%' #{username} '%'
</select>
```

æµ‹è¯•ç±»ï¼š 

```java
@Test
public void testGetUserByLike(){
  SqlSession sqlSession = SqlSessionUtils.getSqlSession();
  SQLMapper mapper = sqlSession.getMapper(SQLMapper.class);
  List<User> user = mapper.getUserByLike("ad");
  System.out.println(user);
}
```



## MyBatis ç‰¹æ®Š SQL çš„æ‰§è¡Œ

### æ‰¹é‡åˆ é™¤

::: tip

æ‰¹é‡åˆ é™¤çš„ SQL è¯­å¥æ ¼å¼ä¸º `delete from user in ( â€¦  )`ï¼Œ`â€¦` ä¸­ä¸èƒ½æ˜¯å­—ç¬¦ä¸²ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡ä¸è‡ªåŠ¨è¡¥ `â€˜â€™` çš„ `${}` è·å–å‚æ•°ã€‚

:::

ğŸŒ° ä¾‹å­ï¼šæ ¹æ®å­—ç¬¦ä¸² `ids` å¤šä¸ªç”¨æˆ·åè¿›è¡Œæ‰¹é‡åˆ é™¤ç”¨æˆ·ï¼š



### åŠ¨æ€è®¾ç½®è¡¨å

è¡¨ä¸­æ•°æ®å¤ªå¤šï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥å°†ä¸€å¼ è¡¨è¿›è¡Œåˆ‡åˆ†ï¼Œçœ‹ä½œå¤šå¼ è¡¨å…±åŒå­˜å‚¨è¿™ä¸€å¼ è¡¨çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢æˆ–è€…æ“ä½œè¿™ä¸€å¼ è¡¨å¯ä»¥çœ‹ä½œæ˜¯ä¸ä¸€æ ·çš„è¡¨ï¼Œå¯ä»¥é€šè¿‡**åŠ¨æ€è®¾ç½®è¡¨å**å®ç°ã€‚ï¼ˆ**æ³¨æ„åªèƒ½é€šè¿‡ `${}` ä¼ è¾“åŠ¨æ€è¡¨åå‚æ•°**ï¼‰



ğŸŒ° ä¾‹å­ï¼šæ ¹æ®ä¸åŒçš„è¡¨åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š

mapper æ¥å£ `SQLMapper`ï¼š

```java
public interface SQLMapper {
    List<User> getUserByTableName(@Param("tableName") String tableName);
}
```

mapper é…ç½® `SQLMapper.xml` ï¼š

```xml
<!--List<User> getUserByTableName(String tableName); -->
<select id="getUserByTableName" resultType="User">
    select * from ${tableName}
</select>
```

æµ‹è¯•ç±»ï¼š 

```java
@Test
public void testGetUserByTableName() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    SQLMapper mapper = sqlSession.getMapper(SQLMapper.class);
    List<User> user = mapper.getUserByTableName("user");
    System.out.println(user);
}
```



### æ·»åŠ åŠŸèƒ½è·å–è‡ªå¢çš„ä¸»é”®

ï¼ˆä¸»é”®å›å¡«ï¼šå¦‚æœä¸»é”®è‡ªåŠ¨ç”Ÿæˆï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åˆéœ€è¦å–å¾—åˆšåˆšæ·»åŠ è®°å½•çš„ä¸»é”®å€¼ã€‚`insert` è¯­å¥ä¸­æœ‰ä¸€ä¸ªå¼€å…³å±æ€§ `useGeneratedKeys` ï¼Œæ‰“å¼€å®ƒå¹¶é…ç½® `keyProperty` åŠ `keyColunm` ï¼ˆæ•°æ®åº“è¡¨ä¸­ç¬¬ä¸€åˆ—ä¸æ˜¯ä¸»é”®æ—¶æ‰å¿…é¡»ï¼‰ï¼Œåˆ™æ•°æ®åº“ç”Ÿæˆçš„ä¸»é”®å¯ä»¥**å›å¡«ç»™ç›¸åº”æŒä¹…åŒ–ç±»**ï¼‰

ğŸŒ° ä¾‹å­ï¼šæ·»åŠ ç­çº§ä¿¡æ¯ï¼Œç­çº§åˆ†é…å­¦ç”Ÿä¾‹å­ï¼š

æœ‰ä¸¤ä¸ªè¡¨ï¼š`t_class(class_id, class_name)`ï¼Œ`t_student(student_id, student_name, class_id)` ï¼Œç­çº§è¡¨ä¸å­¦ç”Ÿè¡¨çš„å…³ç³»æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæ‰€ä»¥å­¦ç”Ÿè¡¨æœ‰ç­çº§è¡¨çš„ `id` ä¿¡æ¯ã€‚è¦å®ç°åŠŸèƒ½ï¼š

+ æ·»åŠ ç­çº§ä¿¡æ¯ï¼›
+ è·å–æ–°æ·»åŠ çš„ç­çº§çš„ `id` ï¼›
+ ä»¥ç­çº§åˆ†é…å­¦ç”Ÿï¼Œå³**å°†æŸå­¦ç”Ÿçš„ `id` ä¿®æ”¹ä¸ºæ–°æ·»åŠ çš„ç­çº§çš„ `id`ã€‚**



ğŸŒ° ä¾‹å­ï¼šæ·»åŠ ç”¨æˆ·å¹¶ä¸”è¿”å›ä¸»é”® `id` åˆ°å¯¹è±¡çš„å±æ€§ã€‚

```java
public interface SelectMapper {   
  void insertUser(User user);
}
```

mapper é…ç½® `SelectMapper.xml` ï¼š

```xml
<!--void insertUser(User user);-->
<insert id="insertUser" useGeneratedKeys="true" keyProperty="id">
    insert into user values (null, #{username}, #{password}, #{age}, #{sex}, #{email});
</insert>
```

::: tip

+ `useGenerateKeys`ï¼šè®¾ç½® `true` ä½¿ç”¨è‡ªå¢çš„ä¸»é”®ã€‚

+ `keyProperty`ï¼šå› ä¸ºå¢åˆ æ”¹æœ‰ç»Ÿä¸€çš„**è¿”å›å€¼**ï¼ˆå—å½±å“çš„è¡Œæ•°ï¼‰ï¼Œå› æ­¤åªèƒ½å°†è·å–åˆ°çš„è‡ªå¢çš„ä¸»é”®æ”¾åœ¨**ä¼ è¾“çš„å‚æ•°**ï¼ˆå¦‚ä¸Šä¾‹å­ï¼Œä¸ºå¯¹è±¡ `user` ï¼‰çš„æŸä¸ªå±æ€§ä¸­ï¼ˆå¦‚ä¸Šä¾‹å­ï¼Œè®¾ç½®ä¸º `id`ï¼‰ã€‚

:::

æµ‹è¯•ç±»ï¼š

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab java 

```java
@Test
public void testInsertUser() {
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    SQLMapper mapper = sqlSession.getMapper(SQLMapper.class);
    User user = new User(null, "ç‹äº”", "123456", 23, "ç”·", "123456@qq.com");
    mapper.insertUser(user);
    System.out.println(user);
}
```

:::

::: tab result

```sql
DEBUG 03-04 15:51:30,027 ==>  Preparing: insert into user values (null, ?, ?, ?, ?, ?); (BaseJdbcLogger.java:137) 
DEBUG 03-04 15:51:30,054 ==> Parameters: ç‹äº”(String), 123456(String), 23(Integer), ç”·(String), 123456@qq.com(String) (BaseJdbcLogger.java:137) 
DEBUG 03-04 15:51:30,057 <==    Updates: 1 (BaseJdbcLogger.java:137) 
User{id=6, username='ç‹äº”', password='123456', age=23, sex='ç”·', email='123456@qq.com'}
```

å¯ä»¥çœ‹åˆ°æ‰§è¡Œä¹‹åçš„ `user` å¯¹è±¡çš„å±æ€§ `id` è·å–åˆ°äº†è‡ªå¢çš„ä¸»é”®çš„å€¼ã€‚

:::

::::
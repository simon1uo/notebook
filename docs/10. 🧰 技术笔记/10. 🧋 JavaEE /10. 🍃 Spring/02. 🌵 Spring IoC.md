---
title: ğŸŒµ Spring IoC
date: 2022-03-24 13:28:35
permalink: /pages/a8acd2/
categories: 
  - _pages
  - ğŸ§‹ JavaEE
  - ğŸƒ Spring
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---
## Spring IoC æ¦‚å¿µåŸç†

ğŸŒ° å¼•å…¥ä¾‹å­ï¼š

::: details

+ æœ‰ä¸€ä¸ªæ¥å£ç±» `Person` ï¼š

```java
public interface Person {
    void love();
    String showName();
}
```

+ ä¸¤ä¸ª `Person` çš„å®ç°ç±» `Man` å’Œ `Woman` ï¼Œå‡æœ‰å±æ€§ `name` å’Œ `Person` ç±»å‹çš„ `lover` ï¼š

```java
public class Man implements Person {
    private String name;
    private Person lover;
    
  	@Override
    public void love() {
        System.out.println("He loves " + lover.showName());
    }

    @Override
    public String showName() {
        return name;
    }
}
```

```java
public class Woman implements Person {
    private String name;
    private Person lover;
  
  	@Override
    public void love() {
        System.out.println("She loves " + lover.showName());
    }

    @Override
    public String showName() {
        return name;
    }
}
```

+ åˆ›å»º Spring é…ç½®æ–‡ä»¶ `applicationContext.xml`ï¼Œå®Œæˆä¸¤ä¸ªå®ç°ç±»çš„å®ä¾‹å¯¹è±¡çš„åˆ›å»ºä»¥åŠåˆ†åˆ«æ˜¯äº’ç›¸çš„å±æ€§çš„ä¸€éƒ¨åˆ†ï¼Œå®Œæˆä¾èµ–æ³¨å…¥ã€‚

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="man" class="com.simon.impl.Man">
        <property name="name" value="Jack"/>
        <property name="lover" ref="woman"/>
    </bean>
    <bean id="woman" class="com.simon.impl.Woman">
        <property name="name" value="Rose"/>
        <property name="lover" ref="woman"/>
    </bean>
</beans>
```

+  ç¼–å†™æµ‹è¯•ç±»ï¼Œæµ‹è¯• `love` æ–¹æ³•ï¼š

```java
@Test
public void testPerson(){
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext("applicationContext.xml");
    Man man = applicationContext.getBean("man", Man.class);
    System.out.println(man);
    man.love();
    Woman woman = applicationContext.getBean("woman", Woman.class);
    System.out.println(woman);
    woman.love();
}
```

ä¾‹å­æ€»ç»“ï¼šå¯ä»¥çœ‹å‡ºï¼Œ**ä»æ¥æ²¡æœ‰ä½¿ç”¨ä¸¤ä¸ªå®ç°ç±»ç›´æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡**ï¼Œä»–ä»¬ä¹‹é—´ä¹Ÿæ²¡æœ‰äº§ç”Ÿè€¦åˆå…³ç³»ï¼Œå®Œå…¨é€šè¿‡é…ç½®æ–‡ä»¶ã€Œè½¯ç¼–ç ã€ï¼Œä½¿å¾—ä¸¤ä¸ªç±»ä¹‹é—´å·²ç»å®ç°äº†å½¼æ­¤çš„é“¾æ¥ï¼Œè¿™ä½“ç°äº† Spring çš„å¼ºå¤§ã€‚

:::

ä»å‰é¢çš„ä¾‹å­ä¸­è´¯å½»çš„æ€æƒ³æ­£æ˜¯ ã€Œæ§åˆ¶åè½¬ï¼ˆIoCï¼‰ã€ï¼š

+ IoC ï¼ˆInversion of Controlï¼‰æ§åˆ¶é¥­åº„çš„æ¦‚å¿µï¼šæ§åˆ¶åè½¬æŠŠåˆ›å»ºå¯¹è±¡çš„æƒåˆ©äº¤ç»™å®¹å™¨ï¼Œ**å¯¹è±¡çš„å®åˆ›ä¸å†ç”±è°ƒç”¨è€…æ¥åˆ›å»ºï¼Œè€Œæ˜¯ç”±å®¹å™¨æ¥åˆ›å»ºï¼Œå®¹å™¨ä¼šè´Ÿè´£æ§åˆ¶ç¨‹åºä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯ç”±è°ƒç”¨è€…çš„ç¨‹åºä»£ç ç›´æ¥æ§åˆ¶ã€‚**è¿™æ ·ï¼Œæ§åˆ¶æƒç”±åº”ç”¨ä»£ç è½¬ç§»åˆ°äº†**å®¹å™¨**ï¼Œæ§åˆ¶æƒå‘ç”Ÿäº†åè½¬ï¼Œè¿™å°±æ˜¯æ§åˆ¶åè½¬ã€‚è¿™æ˜¯ Spring æ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³ä¹‹ä¸€ã€‚
+ ä½¿ç”¨ IoC çš„ç›®çš„ï¼š**é™ä½ä»£ç ä¹‹é—´çš„è€¦åˆåº¦**ï¼ˆè§£é™¤ä»£ç ä¸­çš„ä¾èµ–å…³ç³»ï¼‰ã€‚

### Spring ä¾èµ–æ³¨å…¥

+ DIï¼ˆDependency Injectionï¼‰**ä¾èµ–æ³¨å…¥**ï¼šç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ç”±å®¹å™¨åœ¨è¿è¡ŒæœŸå†³å®šï¼Œå½¢è±¡çš„è¯´ï¼Œå³ç”±å®¹å™¨åŠ¨æ€çš„ï¼ˆç¼–è¯‘å‰ä¸ä¼šå»ºç«‹ï¼Œè¿è¡Œæ—¶å»ºç«‹ï¼‰å°†æŸä¸ªä¾èµ–å…³æ¡æ³¨å…¥åˆ°ç»„ä»¶ä¹‹ä¸­ã€‚ï¼ˆä¸æ§åˆ¶åè½¬æ˜¯ä»ä¸¤ä¸ªè§’åº¦æè¿°åŒä¸€ä¸ªæ¦‚å¿µï¼‰
+ ä¾èµ–æ³¨å…¥çš„ç›®çš„å¹¶éä¸ºè½¯ä»¶æ¡ç»Ÿå¸¦æ¥æ›´å¤šåŠŸèƒ½ï¼Œè€Œæ˜¯**ä¸ºäº†æå‡ç»„ä»¶é‡ç”¨çš„é¢‘ç‡ï¼Œå¹¶ä¸ºç³»ç»Ÿæ­å»ºä¸€ä¸ªçµæ´»ã€å¯æ‰©æ‹“å±•å¹³å°ã€‚**é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ç®€å•çš„é…ç½®ï¼Œè€Œæ— éœ€ä»»ä½•ä»£ç å°±å¯æŒ‡å®šç›®æ ‡éœ€è¦çš„èµ„æºï¼Œå®Œæˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„èµ„æºæ¥è‡ªä½•å¤„ï¼Œç”±è°å®ç°ã€‚

+ å½“æŸä¸ªJavaå¯¹è±¡ï¼ˆè°ƒç”¨è€…ï¼‰éœ€è¦è°ƒç”¨å¦ä¸€ä¸ªJavaå¯¹è±¡ï¼ˆè¢«ä¾èµ–å¯¹è±¡ï¼‰çš„æ–¹æ³•æ—¶ï¼Œä¼ ç»Ÿæ–¹å¼æœ‰ï¼š
  + åŸå§‹åšæ³•ï¼šè°ƒç”¨è€…ä¸»åŠ¨åˆ›å»ºè¢«ä¾èµ–å¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨è¢«ä¾èµ–å¯¹è±¡çš„æ–¹æ³•ã€‚ï¼ˆç¡¬ç¼–ç ã€Œè‡ªå·±åˆ¶é€ ã€ï¼‰
  + **ç®€å•å·¥å‚æ¨¡å¼**ï¼šè°ƒç”¨è€…å…ˆæ‰¾åˆ°è¢«ä¾èµ–å¯¹è±¡çš„å·¥å‚ï¼Œç„¶åä¸»åŠ¨é€šè¿‡å·¥å‚å»è·å–è¢«ä¾èµ–å¯¹è±¡ï¼Œæœ€åå†è°ƒç”¨ä¾èµ–å¯¹è±¡çš„æ–¹æ³•ã€‚ï¼ˆè°ƒç”¨ç»„ä»¶éœ€è¦ä¸»åŠ¨é€šè¿‡å·¥å‚å»è·å–æ”¾ä¾èµ–å¯¹è±¡ï¼Œå¸¦æ¥è°ƒç”¨ç»„ä»¶ä¸è¢«ä¾èµ–å¯¹è±¡å·¥å‚çš„ã€Œå·¥å‚åˆ¶é€ ã€ï¼‰
+ ä½¿ç”¨ Spring æ¡†æ¶åï¼Œè°ƒç”¨è€…æ— éœ€ä¸»åŠ¨è»å–è¢«ä¾èµ–å¯¹è±¡ï¼Œè°ƒç”¨è€…åªè¦è¢«åŠ¨æ¥å— Spring å®¹å™¨ä¸ºè°ƒç”¨è€…èµ‹äºˆå³å¯ï¼Œç”±ã€Œ**åŸæ¥çš„ä¸»åŠ¨è·å–å˜æˆäº†è¢«åŠ¨æ¥å—**ã€ã€‚



+ ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼š

  + è®¾å€¼æ³¨å…¥

  + æ„é€ æ³¨å…¥

  + æ¥å£æ³¨å…¥

+ èƒ½æ³¨å…¥çš„ç±»å‹ï¼š
  + åŸºæœ¬ç±»å‹å’Œ String
  + é…ç½®æ–‡ä»¶å·²ç»æ’å…¥çš„ Bean ç±»å‹
  + å¤æ‚ç±»å‹ / é›†åˆç±»å‹



### IoC çš„åº•å±‚å®ç°åŸç†

+ XML è§£æ
+ å·¥å‚æ¨¡å¼
+ åå°„æŠ€æœ¯



ğŸŒ° **å…·ä½“ä¾‹å­è§£é‡Š IoC çš„åŸç†**ï¼š

+ ä½¿ç”¨åŸå§‹æ–¹æ³•å®ç°å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡æ–¹æ³•çš„è°ƒç”¨ï¼Œå…¶ä¸­çš„ä»£ç ä¹‹é—´çš„è€¦åˆåº¦å¤ªé«˜ã€‚

```java
class UserService{
  excute(){
    UserDAO dao = new UserDAO();  
    dao.add();
  } 
}
```

```java
class UserDAO {
	add() {
    // ...
  }
}
```



+ å·¥å‚æ¨¡å¼ï¼šå¦‚ä»¥ä¸‹ä¾‹å­ï¼Œåœ¨ä¸¤ä¸ªç±»ä¸­é—´åˆ›å»ºä¸€ä¸ªå·¥å‚ç±» `UserFactory` å¤„ç†åˆ›å»ºå¯¹è±¡çš„å·¥ä½œï¼Œç›®çš„æ˜¯å‡å°‘ä¸¤ä¸ªç±»ä¹‹é—´çš„è€¦åˆåº¦æœ€ä½é™åº¦ï¼ˆä½¿ç”¨å·¥å‚æ¨¡å¼ä»å­˜åœ¨è€¦åˆåº¦ï¼Œæ²¡æœ‰å®Œå…¨è§£è€¦ï¼‰

```java
class UserService{
  excute(){
    UserDAO dao = UserFactory.getDAO();
    dao.add();
  } 
  
}
```

```java
class UserFactory {
	public static UserDAO getDAO(){
    return new UserDAO();
  }
}
```

```java
class UserDAO {
	add() {
    // ...
  }
}
```



+ åœ¨ IoC ä¸­ï¼Œç»“åˆ XML è§£æã€å·¥å‚æ¨¡å¼ã€åå°„ä¸‰ç§æŠ€æœ¯ï¼š
  + XML è§£æï¼šé…ç½®åˆ›å»ºçš„å¯¹è±¡ã€‚
  + åå°„ï¼šé€šè¿‡å¾—åˆ°ç±»çš„å­—èŠ‚ç æ–‡ä»¶ `.class` ï¼Œç„¶åå¯ä»¥æ“ä½œç±»ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚

ğŸŒ° ä¾‹å­ï¼šä½¿ç”¨ IoC è§£è€¦ï¼šè¿›ä¸€æ­¥é™ä½è€¦åˆåº¦ã€‚

1. ç¬¬ä¸€æ­¥ï¼šXML é…ç½®æ–‡ä»¶ï¼Œé…ç½®åˆ›å»ºçš„å¯¹è±¡ï¼š

```xml
<!--é…ç½®Userå¯¹è±¡çš„åˆ›å»º-->
<bean id="user" class="com.simon.User"/>
```

2. ç¬¬äºŒæ­¥ï¼šç°æœ‰ `UserService` ç±»å’Œ `UserDAO` ç±»ï¼Œåˆ›å»ºå·¥å‚ç±»ï¼ˆè¿ç”¨åå°„æŠ€æœ¯ï¼‰ï¼š

```java
class UserFactory {
  public static UserDAO getDAO(){
		String classValue = "classå±æ€§å€¼"; // 1xmlè§£æ
    Class claszz = Class.forName(classValue);// 2 é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡
    return (UserDAO)clazz.newInstance(); // å®Œæˆåå°„åˆ›å»º
  }
}
```



### IoC æ¥å£

+ IoC çš„æ€æƒ³åŸºäº IoC å®¹å™¨å®Œæˆï¼ŒIoC å®¹å™¨åº•å±‚å°±æ˜¯å¯¹è±¡å·¥å‚ã€‚
+ Spring æä¾› IoC å®¹å™¨å®ç°ä¸¤ç§æ–¹å¼ï¼ˆ**ä¸¤ä¸ªæ¥å£**ï¼‰
  + `BeanFactory`ï¼šIoC å®¹å™¨ä¸­æœ€åŸºæœ¬çš„å®ç°çš„æ–¹å¼ï¼Œæ˜¯ Spring å†…éƒ¨ä¸­ä½¿ç”¨çš„åŸºæœ¬æ¥å£ï¼Œå®ƒè´Ÿè´£é…ç½®ã€åˆ›å»ºã€ç®¡ç† beanï¼Œä¸æä¾›å¼€å‘äººå‘˜è¿›è¡Œä½¿ç”¨ã€‚ï¼ˆ:warning: **åœ¨åŠ è½½é…ç½®æ–‡ä»¶æ—¶ä¸ä¼šåˆ›å»ºå¯¹è±¡**ï¼Œåªæœ‰åœ¨è·å–å¯¹è±¡ï¼ˆæˆ–è€…ä½¿ç”¨å¯¹è±¡ï¼‰æ‰å»åˆ›å»ºå¯¹è±¡ã€‚ï¼‰
  + :star: `ApplicationContext` ï¼šæ˜¯ `BeanFactory` **æ¥å£çš„å­æ¥å£**ï¼Œæä¾›æ›´å¤šæ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸€èˆ¬æä¾›å¼€å‘äººå‘˜è¿›è¡Œä½¿ç”¨ã€‚ï¼ˆ:warning: åŠ è½½é…ç½®æ–‡ä»¶æ—¶å°±ä¼šæŠŠåœ¨é…ç½®æ–‡ä»¶ä¸­çš„å¯¹è±¡è¿›è¡Œåˆ›å»ºï¼‰

â€‹	ï¼ˆè¦ç»“åˆ Web æ¡†æ¶ï¼Œè¦å°†è€—æ—¶è€—èµ„æºçš„å·¥ä½œåœ¨æœåŠ¡å™¨å¯åŠ¨è¿‡ç¨‹ä¸­å°±åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ç”¨æ‰åˆ›å»ºï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹è±¡ï¼Œæ‰€ä»¥åº”å¤šä½¿ç”¨ `ApplicationContext` ï¼‰



+ `BeanFactory` æ¥å£ä¸­çš„å­æ¥å£å’Œå®ç°ç±»ï¼š

  ![image-20220324204226340](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/ErWDXc.png)

  `ConfigurableApplicationContext`ï¼šåŒ…å«ä¸€äº›ç›¸å…³çš„æ‹“å±•åŠŸèƒ½ã€‚

  

+ `Application` æ¥å£ä¸­çš„å­æ¥å£å’Œå®ç°ç±»ï¼š
  ![image-20220324203635894](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/7ZUFYA.png)
  
  + `ClassPathXmlApplicationContext`  ï¼šXML é…ç½®æ–‡ä»¶åœ¨é¡¹ç›®ä¸­ `src` ç›®å½•ä¸‹çš„ç›¸å¯¹è·¯å¾„ï¼ˆå†…éƒ¨è·¯å¾„ï¼‰
  + `FileSystemXmlApplicationContext `ï¼šXML æ–‡ä»¶çš„å®Œæ•´çš„ç»å¯¹è·¯å¾„ 



## Bean ç®¡ç†

Spring å¯ä»¥æŠŠã€Œ**ä¸€åˆ‡ Java å¯¹è±¡**ã€å½“æˆå®¹å™¨é‡Œçš„ beanï¼Œä¸ç®¡æ˜¯ç¨‹åºå‘˜è‡ªå·±ç¼–å†™çš„ï¼Œç¬¬ä¸‰æ–¹æ¡†æ¶æä¾›çš„ï¼Œè¿˜æ˜¯JDKæä¾›çš„ï¼Œå¦‚ `<bean id= "data" class="java.util.Date"/>` è¿™ç§ JDK é‡Œçš„ç±»ï¼Œåœ¨ Spring çœ‹æ¥ä¾ç„¶æ˜¯ä¸€ä¸ªçš„ bean ã€‚

Spring é…ç½® bean æ—¶ï¼Œ`class` å±æ€§çš„å€¼å¿…é¡»æ˜¯ bean å®ç°ç±»çš„**å®Œæ•´ç±»å**ï¼ˆå¿…é¡»å¸¦åŒ…åï¼‰ï¼Œè€Œä¸”ä¸èƒ½æ˜¯æ¥å£ï¼Œ**é™¤éç‰¹æ®Šé…è½½å¦åˆ™ä¹Ÿä¸èƒ½æ˜¯æŠ½è±¡ç±»**ã€‚

Bean ç®¡ç†æŒ‡ IoC çš„å…·ä½“æ“ä½œï¼ŒæŒ‡çš„æ˜¯ä¸¤ä¸ªæ“ä½œï¼š

+ Spring **åˆ›å»ºå¯¹è±¡**
+ Spring **æ³¨å…¥å±æ€§**



å¦‚æœæŠŠ Spring çœ‹åšä¸€ä¸ªå¤§å‹å·¥å‚ï¼Œåˆ™ Spring å®¹å™¨ä¸­çš„ bean å¯¹è±¡å°±æ˜¯è¯¥å·¥å‚çš„äº§å“ã€‚è¦æƒ³ä½¿ç”¨è¿™ä¸ªå·¥å‚ç”Ÿäº§å’Œç®¡ç† bean å¯¹è±¡ï¼Œå°±éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å‘Šè¯‰å®ƒéœ€è¦å“ªäº› bean å¯¹è±¡ï¼Œä»¥åŠéœ€è¦ä½¿ç”¨ä½•ç§æ–¹å¼å°†è¿™äº› bean å¯¹è±¡è£é…åˆ°ä¸€èµ·ã€‚

**Bean ç®¡ç†é…ç½®æœ‰ä¸¤ç§å®ç°æ–¹å¼**ï¼š

+ åŸºäº XML é…ç½®æ–‡ä»¶æ–¹å¼å®ç°
+ åŸºäºæ³¨è§£æ–¹å¼å®ç°



### åŸºäº XML çš„ Bean ç®¡ç†

#### é…ç½®è¯´æ˜

Spring å…¨å±€é…ç½® XML æ–‡ä»¶ç›¸å…³é…ç½®è¯´æ˜ï¼š

![image-20220411170642184](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/yo46d5.png)

+ `<beans>` å…ƒç´ æ˜¯ Spring é…ç½®æ–‡ä»¶çš„æ ¹å…ƒç´ ï¼Œå®ƒæœ‰ä»¥ä¸‹å±æ€§ï¼š

  + `default-autowired` ï¼šæ‰€æœ‰ bean é»˜è®¤çš„è‡ªåŠ¨è£é…è¡Œä¸ºã€‚
  + `default-init-method` ï¼šæ‰€æœ‰ bean é»˜è®¤çš„åˆå§‹åŒ–æ–¹æ³•ã€‚
  + `default-destroy-method`ï¼šæ‰€æœ‰ bean é»˜è®¤çš„å›æ”¶æ–¹æ³•ã€‚

  è¿™äº›å±æ€§å¯ä»¥è®¾ç½®å¯¹æ‰€æœ‰beanèµ·ä½œç”¨çš„é»˜è®¤å€¼ã€‚

+ `<description>` å…ƒç´ æ˜¯ `<beans>` å…ƒç´ çš„ä¸€ä¸ªå¯é€‰çš„å­å…ƒç´ ï¼Œå°±æ˜¯å¯¹è±¡å½“æœŸä¸­æ‰€é…ç½®çš„ `javabean` çš„æè¿°ä¿¡æ¯ã€‚

+ `<import>` å…ƒç´ æ˜¯ `<beans>` å…ƒç´ çš„ä¸€ä¸ªå¯é€‰çš„å­å…ƒç´ ã€‚åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œå¾€å¾€ä¼šåˆ†ä¸ºå¾ˆå¤šä¸åŒçš„åŒ…ï¼Œå¦‚æœé‡è§ä¸º**ä¸åŒçš„åŒ…éƒ½å†™åœ¨ä¸€ä¸ªæ€»çš„é…ç½®æ–‡ä»¶**ä¸­ï¼Œéš¾å…ä¼šé€ æˆé…ç½®æ–‡ä»¶å†…å®¹è‡ƒè‚¿ï¼Œä¸æ˜“é˜…è¯»çš„æƒ…å†µã€‚ä¸ºäº†æ–¹ä¾¿ç®¡ç†åº”ç”¨é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `import` æ¥è§„åˆ’é…ç½®æ–‡ä»¶ï¼Œ**æŠŠé…ç½®æ–‡ä»¶åˆ†æ•£åˆ°å„ä¸ªæ¨¡å—ä¸­**ï¼Œç„¶ååœ¨æ€»çš„é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ `import` å…ƒç´ å¼•å…¥è¿™äº›é…ç½®æ–‡ä»¶ï¼Œå®ƒæœ‰ä»¥ä¸‹å±æ€§ï¼š

  + `resource`ï¼šå¼•å…¥çš„é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚

  ```xml
  <import resource="subconf.xml"/>
  ```

  > Spring ä¸­æä¾›äº†ä¸‰ç§å‰ç¼€æ ‡è®°è¾…åŠ©æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼š
  >
  > + `[classpath:]`ï¼šè¡¨ç¤ºä» `classpath` å¼€å§‹å¯»æ‰¾åé¢çš„èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š`<import resource="classpath:test/subconf.xml"/>`ã€‚
  > + `[classpath*:]`ï¼š è¡¨ç¤ºä¸ä»…ä¼šåœ¨ `classpath` è·¯å¾„ä¸­å»æŸ¥æ‰¾æ–‡ä»¶ï¼Œè¿˜ä¼šåœ¨ç›¸åº”çš„ `jar` ä¸­å»æŸ¥æ‰¾æ–‡ä»¶ã€‚
  > + `file` ï¼šè¡¨ç¤ºä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼å¯»æ‰¾åé¢çš„èµ„æºæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š`<import resource= "file:test/subconf.xml"/>`

+ `<alias>` å…ƒç´ æ˜¯ `<beans>` å…ƒç´ çš„å­å…ƒç´ ï¼Œå¯ä»¥ä¸ºå·²æœ‰çš„ bean **æŒ‡å®šåˆ«å**ï¼Œæœ‰ä»¥ä¸‹å±æ€§ï¼š

  + `name`ï¼šå±æ€§æŒ‡å®šä¸€ä¸ªbeanå®ä¾‹çš„æ ‡è¯†åï¼Œè¡¨æ˜ä¸ºè¯¥ bean å®ä¾‹æŒ‡å®šåˆ«åã€‚
  + `alias`ï¼šæŒ‡å®šçš„åˆ«åã€‚

  å¦‚ä¸‹ä¾‹å­ï¼Œä¸º `p` æŒ‡å®šä¸¤ä¸ªåˆ«åï¼š

  ```xml
  <bean id="p" class= "myj.Person"/>
  <alias name="p" alias="jack"/>
  <alias name="jack" alias="jackee"/>
  ```

  

#### åˆ›å»ºå¯¹è±¡

åŸºäº XML **åˆ›å»ºå¯¹è±¡**ï¼ˆåœ¨ä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ä¸­ï¼ˆä»¥ `bean1.xml` ä¸ºä¾‹ï¼‰ï¼‰ï¼šä½¿ç”¨ `<bean>` æ ‡ç­¾ï¼Œåœ¨æ ‡ç­¾ä¸­**æ·»åŠ å¯¹åº”çš„å±æ€§**å°±å¯ä»¥å®ç°å¯¹è±¡çš„åˆ›å»ºï¼Œæ¯ä¸ª bean å¯¹åº” Spring å®¹å™¨ä¸­ä¸€ä¸ª Java å®ä¾‹ã€‚

```xml
<!--é…ç½®Userå¯¹è±¡çš„åˆ›å»º-->
<bean id="user" class="com.simon.User"/>
```

`<bean>` **æ ‡ç­¾ä¸­å¸¸ç”¨çš„å±æ€§**ï¼š

+ `id` å±æ€§ï¼šç»™åˆ›å»ºçš„å¯¹è±¡åˆ›å»ºå”¯ä¸€çš„æ ‡è¯†ã€‚

+ `class` å±æ€§ï¼šç±»å…¨é™å®šåï¼ˆ**ç±»å…¨è·¯å¾„**ï¼‰ã€‚

+ `name` å±æ€§ï¼ˆäº†è§£ï¼‰ï¼šï¼ˆä¸ `id` çš„ä½œç”¨ä¸€æ ·ï¼‰ï¼Œæ—©æœŸä¸º `Struts` æ¡†æ¶æœåŠ¡ï¼Œç°åœ¨å°‘ç”¨ã€‚



+ åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œé»˜è®¤æ‰§è¡Œ**æ— å‚æ„é€ æ–¹æ³•**ï¼Œå¦‚æœç±»ä¸­æ²¡æœ‰å®šä¹‰æ— å‚æ„é€ æ–¹æ³•ï¼ˆæˆ–è€…ä»…ä»…å­˜åœ¨æœ‰å‚æ„é€ æ–¹æ³•ï¼‰æ—¶ï¼Œè¿è¡Œåˆ›å»ºå¯¹è±¡ä¼šæŠ¥é”™ï¼ˆåˆå§‹åŒ–å¯¹è±¡å¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰æ‰¾åˆ°é»˜è®¤æ„é€  `NoSuchMethodException` ï¼‰ã€‚



**æ³¨å…¥å±æ€§çš„æ–¹æ³•**ï¼ŒåŸºäº XML **æ³¨å…¥å±æ€§**ï¼š

+ `DI` ï¼šä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯æ³¨å…¥å±æ€§ï¼ˆ**éœ€è¦åœ¨åˆ›å»ºå¯¹è±¡çš„åŸºç¡€ä¸Šè¿›è¡Œ**ï¼‰ã€‚
+ `IoC` ä¸ `DI` çš„åŒºåˆ«ï¼š`DI` æ˜¯ `IoC` çš„ä¸€ç§å…·ä½“è¡¨ç°ã€‚

**æœ‰ä¸¤ç§æ³¨å…¥æ–¹æ³•**ï¼š

+ **`Setter` æ–¹æ³•**
+ **æœ‰å‚æ„é€ æ–¹æ³•**



ğŸŒ° :one: ä½¿ç”¨ä¸¤ç§**åŸå§‹ Java æ–¹æ³•**æ³¨å…¥å±æ€§çš„ä¾‹å­ï¼ˆå¼•å…¥ä¾‹å­ï¼‰ï¼š

::: details

+ ç¬¬ä¸€ç§æ³¨å…¥æ–¹å¼ï¼šä½¿ç”¨`set` æ–¹æ³•æ³¨å…¥å±æ€§ï¼š

```java
public class Book {
    private String title;

    public void setTitle(String title) {
        this.title = title;
    }

    public static void main(String[] args) {
        Book book = new Book();
        book.setTitle("BookTitle");
    }
}
```

+ ç¬¬äºŒç§æ³¨å…¥æ–¹æ³•ï¼šä½¿ç”¨**æœ‰å‚æ„é€ æ–¹æ³•**æ³¨å…¥å±æ€§ï¼š

```java
public class Book {
    private String title;

    public Book(String title) {
        this.title = title;
    }

    public static void main(String[] args) {
        Book book = new Book("BookTitle");
    }
}
```

:::



#### è®¾å€¼æ³¨å…¥å±æ€§

è®¾å€¼æ³¨å…¥é€šè¿‡ `<bean>` çš„å…ƒç´   `<property>` å…ƒç´ å®Œæˆè¯¥ bean çš„å±æ€§æ³¨å…¥ï¼Œæœ‰ä»¥ä¸‹å±æ€§ï¼š

+ `name` ï¼šç±»é‡Œé¢çš„å±æ€§çš„åç§°ã€‚

+ `value` ï¼šå‘å±æ€§æ³¨å…¥çš„å€¼ã€‚



ğŸŒ° **è®¾å€¼æ³¨å…¥å±æ€§çš„ä¾‹å­**ï¼š

ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç±»å’Œå®šä¹‰å±æ€§å±æ€§å’Œå±æ€§å¯¹åº”çš„`set` æ–¹æ³•ï¼š

```java
public class Book {
    
    private String title;
    private String author;

    public void setTitle(String title) {
        this.title = title;
    }

    public void setAuthor(String author) {
        this.author = author;
    }
}
```

ç¬¬äºŒæ­¥ï¼šåœ¨ Spring é…ç½®æ–‡ä»¶ä¸­ï¼ˆä»¥ `bean1.xml` ä¸ºä¾‹ï¼‰ï¼Œä½¿ç”¨ `bean` æ ‡ç­¾å®Œæˆå±æ€§æ³¨å…¥ï¼š

```xml
<bean id="book" class="com.simon.Book">
    <property name="author" value="bookAuthor"/>
    <property name="title" value="bookTitle"/>
</bean>
```



ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±» `BookTest` è¿›è¡Œæµ‹è¯•ï¼š

```java
public class BookTest {
    @Test
    public void testBook(){
      // ç¬¬ä¸€æ­¥ï¼šåŠ è½½Springé…ç½®æ–‡ä»¶
      ApplicationContext context = new ClassPathXmlApplicationContext("bean1.xml");
      // ç¬¬äºŒæ­¥ï¼šè·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡ï¼ˆå·²ç»æ³¨å…¥å±æ€§åçš„å¯¹è±¡ï¼‰
      Book book = context.getBean("book", Book.class);
      System.out.println(book);
      book.testBook(); // ä¸ºäº†æµ‹è¯•åˆ›å»ºçš„ä¸€ä¸ªæ–¹æ³•
    }
}
```



#### æœ‰å‚æ„é€ æ³¨å…¥å±æ€§

æœ‰å‚æ„é€ æ³¨å…¥å±æ€§é€šè¿‡ `<bean>` å…ƒç´ çš„å­å…ƒç´  `<constructor-arg>` å®ç°ï¼Œä¸ºè¯¥ bean å®Œæˆæ„é€ æ³¨å…¥ï¼Œå…¶ä¸­çš„å±æ€§ç”¨æ³•ä¸ `<property>` å…ƒç´ ç±»ä¼¼ã€‚

ğŸŒ° **æœ‰å‚æ„é€ æ³¨å…¥å±æ€§ä¾‹å­**ï¼š

ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç±»å’Œå®šä¹‰å±æ€§ï¼Œåˆ›å»ºå±æ€§å¯¹åº”æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ï¼š

```java
public class Orders {
    private String oName;
    private String oAddress;

    public Orders(String oName, String oAddress) {
        this.oName = oName;
        this.oAddress = oAddress;
    }
}
```

ç¬¬äºŒæ­¥ï¼šåœ¨ Spring é…ç½®æ–‡ä»¶ä¸­ï¼ˆä»¥ `bean1.xml` ä¸ºä¾‹ï¼‰ï¼Œä½¿ç”¨ `bean` æ ‡ç­¾å®Œæˆå±æ€§æ³¨å…¥ï¼š

```xml
<bean id="orders" class="com.simon.Orders">
    <constructor-arg name="oName" value="orderName"/>
    <constructor-arg name="oAddress" value="orderAddress"/>
</bean>
```

> ä½¿ç”¨ `constructor-arg` å®Œæˆå±æ€§æ³¨å…¥ï¼š
>
> + `name` ï¼šç±»é‡Œé¢çš„å±æ€§çš„åç§°ï¼ˆæœ‰å‚æ„é€ æ–¹æ³•çš„å‚æ•°åç§°ï¼‰ã€‚
>
> + `value` ï¼šå‘å±æ€§æ³¨å…¥çš„å€¼ã€‚
> + æˆ–è€…é€šè¿‡ `index` å±æ€§ç´¢å¼•æœ‰å‚æ„é€ æ–¹æ³•çš„å‚æ•°ã€‚

ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±» `BookTest` è¿›è¡Œæµ‹è¯•ï¼š

```java
@Test
public void testOrders() {
    // ç¬¬ä¸€æ­¥ï¼šåŠ è½½Springé…ç½®æ–‡ä»¶
    ApplicationContext context = new ClassPathXmlApplicationContext("bean1.xml");
    // ç¬¬äºŒæ­¥ï¼šè·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡
    Orders orders = context.getBean("orders", Orders.class);
    System.out.println(orders);
    orders.testOrders();
}
```



::: tip

è®¾å€¼æ³¨å…¥æ–¹æ³• ä¸ æ„é€ æ³¨å…¥æ–¹æ³• å¯¹æ¯”ï¼š

+ é€šè¿‡è®¾å€¼æ³¨å…¥æ–¹æ³•è®¾å®šçš„ä¾èµ–å…³ç³»æ›´åŠ ç›´è§‚ï¼Œ**å¯¹äºå¤æ‚çš„ä¾èµ–å…³ç³»**ï¼Œå»ºè®®é‡‡ç”¨è®¾ç½®æ³¨å…¥ã€‚**å¯¹äºåœ¨æŸäº›å±æ€§å¯é€‰çš„æƒ…å†µä¸‹**ï¼Œé‡‡ç”¨è®¾å€¼æ›´åŠ åˆé€‚ã€‚
+ **æ„é€ æ³¨å…¥é€‚åˆä¾èµ–å…³ç³»æ— éœ€å˜åŒ–çš„æ³¨å…¥æƒ…å†µ**ï¼Œå…¶ä»–ä¾èµ–å…³ç³»çš„æ³¨å…¥åº”è¯¥è€ƒè™‘é‡‡ç”¨è®¾å€¼æ³¨å…¥çš„æ–¹å¼ã€‚

:::



#### p åç§°ç©ºé—´æ³¨å…¥å±æ€§

ğŸŒ° :four: `p` åç§°ç©ºé—´æ³¨å…¥å±æ€§ï¼Œç®€åŒ–åŸºäº XML é…ç½®æ–¹å¼ï¼ˆ`set` æ–¹æ³•çš„ç®€åŒ– ï¼‰ï¼ˆäº†è§£å³å¯ï¼Œæ¯”è¾ƒå°‘ç”¨ï¼‰ï¼š

::: details

+ ç¬¬ä¸€æ­¥ï¼šæ·»åŠ  `p` åç§°ç©ºé—´åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å¼•å…¥ï¼š

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
```

+ æ³¨å…¥å±æ€§ï¼š

```xml
<bean id="book" class="com.simon.Book" p:author="authorName" p:title="bookTitle" />
```

:::



#### æ³¨å…¥å…¶ä»–ç±»å‹å±æ€§

è®¾ç½®æŸä¸ªå±æ€§ä¸ºå­—é¢é‡ ï¼ˆå›ºå®šå€¼ï¼‰æ—¶ï¼š

+ `null`
+ **å±æ€§å€¼åŒ…å«ç‰¹æ®Šç¬¦å·**



ğŸŒ° **è®¾ç½®æŸä¸ªå±æ€§ä¸º `null` å€¼ä¾‹å­**ï¼š

::: details

+ åœ¨ä¹‹å‰ä½¿ç”¨ `set` æ–¹æ³•æ³¨å…¥å±æ€§çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„ `address` å±æ€§ã€‚
+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­ï¼š

```xml
<!--setæ–¹æ³•æ³¨å…¥å±æ€§-->
<bean id="book" class="com.simon.Book">
    <property name="author" value="bookAuthor"/>
    <property name="title" value="bookTitle"/>
    <!--è®¾ç½®æŸä¸ªå±æ€§ä¸ºnullå€¼çš„æ–¹æ³•-->
    <property name="address">
        <null/>
    </property>
</bean>
```

:::

ğŸŒ° æ³¨å…¥è®¾ç½®çš„å±æ€§å€¼åŒ…å«**ç‰¹æ®Šç¬¦å·**ï¼š

åœ¨è®¾ç½®æ³¨å…¥å±æ€§æˆ–è€…æ„é€ æ³¨å…¥å±æ€§çš„ `value` å±æ€§ä¸­ä¸å¯ä»¥åŠ å…¥ç‰¹æ®Šç¬¦å·ï¼Œå¦‚æœè¦è®¾ç½®å¯ä»¥åˆ©ç”¨ `<property>` çš„å­å…ƒç´  `<value>`ï¼š

+ å°†ç‰¹æ®Šç¬¦å·è½¬ä¹‰
+ æŠŠå¸¦ç‰¹æ®Šç¬¦å·çš„å†…å®¹å†™åˆ° `CDATA` ï¼š

```xml
<!--è®¾ç½®æŸä¸ªå±æ€§åŒ…å«ç‰¹æ®Šç¬¦å·çš„æ–¹æ³•-->
<property name="address">
    <value><![CDATA[<<å—äº¬>>]]></value>
</property>
```





#### æ³¨å…¥å¤–éƒ¨ Bean

æ³¨å…¥å¤–éƒ¨ bean é€šè¿‡ `<property>` æˆ–è€… `<constructor-arg>` å…ƒç´ çš„å­å…ƒç´  `ref` æˆ–è€…å±æ€§ï¼Œä¸ºè¯¥ bean æ³¨å…¥å¤–éƒ¨ bean çš„å€¼ï¼ˆå¼•ç”¨ï¼‰ã€‚  



ğŸŒ° ä¾‹å­ï¼šï¼ˆå®é™…è¿ç”¨ä¸Šé¢çš„æ³¨å…¥å±æ€§çš„æ–¹æ³•ï¼‰

::: details

+ åˆ›å»º `service` ç±»å’Œ `DAO` ç±»ï¼ˆåŒ…æ‹¬ `DAOImpl` ç±»ï¼‰ï¼š

```java
public interface UserDAO {
    public void update();
}
```

```java
public class UserDAOImpl implements UserDAO{
    @Override
    public void update() {
        System.out.println("UserDAO Update()...");
    }
}
```

```java
public class UserService {

    public void add(){
        System.out.println("UserService Add() ...");
    }
}
```

+ åœ¨ `service` ç±»è°ƒç”¨ `DAO` é‡Œé¢çš„æ–¹æ³•ï¼š

1.  ~~ä½¿ç”¨åŸå§‹æ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶ä¸”è°ƒç”¨ï¼ˆæ–¹æ³•ä¸€ï¼‰~~ï¼š

```java
public void add(){
    System.out.println("UserService Add() ...");
    // ä½¿ç”¨åŸå§‹æ–¹å¼åˆ›å»ºå¯¹è±¡å¹¶ä¸”è°ƒç”¨UserDAOä¸­çš„æ–¹æ³•
    UserDAOImpl userDAO = new UserDAOImpl();
    userDAO.update();
}
```

2. åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œå®Œæˆå¤–éƒ¨ `bean` çš„æ³¨å…¥ï¼š

```xml
<!--åˆ›å»ºServiceå’ŒDAOçš„å¯¹è±¡-->
<bean id="userService" class="com.simon.service.UserService">
    <!--æ³¨å…¥userDAOå¯¹è±¡
        *name å±æ€§å€¼ï¼šç±»é‡Œé¢çš„å±æ€§åç§°
        *ref å±æ€§å€¼ï¼šä¸‹é¢åˆ›å»ºçš„userDAOå¯¹è±¡beanæ ‡ç­¾çš„idå€¼ï¼ˆå¼•å…¥å¤–éƒ¨beanï¼‰
    -->
    <property name="userDAO" ref="userDAO"/>
</bean>

<bean id="userDAO" class="com.simon.dao.UserDAOImpl"/>
```

> å¦ä¸€ç§å†™æ³•ï¼š
> ```xml
> <property name="userDAO">
> 	<ref bean="userDAO"/>
> </property>
> ```

3. ç¼–å†™æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š`testAdd()` ï¼š

```java
public class UserServiceTest {
    @Test
    public void testAdd(){
        ApplicationContext context = new ClassPathXmlApplicationContext("bean2/UserServiceBean.xml");

        UserService userService = context.getBean("userService", UserService.class);
        userService.add();
    }
}
```

:::



#### å†…éƒ¨ Bean å’Œçº§è”èµ‹å€¼

`<bean>` å…ƒç´ å¯ä»¥ä½œä¸º `<property>` å…ƒç´ æˆ–è€… `<constructor-arg>` å…ƒç´ çš„å­å…ƒç´ ï¼Œå³åœ¨ä¹‹ä¸­åµŒå¥—å®ç”¨ã€‚åµŒå¥—çš„å†…éƒ¨ bean ä¸èƒ½è¢«å®¹å™¨è·å–ï¼Œæ‰€ä»¥åµŒå¥—çš„å†…éƒ¨ bean ä¸éœ€è¦ `id` å±æ€§ã€‚  

ğŸŒ° ï¼šå†…éƒ¨ Bean ï¼ˆåº”ç”¨äºæ•°æ®åº“çš„å…³ç³»ï¼‰ï¼Œä»¥ä¸€å¯¹å¤šå…³ç³»ä¸ºä¾‹ï¼šéƒ¨é—¨å’Œå‘˜å·¥ï¼ˆä¸€ä¸ªéƒ¨é—¨å¯¹åº”å¤šä¸ªå‘˜å·¥ï¼‰ï¼š

::: details

+ åˆ›å»ºéƒ¨é—¨ç±»å’Œå‘˜å·¥ç±»ï¼Œå‘˜å·¥ä½¿ç”¨å¯¹è±¡è¡¨ç¤ºæ‰€å±çš„éƒ¨é—¨ï¼š

```java
public class Dept {
    private String deptName;

    public void setDeptName(String deptName) {
        this.deptName = deptName;
    }
}
```

```java
public class Emp {
    private String empName;
    private String empGender;
    private Dept dept; // å‘˜å·¥å±äºæŸä¸ªéƒ¨é—¨ï¼Œä½¿ç”¨å¯¹è±¡å½¢å¼è¡¨ç¤º

    public void setDept(Dept dept) {
        this.dept = dept;
    }

    public void setEmpName(String empName) {
        this.empName = empName;
    }

    public void setEmpGender(String empGender) {
        this.empGender = empGender;
    }
}
```

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®å†…éƒ¨ bean æ³¨å…¥ï¼š

```xml
<bean id="emp" class="com.simon.bean.Emp">
    <!--è®¾ç½®ä¸¤ä¸ªæ™®é€šå±æ€§-->
    <property name="empName" value="Simon"/>
    <property name="empGender" value="M"/>

    <!--è®¾ç½®å¯¹è±¡ç±»å‹å±æ€§-->
    <property name="dept">
        <bean id="dept" class="com.simon.bean.Dept">
            <property name="deptName" value="IT"/>
        </bean>
    </property>
</bean>
```

+ ç¼–å†™æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š

```java
public class DeptAndEmpTest {

    @Test
    public void testDeptAndEmp() {
        ApplicationContext context = new ClassPathXmlApplicationContext("bean2/DeptAndEmpBean.xml");

        Emp emp = context.getBean("emp", Emp.class);
        emp.print();
    }
}
```

:::



ğŸŒ° **çº§è”èµ‹å€¼ä¾‹å­**ï¼ˆå»¶ç»­ä¸Šé¢éƒ¨é—¨ä¸å‘˜å·¥çš„ä¾‹å­ï¼‰ï¼š

::: details

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®å®ç°çº§è”èµ‹å€¼ï¼š

ç¬¬ä¸€ç§å†™æ³•ï¼š

```xml
<bean id="emp" class="com.simon.bean.Emp">
    <!--è®¾ç½®ä¸¤ä¸ªæ™®é€šçš„å±æ€§-->
    <property name="empName" value="Simon"/>
    <property name="empGender" value="M"/>
    <!--çº§è”èµ‹å€¼-->
    <property name="dept" ref="dept"/>
</bean>

<bean id="dept" class="com.simon.bean.Dept">
    <property name="deptName" value="è´¢åŠ¡"/>
</bean>
```



ç¬¬äºŒç§å†™æ³•ï¼š

```xml
<bean id="emp2" class="com.simon.bean.Emp">
    <!--è®¾ç½®ä¸¤ä¸ªæ™®é€šçš„å±æ€§-->
    <property name="empName" value="Simon"/>
    <property name="empGender" value="M"/>
    <!--çº§è”èµ‹å€¼-->
    <property name="dept" ref="dept"/>
    <property name="dept.deptName" value="æŠ€æœ¯"/>
</bean>

<bean id="dept" class="com.simon.bean.Dept">
    <property name="deptName" value="è´¢åŠ¡"/>
</bean>
```

:warning: **ç¬¬äºŒç§å†™æ³•ä¸­è¦ç¡®ä¿å®ä½“ç±»çš„å±æ€§ `dept` ï¼ˆè¦å…³è”çš„å±æ€§ï¼‰çš„ `getter` æ–¹æ³•ç”Ÿæˆ**ã€‚

:::



#### æ³¨å…¥é›†åˆå±æ€§

ğŸŒ° å››ç§é›†åˆç±»å‹ï¼ˆæ•°ç»„ã€`List`ã€`Map`ã€`Set`ï¼‰ä¾‹å­ï¼š

::: details

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®å®ç°é›†åˆç±»å‹çš„æ³¨å…¥ï¼š

```xml
<!--é›†åˆç±»å‹å±æ€§æ³¨å…¥-->
<bean id="stu" class="com.simon.bean.Stu">
    <!--æ•°ç»„ç±»å‹å±æ€§æ³¨å…¥-->
    <property name="courses">
        <array>
            <value>Javaè¯¾ç¨‹</value>
            <value>æ•°æ®åº“è¯¾ç¨‹</value>
        </array>
    </property>

    <!--Listé›†åˆç±»å‹å±æ€§æ³¨å…¥-->
    <property name="list">
        <list>
            <value>listValue1</value>
            <value>listValue2</value>
        </list>
    </property>

    <!--Mapç±»å‹å±æ€§æ³¨å…¥
           æ³¨æ„ mapçš„é”®å€¼è¦ç”¨entryæ ‡ç­¾
    -->
    <property name="maps">
        <map>
            <entry key="mapKey1" value="mapValue1"/>
            <entry key="mapKey2" value="mapValue2"/>
        </map>
    </property>

    <!--Setç±»å‹å±æ€§æ³¨å…¥-->
    <property name="sets">
        <set>
            <value>setValue1</value>
            <value>setValue2</value>
            <value>setValue3</value>
        </set>
    </property>
</bean>
```

+ ç¼–å†™æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š

```java
public class StuTest {

    @Test
    public void TestStuBean(){
        ApplicationContext context = new ClassPathXmlApplicationContext("StuBean.xml");
        Stu stu = context.getBean("stu", Stu.class);
        stu.print();
    }
}
```

:::

::: tip 

**æ³¨å…¥é›†åˆç±»å‹çš„ç»†èŠ‚é—®é¢˜**ï¼š

+ å½“é›†åˆä¸­è®¾ç½®çš„å¯¹è±¡ç±»å‹å€¼ï¼š

ğŸŒ° ä¾‹å­ï¼šå­¦ç”Ÿå­¦ä¹ å¤šé—¨çš„è¯¾ç¨‹ä½œä¸ºå­¦ç”Ÿçš„å±æ€§ï¼Œ`List` é›†åˆçš„å€¼ä¸º `Course` ç±»ä¸­çš„å¯¹è±¡ï¼š

::: details 

+ åˆ›å»ºæ–°çš„ `Course` ç±»ï¼š

```java
public class Course {
    // è¯¾ç¨‹åç§°
    private String courseName;

    public void setCourseName(String courseName) {
        this.courseName = courseName;
    }
}
```

+ åœ¨å­¦ç”Ÿç±» `Stu` ä¸­æ·»åŠ å±æ€§ `CourseList` ï¼š

```java
public class Stu{
  private List<Course> courseList;
  
  public void setCourseList(List<Course> courseList) {   
    this.courseList = courseList;
  }
}
```

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®æ³¨å…¥ï¼š

```xml
<bean id="stu" class="com.simon.bean.Stu">
  <!-- æ³¨å…¥Listçš„é›†åˆç±»å‹ï¼Œå€¼æ˜¯å¯¹è±¡-->
  <property name="courseList">
    <list>
      <ref bean="course1"/>
      <ref bean="course2"/>
    </list>
  </property>
</bean>
```

è¦è®¾ç½® `List` é›†åˆä¸­çš„å€¼æ˜¯å¯¹è±¡ï¼Œå¯ä»¥åˆ›å»ºä¸‹é¢çš„å¯¹è±¡ï¼š

```xml
<!--åˆ›å»ºå¤šä¸ªcourseå¯¹è±¡-->
<bean id="course1" class="com.simon.bean.Course">
    <property name="courseName" value="Spring5"/>
</bean>

<bean id="course2" class="com.simon.bean.Course">
    <property name="courseName" value="MyBatis"/>
</bean>
```

:::



+ æŠŠ**é›†åˆæ³¨å…¥éƒ¨åˆ†**æå–å‡ºæ¥**ä½œä¸ºå…¬å…±éƒ¨åˆ†**ï¼š

ğŸŒ° ä¾‹å­ï¼š

+ åˆ›å»ºæ–°çš„ç±» `Book` ï¼š

```java
public class Book {

    private List<String> bookList;

    public void setBookList(List<String> bookList) {
        this.bookList = bookList;
    }

    public void print(){
        System.out.println(bookList);
    }
}
```

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å¼•å…¥åç§°ç©ºé—´ `util`ï¼šï¼ˆæ·»åŠ  `xmlns:util` ä»¥åŠåœ¨ `xsi:schemaLocation` ç›¸å…³å†…å®¹ï¼‰ï¼š

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
```

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æå–å±æ€§æ³¨å…¥ï¼š

```xml
<!--æå–Listé›†åˆç±»å‹å±æ€§æ³¨å…¥-->
<util:list id="bookList">
    <value>SpringBoot</value>
    <value>SpringMVC</value>
    <value>MyBatis</value>
    <!--<ref>å¯ä»¥æ˜¯å¯¹è±¡</ref>-->
</util:list>

<bean id="book" class="com.simon.bean.Book">
    <property name="bookList" ref="bookList"/>
</bean>
```

+ ç¼–å†™æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š

```java
public class BookTest {
    @Test
    public void TestBookBean(){
        ApplicationContext context = new ClassPathXmlApplicationContext("BookBean.xml");
        Book book = context.getBean("book", Book.class);
        book.print();
    }
}
```

:::



####  è‡ªåŠ¨è£…é…

+ è‡ªåŠ¨è£…é…ï¼ˆè‡ªåŠ¨å®Œæˆå±æ€§æ³¨å…¥ï¼‰ï¼šæ ¹æ®æŒ‡å®šçš„è£…é…è§„åˆ™ï¼ˆå±æ€§åç§°æˆ–è€…å±æ€§ç±»å‹ï¼‰ï¼ŒSpring è‡ªåŠ¨å°†åŒ¹é…çš„å±æ€§å€¼è¿›è¡Œæ³¨å…¥ã€‚

+ åœ¨ `bean` æ ‡ç­¾å±æ€§ `autowire` ä¸­é…ç½®è‡ªåŠ¨è£…é…ï¼Œå¸¸ç”¨å±æ€§å€¼æœ‰ï¼š
  + `byName` ï¼šæ ¹æ®**å±æ€§åç§°**æ³¨å…¥ï¼Œç‰¹ç‚¹ï¼šè¦æ³¨å…¥å€¼ `bean` çš„ `id` å€¼è¦ä¸ç±»å±æ€§åç§°ä¸€æ ·ã€‚
  + `byType`ï¼šæ ¹æ®**å±æ€§ç±»å‹**æ³¨å…¥ã€‚:warning: è¦æ³¨æ„ç›¸åŒç±»å‹çš„ `bean` ä¸èƒ½åˆ›å»ºå¤šä¸ªï¼Œå¦åˆ™ `bean` æ— æ³•è¯†åˆ«ï¼Œæ­¤æ—¶æœ€å¥½ä½¿ç”¨æ ¹æ®åç§°æ³¨å…¥ã€‚

ï¼ˆè‡ªåŠ¨è£…é…ä¸€èˆ¬é€šè¿‡æ³¨è§£æ–¹æ³•å®ç°ï¼‰

ğŸŒ° è‡ªåŠ¨è£…é…çš„è¿‡ç¨‹ä¾‹å­ï¼š
::: details

+ æœ‰ä¸¤ä¸ªç±» `Emp` å’Œ `Dept` ï¼Œå¯¹åº”çš„å…³ç³»å¦‚ä¸‹ï¼š

```java
public class Emp {
    private Dept dept;

    public Dept getDept() {
        return dept;
    }

    public void setDept(Dept dept) {
        this.dept = dept;
    }
}
```

```java
public class Dept {
    @Override
    public String toString() {
        return "Dept{}";
    }
}
```

+ æ ¹æ®å±æ€§åç§°è‡ªåŠ¨è£…é…ï¼š

```xml
<bean id="emp" class="com.simon.autowire.Emp" autowire="byName"/>

<bean id="dept" class="com.simon.autowire.Dept"/>
```

+ æ ¹æ®å±æ€§ç±»å‹è‡ªåŠ¨è£…é…ï¼š

```xml
<bean id="emp" class="com.simon.autowire.Emp" autowire="byType"/>

<bean id="dept" class="com.simon.autowire.Dept"/>
```

::: 



#### å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶

åº”ç”¨åœºæ™¯ï¼š**ä»¥é…ç½®æ•°æ®åº“ä¿¡æ¯ä¸ºä¾‹**ï¼šï¼ˆå½“ä¸€ä¸ª bean ä¸­çš„å±æ€§ä¸å€¼æœ‰å¾ˆå¤šï¼‰

ğŸŒ° ä¾‹å­ï¼š**é€šè¿‡å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶é…ç½®æ•°æ®åº“è¿æ¥æ± **ï¼š

::: details

+ åˆ›å»ºå¤–éƒ¨å±æ€§æ–‡ä»¶ `properties` æ ¼å¼çš„æ–‡ä»¶ï¼ˆä»¥ `jdbc.properties` ä¸ºä¾‹ï¼‰ï¼Œå†™å…¥æ•°æ®åº“çš„ç›¸å…³ä¿¡æ¯ï¼š

```properties
jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/javaeeTest?useUnicode=true&characterEncoding=utf8
jdbc.username=root
jdbc.password=root
```

+ æŠŠå¤–éƒ¨ `properties` å±æ€§æ–‡ä»¶å¼•å…¥åˆ° Spring é…ç½®æ–‡ä»¶ï¼šå¼•å…¥ `context` åç§°ç©ºé—´ï¼š

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context  http://www.springframework.org/schema/context/spring-context.xsd">
```

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ï¼š

```xml
<context:property-placeholder location="jdbc.properties"/>

<bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource">
    <property name="driverClassName" value="${jdbc.driver}"/>
    <property name="url" value="${jdbc.url}"/>
    <property name="username" value="${jdbc.username}"/>
    <property name="password" value="${jdbc.password}"/>
</bean>
```

:::





### FactoryBean

+ åœ¨ Spring ä¸­æœ‰ä¸¤ç§ç±»å‹çš„ Beanï¼Œä¸€ç§ä¸ºæ™®é€š Beanï¼ˆè¿„ä»Šæåˆ°çš„ä¾‹å­ï¼‰ï¼Œå¦ä¸€ç§ä¸ºå·¥å‚ Bean ï¼ˆFactoryBeanï¼‰ã€‚
  + æ™®é€š Bean çš„ç‰¹ç‚¹ï¼šåœ¨ Bean ä¸­å®šä¹‰çš„ `bean` çš„ `class` ç±»å‹è¿”å›çš„å°±æ˜¯æ­¤ç±»å‹ã€‚
  + å·¥å‚ Bean çš„ç‰¹ç‚¹ï¼šåœ¨ Bean ä¸­å®šä¹‰çš„ `bean` çš„ç±»å‹å’Œè¿”å›çš„ç±»å‹å¯ä»¥æ˜¯ä¸ä¸€æ ·çš„ã€‚



ğŸŒ° ä¾‹å­ï¼šï¼ˆå·¥å‚ Bean çš„æ¦‚å¿µå®ä¾‹ï¼‰ï¼š

::: details

+ åˆ›å»ºä¸€ä¸ªç±»ï¼Œè®©è¿™ä¸ªç±»ç§°ä¸ºå·¥å‚ Beanï¼Œè¦å®ç°æ¥å£ `FactoryBean` ï¼Œå®ç° `FactoryBean` æ¥å£é‡Œé¢çš„æ–¹æ³•ï¼Œåœ¨å®ç°çš„æ–¹æ³•ä¸­å®šä¹‰è¿”å›çš„ Bean ç±»å‹ã€‚

```java
public class MyBean implements FactoryBean<Course> {

    // å®šä¹‰è¿”å›beançš„ç±»å‹
    @Override
    public Course getObject() throws Exception {
        Course course = new Course();
        course.setCourseName("MyBatis");
        return course;
    }

    @Override
    public Class<?> getObjectType() {
        return null;
    }

    @Override
    public boolean isSingleton() {
        return FactoryBean.super.isSingleton();
    }

}
```

+ åœ¨ Spring çš„é…ç½®ï¼š

```xml
<bean id="myBean" class="com.simon.factorybean.MyBean">
</bean>
```

+ ç¼–å†™æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š

```java
public class MyBeanTest {
    @Test
    public void TestMyBean(){
        ApplicationContext context = new ClassPathXmlApplicationContext("MyBean.xml");
        Course myBean = context.getBean("myBean", Course.class); // æ­¤å¤„è¿”å›çš„ç±»å‹ä¸ºCourse
        System.out.println(myBean);
    }
}
```

::: 



### Bean çš„ä½œç”¨åŸŸ

ä»æœ¬è´¨ä¸Šæ¥çœ‹ï¼ŒSpring å®¹å™¨å°±æ˜¯ä¸€ä¸ªè¶…çº§å¤§å·¥å‚ï¼ŒSpring å®¹å™¨ä¸­çš„ bean çš„å®ä¾‹å°±æ˜¯è¯¥å·¥å‚çš„äº§å“ï¼Œè¿™äº›å®ä¾‹å¯ä»¥åˆ†æˆå•ä¾‹å¯¹è±¡å’Œå¤šä¾‹å¯¹è±¡ï¼š

+ å•ä¾‹å¯¹è±¡ï¼šå½“å®¹å™¨åˆ›å»ºæ—¶å¯¹è±¡å‡ºç”Ÿï¼Œåªè¦å®¹å™¨åœ¨å¯¹è±¡å°±ä¸€ç›´å­˜æ´»ç€ï¼Œå®¹å™¨é”€æ¯æ—¶å¯¹è±¡æ¶ˆäº¡ã€‚
+ å¤šä¾‹å¯¹è±¡ï¼šä½¿ç”¨å¯¹è±¡æ—¶äº§ç”Ÿï¼Œå¯¹è±¡åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å°±ä¸€ç›´å­˜æ´»ç€ï¼Œå½“å¯¹è±¡é•¿æœŸä¸ç”¨å¹¶ä¸”ä¹Ÿæ²¡æœ‰å…¶å®ƒå¯¹è±¡å¼•ç”¨æ—¶ï¼Œå°†ç”±Javaåƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚

Bean çš„ä½œç”¨åŸŸ `scope` ï¼š

+ åœ¨ Spring ä¸­ï¼Œåˆ›å»ºçš„ Bean å®ä¾‹**å¯ä»¥æ˜¯å•å®ä¾‹æˆ–è€…æ˜¯å¤šå®ä¾‹ã€‚**
+ åœ¨ Spring ä¸­ï¼Œ**é»˜è®¤åˆ›å»ºçš„ Bean å®ä¾‹æ˜¯å•å®ä¾‹å¯¹è±¡**ã€‚



ğŸŒ° å•å®ä¾‹å¯¹è±¡ä¾‹å­ï¼š

::: details

+ å¯ä»¥é€šè¿‡æ¯”è¾ƒé€šè¿‡ Bean åˆ›å»ºçš„å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼ˆæˆ–è€…åœ°å€å€¼ï¼‰ï¼Œçœ‹æ˜¯å¦åˆ›å»ºçš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚è¯´æ˜æ­¤æ—¶åˆ›å»ºçš„ Bean å®ä¾‹æ˜¯å•å®ä¾‹å¯¹è±¡ã€‚

```java
public class BookTest {
    @Test
    public void TestBookBean(){
        ApplicationContext context = new ClassPathXmlApplicationContext("BookBean.xml");
        Book book1 = context.getBean("book", Book.class);

        Book book2 = context.getBean("book", Book.class);
        System.out.println(book1.hashCode());
        System.out.println(book2.hashCode());
    }
}
```

:::



ğŸŒ° å¦‚ä½•è®¾ç½®å•å®ä¾‹è¿˜æ˜¯å¤šå®ä¾‹ï¼š

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­çš„ `<bean>` æ ‡ç­¾ä¸­æ·»åŠ  `scope` å±æ€§ï¼š

> `scope` å±æ€§çš„ç›¸å…³å±æ€§å€¼ï¼š
>
> + `singleton` ï¼šè¡¨ç¤ºè®¾ç½®æ˜¯å•å®ä¾‹å¯¹è±¡ï¼ˆé»˜è®¤ï¼‰ã€‚
> + `prototype` ï¼šè¡¨ç¤ºè®¾ç½®æ˜¯å¤šå®ä¾‹å¯¹è±¡ã€‚
>
> ***
>
> + è¿˜æœ‰ä¸¤ä¸ªå±æ€§å€¼ `request` å’Œ `session` ã€‚

::: details

```xml
<bean id="book" class="com.simon.bean.Book" scope="prototype">
    <property name="bookList" ref="bookList"/>
</bean>
```

å†æ¬¡è¿è¡Œå…ˆå‰çš„å•å®ä¾‹æµ‹è¯•ä¾‹å­ï¼Œå¯ä»¥å‘ç°ä¸¤æ¬¡åˆ›å»ºçš„å¯¹è±¡çš„å“ˆå¸Œå€¼ä¸ç›¸åŒï¼Œ**è¯´æ˜æ­¤æ—¶åˆ›å»ºçš„ Bean å®ä¾‹æ˜¯å¤šå®ä¾‹å¯¹è±¡**ã€‚

:::

::: warning

:warning: **å•å®ä¾‹ä¸å¤šå®ä¾‹çš„åŒºåˆ«**ï¼š
+ å½“ `scope` çš„å€¼æ˜¯ `singleton` çš„æ—¶å€™ï¼Œ**åŠ è½½ Spring é…ç½®æ–‡ä»¶çš„æ—¶å€™**å°±ä¼šåˆ›å»ºå•å®ä¾‹å¯¹è±¡ã€‚
+ å½“ `scope` çš„å€¼æ˜¯ `prototype`  çš„æ—¶å€™ï¼Œä¸æ˜¯åŠ è½½åœ¨ Spring é…ç½®æ–‡ä»¶æ—¶åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨ `getBean()` æ–¹æ³•æ—¶åˆ›å»ºå¤šå®ä¾‹å¯¹è±¡ã€‚

:::



å…³äº `<lookup-method>` å…ƒç´ ï¼šå½“å•ä¾‹æ¨¡å¼çš„ bean A éœ€è¦å¤šä¾‹æ¨¡å¼çš„ bean B æ³¨å…¥è¿›æ¥ï¼Œä¸ºäº†æ¯æ¬¡å¼•ç”¨æ—¶éƒ½èƒ½æ‹¿åˆ°æœ€æ–°çš„ bean Bï¼Œé€šè¿‡ `<lookup-method>` ä»è€Œèƒ½åœ¨è¿è¡Œæ—¶é€šè¿‡ `getBean(String beanName)` è·å–**æœ€æ–°çš„ bean B å®ä¾‹**ã€‚

ğŸŒ° ä¾‹å¦‚ï¼Œå°†å¤šä¾‹æ¨¡å¼çš„ `PrototypeBean` æ³¨å…¥åˆ°å•ä¾‹æ¨¡å¼çš„ `SingletonBean` ä¸­ï¼š

```java
public class SingletonBean {
  public PrototypeBean getPrototypeBean(){
    return new PrototypeBean();
  }
 
  public void show(){
    System.out.println("SingletonBean's hashCode:" + this.hashCode());
    System.out.println("PrototypeBean's hashCode:" + getPrototypeBean().hashCode());
  }
}
```

ç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼š

```xml
<bean id="prototypeBean" class="com.simon.PrototypeBean" scope="prototype"/>
<bean id="singletonBean" class="com.simon.singletonBean">
	<lookup-method name="getPrototypeBean" bean="prototypeBean"/> 
</bean>
```

æµ‹è¯•ç±»ï¼š

```java
@Test
public void testLookup(){
  SingletonBean singletonBean1 = (SingletonBean) context.getBean("singletonBean");
  SingletonBean singletonBean2 = (SingletonBean) context.getBean("singletonBean");
  singletonBean1.show();
  singletonBean2.show();
}
```



å…³äº `<replaced-method>` å…ƒç´ ï¼šå½“æƒ³æ›¿æ¢æ‰ bean ä¸­çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `<replaced-method>`ï¼š

ğŸŒ° ä¾‹å¦‚ï¼š

```java
public class MyMethod{
  public void show() { System.out.println("my method");}
}
```

```java
public class MyMethodRepalcer implements MethodReplacer {
  public Object reimplement(Object o, Method method, Object[] objects) throws Throwable {
		System.out.println("new method");
    return null;
  }
}
```

åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œæ–¹æ³•æ›¿æ¢ï¼š

```xml
<bean id="mymethod2" class="com.simon.MyMethodRepalcer">
	<bean id="mymethod1" class="com.simon.MyMethod">
  	<replaced-method name="show" replacer="mymethod2"/>
  </bean>	
</bean>
```





### Bean çš„ç”Ÿå‘½å‘¨æœŸ

> ç”Ÿå‘½å‘¨æœŸï¼šä»å¯¹è±¡åˆ›å»ºåˆ°å¯¹è±¡é”€æ¯çš„è¿‡ç¨‹ã€‚

:star: **Bean çš„ç”Ÿå‘½å‘¨æœŸ**ï¼š

1. é€šè¿‡æ„é€ èµ·åˆ›å»º bean çš„å®ä¾‹ï¼ˆæ— å‚æ•°æ„é€ æ–¹æ³•ï¼‰
2. ä¸º bean ä¸­çš„å±æ€§è®¾ç½®å€¼æˆ–è€…å¯¹å…¶ä»– bean çš„å¼•ç”¨ï¼ˆè°ƒç”¨ `set` æ–¹æ³•ï¼‰
3. è°ƒç”¨ bean çš„åˆå§‹åŒ–çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®ï¼‰ã€‚
4. bean æŠ•å…¥ä½¿ç”¨ï¼ˆè·å–åˆ°äº†å¯¹è±¡ï¼‰ã€‚
5. å½“å®¹å™¨å…³é—­æ—¶ï¼Œè°ƒç”¨ bean çš„é”€æ¯æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®é”€æ¯æ–¹æ³•ï¼‰ã€‚



ğŸŒ° ä¾‹å­ï¼ˆç”Ÿå‘½å‘¨æœŸæ­¥éª¤ï¼‰ï¼š

::: details

+ åˆ›å»º `Orders` ç±»ï¼š*ï¼ˆåŒ…å«æ— å‚æ„é€ æ–¹æ³•ï¼ˆBean åˆ›å»ºæ—¶ä½¿ç”¨ï¼‰ï¼Œåˆå§‹åŒ–æ‰§è¡Œçš„æ–¹æ³•å’Œé”€æ¯æ—¶æ‰§è¡Œçš„æ–¹æ³•ï¼‰

```java
public class Orders {

    private String orderName;


    public Orders() {
        System.out.println("ç¬¬ä¸€æ­¥ï¼šæ‰§è¡Œæ— å‚æ•°æ„é€ åˆ›å»ºbeanå®ä¾‹");
    }

    public void setOrderName(String orderName) {
        System.out.println("ç¬¬äºŒæ­¥ï¼šè°ƒç”¨setæ–¹æ³•è®¾ç½®å±æ€§å€¼");
        this.orderName = orderName;

    }

    // åˆ›å»ºæ‰§è¡Œçš„åˆå§‹åŒ–çš„æ–¹æ³•
    public void initMethod(){
        System.out.println("ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œåˆå§‹åŒ–çš„æ–¹æ³•");
    }

    // åˆ›å»ºæ‰§è¡Œçš„é”€æ¯çš„æ–¹æ³•
    public void destroyMethod(){
        System.out.println("ç¬¬äº”æ­¥ï¼šæ‰§è¡Œé”€æ¯çš„æ–¹æ³•çš„æ–¹æ³•");
    }

    @Override
    public String toString() {
        return "Orders{" +
                "orderName='" + orderName + '\'' +
                '}';
    }
}
```

+ Spring ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬è¦é…ç½®åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•ã€‚

```xml
<bean id="order" class="com.simon.bean.Orders" init-method="initMethod" destroy-method="destroyMethod">
    <property name="orderName" value="phone"/>
</bean>
```

+ ç¼–å†™æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š

```java
public class OrderTest {

    @Test
    public void TestOrderBean() {
        // ApplicationContext context = new ClassPathXmlApplicationContext("OrderBean.xml"); // ç”±äºApplicationä¸­æ²¡æœ‰closeæ–¹æ³•ï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒå­æ¥å£ä¸­çš„ç±»å‹ä¸­çš„æ–¹æ³•
        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("OrderBean.xml");
        Orders order = context.getBean("order", Orders.class);
        System.out.println("ç¬¬å››éƒ¨ï¼šè·å–åˆ›å»ºçš„beanå¯¹è±¡");
        System.out.println(order);

        // æ‰‹åŠ¨è®©beanå®ä¾‹é”€æ¯
        context.close();
    }
}
```

:::



**bean çš„åç½®å¤„ç†å™¨**ï¼š

> åŠ ä¸Šåç½®å¤„ç†å™¨åï¼Œ**ç”Ÿå‘½å‘¨æœŸå˜ä¸ºä¸ƒä¸ªæ­¥éª¤**ï¼š
>
> 1. é€šè¿‡æ„é€ èµ·åˆ›å»º bean çš„å®ä¾‹ï¼ˆæ— å‚æ•°æ„é€ æ–¹æ³•ï¼‰
> 2. ä¸º bean ä¸­çš„å±æ€§è®¾ç½®å€¼æˆ–è€…å¯¹å…¶ä»– bean çš„å¼•ç”¨ï¼ˆè°ƒç”¨ `set` æ–¹æ³•ï¼‰
> 3. **æŠŠ bean çš„å®ä¾‹ä¼ é€’ bean åç½®å¤„ç†å™¨çš„æ–¹æ³• `postProcessBeforeInitialization`  ã€‚**
> 4. è°ƒç”¨ bean çš„åˆå§‹åŒ–çš„æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®ï¼‰ã€‚
> 5. **æŠŠ bean å®ä¾‹ä¼ é€’ bean åç½®å¤„ç†å™¨çš„æ–¹æ³• `postProcessAfterInitialization`ã€‚**
> 6. bean æŠ•å…¥ä½¿ç”¨ï¼ˆè·å–åˆ°äº†å¯¹è±¡ï¼‰ã€‚
> 7. å½“å®¹å™¨å…³é—­æ—¶ï¼Œè°ƒç”¨ bean çš„é”€æ¯æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®é”€æ¯æ–¹æ³•ï¼‰ã€‚

ğŸŒ° æ·»åŠ åç½®å¤„ç†å™¨åçš„ä¾‹å­ï¼š

::: details

+ åˆ›å»ºåç½®å¤„ç†å™¨ç±»ï¼Œå®ç°æ¥å£ `BeanPostProcessor`ä¸­çš„æ–¹æ³•ï¼š

```java
public class MyBeanPost implements BeanPostProcessor {

    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("åœ¨åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•");
        return bean;
    }

    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("åœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œçš„æ–¹æ³•");
        return bean;
    }
}
```

+ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½®åç½®å¤„ç†å™¨ï¼Œå½“é…ç½®æ–‡ä»¶è¢«åŠ è½½æ—¶ï¼Œåˆ›å»ºçš„ bean å¯¹è±¡å®ä¾‹éƒ½ä¼šè¢«æ·»åŠ åç½®å¤„ç†å™¨ï¼š

```xml
<!--é…ç½®åç½®å¤„ç†å™¨-->
<!--å†åŠ è½½æœ¬é…ç½®æ–‡ä»¶æ—¶ï¼Œåˆ›å»ºä¸Šé¢çš„beanæ—¶ï¼Œä¸ºä¸Šé¢æ‰€æœ‰çš„beanéƒ½æ·»åŠ åç½®å¤„ç†å™¨-->
<bean id="myBeanPost" class="com.simon.bean.MyBeanPost"/>
```

:::



### åŸºäºæ³¨è§£æ–¹å¼çš„ Bean ç®¡ç†

> æ³¨è§£ï¼šæ˜¯ä»£ç ç‰¹æ®Šæ ‡è®°ï¼Œæ ¼å¼ï¼š `@æ³¨è§£åç§°(å±æ€§åç§°=å±æ€§å€¼, å±æ€§åç§°=å±æ€§å€¼ ...)`ã€‚
>
> æ³¨è§£ä½¿ç”¨çš„ä½ç½®ï¼šæ³¨è§£ä½œç”¨åœ¨ç±»ä¸Šé¢ã€æ–¹æ³•ä¸Šé¢ã€å±æ€§ä¸Šé¢ã€‚
>
> æ³¨è§£ä½¿ç”¨çš„ç›®çš„ï¼šå‡å°‘ XML é…ç½®é‡ã€‚



#### åˆ›å»ºå¯¹è±¡

Spring é’ˆå¯¹ Bean ç®¡ç†ä¸­åˆ›å»ºå¯¹è±¡æä¾›çš„æ³¨è§£æœ‰ï¼š

+ `@Conponent`ï¼š**æ™®é€šæ³¨è§£** 
+ `@Service`ï¼šä¸šåŠ¡é€»è¾‘ç»„ä»¶ç±»ï¼Œä¸šåŠ¡å±‚
+ `@Controller`ï¼šæ§åˆ¶å™¨ç»„ä»¶ç±»ï¼Œè¡¨ç°å±‚
+ `@Repository`  ï¼šDAO ç»„ä»¶ç±»ï¼ŒæŒä¹…åŒ–å±‚

**ï¼ˆä¸Šé¢çš„å››ä¸ªæ³¨è§£åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥ç”¨æ¥åˆ›å»º Bean çš„å®ä¾‹ï¼‰**

ğŸŒ° åŸºäºæ³¨è§£æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼š

::: details 

+ é™¤äº†åœ¨åŸºäº XML ä¸­ä½¿ç”¨åˆ°çš„ Spring ä¾èµ–ï¼Œè¿˜éœ€è¦æ·»åŠ é¢å¤–çš„ä¾èµ–ï¼š

![image-20220328155231274](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/OToRxI.png)

+ **å¼€å¯ç»„ä»¶æ‰«æ**ï¼š

  ï¼ˆè¦æ‰«æå¤šä¸ªåŒ…ä½¿ç”¨`,` éš”å¼€ï¼Œæˆ–è€…ç›´æ¥æ‰«æåŒ…çš„ä¸Šå±‚ç›®å½•ï¼‰

```xml
<!--å¼€å¯ç»„ä»¶æ‰«æ-->
<!--<context:component-scan base-package="com.simon.dao, com.simon.service"/>-->
<context:component-scan base-package="com.simon"/>
```

+ åˆ›å»ºç±»ï¼Œåœ¨ç±»ä¸Šé¢æ·»åŠ å¯¹è±¡æ³¨è§£ï¼š

ç›¸å½“äº` <bean id="userService" class="...">`ï¼Œå¦‚**æœæ³¨è§£ä¸­çš„å€¼çœç•¥ä¸å†™ï¼Œé»˜è®¤å€¼ä¸ºé¦–å­—æ¯å°å†™çš„ç±»åç§°ï¼ˆå¦‚ä¸‹ï¼‰**ã€‚

```java
@Service(value = "userService") 
public class UserService {
    
    public void add(){
        System.out.println("UserService add() ...");
    }
}
```

+ ç¼–å†™æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š

```java
@Test
public void testAdd(){
    ApplicationContext context = new ClassPathXmlApplicationContext("UserBean.xml");
    UserService userService = context.getBean("userService", UserService.class);
    System.out.println(userService);
    userService.add();
}
```

:::



#### ç»„ä»¶æ‰«æé…ç½®

ğŸŒ° ä¾‹å­ï¼šè®¾ç½®åªæ‰«æçš„ç»„ä»¶ï¼š

> ç›¸å…³çš„æ ‡ç­¾å’Œå±æ€§å€¼ï¼š
>
> - `use-defalut-filters="false"` ï¼šè¡¨ç¤ºç°åœ¨ä¸ä½¿ç”¨é»˜è®¤ `filter`ï¼Œè‡ªå·±é…ç½® `filter`ã€‚
>
> - `include-filter` æ ‡ç­¾ä¸­è®¾ç½®æ‰«æå“ªäº›å†…å®¹ã€‚ä¸‹é¢çš„é…ç½®è¡¨ç¤ºåªæ‰«æ `@Controller` çš„æ³¨è§£ã€‚

```xml
<context:component-scan base-package="com.simon" use-default-filters="false">
    <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
</context:component-scan>
```



ğŸŒ° ä¾‹å­ï¼šè®¾ç½®ä¸æ‰«æçš„ç»„ä»¶ï¼š

> - `exclude-filter` æ ‡ç­¾ä¸­è®¾ç½®ä¸æ‰«æå“ªäº›å†…å®¹ã€‚ä¸‹é¢çš„é…ç½®è¡¨ç¤ºä¸æ‰«æ `@Controller` çš„æ³¨è§£ã€‚

```xml
<context:component-scan base-package="com.simon">
    <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
</context:component-scan>
```



#### æ³¨å…¥å±æ€§

åœ¨ Spring ä¸­ä¸å±æ€§æ³¨å…¥ç›¸å…³çš„æ³¨è§£ï¼š

- `@Autowired` ï¼šæ ¹æ®å±æ€§ç±»å‹è¿›è¡Œ**è‡ªåŠ¨è£…é…**ã€‚

- `@Qualifier`ï¼šæ ¹æ®å±æ€§åç§°è¿›è¡Œæ³¨å…¥ï¼Œéœ€è¦å’Œ `@Autowired` ä¸€èµ·ä½¿ç”¨ã€‚

- `@Resource`ï¼šå¯ä»¥**æ ¹æ®ç±»å‹æˆ–è€…åç§°**æ³¨å…¥å±æ€§ã€‚

- `@Value`ï¼šæ ¹æ®æ™®é€šç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼‰æ³¨å…¥å±æ€§ã€‚



 `@Autowired` **è‡ªåŠ¨è£…é…**ï¼šè‡ªåŠ¨æŒ‰ç…§ç±»å‹æ³¨å…¥ã€‚ï¼ˆè¿™ç§æƒ…å†µä¸‹ `set` æ–¹æ³•å¯ä»¥çœç•¥ï¼Œå› ä¸ºå®è´¨ä¸Šæ˜¯åœ¨å®¹å™¨é‡Œå®Œæˆè£…é…çš„ï¼‰åªè¦ IoC å®¹å™¨ä¸­æœ‰å”¯ä¸€çš„ä¸€ä¸ª bean å¯¹è±¡å’Œè¦æ³¨å…¥çš„å˜é‡ç±»å‹åŒ¹é…ï¼Œå°±å¯ä»¥æ³¨å…¥æˆåŠŸã€‚

ğŸŒ° ä¾‹å­ï¼š

::: details

+ ä½¿ç”¨æ³¨è§£æ³•åˆ›å»º `UserService` å’Œ `UserDAO` ç±»çš„å¯¹è±¡ï¼š

```java
public interface UserDao {
    void add();
}
```

```java
@Repository
public class UserDAOImpl implements UserDAO{
    @Override
    public void add() {
        System.out.println("UserDAO add() ... ");
    }
}
```

+ åœ¨ `UserService` ä¸­æ·»åŠ  `UserDAO` ç±»å‹çš„å±æ€§ï¼Œåœ¨å±æ€§ä¸Šä½¿ç”¨æ³¨è§£æ³¨å…¥ `UserDAO`  å¯¹è±¡ï¼Œæ³¨æ„å±æ€§ä¸éœ€è¦ç¼–å†™ `set` æ–¹æ³•

```java
@Service(value = "userService") // ç›¸å½“äº <bean id="userService" class="...">
public class UserService {
    @Autowired // æ ¹æ®ç±»å‹æ³¨å…¥
    private UserDAO userDAO; // ä¸éœ€è¦æ·»åŠ setæ–¹æ³•

    public void add(){
        System.out.println("UserService add() ...");
        userDAO.add();
    }
```

> æ­¤æ—¶ `@Autowired` è‡ªåŠ¨è£…é…æ˜¯æ ¹æ®å±æ€§çš„ç±»å‹è¿›è¡Œæ³¨å…¥çš„ï¼Œå¦‚æœ `UserDAO` çš„å®ç°ç±»ä¸æ­¢ä¸€ä¸ªï¼Œæ¯”å¦‚æ–°å¢ä¸€ä¸ª `UserDAOImpl2` ï¼š
>
> ```java
> @Repository
> public class UserDAOImpl2 implements UserDAO{
>     @Override
>     public void add() {
>         System.out.println("UserDAO2 add() ... ");
>     }
> }
> ```
>
> å†è¿›è¡Œæµ‹è¯•æ—¶ï¼Œç¨‹åºä¼šæŠ¥é”™ï¼š`UnsatisfiedDependencyException`å³*ä¸æ»¡è¶³ä¾èµ–å¼‚å¸¸*ï¼ŒåµŒå¥—å¼‚å¸¸æ˜¯`NoUniqueBeanDefinitionException`å³*Beanå®šä¹‰ä¸å”¯ä¸€å¼‚å¸¸*ï¼Œé¢„æœŸåŒ¹é…å•ä¸ª Bean ä½†æ˜¯æ‰¾åˆ°äº†ä¸¤ä¸ª Beanã€‚è¦å‘æŒ‡å®šè£…é…æŸä¸€ä¸ªå®ç°ç±»ï¼Œå°±éœ€è¦ç”¨åˆ° `@Qualifier` æ³¨è§£ã€‚

:::



 `@Qualifier` ï¼š

æ ¹æ®åç§°æ³¨å…¥ï¼Œæƒ³è¦ä»å¤šä¸ªå®ç°ç±»ä¸­è£…é…å…·ä½“æŸä¸€ä¸ªå®ç°ç±»ï¼Œå¯ä»¥ä½¿ç”¨ `@Qulifier`ï¼š

+ å±æ€§ `value` å€¼ä¸ºå…·ä½“çš„å®ç°ç±»ä¸Šé…ç½®çš„æ³¨è§£ä¸­çš„ `value` å€¼ã€‚

ğŸŒ° ä¾‹å­ï¼š

::: details

+ åœ¨ `UserService` ä¸­çš„ `UserDAO` ç±»å‹å±æ€§ä¸­ä½¿ç”¨ï¼Œå³å¯å°†å®ç°ç±»æŒ‡å®šä¸º `userDAOImpl`ï¼š

```java
@Service(value = "userService") 
public class UserService {
    @Autowired 
    @Qualifier(value = "userDAOImpl")
    private UserDAO userDAO;

    public void add(){
        System.out.println("UserService add() ...");
        userDAO.add();
    }
}
```



::: warning

+ `@Qulifier` æ³¨è§£è¦è·Ÿ `@Autowired` ä¸€èµ·ä½¿ç”¨ã€‚

+ åœ¨ `@Qulifier` æ³¨è§£ä¸­çš„ `value` å€¼å¯¹åº”å®ç°ç±»ä¸­ `@Repository`  æ³¨è§£çš„å±æ€§å€¼ï¼ˆå¦‚æœæ²¡æœ‰é…ç½®åˆ™é»˜è®¤ä¸ºé¦–å­—æ¯å°å†™çš„ç±»åï¼‰ï¼Œå½“æŒ‡å®šåç§°æœ‰è¯¯ï¼Œå³ä¸å­˜åœ¨åç§°å¯¹åº”çš„ç±»ï¼Œåˆ™ä¼šæŠ›å‡ºæ‰¾ä¸åˆ°å¯¹åº”ç±»çš„å¼‚å¸¸ã€‚

:::

::: 



`@Resource` ï¼šæ—¢å¯ä»¥æ ¹æ®ç±»å‹ä¹Ÿå¯ä»¥æ ¹æ®åç§°æ³¨å…¥ã€‚

ğŸŒ° ä¾‹å­ï¼š
::: details 

+ æ ¹æ®ç±»å‹æ³¨å…¥ï¼š

```java
@Resource
private UserDao userDao;
```

+ æ ¹æ®åç§°æ³¨å…¥

```java
@Resource(name = "userDaoImpl")
private UserDao userDao;
```

:::

::: tip

ç”±äº `@Resource` æ³¨è§£æ‰€åœ¨çš„åŒ…ä¸º `javax.annotation` å³ Java æ‰©å±•åŒ…ï¼Œæ‰€ä»¥ Spring å®˜æ–¹ä¸å»ºè®®ä½¿ç”¨è¯¥æ³¨è§£è€Œæ¨èä½¿ç”¨ `@Autowired` å’Œ `@Qualifier` æ³¨è§£ã€‚

> å¸¸ç”¨çš„æ³¨è§£åœ¨ `org.springframework.steotype` åŒ…ä¸‹ã€‚

:::



`@Value` 

ä¸Šè¿°æåˆ°çš„æ³¨è§£éƒ½æ˜¯å¯¹**å¯¹è±¡ç±»å‹çš„å±æ€§**è¿›è¡Œæ³¨å…¥ï¼Œè¦è£…é…æ™®é€šç±»å‹é¢çš„å±æ€§ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹åŠå…¶åŒ…è£…ç±»ï¼Œå¯ä»¥ä½¿ç”¨ `@Value` æ³¨è§£ï¼š

ğŸŒ° ä¾‹å­ï¼š

::: details 

```java
@Value(value = "Simon")
private String name;
@Value(value = "23")
private Integer age;
@Value(value = "200.0d")
private Double length;
@Value(value = "true")
private boolean isOk;
@Value(value = "0,a,3,6,test")
private String[] arrs;
```

:::



#### å®Œå…¨ä½¿ç”¨æ³¨è§£å¼€å‘

+ åˆ›å»ºé…ç½®ç±»ï¼ˆğŸŒ° ä¾‹å¦‚ä¸‹é¢çš„ `SpringConfig`  ç±»ï¼‰ï¼Œæ›¿ä»£ XML é…ç½®æ–‡ä»¶ï¼šï¼ˆä½¿ç”¨æ³¨è§£ `@Configuration` å’Œ `@ComponentScan(â€¦)` ï¼‰

```java
@Configuration
@ComponentScan(basePackages = "com.simon.annotation")
public class SpringConfig {
}
```

+ æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ï¼š

```java
public class UserServiceTest {
    @Test
    public void testAdd(){
      // ApplicationContext context = new ClassPathXmlApplicationContext("UserBean.xml");
        ApplicationContext context = new AnnotationConfigApplicationContext(SpringConfig.class);
        UserService userService = context.getBean("userService", UserService.class);
        System.out.println(userService);
        userService.add();
    }
}
```

ä¸ä¹‹å‰çš„ä¸åŒç‚¹å°±æ˜¯ç”¨ `AnnotationConfigApplicationContext` ä»£æ›¿äº† `ClassPathXmlApplicationContext` å¯¹è±¡ã€‚

---
title:  ğŸ¤– ç”¨æˆ·ç®¡ç†æ¨¡ç‰ˆ
date: 2022-05-12 15:54:09
permalink: /pages/601e96/
categories:
  -  ğŸ“® é¡¹ç›®æ–‡æ¡£å­˜æ¡£
tags:
  - 
---
### æ¶‰åŠé…ç½®ä¸æ’ä»¶



+ MyBatisPlusX

+ apache `commons-lang3`
+ GenerateAllSetter ï¼š ä¸€ä»¶è°ƒç”¨å¯¹è±¡çš„æ‰€æœ‰ `set` æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹å¯¹è±¡æ—¶ã€‚
+ Auto filling Java call arguments ï¼šè‡ªåŠ¨å¡«å…… Java è°ƒç”¨å‡½æ•°æ—¶å‚æ•°
+ GenerateSerialVersionUIDï¼š ç”Ÿæˆåºåˆ—åŒ– id



## æ³¨å†ŒåŠŸèƒ½



## ç™»å½•åŠŸèƒ½

### ç™»å½•é€»è¾‘

+ ä¸»è¦æ€è·¯ï¼š
  1. éªŒè¯ç™»å½•ä¿¡æ¯ï¼šè´¦æˆ·ã€å¯†ç æ˜¯å¦ç¬¦åˆè§„åˆ™ã€‚
  2. å¯†ç åŠ å¯†
  3. æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
  4. ç”¨æˆ·è„±æ•ï¼ˆå°†ç”¨æˆ·ä¸æ•æ„Ÿçš„ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„ç”¨æˆ·å®ä¾‹å¯¹è±¡ï¼‰
  5. åœ¨ session ä¸­ä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€





+ è§£å†³ **ç”¨æˆ·å¦‚æœå¤„äºè¢«åˆ é™¤åçš„çŠ¶æ€** èƒ½å¦è¢«æŸ¥è¯¢ã€‚

  å‚è€ƒ MyBatisPlus æ–‡æ¡£ä¸­ [é€»è¾‘åˆ é™¤ | MyBatis-Plus (baomidou.com)](https://baomidou.com/pages/6b03c5/)ï¼Œé»˜è®¤æŸ¥è¯¢æ²¡æœ‰è¢«åˆ é™¤çš„ç”¨æˆ·ã€‚

  

  1. åœ¨ SpringBoot é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸Šç›¸å…³çš„é…ç½®ï¼š

     ```yml
     global-config:
         db-config:
           logic-delete-field: isDelete # å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå(since 3.3.0,é…ç½®åå¯ä»¥å¿½ç•¥ä¸é…ç½®æ­¥éª¤2)
           logic-delete-value: 1 # é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)
           logic-not-delete-value: 0 # é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)
     ```

  2. åœ¨ç›¸å…³çš„å®ä½“ç±»ä¸­çš„ç›¸å…³å­—æ®µä¸Šæ·»åŠ  **æ³¨è§£ `@TableLogic`**

  3. è‡³æ­¤ï¼Œåˆ é™¤åçš„ç”¨æˆ·åœ¨è¢« `isDelete` å­—æ®µå—å½±å“åä¸ä¼šå†è¢«æŸ¥è¯¢å‡ºæ¥ã€‚



### ç™»å½•æ¥å£



+ å¦‚æœè¦æ¥æ”¶ JSON æ ¼å¼çš„å‚æ•°ï¼Œæœ€å¥½å°è£…ä¸€ä¸ªå¯¹è±¡è®°å½•æ‰€æœ‰çš„è¯·æ±‚å‚æ•°ã€‚

  1. åœ¨ `domain` åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„åŒ… `request` å¤„ç†è¯·æ±‚å‚æ•°ã€‚

  2. ä»¥å¤„ç† **ç”¨æˆ·æ³¨å†Œ** çš„å‚æ•°ä¸ºä¾‹ï¼Œåˆ›å»ºç±» `UserRegisterRequest`ï¼Œåºåˆ—åŒ–å®ç° `Serializable` æ¥å£ã€‚

     > ä¸ºäº†ç”Ÿæˆ åºåˆ—åŒ– UIDï¼šä½¿ç”¨æ’ä»¶ GenerateSerialVersionUIDã€‚

  3. ç¼–å†™è¦æ¥æ”¶çš„å±æ€§ï¼Œæœ€ååœ¨ç±»ä¸Šä½¿ç”¨ lombok çš„`@Data` æ³¨è§£ã€‚



### æµ‹è¯•æ¥å£

åˆ©ç”¨ IDEA ä¸­çš„ HTTP clients å·¥å…·ï¼š
![image-20220512170321468](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/xcK0sK.png)

ğŸŒ° ä¾‹å­ï¼š

![image-20220512185220715](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/W9MlnB.png)



### æ·»åŠ æƒé™é€»è¾‘

å¿…é¡»è¦ **åˆ¤æ–­æƒé™** é™åˆ¶æŸäº›æ¥å£çš„ä½¿ç”¨ä»…ä»…åªèƒ½ **ç®¡ç†å‘˜** ä½¿ç”¨ã€‚

+ åœ¨ç”¨æˆ·è¡¨ä¸­å¢åŠ æ–°çš„å­—æ®µ `userRole` (é»˜è®¤å€¼ä¸º `0`ï¼Œ``0` - æ™®é€šç”¨æˆ·ï¼Œ`1` - ç®¡ç†å‘˜)ã€‚
+ ~~é‡æ–°ä½¿ç”¨ MyBatisX ç”Ÿæˆä»£ç ã€‚~~
+ ~~æ³¨æ„åŸæ¥ `isDelete` å­—æ®µåœ¨å®ä½“ç±»å¤„è¦æ·»åŠ æ³¨è§£ `@TableLogic`~~ã€‚



1. å°è£… **æ ‡è¯†ç”¨æˆ·è§’è‰²ç›¸å…³çš„** å¸¸é‡åˆ°æ¥å£ `UserConstant`ï¼š

   ```java
   public interface UserConstant {
       // ç”¨æˆ·ç™»å½•çŠ¶æ€é”®
       String USER_LOGIN_STATE = "userLoginState";
   
       // ç”¨æˆ·æƒé™åŒºåˆ†
       int DEFAULT_ROLE = 0;
   
       int ADMIN_ROLE = 1;
   }
   ```

2. æ³¨æ„è¦åœ¨ `UserServiceImpl` ä¹‹å‰ä½¿ç”¨è¿‡çš„åœ°æ–¹ä¿®æ”¹å¼•å…¥ã€‚

3. åœ¨ `UserController` ä¸­å°è£…ä¸€ä¸ªåˆ¤æ–­ **æ˜¯å¦ä¸ºç®¡ç†å‘˜** çš„æ–¹æ³•ï¼š

   ```java
   private boolean isAdmin(HttpServletRequest request) {
       Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
       User user = (User) userObj;
       return user != null && user.getUserRole() == ADMIN_ROLE;
   }
   ```

   > å…ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œç„¶åå†åˆ¤æ–­æ˜¯å¦ä¸º **ç®¡ç†å‘˜**ã€‚

4. åœ¨è¦åˆ¤æ–­æƒé™çš„ **æ¥å£** å¤„ï¼Œåœ¨å®Œæˆç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­æƒé™ï¼Œä¾‹å¦‚ **ç”¨æˆ·æœç´¢**ï¼š

   ```java
   @PostMapping("/search")
   public List<User> searchUsers(String username, HttpServletRequest request) {
       if (!isAdmin(request)) return new ArrayList<>();
   
       QueryWrapper<User> queryWrapper = new QueryWrapper<>();
       if (StringUtils.isNotBlank(username)) {
           queryWrapper.like("username", username);
       }
   
       return userService.list(queryWrapper);
   }
   ```



è¿›ä¸€æ­¥é™åˆ¶ ç™»å½• çš„ session å¤±æ•ˆæ—¶é•¿ï¼Œåœ¨ SpringBoot é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š
```yml
session:
    timeout: 86400
```

> è®¾ç½®ä¸ºä¸€å¤©ã€‚



### å°è£…ä¿¡æ¯è„±æ•

æµ‹è¯• **æœç´¢åŠŸèƒ½** åå‘ç°ï¼Œæ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ä¸åº”è¯¥å®Œå…¨æš´éœ²ã€‚æ‰€ä»¥æœ€å¥½è¿˜æ˜¯åœ¨æœç´¢è¿”å›ç»“æœä¹‹å‰è„±æ•ï¼Œä¹‹å‰ **ç™»å½•ç”¨æˆ·** æ—¶ä¹Ÿç”¨åˆ°äº†ç”¨æˆ·ä¿¡æ¯è„±æ•ã€‚æ‰€ä»¥å¯ä»¥å°è£…ä¸ºä¸€ä¸ªæ–¹æ³•ã€‚

```java
@Override
public User getSafetyUser(User sourceUser) {
    // ç”¨æˆ·è„±æ•
    User safetyUser = new User();
    safetyUser.setId(sourceUser.getId());
    safetyUser.setUsername(sourceUser.getUsername());
    safetyUser.setUserAccount(sourceUser.getUserAccount());
    safetyUser.setAvatarUrl(sourceUser.getAvatarUrl());
    safetyUser.setGender(sourceUser.getGender());
    safetyUser.setEmail(sourceUser.getEmail());
    safetyUser.setPhone(sourceUser.getPhone());
    safetyUser.setUserStatus(sourceUser.getUserStatus());
    safetyUser.setCreateTime(sourceUser.getCreateTime());
    safetyUser.setUserRole(sourceUser.getUserRole());

    return safetyUser;
}
```




---
title: ğŸ–‡ MyBatis æ‹“å±•åº”ç”¨
date: 2022-03-09 14:40:56
permalink: /pages/3b8955/
categories: 
  - _pages
  - ğŸ§‹ JavaEE
  - ğŸ—º MyBatis
tags: 
  - MyBatis
author: 
  name: Simon
  link: https://github.com/simon1uo
---



## MyBatis ç¼“å­˜æ‹“å±•

### ç¬¬ä¸‰æ–¹ç¼“å­˜ EHCache



::: tip

é…ç½® EHCache æ­¥éª¤ï¼š

+ å¼•å…¥ EHCache åˆ° maven `pom.xml` ï¼š

```xml
<!-- Mybatis EHCacheæ•´åˆåŒ… -->
<dependency>
    <groupId>org.mybatis.caches</groupId>
    <artifactId>mybatis-ehcache</artifactId>
    <version>1.2.1</version>
</dependency>
<!-- slf4jæ—¥å¿—é—¨é¢çš„ä¸€ä¸ªå…·ä½“å®ç° -->
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
    <version>1.2.3</version>
</dependency>
```

+ åˆ›å»ºé…ç½®æ–‡ä»¶`ehcache.xml`ï¼š

```xml
<?xml version="1.0" encoding="utf-8" ?>
<ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="../config/ehcache.xsd">
    <!-- ç£ç›˜ä¿å­˜è·¯å¾„ -->
    <diskStore path="D:\atguigu\ehcache"/>
    <defaultCache
            maxElementsInMemory="1000"
            maxElementsOnDisk="10000000"
            eternal="false"
            overflowToDisk="true"
            timeToIdleSeconds="120"
            timeToLiveSeconds="120"
            diskExpiryThreadIntervalSeconds="120"
            memoryStoreEvictionPolicy="LRU">
    </defaultCache>
</ehcache>
```

+ åœ¨ `Cache` æ ‡ç­¾ä¸­è®¾ç½®äºŒçº§ç¼“å­˜çš„ç±»å‹ï¼š

```xml
<cache type="org.mybatis.caches.ehcache.EhcacheCache"/>
```

+ åŠ å…¥ **logback** æ—¥å¿—é…ç½®ï¼šç”±äºå­˜åœ¨ slf4jï¼Œç®€æ˜“æ—¥å¿—çš„ log4j å°†ä¼šå¤±æ•ˆï¼Œéœ€è¦å€ŸåŠ© slf4jçš„å…·ä½“å®ç° logback æ‰“å°æ—¥å¿—ã€‚åˆ›å»ºé…ç½®æ–‡ä»¶ `logback.xml` ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration debug="true">
    <!-- æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„ä½ç½® -->
    <appender name="STDOUT"
              class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <!-- æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ -->
            <!-- æŒ‰ç…§é¡ºåºåˆ†åˆ«æ˜¯ï¼šæ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€çº¿ç¨‹åç§°ã€æ‰“å°æ—¥å¿—çš„ç±»ã€æ—¥å¿—ä¸»ä½“å†…å®¹ã€æ¢è¡Œ -->
            <pattern>[%d{HH:mm:ss.SSS}] [%-5level] [%thread] [%logger]
                [%msg]%n
            </pattern>
        </encoder>
    </appender>
    
    <!--è®¾ç½®å…¨å±€æ—¥å¿—çº§åˆ«ã€‚æ—¥å¿—çº§åˆ«æŒ‰é¡ºåºåˆ†åˆ«æ˜¯ï¼šDEBUGã€INFOã€WARNã€ERROR-->
    <!-- æŒ‡å®šä»»ä½•ä¸€ä¸ªæ—¥å¿—çº§åˆ«éƒ½åªæ‰“å°å½“å‰çº§åˆ«å’Œåé¢çº§åˆ«çš„æ—¥å¿—ã€‚ -->
    <root level="DEBUG">
        <!-- æŒ‡å®šæ‰“å°æ—¥å¿—çš„appenderï¼Œè¿™é‡Œé€šè¿‡â€œSTDOUTâ€å¼•ç”¨äº†å‰é¢é…ç½®çš„appender -->
        <appender-ref ref="STDOUT"/>
    </root>
    <!-- æ ¹æ®ç‰¹æ®Šéœ€æ±‚æŒ‡å®šå±€éƒ¨æ—¥å¿—çº§åˆ« -->
    <logger name="com.mybatis.mapper" level="DEBUG"/>
</configuration>
```

::: 



## MyBatis çš„é€†å‘å·¥ç¨‹

> æ­£å‘å·¥ç¨‹ï¼šå…ˆåˆ›å»º Java å®ä½“ç±»ï¼Œç”±æ¡†æ¶è´Ÿè´£æ ¹æ®å®ä½“ç±»ç”Ÿæˆæ•°æ®åº“è¡¨ã€‚ Hibernate æ˜¯æ”¯æŒæ­£å‘å·¥ç¨‹çš„ã€‚
>
> é€†å‘å·¥ç¨‹ï¼šå…ˆåˆ›å»ºæ•°æ®åº“è¡¨ï¼Œç”±æ¡†æ¶è´Ÿè´£æ ¹æ®æ•°æ®åº“è¡¨ï¼Œåå‘ç”Ÿæˆå¦‚ä¸‹èµ„æºï¼š
>
> +  Javaå®ä½“ç±»
> + Mapperæ¥å£
> + Mapperæ˜ å°„æ–‡ä»¶



::: tip

åˆ›å»ºé€†å‘å·¥ç¨‹çš„æ­¥éª¤ï¼š

+ å¼•å…¥ç›¸å…³çš„ maven ä¾èµ–ï¼š`pom.xml` ï¼šåŒ…å« MyBatis æ ¸å¿ƒä»¥åŠæ’ä»¶ **mybatis generator**ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>org.example</groupId>
    <artifactId>demo3</artifactId>
    <version>1.0-SNAPSHOT</version>

    <packaging>jar</packaging>

    <properties>
        <maven.compiler.source>15</maven.compiler.source>
        <maven.compiler.target>15</maven.compiler.target>
    </properties>

    <!-- ä¾èµ–MyBatisæ ¸å¿ƒåŒ… -->
    <dependencies>
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.5.7</version>
        </dependency>
        <!-- junitæµ‹è¯• -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
            <scope>test</scope>
        </dependency>
        <!-- log4j -->
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.17</version>
        </dependency>
    </dependencies>

    <!-- æ§åˆ¶Mavenåœ¨æ„å»ºè¿‡ç¨‹ä¸­ç›¸å…³é…ç½® -->
    <build>
        <!-- æ„å»ºè¿‡ç¨‹ä¸­ç”¨åˆ°çš„æ’ä»¶ -->
        <plugins>
            <!-- å…·ä½“æ’ä»¶ï¼Œé€†å‘å·¥ç¨‹çš„æ“ä½œæ˜¯ä»¥æ„å»ºè¿‡ç¨‹ä¸­æ’ä»¶å½¢å¼å‡ºç°çš„ -->
            <plugin>
                <groupId>org.mybatis.generator</groupId>
                <artifactId>mybatis-generator-maven-plugin</artifactId>
                <version>1.3.0</version>
                <!-- æ’ä»¶çš„ä¾èµ– -->
                <dependencies>
                    <!-- é€†å‘å·¥ç¨‹çš„æ ¸å¿ƒä¾èµ– -->
                    <dependency>
                        <groupId>org.mybatis.generator</groupId>
                        <artifactId>mybatis-generator-core</artifactId>
                        <version>1.3.2</version>
                    </dependency>
                    <!-- æ•°æ®åº“è¿æ¥æ±  -->
                    <dependency>
                        <groupId>com.mchange</groupId>
                        <artifactId>c3p0</artifactId>
                        <version>0.9.2</version>
                    </dependency>
                    <!-- MySQLé©±åŠ¨ -->
                    <dependency>
                        <groupId>mysql</groupId>
                        <artifactId>mysql-connector-java</artifactId>
                        <version>5.1.8</version>
                    </dependency>
                </dependencies>
            </plugin>
        </plugins>
    </build>
</project>
```

+ åˆ›å»ºé…ç½®æ–‡ä»¶ `generatorConfig.xml` ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE generatorConfiguration
        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
<generatorConfiguration>
    <!--
    targetRuntime: æ‰§è¡Œç”Ÿæˆçš„é€†å‘å·¥ç¨‹çš„ç‰ˆæœ¬
    MyBatis3Simple: ç”ŸæˆåŸºæœ¬çš„CRUDï¼ˆæ¸…æ–°ç®€æ´ç‰ˆï¼‰
    MyBatis3: ç”Ÿæˆå¸¦æ¡ä»¶çš„CRUDï¼ˆå¥¢åå°Šäº«ç‰ˆï¼‰
    -->
    <context id="DB2Tables" targetRuntime="MyBatis3Simple">
        <!-- æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ -->
        <jdbcConnection driverClass="com.mysql.jdbc.Driver"
                        connectionURL="jdbc:mysql://localhost:3306/mybatis_demo?useUnicode=true&amp;characterEncoding=utf8"
                        userId="root"
                        password="00000000">
        </jdbcConnection>
        <!-- javaBeançš„ç”Ÿæˆç­–ç•¥-->
        <javaModelGenerator targetPackage="com.mybatis.pojo"
                            targetProject="./src/main/java">
            <property name="enableSubPackages" value="true"/>
            <property name="trimStrings" value="true"/>
        </javaModelGenerator>
        <!-- SQLæ˜ å°„æ–‡ä»¶çš„ç”Ÿæˆç­–ç•¥ -->
        <sqlMapGenerator targetPackage="com.mybatis.mapper"
                         targetProject="./src/main/resources">
            <property name="enableSubPackages" value="true"/>
        </sqlMapGenerator>
        <!-- Mapperæ¥å£çš„ç”Ÿæˆç­–ç•¥ -->
        <javaClientGenerator type="XMLMAPPER"
                             targetPackage="com.mybatis.mapper" targetProject="./src/main/java">
            <property name="enableSubPackages" value="true"/>
        </javaClientGenerator>
        <!-- é€†å‘åˆ†æçš„è¡¨ -->
        <!-- tableNameè®¾ç½®ä¸º*å·ï¼Œå¯ä»¥å¯¹åº”æ‰€æœ‰è¡¨ï¼Œæ­¤æ—¶ä¸å†™domainObjectName -->
        <!-- domainObjectNameå±æ€§æŒ‡å®šç”Ÿæˆå‡ºæ¥çš„å®ä½“ç±»çš„ç±»å -->
        <table tableName="emp" domainObjectName="Emp"/>
        <table tableName="dept" domainObjectName="Dept"/>
    </context>
</generatorConfiguration>
```

::: warning 

`target` è·¯å¾„ä½ç½®å¯èƒ½éœ€è¦æ ¹æ®å®é™…ä¿®æ”¹ `/` æˆ–è€… `\`ã€‚æˆ‘è¿™é‡Œåœ¨ macOS ä¸‹ä½¿ç”¨çš„æ˜¯ `/` ã€‚

:::

+ é€šè¿‡è¿è¡Œæ’ä»¶ **mybatis-generator:generate** å³å¯ç”Ÿæˆç›¸å…³çš„æ–‡ä»¶ã€‚

  <img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/UkXBxh.png" alt="image-20220309152203802" style="zoom:33%;" />





ğŸŒ° ä¾‹å­ï¼šç”¨ç”Ÿæˆåçš„æ˜ å°„è¿›è¡ŒæŸ¥è¯¢ï¼ˆæ¡ä»¶æŸ¥è¯¢ï¼‰ï¼š

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab code

```java
@Test
public void testMBG(){
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);

    /*// æŸ¥è¯¢æ‰€æœ‰æ•°æ®
    List<Emp> emps = mapper.selectByExample(null);
    emps.forEach(emp -> System.out.println(emp));*/

    // æ ¹æ®æ¡ä»¶æŸ¥è¯¢
    EmpExample empExample = new EmpExample();
    empExample.createCriteria().andEmpNameEqualTo("å¼ ä¸‰").andAgeBetween(10,20);
    empExample.or().andDidIsNotNull();
    List<Emp> emps = mapper.selectByExample(empExample);
    emps.forEach(emp -> System.out.println(emp));
}
```

::: 

::: tab result

```sql
DEBUG 03-09 16:14:20,060 ==>  Preparing: select eid, emp_name, age, sex, email, did from emp WHERE ( emp_name = ? and age between ? and ? ) or( did is not null ) (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:14:20,094 ==> Parameters: å¼ ä¸‰(String), 10(Integer), 20(Integer) (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:14:20,127 <==      Total: 5 (BaseJdbcLogger.java:137) 
Emp{eid=1, empName='å¼ ä¸‰', age=20, sex='ç”·', email='123@qq.com', did=1}
Emp{eid=2, empName='æå››', age=18, sex='å¥³', email='455@163.com', did=2}
Emp{eid=3, empName='ç‹äº”', age=18, sex='å¥³', email='455@163.com', did=3}
Emp{eid=4, empName='èµµå…­', age=18, sex='ç”·', email='455@163.com', did=1}
Emp{eid=5, empName='ç”°ä¸ƒ', age=20, sex='å¥³', email='455@163.com', did=2}
```

:::

::::



ğŸŒ° ä¾‹å­ï¼šä¿®æ”¹ä¿¡æ¯

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab code

1. `UpdateByPrimaryKey` ï¼š

```java
@Test
public void testMBG(){
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);
  	mapper.updateByPrimaryKey(new Emp(1, "admin", 22, "å¥³", "456@qq.com", 3));
}
```

:::

::: tab result

```sql
DEBUG 03-09 16:23:28,335 ==>  Preparing: update emp set emp_name = ?, age = ?, sex = ?, email = ?, did = ? where eid = ? (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:23:28,365 ==> Parameters: admin(String), 22(Integer), å¥³(String), 456@qq.com(String), 3(Integer), 1(Integer) (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:23:28,403 <==    Updates: 1 (BaseJdbcLogger.java:137) 
```

:::

::::

:::: tabs cache-lifetime="5" :options="{ useUrlFragment: false }" 

::: tab code

2. `UpdateByPrimaryKeySelective` ï¼š

```java
@Test
public void testMBG(){
    SqlSession sqlSession = SqlSessionUtils.getSqlSession();
    EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);
    mapper.updateByPrimaryKeySelective(new Emp(1, "admin", null, "å¥³", "456@qq.com", 3));
}
```

:::

::: tab result

æ­¤æ—¶ï¼Œä¿®æ”¹çš„å¯¹è±¡ä¸­ï¼Œä¿®æ”¹å€¼æœ‰ `null` æ—¶ï¼Œä¸ä¼šå‡ºç°åœ¨ SQL æ›´æ–°è¯­å¥å½“ä¸­ã€‚

```sql
DEBUG 03-09 16:25:38,120 ==>  Preparing: update emp SET emp_name = ?, sex = ?, email = ?, did = ? where eid = ? (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:25:38,151 ==> Parameters: admin(String), å¥³(String), 456@qq.com(String), 3(Integer), 1(Integer) (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:25:38,155 <==    Updates: 1 (BaseJdbcLogger.java:137) 
```

:::

::::

æ·»åŠ ä¿¡æ¯çš„å®ç°åŸç†ä¸ä¿®æ”¹ä¿¡æ¯åŸç†ç±»ä¼¼ã€‚



## åˆ†é¡µæ’ä»¶



::: tip

é…ç½®åˆ†é¡µæ’ä»¶æ­¥éª¤ï¼š

+ åœ¨ maven ä¸­æ·»åŠ ä¾èµ–ï¼š`pom.xml`ï¼š

```xml
<!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper -->
<dependency>
    <groupId>com.github.pagehelper</groupId>
    <artifactId>pagehelper</artifactId>
    <version>5.2.0</version>
</dependency>
```

+ åœ¨ MyBatis æ ¸å¿ƒé…ç½®ä¸­é…ç½®æ’ä»¶ï¼š

```xml
<plugins>
    <!--è®¾ç½®åˆ†é¡µæ’ä»¶-->
    <plugin interceptor="com.github.pagehelper.PageInterceptor"></plugin>
</plugins>
```

:::



åˆ†é¡µæ’ä»¶çš„ä½¿ç”¨ï¼š

+ éœ€è¦åœ¨æŸ¥è¯¢åŠŸèƒ½ä¹‹å‰ä½¿ç”¨ `PageHelper.startPage(int pageNum, int pageSize)` å¼€å¯åˆ†é¡µåŠŸèƒ½ã€‚
+ åœ¨æŸ¥è¯¢è·å–æ•°æ®åï¼Œä½¿ç”¨ `PageInfo<T> pageInfo = new PageInfo<>(List<T> list, int navigatePages)` è·å–åˆ†é¡µçš„ç›¸å…³æ•°æ®ï¼Œ`list` ä¸ºè¦åˆ†é¡µçš„Pæ•°æ®ã€‚

ğŸŒ° ä¾‹å­ï¼šæŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥ä¿¡æ¯åï¼Œä½¿ç”¨åˆ†é¡µæ’ä»¶è¿›è¡Œå†…å®¹çš„åˆ†é¡µï¼š`Page<Object> page = PageHelper.startPage(2, 4);` è·å–åˆ†é¡µçš„ç›¸å…³æ•°æ®

::: tab code

```java
@Test
    public void testPageHelper() {
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);
//        Page<Object> page = PageHelper.startPage(2, 4);
        PageHelper.startPage(2, 4);
        List<Emp> emps = mapper.selectByExample(null);
        PageInfo<Emp> empPageInfo = new PageInfo<>(emps, 5);// navigatePages ä¸€èˆ¬ä¸ºåŸºæ•°
//        emps.forEach(emp -> System.out.println(emp));
        System.out.println(empPageInfo);
    }
```

::: 

::: tab result

```sql
DEBUG 03-09 16:58:47,635 Cache Hit Ratio [SQL_CACHE]: 0.0 (LoggingCache.java:60) 
DEBUG 03-09 16:58:47,677 ==>  Preparing: SELECT count(0) FROM emp (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:58:47,710 ==> Parameters:  (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:58:47,738 <==      Total: 1 (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:58:47,740 ==>  Preparing: select eid, emp_name, age, sex, email, did from emp LIMIT ?, ? (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:58:47,741 ==> Parameters: 4(Long), 4(Integer) (BaseJdbcLogger.java:137) 
DEBUG 03-09 16:58:47,744 <==      Total: 4 (BaseJdbcLogger.java:137) 
PageInfo{pageNum=2, pageSize=4, size=4, startRow=5, endRow=8, total=14, pages=4, list=Page{count=true, pageNum=2, pageSize=4, startRow=4, endRow=8, total=14, pages=4, reasonable=false, pageSizeZero=false}[Emp{eid=5, empName='ç”°ä¸ƒ', age=20, sex='å¥³', email='455@163.com', did=2}, Emp{eid=9, empName='4', age=null, sex='null', email='null', did=null}, Emp{eid=10, empName='5', age=null, sex='null', email='null', did=null}, Emp{eid=11, empName='6', age=null, sex='null', email='null', did=null}], prePage=1, nextPage=3, isFirstPage=false, isLastPage=false, hasPreviousPage=true, hasNextPage=true, navigatePages=5, navigateFirstPage=1, navigateLastPage=4, navigatepageNums=[1, 2, 3, 4]}
```

:::

> ğŸ”¢ å¸¸ç”¨æ•°æ®ï¼š 
>
> + `pageNum` ï¼šå½“å‰é¡µçš„é¡µç ï¼›
> + `pageSize` ï¼šæ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°ï¼›
> + `size`ï¼šå½“å‰é¡µæ˜¾ç¤ºçš„çœŸå®æ¡æ•°ï¼›
> + `total`ï¼šæ€»è®°å½•æ•°ï¼›
> + `pages` ï¼šæ€»é¡µæ•°ï¼›
> + `prePage` ï¼šä¸Šä¸€é¡µçš„é¡µç ï¼›
> + `nextPage`ï¼šä¸‹ä¸€é¡µçš„é¡µç ï¼›
> + `isFirstPage/isLastPage`ï¼šæ˜¯å¦ä¸ºç¬¬ä¸€é¡µ/æœ€åä¸€é¡µï¼›
> + `hasPreviousPage/hasNextPage`ï¼šæ˜¯å¦å­˜åœ¨ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µï¼›
> + `navigatePage`ï¼šå¯¼èˆªåˆ†é¡µçš„é¡µç æ•°ï¼›
> + `navigatepageNums`ï¼šå¯¼èˆªåˆ†é¡µçš„é¡µç ï¼Œä¾‹å¦‚ï¼š`[1,2,3,4,5]`

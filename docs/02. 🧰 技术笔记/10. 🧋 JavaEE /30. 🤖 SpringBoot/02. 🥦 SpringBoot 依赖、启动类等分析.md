---
title:  ğŸ¥¦ SpringBoot ä¾èµ–ã€å¯åŠ¨ç±»ç­‰åˆ†æ
date: 2022-04-27 17:21:28
permalink: /pages/f914c6/
categories:
  -  ğŸ§° æŠ€æœ¯ç¬”è®°
  -  ğŸ§‹ JavaEE 
  -  ğŸ¤– SpringBoot
tags:
  - 
author: 
  name: Simon
  link: https://github.com/simon1uo
---


## Maven `pom.xml` ä¾èµ–åˆ†æ

SpringBoot Maven é¡¹ç›®ä¸­çš„ä¾èµ–ï¼š

+ çˆ¶ä¾èµ–ï¼šä¸»è¦æ˜¯ä¾èµ–ä¸€ä¸ªçˆ¶é¡¹ç›®ï¼Œä¸»è¦æ˜¯ç®¡ç†é¡¹ç›®çš„èµ„æºè¿‡æ»¤åŠæ’ä»¶ã€‚

  ```xml
  <parent>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-parent</artifactId>
      <version>2.6.7</version>
      <relativePath/> <!-- lookup parent from repository -->
  </parent>
  ```

  å†æ·±ä¸€å±‚ï¼Œè¿˜æœ‰ä¸€ä¸ªçˆ¶ä¾èµ–ï¼šè¿™é‡Œæ‰æ˜¯çœŸæ­£ç®¡ç† SpringBoot åº”ç”¨é‡Œé¢æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬çš„åœ°æ–¹ï¼Œ**SpringBoot çš„ç‰ˆæœ¬æ§åˆ¶ä¸­å¿ƒ**ï¼š

  ```xml
  <parent>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-dependencies</artifactId>
      <version>2.6.7.RELEASE</version>
      <relativePath>../../spring-boot-dependencies</relativePath>
  </parent>
  ```

  

  

+ å¯åŠ¨å™¨ `spring-boot-starter` ç›¸å…³ä¾èµ–ï¼š

  **`springboot-boot-starter-*`**ï¼šå°±æ˜¯ SpringBoot çš„åœºæ™¯å¯åŠ¨å™¨ã€‚ä»¥ `spring-boot-starter-web` ä¸ºä¾‹ï¼Œå¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ã€‚

  ```xml
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
  </dependency>
  ```

  SpringBoot å°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªä¸ªçš„ starter ï¼ˆå¯åŠ¨å™¨ï¼‰ï¼Œåªéœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥è¿™äº› starter å³å¯ï¼Œæ‰€æœ‰ç›¸å…³çš„ä¾èµ–éƒ½ä¼šå¯¼å…¥è¿›æ¥ ï¼Œ **è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±å¯¼å…¥ä»€ä¹ˆæ ·çš„åœºæ™¯å¯åŠ¨å™¨å³å¯** ï¼›æœªæ¥ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ starterã€‚

â€‹	

## SpringBoot ä¸»å¯åŠ¨ç±» `SpringBootApplication`

```java
// @SpringBootApplication æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»
// è¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpringBootåº”ç”¨
@SpringBootApplication
public class SpringbootApplication {
   public static void main(String[] args) {
     // å¯åŠ¨äº†ä¸€ä¸ªæœåŠ¡
      SpringApplication.run(SpringbootApplication.class, args);
   }

}
```



### **æ³¨è§£ç›¸å…³åˆ†æ**

+ `@SpringBootApplication` æ³¨è§£ä½œç”¨ï¼šæ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯ SpringBoot çš„ä¸»é…ç½®ç±» ï¼Œ SpringBoot å°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„ main æ–¹æ³•æ¥å¯åŠ¨ SpringBoot åº”ç”¨ï¼›

  è¿›å…¥ `@SpringBootApplication` ä¸­æŸ¥çœ‹ï¼šæœ‰ç›¸å…³çš„å…¶ä»–æ³¨è§£ï¼š

  ```java
  @SpringBootConfiguration
  @EnableAutoConfiguration
  @ComponentScan(
      excludeFilters = {@Filter(
      type = FilterType.CUSTOM,
      classes = {TypeExcludeFilter.class}
  ), @Filter(
      type = FilterType.CUSTOM,
      classes = {AutoConfigurationExcludeFilter.class}
  )}
  )
  public @interface SpringBootApplication {
      // ......
  }
  ```

  + `@ComponentScan`ï¼šè‡ªåŠ¨æ‰«æå¹¶åŠ è½½ç¬¦åˆæ¡ä»¶çš„ç»„ä»¶æˆ–è€… beanï¼Œ å°†è¿™ä¸ª bean å®šä¹‰åŠ è½½åˆ° IoC å®¹å™¨ä¸­ã€‚

  + `@SpringBootConfiguration` ï¼šSpringBoot çš„é…ç½®ç±» ï¼Œæ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Š ï¼Œ è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª SpringBoot çš„é…ç½®ç±»ï¼›è¿›å…¥ `SpringBootConfiguration` ä¸‹æŸ¥çœ‹ï¼š

    ```java
    @Configuration
    public @interface SpringBootConfiguration {}
    
    @Component
    public @interface Configuration {}
    ```

    è¿™é‡Œå°±æ˜¯ Spring ä¸­å·²ç»å¾ˆç†Ÿæ‚‰çš„ Spring æ³¨è§£é…ç½®ç±»çš„ç›¸å…³æ³¨è§£äº†ã€‚

    + `@Configuration` ï¼š è¯´æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±» ï¼Œé…ç½®ç±»å°±æ˜¯å¯¹åº” Spring çš„ xml é…ç½®æ–‡ä»¶ï¼›
    + `@Component` ï¼š**è¯´æ˜å¯åŠ¨ç±»æœ¬èº«ä¹Ÿæ˜¯ Spring ä¸­çš„ä¸€ä¸ªç»„ä»¶è€Œå·²ï¼Œè´Ÿè´£å¯åŠ¨åº”ç”¨**ã€‚

  + `@EnableAutoConfiguration`ï¼š**å¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½**ã€‚ä»¥å‰éœ€è¦è‡ªå·±é…ç½®çš„ä¸œè¥¿ï¼Œè€Œç°åœ¨ SpringBoot å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®ï¼› `@EnableAutoConfiguration` å‘Šè¯‰ SpringBoot å¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œè¿™æ ·è‡ªåŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼›

    + è¿›å…¥å…¶ä¸­å‘ç°é…ç½® `@AutoConfigurationPackage`ï¼Œ**è‡ªåŠ¨é…ç½®åŒ…**ï¼š

      ```java
      @Import({Registrar.class})
      public @interface AutoConfigurationPackage {
      }
      ```

      `@import` ï¼šSpring åº•å±‚æ³¨è§£ï¼Œ ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ã€‚`Registrar.class` ä½œç”¨ï¼š**å°†ä¸»å¯åŠ¨ç±»çš„æ‰€åœ¨åŒ…åŠåŒ…ä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ° Spring å®¹å™¨** ï¼›

    + `@Import({AutoConfigurationImportSelector.class})` ï¼šç»™å®¹å™¨å¯¼å…¥ç»„ä»¶ï¼Œ`AutoConfigurationImportSelector` ï¼šè‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©å™¨ï¼Œè¿›å…¥è¯¥ç±»æŸ¥çœ‹æºç ï¼Œå‘ç°ä¸€ä¸‹ç±»ï¼š

      ```java
      // è·å¾—å€™é€‰çš„é…ç½®
      protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
          //è¿™é‡Œçš„getSpringFactoriesLoaderFactoryClassï¼ˆï¼‰æ–¹æ³•
          //è¿”å›çš„å°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹çœ‹çš„å¯åŠ¨è‡ªåŠ¨å¯¼å…¥é…ç½®æ–‡ä»¶çš„æ³¨è§£ç±»ï¼›EnableAutoConfiguration
          List<String> configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());
          Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.");
          return configurations;
      }
      ```

      è¿™ä¸ªæ–¹æ³•åˆè°ƒç”¨äº†  `SpringFactoriesLoader` ç±»çš„é™æ€æ–¹æ³•ï¼Œè¿›å…¥ `SpringFactoriesLoader` ç±» `loadFactoryNames()`  æ–¹æ³•ï¼š

      ```java
      public static List<String> loadFactoryNames(Class<?> factoryClass, @Nullable ClassLoader classLoader) {
          String factoryClassName = factoryClass.getName();
          //è¿™é‡Œå®ƒåˆè°ƒç”¨äº† loadSpringFactories æ–¹æ³•
          return (List)loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());
      }
      ```

      ç»§ç»­è¿›å…¥æŸ¥çœ‹ `loadSpringFactories` æ–¹æ³•ï¼š

      â€¦ 

      å‘ç°ä¸€ä¸ªå¤šæ¬¡å‡ºç°çš„æ–‡ä»¶ `spring.factories` ã€‚å…¨å±€æœç´¢è¯¥æ–‡ä»¶å¹¶æ‰“å¼€å¤§ã€‚å…¶ä¸­å‘ç°äº†è®¸å¤šç†Ÿæ‚‰çš„ JavaConfig  é…ç½®ç±»ï¼Œå¹¶ä¸”æ³¨å…¥äº† Beanã€‚



:star: æ€»ç»“ï¼š

+ è‡ªåŠ¨é…ç½®çœŸæ­£å®ç°æ˜¯ä» `classpath` ä¸­æœå¯»æ‰€æœ‰çš„ `META-INF/spring.factories` é…ç½®æ–‡ä»¶ ï¼Œå¹¶å°†å…¶ä¸­å¯¹åº”çš„  `org.springframework.boot.autoconfigure` åŒ…ä¸‹çš„é…ç½®é¡¹ï¼Œé€šè¿‡åå°„å®ä¾‹åŒ–ä¸ºå¯¹åº”æ ‡æ³¨äº† `@Configuration` çš„ JavaConfig å½¢å¼çš„IOCå®¹å™¨é…ç½®ç±» ï¼Œ ç„¶åå°†è¿™äº›éƒ½æ±‡æ€»æˆä¸ºä¸€ä¸ªå®ä¾‹å¹¶åŠ è½½åˆ° IoC å®¹å™¨ä¸­ï¼›
+ å°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥å®¹å™¨ï¼Œ è‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆ ï¼Œ SpringBoot è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œï¼›
+ æ•´ä¸ª J2EE çš„æ•´ä½“è§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®éƒ½åœ¨ `springboot-autoconfigure` çš„ `jar` åŒ…ä¸­ï¼Œå®ƒç»™å®¹å™¨ä¸­å¯¼å…¥éå¸¸å¤šçš„è‡ªåŠ¨é…ç½®ç±» ï¼ˆ`xxxAutoConfiguration`ï¼‰, å°±æ˜¯ç»™å®¹å™¨ä¸­å¯¼å…¥è¿™ä¸ªåœºæ™¯éœ€è¦çš„æ‰€æœ‰ç»„ä»¶ ï¼Œ å¹¶é…ç½®å¥½è¿™äº›ç»„ä»¶ ï¼›
+ æœ‰äº†è‡ªåŠ¨é…ç½®ç±» ï¼Œ å…å»äº†æ‰‹åŠ¨ç¼–å†™é…ç½®æ³¨å…¥åŠŸèƒ½ç»„ä»¶ç­‰çš„å·¥ä½œï¼›



### `SpringApplication.run` åˆ†æ

+ è¯¥æ–¹æ³•ä¸»è¦åˆ†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ SpringApplication çš„å®ä¾‹åŒ–ï¼ŒäºŒæ˜¯ runæ–¹æ³•çš„æ‰§è¡Œï¼›

+ `SpringApplication` ç±»çš„åˆ†æï¼š

  1. æ¨æ–­åº”ç”¨çš„ç±»å‹æ˜¯æ™®é€šçš„é¡¹ç›®è¿˜æ˜¯ Web é¡¹ç›®ï¼›

  2. æŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨åˆå§‹åŒ–å™¨ ï¼Œ è®¾ç½®åˆ° initializers å±æ€§ä¸­ï¼›

  3. æ‰¾å‡ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºç›‘å¬å™¨ï¼Œè®¾ç½®åˆ° listeners å±æ€§ä¸­ï¼›

  4. æ¨æ–­å¹¶è®¾ç½® main æ–¹æ³•çš„å®šä¹‰ç±»ï¼Œæ‰¾åˆ°è¿è¡Œçš„ä¸»ç±»ï¼›

+ `SpringApplication` æ„é€ å™¨åˆ†æï¼š

  ```java
  public SpringApplication(ResourceLoader resourceLoader, Class... primarySources) {
      // ......
      this.webApplicationType = WebApplicationType.deduceFromClasspath();
     this.setInitializers(this.getSpringFactoriesInstances();    this.setListeners(this.getSpringFactoriesInstances(ApplicationListener.class));
      this.mainApplicationClass = this.deduceMainApplicationClass();
  }
  ```



+ `run` æ–¹æ³•æµç¨‹åˆ†æï¼š â€¦



## `application.properties` é…ç½®æ–‡ä»¶åˆ†æ

> æ ¹æ®ä¸åŒçš„æ–‡ä»¶æ ¼å¼è¯­æ³•æœ‰æ‰€ä¸åŒï¼š
>
> - `application.properties`ï¼š
>
> - - è¯­æ³•ç»“æ„ ï¼škey=value
>
> - `application.yml`ï¼š
>
> - - è¯­æ³•ç»“æ„ ï¼škeyï¼šç©ºæ ¼ value

**é…ç½®æ–‡ä»¶çš„ä½œç”¨**ï¼šä¿®æ”¹ SpringBoot è‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ï¼Œå› ä¸º SpringBoot åœ¨åº•å±‚å·²ç»è‡ªåŠ¨é…ç½®å¥½ã€‚



### yaml ç›¸å…³è¯­æ³•

è¿™ç§è¯­è¨€ä»¥æ•°æ®ä½œä¸ºä¸­å¿ƒï¼Œè€Œä¸æ˜¯ä»¥æ ‡è®°è¯­è¨€ä¸ºé‡ç‚¹ã€‚å¯¹æ¯” xml æŠ›å¼ƒäº†æ ‡ç­¾çš„ç”¨æ³•ã€‚

+ åŸºç¡€è¯­æ³•ï¼š**è¯­æ³•è¦æ±‚ä¸¥æ ¼**ï¼

  + **ç©ºæ ¼ä¸èƒ½çœç•¥**ã€‚
  + **ä»¥ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»**ï¼Œåªè¦æ˜¯å·¦è¾¹å¯¹é½çš„ä¸€åˆ—æ•°æ®éƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„ã€‚
  + **å±æ€§å’Œå€¼çš„å¤§å°å†™éƒ½æ˜¯ååˆ†æ•æ„Ÿçš„**ã€‚

+ å­—é¢é‡ï¼ˆ**æ™®é€šçš„å€¼ï¼šæ•°å­—ï¼Œå¸ƒå°”å€¼ï¼Œå­—ç¬¦ä¸²**ï¼‰ï¼šç›´æ¥å†™åœ¨åé¢å°±å¯ä»¥ ï¼Œ å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸ŠåŒå¼•å·æˆ–è€…å•å¼•å·ã€‚

  ```yaml
  key: value
  ```

  æ³¨æ„ï¼š

  + `â€œ â€` åŒå¼•å·ï¼Œ**ä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦** ï¼Œ ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€ï¼›æ¯”å¦‚ ï¼š`name: "kuang \n shen" ` è¾“å‡º ï¼š`kuang  æ¢è¡Œ  shen`ã€‚
  + `''` å•å¼•å·ï¼Œ**ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦** ï¼Œ ç‰¹æ®Šå­—ç¬¦æœ€ç»ˆä¼šå˜æˆå’Œæ™®é€šå­—ç¬¦ä¸€æ ·è¾“å‡ºã€‚æ¯”å¦‚ ï¼š`name: â€˜kuang \n shenâ€™`  è¾“å‡º ï¼š`kuang  \n  shen`ã€‚

+ å¯¹è±¡ã€Map ï¼ˆé”®å€¼å¯¹ï¼‰ï¼š

  ```yaml
  student:
      name: qinjiang
      age: 3
  ```

  æ³¨æ„ç¼©è¿›ä»¥ç¡®å®šé”®ä¸å€¼çš„å…³ç³»ã€‚

  è¡Œå†…å†™æ³•ï¼š

  ```yaml
  student: {name: qinjiang,age: 3}
  ```

+ æ•°ç»„ï¼ˆ Listã€set ï¼‰ï¼šä½¿ç”¨ `-` è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ï¼š

  ```yaml
  pets:
   - cat
   - dog
   - pig
  ```

  è¡Œå†…å†™æ³•ï¼š `pets: [cat,dog,pig]`ã€‚



#### yaml æ³¨å…¥é…ç½®æ–‡ä»¶

ğŸŒ° ç¼–å†™ä¸€ä¸ªå¤æ‚çš„å®ä½“ç±»ï¼š
```java
@Component //æ³¨å†Œbeanåˆ°å®¹å™¨ä¸­
public class Person {
    private String name;
    private Integer age;
    private Boolean happy;
    private Date birth;
    private Map<String,Object> maps;
    private List<Object> lists;
    private Dog dog;
    
    // ... æœ‰å‚æ— å‚æ„é€ ã€getã€setæ–¹æ³•ã€toString()æ–¹æ³•  
}
```

ä½¿ç”¨ yaml é…ç½®çš„æ–¹å¼æ³¨å…¥å±æ€§ï¼š

```yaml
person:
  name: qinjiang
  age: 3
  happy: false
  birth: 2000/01/01
  maps: {k1: v1,k2: v2}
  lists:
   - code
   - girl
   - music
  dog:
    name: æ—ºè´¢
    age: 1
```

åœ¨å®ä½“ç±»ä¸Šæ·»åŠ ä¸€ä¸ªæ³¨è§£ `@ConfigurationProperties(prefix = "person")` ï¼š

+ ä½œç”¨ï¼šå°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ï¼›å‘Šè¯‰ SpringBoot å°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®**è¿›è¡Œç»‘å®š**å‚æ•° `prefix = â€œpersonâ€` ï¼šå°†é…ç½®æ–‡ä»¶ä¸­çš„ `person`ä¸‹é¢çš„æ‰€æœ‰å±æ€§ä¸€ä¸€å¯¹åº”ã€‚

+ åœ¨æ­¤ä¹‹å‰éœ€è¦åœ¨ Maven æ·»åŠ é…ç½®æ³¨è§£å¤„ç†å™¨çš„ä¾èµ–ï¼š

  ```xml
  <!-- å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤ºï¼Œéœ€è¦é‡å¯ -->
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
  </dependency>
  ```

  

#### åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶

`@PropertySource` ï¼š**åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶**ï¼›

`@configurationProperties`ï¼šé»˜è®¤ä»**å…¨å±€é…ç½®æ–‡ä»¶**ä¸­è·å–å€¼ï¼›



ğŸŒ° ä¾‹å¦‚ï¼Œä¸Šè¿°çš„ä¾‹å­æŒ‡å®šæ³¨å…¥çš„é…ç½®æ–‡ä»¶ï¼š

+ åœ¨ resources ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `person.properties` æ–‡ä»¶ã€‚

+ åœ¨åŸæ¥çš„å®ä½“ç±»ä¸­ä½¿ç”¨ `@PropertySource` æ³¨è§£ï¼š

  ```java
  @PropertySource(value = "classpath:person.properties")
  @Component //æ³¨å†Œbean
  public class Person {
  
      @Value("${name}")
      private String name;
  
      ......  
  }
  ```

  



#### yaml é…ç½®æ–‡ä»¶å ä½ç¬¦

åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ç¼–å†™å ä½ç¬¦ç”Ÿæˆéšæœºæ•°

```yaml
person:
    name: qinjiang${random.uuid} # éšæœºuuid
    age: ${random.int}  # éšæœºint
```



### properties é…ç½®ç›¸å…³

ä¸ºäº†é˜²æ­¢ `.properties` ç›¸å…³çš„æ–‡ä»¶å› ä¸ºå…¶ä¸­æœ‰ä¸­æ–‡è€Œå¼•èµ·ä¹±ç ï¼Œåœ¨ IDEA çš„ File Encoding ä¸­é…ç½®æ ¼å¼ï¼š

![image-20220427211929698](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/1eNYk3.png)



#### properties æ³¨å…¥é…ç½®æ–‡ä»¶

åœ¨æ­¤å‰ Spring ä¸­ä½¿ç”¨å®Œå…¨æ³¨è§£å¼€å‘ä¸­ï¼ŒJDBC è¿æ¥æ•°æ®åº“ä½¿ç”¨è¿‡è¯»å–é…ç½®æ–‡ä»¶çš„æ•°æ®ï¼ŒåŒç†ã€‚

+ å®ä½“ç±» `User`ï¼š

  ```java
  @Component //æ³¨å†Œbean
  public class User {
      private String name;
      private int age;
      private String sex;
  }
  ```

+ é…ç½®æ–‡ä»¶ `user.properties` ï¼š

  ```properties
  user1.name=kuangshen
  user1.age=18
  user1.sex=ç”·
  ```

+ åœ¨ `User` ä¸­ä½¿ç”¨ `@Value` å®Œæˆå±æ€§æ³¨å…¥ï¼š

  ```java
  @Component //æ³¨å†Œbean
  @PropertySource(value = "classpath:user.properties")
  public class User {
      //ç›´æ¥ä½¿ç”¨@value
      @Value("${user.name}") //ä»é…ç½®æ–‡ä»¶ä¸­å–å€¼
      private String name;
      @Value("#{9*2}")  // #{SPEL} Springè¡¨è¾¾å¼
      private int age;
      @Value("ç”·")  // å­—é¢é‡
      private String sex;
  }
  ```

+ `@SpringBootTest` æµ‹è¯•ï¼š

  ```java
  @SpringBootTest
  class DemoApplicationTests {
  
      @Autowired
      User user;
  
      @Test
      public void contextLoads() {
          System.out.println(user);
      }
  
  }
  ```

  



### æ€»ç»“

+ yaml ä¸ properties ä¸¤ç§æ³¨å…¥æ–¹å¼å¯¹æ¯”ï¼Œä½¿ç”¨ `@ConfigurationProperties` åªéœ€è¦å†™ä¸€æ¬¡å³å¯ ï¼Œ `@Value` åˆ™éœ€è¦æ¯ä¸ªå­—æ®µéƒ½æ·»åŠ ã€‚
+ yaml ä¸­éµå¾ªæ¾æ•£ç»‘å®šã€‚ä¾‹å¦‚ yml ä¸­å†™çš„ `last-name`ï¼Œä¸ `lastName` ç­‰ä»·ï¼Œ `-` **åé¢è·Ÿç€çš„å­—æ¯é»˜è®¤æ˜¯å¤§å†™çš„**ã€‚
+ JSR303 æ•°æ®æ ¡éªŒ ï¼Œ è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨å­—æ®µæ˜¯å¢åŠ ä¸€å±‚è¿‡æ»¤å™¨éªŒè¯ ï¼Œ å¯ä»¥ä¿è¯æ•°æ®çš„åˆæ³•æ€§ã€‚
+ å¤æ‚ç±»å‹å°è£…ï¼Œyml ä¸­å¯ä»¥å°è£…å¯¹è±¡ ï¼Œ ä½¿ç”¨ properties çš„ `@value` æ³¨å…¥å°±ä¸æ”¯æŒã€‚



æ‰€ä»¥ï¼Œyaml ä¸ properties å¯¹æ¯”ï¼Œyaml å¯ä»¥è‡ªåŠ¨ä¸€ä¸€æ˜ å°„å±æ€§ï¼Œä¼˜é€‰ yamlã€‚



## æ•°æ®æ ¡éªŒ

SpringBoot ä¸­å¯ä»¥ä½¿ç”¨ `@validated` æ ¡éªŒæ•°æ®ï¼Œ**å¦‚æœæ•°æ®å¼‚å¸¸åˆ™ä¼šç»Ÿä¸€æŠ›å‡ºå¼‚å¸¸ï¼Œæ–¹ä¾¿å¼‚å¸¸ä¸­å¿ƒç»Ÿä¸€å¤„ç†ã€‚**æˆ‘ä»¬è¿™é‡Œæ¥å†™ä¸ªæ³¨è§£è®©æˆ‘ä»¬çš„ `name` åªèƒ½æ”¯æŒ Email æ ¼å¼ï¼š

```java
@Component //æ³¨å†Œbean
@ConfigurationProperties(prefix = "person")
@Validated  //æ•°æ®æ ¡éªŒ
public class Person {

    @Email(message="é‚®ç®±æ ¼å¼é”™è¯¯") //nameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼
    private String eamil;
}
```



æ•°æ®æ ¡éªŒçš„å¸¸ç”¨å‚æ•°ï¼š

ğŸŒ°ï¼š

```java
@NotNull(message="åå­—ä¸èƒ½ä¸ºç©º")
private String userName;
@Max(value=120,message="å¹´é¾„æœ€å¤§ä¸èƒ½æŸ¥è¿‡120")
private int age;
@Email(message="é‚®ç®±æ ¼å¼é”™è¯¯")
private String email;
```



```java
// ç©ºæ£€æŸ¥
@Null       // éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºnull
@NotNull    // éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸ºnull, æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²
@NotBlank   // æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº0,åªå¯¹å­—ç¬¦ä¸²,ä¸”ä¼šå»æ‰å‰åç©ºæ ¼.
@NotEmpty   // æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.
    
// Booelanæ£€æŸ¥
@AssertTrue     // éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º true  
@AssertFalse    // éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º false  
    
é•¿åº¦æ£€æŸ¥
@Size(min=, max=) // éªŒè¯å¯¹è±¡ï¼ˆArray,Collection,Map,Stringï¼‰é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…  
@Length(min=, max=) // éªŒè¯å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹ç±»

æ—¥æœŸæ£€æŸ¥
@Past       // éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰  
@Future     // éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å  
@Pattern    // éªŒè¯ String å¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™
```



## å¤šç¯å¢ƒåˆ‡æ¢

`profile` æ˜¯ Spring **å¯¹ä¸åŒç¯å¢ƒæä¾›ä¸åŒé…ç½®åŠŸèƒ½çš„æ”¯æŒ**ï¼Œå¯ä»¥é€šè¿‡æ¿€æ´»ä¸åŒçš„ç¯å¢ƒç‰ˆæœ¬ï¼Œå®ç°å¿«é€Ÿåˆ‡æ¢ç¯å¢ƒï¼›

### å¤šé…ç½®æ–‡ä»¶

åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯ `application-{profile}.properties/yml` ï¼Œ**ç”¨æ¥æŒ‡å®šå¤šä¸ªç¯å¢ƒç‰ˆæœ¬**ï¼›

ğŸŒ° **ä¾‹å¦‚ï¼š**

+ `application-test.properties` ä»£è¡¨**æµ‹è¯•ç¯å¢ƒé…ç½®**ã€‚

+ `application-dev.properties` ä»£è¡¨**å¼€å‘ç¯å¢ƒé…ç½®**ã€‚

ä½†æ˜¯ Springboot å¹¶ä¸ä¼šç›´æ¥å¯åŠ¨è¿™äº›é…ç½®æ–‡ä»¶ï¼Œå®ƒ**é»˜è®¤ä½¿ç”¨ `application.properties` ä¸»é…ç½®æ–‡ä»¶**ï¼›æ‰€ä»¥éœ€è¦é€šè¿‡ä¸€ä¸ªé…ç½®æ¥é€‰æ‹©éœ€è¦æ¿€æ´»çš„ç¯å¢ƒï¼š

ğŸŒ° ä½¿ç”¨ `properties` é…ç½®çš„ä¾‹å­ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä½¿ç”¨ **dev** ç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„ç«¯å£å·è¿›è¡Œæµ‹è¯•ï¼›å¯åŠ¨ SpringBootï¼Œå°±å¯ä»¥çœ‹åˆ°å·²ç»åˆ‡æ¢åˆ° **dev**ä¸‹çš„é…ç½®äº†ï¼›

```properties
spring.profiles.active=dev
```

ğŸŒ° ä½¿ç”¨ `yml` é…ç½®æ–‡ä»¶çš„ä¾‹å­ï¼šå¯ä»¥ä¸ç”¨åˆ‡æ¢å¤šä¸ªæ–‡ä»¶ï¼Œç›´æ¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­åˆ‡æ¢å¼€å‘ç¯å¢ƒï¼š

```yml
server:
  port: 8081

spring:
  profiles:
    active: prod #é€‰æ‹©è¦æ¿€æ´»é‚£ä¸ªç¯å¢ƒå—

---
server:
  port: 8083
spring:
  profiles: dev #é…ç½®ç¯å¢ƒçš„åç§°


---

server:
  port: 8084
spring:
  profiles: prod  #é…ç½®ç¯å¢ƒçš„åç§°
```



âš ï¸ **æ³¨æ„ï¼šå¦‚æœ yml å’Œ properties åŒæ—¶éƒ½é…ç½®äº†ç«¯å£ï¼Œå¹¶ä¸”æ²¡æœ‰æ¿€æ´»å…¶ä»–ç¯å¢ƒ ï¼Œ é»˜è®¤ä¼šä½¿ç”¨ properties é…ç½®æ–‡ä»¶çš„ï¼**



### å¤–éƒ¨åŠ è½½é…ç½®æ–‡ä»¶

**å¤–éƒ¨åŠ è½½é…ç½®æ–‡ä»¶çš„æ–¹å¼ååˆ†å¤šï¼Œé€‰æ‹©æœ€å¸¸ç”¨çš„å³å¯ï¼Œåœ¨å¼€å‘çš„èµ„æºæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼**

SpringBoot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„ `application.properties`æˆ–è€…`application.yml` æ–‡ä»¶ä½œä¸º SpringBoot çš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚

æ‰«æé…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§ï¼Œç”±é«˜åˆ°ä½ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼š**SpringBootä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼Œäº’è¡¥é…ç½®ã€‚**

+ ä¼˜å…ˆçº§1ï¼šé¡¹ç›®è·¯å¾„ä¸‹çš„ config æ–‡ä»¶å¤¹é…ç½®æ–‡ä»¶
+ ä¼˜å…ˆçº§2ï¼šé¡¹ç›®è·¯å¾„ä¸‹é…ç½®æ–‡ä»¶
+ ä¼˜å…ˆçº§3ï¼šèµ„æºè·¯å¾„ä¸‹çš„ config æ–‡ä»¶å¤¹é…ç½®æ–‡ä»¶
+ ä¼˜å…ˆçº§4ï¼š**èµ„æºè·¯å¾„ä¸‹é…ç½®æ–‡ä»¶**

### è¿ç»´æŠ€å·§

é¡¹ç›®æ‰“åŒ…å¥½ä»¥åï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ï¼Œ**å¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®**ï¼›è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬æ˜¯åæœŸè¿ç»´åšçš„å¤šï¼Œç›¸åŒé…ç½®ï¼Œ**å¤–éƒ¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æœ€é«˜**ã€‚



ğŸŒ° ä¾‹å¦‚ï¼š
```
java -jar spring-boot-config.jar --spring.config.location=F:/application.properties
```



## è‡ªåŠ¨é…ç½®åŸç†


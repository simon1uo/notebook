---
title: 🛖 SpringMVC 基础
date: 2022-03-13 21:59:47
permalink: /pages/38968a/
categories: 
  - _pages
  - 🧋 JavaEE
  - 🚏SpringMVC
tags: 
  - SpringMVC
author: 
  name: Simon
  link: https://github.com/simon1uo
---
🔗 相关链接：

+ 🗄 本笔记对应代码 Demo GitHub 仓库：[]()
+ 📀 本笔记参考视频：[【尚硅谷】SpringMVC教程丨一套快速上手spring mvc](https://www.bilibili.com/video/BV1Ry4y1574R?p=10)



## SpringMVC 简介

>  🔗 相关概念：
>  MVC 是一种架构思想，将软件分为**模型、视图、控制器**三部分：
>
>  + **模型层** Model ：处理数据的 JavaBean 类：
>    + **实体类** Bean： 存储业务数据；
>    + **业务处理** Bean：Service 或者 DAO，处理**业务逻辑和数据访问**；
>  + **视图层** View： 展示数据的 **HTML 页面**，与**用户进行交互**。
>  + **控制层** Controller：指工程中的接收**请求和响应**的 **Servlet**。 
>
>  **MVC 的工作流程**：
>
>  + 用户通过试图层**发送请求**到服务器，在服务器中请求被 **Controller** 接收。
>  + **Controller** 调用相应的 **Model** 层处理请求。
>  + **Model** 层处理完毕将结果返回到 **Controller**。
>  + **Controller** 再根据请求处理的结果找到相应的 **View** 视图。
>  + **View** 视图渲染数据后最终相应给浏览器。



**SpringMVC 概念**：

+ 是 Spring 的后续产品，Spring 的一个子项目。

+ SpringMVC 是 Spring 为**表述层**开发提供的一整套完备的解决方案。在表述层框架历经 Struts、WebWork、Strust2 等诸多产品的历代更迭之后，目前业界普遍选择了 SpringMVC 作为 JavaEE 项目表述层开发的首选方案。

> 注：**三层架构**为表述层（表示层）、业务逻辑层、数据访问层。表述层为表示前台页面和后台 Servlet。



**SpringMVC 特点**：

- **Spring 家族原生产品**：与 IOC 容器等基础设施无缝对接。

- **基于原生的 Servlet**：通过了功能强大的前端控制器 DispatcherServlet，对请求和响应进行统一处理。

- **全面解决方案**：表述层各细分领域需要解决的问题全方位覆盖，提供全面的解决方案。

- **代码清新简洁**：大幅度提升开发效率。

- **即插即用**：内部组件化程度高，组件可插拨，想要什么功能配置相应组件即可。

- **性能卓著**：尤其适合现代大型、超大型互联网项目要求。



## SpringMVC 入门项目

👋 `Hello World` ：

1. 创建 Maven 项目，添加 `pom.xml` 依赖：

```xml
<!--设置打包方式为war包-->
<packaging>war</packaging>
```

```xml
<dependencies>
    <!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>5.3.16</version>
    </dependency>
    <!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic -->
    <dependency>
        <groupId>ch.qos.logback</groupId>
        <artifactId>logback-classic</artifactId>
        <version>1.2.11</version>
        <scope>test</scope>
    </dependency>
    <!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api -->
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>javax.servlet-api</artifactId>
        <version>4.0.1</version>
        <scope>provided</scope>
    </dependency>
    <!-- https://mvnrepository.com/artifact/org.thymeleaf/thymeleaf-spring5 -->
    <dependency>
        <groupId>org.thymeleaf</groupId>
        <artifactId>thymeleaf-spring5</artifactId>
        <version>3.0.15.RELEASE</version>
    </dependency>
</dependencies>
```



+ 添加 web 模块：（`Project Structure` 中设置）

注意两个地方的 web目录要配置再 `src/main/webapp` 下：

![image-20220314113254840](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/VCmFQQ.png)

> 注：当使用创建 archetype 为 webapp 的Maven 项目时可以自动创建`webapp` 目录，上述为手动创建。
>
> ![image-20220314151048670](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/A1NAOC.png)



2. **配置 `web.xml` 文件**：注册 SpringMVC 的前端控制器 **DispatcherServlet**。

   :one: 默认配置方式：此配置作用下，SpringMVC 的配置文件默认位于 `WEB-INF` 下，默认名称为 `<servlet-name>-servlet.xml`，🌰 例如，以下配置所对应的 SpringMVC 的配置文件位于 `WEB-INF` 目录下，文件名为 `springMVC-servlet.xml` ：

```xml
<!--配置 SpringMVC 的前端控制器，对浏览器发送的请求统一进行处理-->
<servlet>
    <servlet-name>springMVC</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
</servlet>
<servlet-mapping>
    <servlet-name>springMVC</servlet-name>
    <!--
      设置 SpringMVC 的核心控制器所能处理的请求的请求路径
    -->
    <url-pattern>/</url-pattern>
</servlet-mapping>
```

> `<url-pattern>` 标签：
>
> + `/` 所匹配的请求可以是  `/login` 或 `.html` 或 `.js` 或 `.css` 方式的请求路径。但是 ` / ` 不能匹配 `.jsp` 请求路径的请求，因此就可以避免在访问 `.jsp` 页面时，该请求被 DispatcherServlet 处理，从而找不到相应的页面的情况。
>
> + `/*` 包括 `.jsp` 的**所有请求**。例如在使用过滤器时，若需要对所有请求进行过滤，就需要使用 `/*` 的写法。

::: tip

默认配置方式对位置和名称都是默认的，但是使用 Maven 工程应该统一放置在 `resources` 目录下。

:::

​	:two: **拓展配置方式**（常用） ：

+ 通过 `init-param` 标签设置 SpringMVC 配置文件的位置和名称。
+ 通过`load-on-startup`标签设置 SpringMVC 前端控制器 `DispatcherServlet` 的**初始化时间**。

```xml
<!--配置 SpringMVC 的前端控制器，对浏览器发送的请求统一进行处理-->
<servlet>
    <servlet-name>springMVC</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <!--通过初始化参数指定SpringMVC配置文件的位置和名称-->
    <init-param>
        <!--contextConfigLocation 为固定值-->
        <param-name>contextConfigLocation</param-name>
        <!--使用 classpath: 表示从类路径查找配置文件，java 工程默认src下,maven 工程默认 src/main/resources 下-->
        <param-value>classpath:springMVC.xml</param-value>
    </init-param>
    <!--
        作为框架的核心组件，在启动过程中有大量的初始化操作要做
        而这些操作放在第一次请求时才执行会严重影响访问速度
        将前端控制器 DispatcherServlet 的初始化时间提前到服务启动时
    -->
    <load-on-startup>1</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>springMVC</servlet-name>
    <url-pattern>/</url-pattern>
</servlet-mapping>
```



3. **创建请求控制器** `Controller`：`HelloController.java`

> 请求控制器：由于前端控制器对浏览器发送的请求进行了统一的处理，**但是具体的请求有不同的处理过程**，因此需要创建处理具体请求的类。
>
> 控制器方法：指的是请求控制器中**每一个处理请求的方法**。

```java
package com.mvcDemo.controller;

public class HelloController {
	// ...
}
```

::: tip

SpringMVC 的控制器由一个 POJO （普通 Java 类）担任，因此需要通过注解 `@Controller` 将其识别为一个**控制层组件**，交给 Spring 的 IOC 容器管理，此时的 SpringMVC 才能够识别控制器的存在。

:::



4. **配置对应的 SpringMVC 配置文件**：

🌰 例子（对应配置 `web.xml` 文件时使用拓展配置方法）： `SpringMVC.xml`（`src/main/resources` 目录下） ：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">

    <!--扫描组件-->
    <context:component-scan base-package="com.mvcDemo.controller"></context:component-scan>
    <!--配置Thymeleaf视图解析器-->
    <bean id="viewResolver" class="org.thymeleaf.spring5.view.ThymeleafViewResolver">
        <property name="order" value="1"/>
        <property name="characterEncoding" value="UTF-8"/>
        <property name="templateEngine">
            <bean class="org.thymeleaf.spring5.SpringTemplateEngine">
                <property name="templateResolver">
                    <bean class="org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver">
                        <!--视图前缀-->
                        <property name="prefix" value="/WEB-INF/templates/"/>
                        <!--视图后缀-->
                        <property name="suffix" value=".html"/>
                        <property name="templateMode" value="HTML5"/>
                        <property name="characterEncoding" value="UTF-8"/>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>
</beans>
```

> **视图解析器作用**：每当实现页面跳转时，如果视图名称符合条件，就会被当前的视图解析器解析，找到相对应的页面，实现页面跳转。如上解析 `/WEB-INF/templates/` 中的 `.html` 文件。



5. **测试：**

🌰 例子： **访问首页**：

+ 创建 `index.html`：

``` html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>index | Hello World</title>
</head>
<body>
    <h1>Index</h1>
</body>
</html>
```

+ 在请求控制器中创建处理请求的方法：

```java
//@RequestMapping 注解：处理请求和控制器方法之间的映射关系
//@RequestMapping 注解的 value 属性可以通过请求地址匹配请求，/ 表示的当前工程的上下文路径
// localhost：8080/springMVC/
@RequestMapping("/")
public String index() {
    //返回视图名称
    return "index";
}
```



🌰 延续上例子：**从首页请求跳转页面**

+ 编辑 `index.html` ：添加超链接：

```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>index | Hello World</title>
</head>
<body>
    <h1>Index</h1>
    <a th:href="@{/target}">访问目标页面target.html</a>
</body>
</html>
```

::: tip

注意超链接的写法：不能只写 `/target` ，因为此时相对地址是根据浏览器的地址解析，而不是上下文路径。虽然可以通过添加上下文的写法 `/springMVC/target` 实现，**但不能实现动态获取**。所以通过 **thymeleaf** 动态获取：

+ 首先需要引入 thymeleaf 的命名空间。
+ 然后使用 `th:` 前缀修饰标签属性，这里需要修饰的是 `href` 属性。
+ 最后在 `th:href` 中的属性值中中使用 `@{}` 包裹，例如 `@{/target}` 。

:::

+ 创建页面 `target.html` ：`body` 中内容如下：

```html
<body>
    Hello World Target!
</body>
```

+ 在请求控制器中添加上对 `target` 请求**进行处理**的控制器方法：

```java
@RequestMapping("/target")
public String toTarget(){
    return "target";
}
```



## SpringMVC 请求处理的底层原理总结

浏览器发送请求，若请求地址符合前端控制器的 `url-pattern` ，该请求就会被前端控制器 `DispatcherServlet` 处理。

前端控制器会读取 SpringMVC 的核心配置文件，通过扫描组件找到控制器，将请求地址和控制器中的 `@RequestMapping` 注解的 `value` 属性值匹配。若匹配成功，则改注解所标识的控制器方法就是处理请求的方法。

处理请求的方法需要返回一个字符串类型的**视图名称**，该视图名称会被视图解析器解析，加上前缀和后缀组成视图的路径，通过 **Thymeleaf** 对视图进行渲染，最终**转发**到视图所对应的页面。





## *SpringMVC 工程的创建流程

::: tip

主要步骤：

1）配置`pom.xml`、`web.xml`、`springMVC.xml`。

2）创建前台页面和后台请求控制器。

:::

（*可保存本次配置为 **Project Template**）

<img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/NsFZAZ.png" alt="image-20220320125004986" style="zoom: 50%;" />

1. 新建一个新的 maven 空白工程，配置 `pom.xml` 引入相关依赖：

   ```xml
   <!--打包方式修改为war-->
   <packaging>war</packaging>
   
   <properties>
       <maven.compiler.source>15</maven.compiler.source>
       <maven.compiler.target>15</maven.compiler.target>
   </properties>
   
   <dependencies>
       <!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc -->
       <dependency>
           <groupId>org.springframework</groupId>
           <artifactId>spring-webmvc</artifactId>
           <version>5.3.16</version>
       </dependency>
       <!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic -->
       <dependency>
           <groupId>ch.qos.logback</groupId>
           <artifactId>logback-classic</artifactId>
           <version>1.2.11</version>
           <scope>test</scope>
           <type>jar</type>
       </dependency>
   
       <dependency>
           <groupId>org.slf4j</groupId>
           <artifactId>slf4j-jdk14</artifactId>
           <version>1.7.25</version>
       </dependency>
       <!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api -->
       <dependency>
           <groupId>javax.servlet</groupId>
           <artifactId>javax.servlet-api</artifactId>
           <version>4.0.1</version>
           <scope>provided</scope>
       </dependency>
       <!--Spring和Thymeleaf的整合包-->
       <!-- https://mvnrepository.com/artifact/org.thymeleaf/thymeleaf-spring5 -->
       <dependency>
           <groupId>org.thymeleaf</groupId>
           <artifactId>thymeleaf-spring5</artifactId>
           <version>3.0.15.RELEASE</version>
       </dependency>
   </dependencies>
   ```

2. 创建 `webapp` 目录，在 Project Structure 中配置 `web.xml`（注意路径要修改在 `src/main/webapp` 下） 

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

  <filter>
        <filter-name>CharacterEncodingFilter</filter-name>
        <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>UTF-8</param-value>
        </init-param>
        <init-param>
            <param-name>forceResponseEncoding</param-name>
            <param-value>true</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>CharacterEncodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>

    <servlet>
        <servlet-name>springMVC</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:SpringMVC.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <servlet-name>springMVC</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
</web-app>
```

3. 在 `resources` 目录下创建 `SpringMVC.xml` 配置文件：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">

    <!--扫描组件-->
    <context:component-scan base-package="com.simon.controller"></context:component-scan>

    <!--配置Thymeleaf视图解析器-->
    <bean id="viewResolver" class="org.thymeleaf.spring5.view.ThymeleafViewResolver">
        <property name="order" value="1"/>
        <property name="characterEncoding" value="UTF-8"/>
        <property name="templateEngine">
            <bean class="org.thymeleaf.spring5.SpringTemplateEngine">
                <property name="templateResolver">
                    <bean class="org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver">
                        <!--视图前缀-->
                        <property name="prefix" value="/WEB-INF/templates/"/>
                        <!--视图后缀-->
                        <property name="suffix" value=".html"/>
                        <property name="templateMode" value="HTML5"/>
                        <property name="characterEncoding" value="UTF-8"/>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>
</beans>
```

4. 在 `Java` 目录下创建 `com.*.controller.DemoController`：

```java
@Controller
public class DemoController {
    @RequestMapping("/")
    public String index(){
        return "index";
    }
}
```

5. 在 `webapp/WEB-INF/templates` 目录下，创建测试 Demo 前台页面 `index.html` ：（注意要引入 Thymeleaf 标签）

```xml 
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Index | SpringMVC Demo</title>
</head>
<body>
    <h1>Index</h1>
</body>
</html>
```

完整项目结构应如下：
<img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/uYFD3M.png" alt="image-20220320125729326" style="zoom: 50%;" />

运行测试：

![image-20220320125131344](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/zdRDbn.png)
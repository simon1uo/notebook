---
title: ğŸ— SpringMVC æŠ¥æ–‡ä¿¡æ¯è½¬æ¢
date: 2022-04-19 22:48:54
permalink: /pages/2a2032/
categories: 
  - _pages
  - ğŸ§‹ JavaEE
  - ğŸšSpringMVC
tags: 
  - null
author: 
  name: Simon
  link: https://github.com/simon1uo
---
**æŠ¥æ–‡ä¿¡æ¯è½¬æ¢å™¨** ï¼ˆHttpMessageConverterï¼‰ï¼š**å°†è¯·æ±‚æŠ¥æ–‡è½¬æ¢ä¸º Java å¯¹è±¡ï¼Œå°† Java å¯¹è±¡è½¬æ¢ä¸ºå“åº”æŠ¥æ–‡**ã€‚

æŠ¥æ–‡ä¿¡æ¯è½¬æ¢å™¨æä¾›äº†ä¸¤ä¸ªæ³¨è§£å’Œä¸¤ä¸ªç±»å‹ï¼ˆè¯·æ±‚å’Œå“åº”æŠ¥æ–‡ç›¸å…³ï¼‰ï¼š`@RequestBody`ã€`@ResponseBody`ã€`RequestEntity`ã€`ResponseEntity`ï¼ˆå…³äºç›¸åº”çš„ä½¿ç”¨çš„è¾ƒå¤šï¼‰ã€‚



### `@RequestBody` æ³¨è§£

å¯ä»¥è·å–è¯·æ±‚ä½“ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨æ–¹æ³•**è®¾ç½®ä¸€ä¸ªå½¢å‚**ï¼Œä½¿ç”¨ `@RequestBody` è¿›è¡Œæ ‡è¯†ï¼Œ**å½“å‰è¯·æ±‚çš„è¯·æ±‚ä½“å°±ä¼šä¸ºå½“å‰æ³¨è§£æ‰€æ ‡è¯†çš„å½¢å‚èµ‹å€¼**ã€‚



ğŸŒ° ä¾‹å­ï¼š

+ åå°æ§åˆ¶å™¨ `HttpController` ï¼š

```java
@Controller
public class HttpController {

    @RequestMapping("/testRequestBody")
    public String testRequestBody(@RequestBody String requestBody){
        System.out.println("requestBody: " + requestBody);
        return "success";
    }
}
```

+ å‰å°æµ‹è¯•é¡µé¢ï¼š

```html
<form th:action="@{/testRequestBody}" method="post">
    username: <input type="text" name="username">
    password: <input type="password" name="password">
    <input type="submit" value="æäº¤">
</form>
```

+ æµ‹è¯•ç»“æœï¼š

```
requestBody: username=123&password=123456
```



### `@RequestEntity` æ³¨è§£

å°è£…è¯·æ±‚æŠ¥æ–‡ï¼ˆæ•´ä¸ªï¼‰çš„ä¸€ç§ç±»å‹ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä¸­è®¾ç½®è¯¥ç±»å‹çš„å½¢å‚ï¼Œå½“å‰è¯·æ±‚çš„è¯·æ±‚æŠ¥æ–‡å°±ä¼šèµ‹å€¼ç»™è¯¥å½¢å‚ã€‚



ğŸŒ° ä¾‹å­ï¼š

+ åå°æ§åˆ¶å™¨æ–¹æ³• `testRequestEntity`ï¼š

```java
@RequestMapping("/testRequestEntity")
public String testRequestEntity(RequestEntity<String> requestEntity){
    // requestEntityè¡¨ç¤ºæ•´ä¸ªè¯·æ±‚æŠ¥æ–‡çš„ä¿¡æ¯
    System.out.println("è¯·æ±‚å¤´requestHeaderï¼š" + requestEntity.getHeaders());
    System.out.println("è¯·æ±‚ä½“ï¼š" + requestEntity.getBody());
    return "success";
}
```

+ å‰å°æµ‹è¯•é¡µé¢ï¼š

```html
<form th:action="@{/testRequestEntity}" method="post">
    username: <input type="text" name="username">
    password: <input type="password" name="password">
    <input type="submit" value="æäº¤">
</form>
```

+ æµ‹è¯•ç»“æœï¼š

```
è¯·æ±‚å¤´ï¼š[host:"localhost:8080", connection:"keep-alive", content-length:"27", cache-control:"max-age=0", sec-ch-ua:"" Not A;Brand";v="99", "Chromium";v="100", "Microsoft Edge";v="100"", sec-ch-ua-mobile:"?0", sec-ch-ua-platform:""macOS"", upgrade-insecure-requests:"1", origin:"http://localhost:8080", user-agent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36 Edg/100.0.1185.44", ... ]
è¯·æ±‚ä½“ï¼šusername=234&password=12314
```



### `@ResponseBody` æ³¨è§£

ç”¨äº**æ ‡è¯†ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•**ï¼Œå¯ä»¥å°†è¯¥æ–¹æ³•çš„**è¿”å›å€¼ç›´æ¥ä½œä¸ºå“åº”æŠ¥æ–‡çš„å“åº”ä½“å“åº”åˆ°æµè§ˆå™¨**ã€‚



ğŸŒ° é€šè¿‡ Servlet API çš„ `HttpServletResponse` å¯¹è±¡å“åº”æµè§ˆå™¨æ•°æ®ï¼š

::: details

+ æ§åˆ¶å™¨æ–¹æ³• `testResponse` ï¼š 

```java
@RequestMapping("/testResponse")
public void testResponse(HttpServletResponse response) throws IOException {
    response.getWriter().print("hello, response");
}
```

> å› ä¸ºä¸è·³è½¬é¡µé¢å¯ä»¥å°†æ§åˆ¶å™¨æ–¹æ³•çš„ç±»å‹è®¾ç½®ä¸º `void` ã€‚

+ å‰å°æµ‹è¯•ï¼š

```html
<a th:href="@{/testResponse}">æµ‹è¯•é€šè¿‡ServletAPIçš„Responseå“åº”æµè§ˆå™¨æ•°æ®</a>
```

:::



ğŸŒ° SpringMVC ä¸­ `@ResponseBody` å“åº”æµè§ˆå™¨æ•°æ®ï¼š

+ æ§åˆ¶å™¨æ–¹æ³• `testResponseBody`ï¼š

```java
@RequestMapping("/testResponseBody")
@ResponseBody
public String testResponseBody(){
    return "success from responseBody";
}
```

+ å‰å°æµ‹è¯•ï¼š

```html
<a th:href="@{/testResponseBody}">æµ‹è¯•é€šè¿‡@ResponseBodyçš„Responseå“åº”æµè§ˆå™¨æ•°æ®</a>
```



ğŸŒ° SpringMVC ä¸­ `@ResponseEntity` å¤„ç† JSON æ•°æ®ï¼ˆå“åº”æµè§ˆå™¨ä¸€ä¸ª**å¯¹è±¡**ç±»å‹çš„æ•°æ®ï¼‰

+ æ§åˆ¶å™¨æ–¹æ³•ï¼š

```java
@RequestMapping("/testResponseUser")
@ResponseBody
public User testResponseUser(){
    return new User(1, "Simon", "123456", 23, "male");
}
```

+ å‰å°æµ‹è¯•ï¼š

```html
<a th:href="@{/testResponseUser}">æµ‹è¯•é€šè¿‡@ResponseBodyçš„Responseå“åº”æµè§ˆå™¨å¯¹è±¡ç±»å‹çš„æ•°æ®</a>
```

+ æµ‹è¯•ç»“æœï¼šæ­¤æ—¶å“åº”ç»™æµè§ˆå™¨çš„æ•°æ®æ˜¯ Java å¯¹è±¡ç±»å‹ï¼Œå¹¶æ²¡æœ‰è½¬æ¢ä¸º JSON å“åº”ç»™æµè§ˆå™¨æ¥æ”¶ï¼ˆæµè§ˆå™¨å¹¶ä¸èƒ½æ¥æ¥æ”¶ Java å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼‰ã€‚

<img src="https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/MeyYQj.png" alt="image-20220419233020617" style="zoom:50%;" />



### SpringMVC å¤„ç† JSON

è¦è½¬æ¢ Java å¯¹è±¡ç±»å‹ä¸º JSON ç±»å‹ï¼Œä»¥è§£å†³å“åº”æµè§ˆå™¨æ—¶æ•°æ®è½¬æ¢ä¸èƒ½å‡ºé”™ï¼Œ åœ¨ maven ä¸­å¼•å…¥ä¾èµ– `jackson` åå³å¯ï¼š

```xml
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.13.2</version>
</dependency>
```



> æ­¤æ—¶ SpringMVC å®Œæˆ `@ResponseBody` å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š
>
> + å¼€å¯ **MVC æ³¨è§£é©±åŠ¨**
> + `HandlerAdaptor`ä¸­ä¼šè‡ªåŠ¨è£…é…ä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨`MappingJackson2HttpMessageConverter`ï¼Œå¯ä»¥å°†å“åº”åˆ°æµè§ˆå™¨çš„ Java å¯¹è±¡è½¬æ¢ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚
> + ä½¿ç”¨`@ResponseBody`æ³¨è§£æ ‡è¯†æ§åˆ¶å™¨æ–¹æ³•ã€‚
> + å°† Java å¯¹è±¡ä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼è¿”å›æ—¶ ï¼Œ**ä¼šè‡ªåŠ¨è½¬æ¢ä¸º JSON ç±»å‹çš„å­—ç¬¦ä¸²**ã€‚ï¼ˆå®ä½“ç±»å¯¹è±¡ã€ Map å¯¹è±¡è½¬æ¢ä¸º JSON å¯¹è±¡ï¼ŒList å¯¹è±¡è½¬æ¢ä¸º JSON æ•°ç»„ï¼‰

> **å›é¡¾ MVC æ³¨è§£é©±åŠ¨çš„ä½œç”¨**ï¼š
>
> + è§£å†³è§†å›¾æ§åˆ¶å™¨ `view-controller` é€ æˆå…¶ä»–è¯·æ±‚å¤±æ•ˆçš„é—®é¢˜ï¼›
> + è§£å†³é»˜è®¤ Servlet å¤„ç†å™¨ `default-servlet-handler` é€ æˆ `DispatcherServlet` å¤±æ•ˆçš„é—®é¢˜ï¼ˆé™æ€èµ„æºé—®é¢˜ï¼‰ï¼›
> + è§£å†³ Java å¯¹è±¡è½¬æ¢ä¸º JSON å¯¹è±¡ï¼ˆJSON æ ¼å¼å­—ç¬¦ä¸²ï¼‰çš„é—®é¢˜ã€‚



### SpringMVC å¤„ç† AJAX


ğŸŒ° ä¾‹å­ï¼š

+ æ§åˆ¶å™¨æ–¹æ³•ï¼š

```java
@RequestMapping("/testAxios")
@ResponseBody
public String testAxios(String username, String password) {
    System.out.println("username: " + username + " password: " + password);
    return "success";
}
```

+ å‰å°æµ‹è¯•ï¼š

```html
<div id="app">
    <a th:href="@{/testAxios}" @click="textAxios">æµ‹è¯•SpringMVCå¤„ç†AJAXè¯·æ±‚</a>
</div>

<script type="text/javascript" th:src="@{/static/js/vue.js}"></script>
<script type="text/javascript" th:src="@{/static/js/axios.min.js}"></script>
<script type="text/javascript" >
    new Vue({
        el: "#app",
        methods: {
            textAxios(event) {
                axios({
                    method:"post",
                    url: event.target.href,
                    params: {
                        username: "admin",
                        password: "123456"
                    }
                }).then((response)=>{
                    alert(response.data)
                });
                event.preventDefault();
            }
        }
    })
</script>
```





### `@RestController` æ³¨è§£

`@RestController` æ³¨è§£æ˜¯ SpringMVC æä¾›çš„ä¸€ä¸ª**å¤åˆæ³¨è§£**ï¼Œæ ‡è¯†åœ¨æ§åˆ¶å™¨çš„ç±»ä¸Šï¼Œå°±ç›¸å½“äº**ä¸ºç±»æ·»åŠ äº† `@Controller` æ³¨è§£ï¼Œå¹¶ä¸”ä¸ºå…¶ä¸­çš„æ¯ä¸ªæ–¹æ³•æ·»åŠ äº† `@ResponseBody` æ³¨è§£**ã€‚ï¼ˆè¾ƒå¤šä½¿ç”¨ï¼‰



ğŸŒ° ä¾‹å­ï¼š
```java
@RestController
@RequestMapping("/httpController")
public class HttpController {
    @PostMapping("/testAxios")
    public String testAxios(User user) {
        return user.getUsername() + "," + user.getPassword();
    }
}
```



### `@ResponseEntity` æ³¨è§£

**ç”¨äºæ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼ç±»å‹**ï¼Œè¯¥æ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯**å“åº”åˆ°æµè§ˆå™¨çš„å“åº”æŠ¥æ–‡**ã€‚ï¼ˆè‡ªå®šä¹‰å“åº”æŠ¥æ–‡ï¼‰



ğŸŒ° å®ç°æ–‡ä»¶ä¸‹è½½ï¼š

+ åå°æ§åˆ¶å™¨æ–¹æ³•ï¼š

```java
@Controller
public class FileUpAndDownController {

    @RequestMapping("testDownload")
    public ResponseEntity<byte[]> testResponseEntity(HttpSession httpSession) {
        ServletContext context = httpSession.getServletContext();
        // æ–‡ä»¶ä½ç½®å’Œåç§°
        final String path = "/static/img/";
        String fileName = "1.png";
        // å“åº”ä½“
        String realPath = context.getRealPath(path + fileName);
        byte[] bytes = readFile(realPath);
        // å“åº”å¤´
        MultiValueMap<String, String> headers = new HttpHeaders();
        headers.set("Content-Disposition", "attachment;filename=" + fileName);
        // å“åº”çŠ¶æ€ç 
        HttpStatus status = HttpStatus.OK;
        // å“åº”å®ä½“
        return new ResponseEntity<>(bytes, headers, status);
    }

    private byte[] readFile(String realPath) {
        System.out.println(realPath);
        final int initSize = 0;
        byte[] bytes = new byte[initSize];
        try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream(realPath));) {
            bytes = new byte[bis.available()];
            bis.read(bytes);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return bytes;
    }
}
```

+ å‰å°æµ‹è¯•ï¼š

```html
<a th:href="@{/testDownload}">ä¸‹è½½å›¾ç‰‡</a>
```



ğŸŒ° å®ç°æ–‡ä»¶ä¸Šä¼ ï¼š

æ–‡ä»¶ä¸Šä¼ è¦æ±‚ `form` è¡¨å•çš„è¯·æ±‚æ–¹å¼å¿…é¡»ä¸º `post`ï¼Œå¹¶ä¸”æ·»åŠ å±æ€§ `enctype="multipart/form-data"`ã€‚

SpringMVC å°†ä¸Šä¼ çš„æ–‡ä»¶å°è£…åˆ° `MultipartFile` å¯¹è±¡ä¸­ï¼Œé€šè¿‡æ­¤å¯¹è±¡å¯ä»¥è·å–æ–‡ä»¶ç›¸å…³ä¿¡æ¯ã€‚



+ æ·»åŠ  Maven ä¾èµ– ï¼š

```xml
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.4</version>
</dependency>
```

+ åœ¨ SpringMVC é…ç½®æ–‡ä»¶ä¸­ï¼š

```xml
<!--é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼Œå°†ä¸Šä¼ æ–‡ä»¶è‡ªåŠ¨å°è£…ä¸ºMutilpartFileå¯¹è±¡-->
<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"/>
```

> å¿…é¡»è¦é…ç½® `id` å±æ€§ä¸º `multipartResolver` ï¼ŒSpringMVC æ ¹æ® `id` è·å– beanã€‚

+ æ§åˆ¶å™¨æ–¹æ³•ï¼š

```java
@RequestMapping("/testUpload")
public String testUpload(MultipartFile photo, HttpSession session) throws IOException {
    // ç›®æ ‡ç›®å½•
    String photoPath = session.getServletContext().getRealPath("photo");
    File file = new File(photoPath);
    if (!file.exists()) {
        file.mkdir();
    }
    // ç›®æ ‡æ–‡ä»¶å
    String fileName = photo.getOriginalFilename();
    // ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
    photo.transferTo(new File(photoPath + File.separator + fileName));
    return "success";
}
```



+ å‰å°æµ‹è¯•ï¼š

```html
<form th:action="@{/testUpload}" method="post" enctype="multipart/form-data">
    ä¸Šä¼ å¤´åƒï¼š<input type="file" name="photo"><br>
    <input type="submit" value="ä¸Šä¼ ">
</form>
```

> `enctype` å±æ€§å³`encode type`ï¼Œè¡¨ç¤ºç¼–ç ç±»å‹ï¼Œå®ƒè§„å®šäº†åœ¨å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰åº”è¯¥å¦‚ä½•å¯¹è¡¨å•æ•°æ®è¿›è¡Œç¼–ç ã€‚
>
> é»˜è®¤åœ°ï¼Œ`form` è¡¨å•æ•°æ®ç¼–ç é»˜è®¤å€¼ä¸º `application/x-www-form-urlencoded`ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ`enctype `è¿˜å¯ä»¥è®¾ç½®ä¸º`text/plain`
>
> è¿™ä¸‰ç§ç±»å‹æ˜¯ï¼š
>
> - `application/x-www-form-urlencoded`ï¼šé»˜è®¤å€¼ï¼ŒURL ç¼–ç 
>
> - `multipart/form-data`ï¼šæ–‡ä»¶ç±»å‹
>
> - `text/plain`ï¼šçº¯æ–‡æœ¬æ ¼å¼ç±»å‹



+ å¤„ç†æ–‡ä»¶åŒåé—®é¢˜ï¼Œä½¿ç”¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„æ–‡ä»¶åä»¥å…äº§ç”Ÿå†²çªï¼š


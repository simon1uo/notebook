---
title:  ğŸ JavaScript this æŒ‡å‘é—®é¢˜
date: 2022-06-26 19:04:23
permalink: /pages/b16ce1/
categories:
  -  ğŸª å‰ç«¯é¢è¯•é¢˜æ”¶é›†
  -  ğŸ—¾ JavaScript ç›¸å…³
  -  ğŸ JavaScript å‡½æ•°ç›¸å…³
tags:
  - 
---
> ç›¸å…³é—®é¢˜ï¼š
>
> + JavaScript ä¸­å¯¹å‡½æ•° `this` çš„ç†è§£ï¼Ÿ



## æ¦‚å¿µ

`this` å…³é”®å­—æ—¶å‡½æ•°è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ª **å†…éƒ¨å¯¹è±¡**ã€‚åªèƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œæ€»æ˜¯æŒ‡å‘ **è°ƒç”¨å®ƒ** çš„å¯¹è±¡ã€‚`this` å¯ä»¥æ›´åŠ ä½¿ç”¨ä¾¿æ·çš„æ–¹å¼æ¥å¼•ç”¨å¯¹è±¡ï¼Œè¿›è¡Œä¸€äº› API è®¾è®¡æ—¶ï¼Œä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºå¤ç”¨ã€‚

ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå‡½æ•°çš„è°ƒç”¨æ–¹å¼å†³å®šäº† `this` çš„å€¼ï¼ˆè°ƒç”¨æ—¶ç»‘å®šï¼‰ã€‚åŒæ—¶ `this` åœ¨å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦è¢«ç¡®å®šäº†å°±ä¸èƒ½å†æ›´æ”¹ã€‚



> `this` æ˜¯ä»€ä¹ˆï¼š
>
> + ä»»ä½•å‡½æ•°æœ¬è´¨ä¸Šéƒ½æ˜¯**é€šè¿‡æŸä¸ªå¯¹è±¡æ¥è°ƒç”¨çš„**ï¼Œ:star: **å¦‚æœæ²¡æœ‰åˆ¶å®šå°±æ˜¯å…¨å±€ä½œç”¨åŸŸä¸‹çš„  `window`** ã€‚
>
> + æ‰€æœ‰å‡½æ•°å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªå˜é‡ `this` ï¼›
> + å®ƒçš„å€¼æ˜¯è°ƒç”¨å‡½æ•°çš„å½“å‰å¯¹è±¡ï¼›



### `this` æŒ‡å‘ä»€ä¹ˆï¼Ÿ

åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ï¼š

+ æµè§ˆå™¨ä¸­ `this` æ²¡æœ‰æŒ‡å®šæ—¶ï¼Œä¸º `window`ï¼›
+ æ‰€ä»¥å…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œä¸€èˆ¬ `this` æŒ‡å‘çš„æ˜¯ `window`ï¼›

ä½†æ˜¯å¼€å‘ä¸­å¾ˆå°‘åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ä½¿ç”¨ `this`ï¼Œä¸€èˆ¬åœ¨å‡½æ•°ä¸­ä½¿ç”¨ `this`ã€‚

åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ª **æ‰§è¡Œä¸Šä¸‹æ–‡**ã€‚è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è®°å½•å‡½æ•°çš„è°ƒç”¨æ ˆã€å‡½æ•°çš„è°ƒç”¨æ–¹æ³•ã€ä¼ å…¥çš„å‚æ•°ä¿¡æ¯ç­‰ï¼›`this` æ˜¯å‡½æ•°å†…éƒ¨å…¶ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚

+ å‡½æ•°åœ¨å®šä¹‰æ—¶ï¼Œé»˜è®¤ä¼šç»™ `this` ç»‘å®šä¸€ä¸ªå€¼ï¼›
+ `this` çš„ç»‘å®šå’Œå®šä¹‰çš„ä½ç½®ï¼ˆç¼–å†™çš„ä½ç½®ï¼‰æ²¡æœ‰å…³ç³»ï¼›
+ `this` **çš„ç»‘å®šä¸è°ƒç”¨æ–¹å¼å’Œè°ƒç”¨çš„ä½ç½®æœ‰å…³ç³»**ã€‚

+ `this` æ˜¯åœ¨è¿è¡Œæ—¶è¢«ç»‘å®šçš„ã€‚



## ç»‘å®šè§„åˆ™

æ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œ`this` ä¼šæœ‰ä¸åŒçš„å€¼ã€‚

### é»˜è®¤ç»‘å®š

åœ¨ç‹¬ç«‹çš„å‡½æ•°ä¸­è°ƒç”¨ï¼Œæ„å‘³ç€å‡½æ•°æ²¡æœ‰ç»‘å®šåˆ°æ¯ä¸ªå¯¹è±¡ä¸Šè¿›è¡Œè°ƒç”¨ã€‚å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š

+ æ™®é€šå‡½æ•°è°ƒç”¨ã€‚å‡½æ•°ç›´æ¥è¢«è°ƒç”¨ï¼Œå¹¶æ²¡æœ‰ä»»ä½•çš„å¯¹è±¡å…³è”ã€‚è¿™ç§ç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨ä¼šä½¿ç”¨é»˜è®¤ç»‘å®šï¼Œé€šå¸¸é»˜è®¤ç»‘å®šæ—¶ï¼Œå‡½æ•°ä¸­çš„ `this` æŒ‡å‘å…¨å±€å¯¹è±¡ `window` ã€‚

  æ­¤æ—¶å…¨å±€ç¯å¢ƒä¸­å®šä¹‰çš„å˜é‡ï¼Œåœ¨å‡½æ•°ä¸­å¯ä»¥é€šè¿‡ `this` è·å–ã€‚ï¼ˆé’ˆå¯¹ `var` ç”Ÿå‘½çš„å˜é‡ï¼‰

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  var name = "Simon"
  function person() {
    return this.name
  }
  console.log(person()) // Simon
  ```

  > è°ƒç”¨ `this` çš„å¯¹è±¡æ˜¯å‡½æ•°ï¼Œè€Œå‡½æ•°æœ¬èº«æ²¡æœ‰ `name` è¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥å¾€å¤–æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°æŒ‡å‘ `window`ã€‚
  >
  > ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¸èƒ½è®²å…¨å±€å¯¹è±¡ç”¨äºé»˜è®¤ç»‘å®šï¼Œ `this` ä¼šç»‘å®šåˆ° `undefined`ã€‚



+ å‡½æ•°è°ƒç”¨é“¾ï¼šæ‰€æœ‰çš„å‡½æ•°è°ƒç”¨éƒ½æ²¡æœ‰è¢«ç»‘å®šåˆ°æŸä¸ªå¯¹è±¡ä¸Šã€‚

  ğŸŒ° ä¾‹å­ï¼š
  ```js
  function test1() {
    console.log(this); // window
    test2();
  }
  
  function test2() {
    console.log(this); // window
    test3()
  }
  
  function test3() {
    console.log(this); // window
  }
  test1();
  ```

  

+ å°†å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼š

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  function foo(func) {
    func()
  }
  
  function bar() {
    console.log(this) // window
  }
  
  foo(bar)
  ```

  ğŸŒ° ğŸŒŸ ä¾‹å­ ï¼š

  ```js
  function foo(func) {
    func()
  }
  
  var obj = {
    name: "why",
    bar: function() {
      console.log(this); // window
    }
  }
  
  foo(obj.bar);
  ```

  > æ­¤æ—¶çš„å‡½æ•°è™½ç„¶åœ¨å¯¹è±¡ä¹‹ä¸­ï¼Œä½†æ˜¯çœŸæ­£è°ƒç”¨å‡½æ•°çš„ä½ç½®ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•çš„å¯¹è±¡ç»‘å®šï¼Œåªæ˜¯ä¸€ä¸ªç‹¬ç«‹å‡½æ•°çš„è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œçš„ `this` ä»ç„¶ä¸º `window`ã€‚



### éšå¼ç»‘å®š

å‡½æ•°è¿˜å¯ä»¥ä½œä¸ºæŸä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œæ­¤æ—¶ `this` æŒ‡å‘çš„å°±æ˜¯è¿™ä¸ªä¸Šçº§å¯¹è±¡ã€‚å¯ä»¥åˆ†ä¸ºä»¥ä¸‹çš„æƒ…å†µï¼š

+ é€šè¿‡å¯¹è±¡è°ƒç”¨å‡½æ•°ï¼š

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  function foo() {
    console.log(this) // obj
  }
  
  var obj = {
    name: "Simon",
    foo: foo
  }
  
  obj.foo()
  ```

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  function foo() {
    console.log(this) // obj1
  }
  
  var obj1 = {
    name: "Simon",
    foo: foo
  }
  
  var obj2 = {
    name: "Simon2",
    obj1: obj1
  }
  
  obj2.obj1.foo()
  ```

  > æ­¤æ—¶ï¼Œ`foo` è°ƒç”¨çš„ä½ç½®ä»ç„¶æ˜¯ `obj1` ï¼Œæ‰€ä»¥è¿™é‡Œ `this` ç»‘å®šçš„å¯¹è±¡ä»ç„¶æ˜¯ `obj1`ã€‚

+ éšå¼ä¸¢å¤±ï¼š

  ```js
  function foo() {
    console.log(this) // window
  }
  
  var obj = {
    name: "Simon",
    foo: foo
  }
  
  var bar = obj1.foo
  bar()
  ```

  > å› ä¸ºè¿™é‡Œ `foo` è¢«è°ƒç”¨çš„ä½ç½®æ—¶ `bar`ï¼Œè€Œ `bar` åœ¨è¿›è¡Œè°ƒç”¨çš„æ—¶å€™æ²¡æœ‰ç»‘å®šä»»ä½•çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å½¢æˆéšå½¢ç»‘å®šã€‚ç›¸å½“äºé»˜è®¤ç»‘å®šã€‚



éšå¼ç»‘å®šæœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼š**å¿…é¡»åœ¨è°ƒç”¨çš„å¯¹è±¡å†…éƒ¨æœ‰ä¸€ä¸ªå¯¹å‡½æ•°çš„å¼•ç”¨**ï¼ˆä¾‹å¦‚ä¸€ä¸ªå±æ€§ï¼‰ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„å¼•ç”¨ï¼Œåœ¨è¿›è¡Œè°ƒç”¨çš„æ—¶å€™ï¼Œä¼šæŠ¥æ‰¾ä¸åˆ°è¯¥å‡½æ•°çš„é”™è¯¯ã€‚æ­£æ˜¯é€šè¿‡è¿™ä¸ªå¼•ç”¨ï¼Œé—´æ¥åœ°å°† `this` ç»‘å®šåˆ°è¿™ä¸ªå¯¹è±¡ä¸Šã€‚





### æ˜¾å¼ä¿®æ”¹ç»‘å®š

å¦‚æœä¸å¸Œæœ›åœ¨å¯¹è±¡å†…éƒ¨åŒ…å«è¿™ä¸ªå‡½æ•°çš„å¼•ç”¨ï¼Œåˆå¸Œæœ›åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šå¼ºåˆ¶è°ƒç”¨ã€‚ä½¿ç”¨ `apply` / `call` / `bind` æ–¹æ³•ã€‚æ”¹å˜å‡½æ•°è°ƒç”¨çš„å¯¹è±¡ï¼Œå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ”¹å˜åè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å¯¹è±¡ï¼Œå› æ­¤ `this` æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜ç¡®çš„æŒ‡å®šäº† `this` æŒ‡å‘çš„å¯¹è±¡æ‰€ä»¥ç§°ä¸ºæ˜¾å¼ç»‘å®šã€‚

> JavaScript çš„æ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨ `call` / `apply` æ–¹æ³•ã€‚



+ `call` / `apply`ï¼š

  ä¸¤è€…çš„åŒºåˆ«çŸ¥è¯†å‚æ•°ä¸Šçš„ä¼ é€’æœ‰åŒºåˆ«ï¼š[ğŸšƒ JavaScript è£…é¥°å™¨æ¨¡å¼å’Œè½¬å‘ | notebook (simon1uo.github.io)](https://simon1uo.github.io/notebook/pages/23d75e/#æ€»ç»“)ï¼ŒåŠŸèƒ½ç±»ä¼¼ã€‚

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  function foo() {
    console.log(this)
  }
  
  foo.call(window) // window
  foo.call({name: "simon"}) // {name: "simon"}
  foo.call(123) // Number å¯¹è±¡å­˜æ”¾123
  ```

+ `bind`ï¼šå¦‚æœå¸Œæœ›å‡½æ•°æ€»æ˜¯æ˜¾å¼ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œè¿™æ ·æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶å°±ä¸ç”¨æ¯æ¬¡éƒ½ç»‘å®š `this` åˆ°ä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡ä¸Šã€‚

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  function foo() {
    console.log(this) // window
  }
  
  var obj = {
    name: "simon"
  }
  
  var bar = foo.bind(obj)
  
  bar() // obj
  bar() // obj
  ```



### å†…ç½®å‡½æ•°

åœ¨ JavaScript çš„å†…ç½®å‡½æ•°ï¼ˆæˆ–è€…ç¬¬ä¸‰æ–¹åº“ä¸­çš„å†…ç½®å‡½æ•°ï¼‰ï¼Œè¿™äº›å†…ç½®å‡½æ•°å…è®¸ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸ä¼šæ˜¾å¼è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œè€Œæ˜¯ JavaScript å†…éƒ¨å¸®åŠ©æˆ‘ä»¬æ‰§è¡Œã€‚

+ `setTimeout()`ï¼š

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  setTimeout(function() {
    console.log(this) // window
  }, 1000)
  ```

  > ä¸ `setTimeout` çš„å†…éƒ¨è°ƒç”¨æœ‰å…³ã€‚`setTimeout` å†…éƒ¨é€šè¿‡ `apply` ç»‘å®š `this` å¯¹è±¡ï¼Œå¹¶ä¸”ç»‘å®šçš„æ˜¯ `window ` å¯¹è±¡ã€‚

+ `forEach()`ï¼š

  ğŸŒ° ä¾‹å­ï¼š

  ```js
  var names = ['abc', 'def', 'ghi']
  names.forEach(function(name) {
    console.log(this) // window*3
  })
  ```

  > é»˜è®¤æƒ…å†µä¸‹ä¼ å…¥çš„å‡½æ•°æ˜¯è‡ªåŠ¨è°ƒç”¨å‡½æ•°ï¼ˆé»˜è®¤ç»‘å®šï¼‰ï¼›

  å¯ä»¥æ ¹æ® `forEach(value, thisArg)` çš„æ–¹æ³•ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ”¹å˜ä¼ å…¥çš„å¯¹è±¡ï¼š

  ```js
  var obj = {name: "why"};
  names.forEach(function(name) {
    console.log(this) // window*3
  }, obj)
  ```

+ HTML å…ƒç´ çš„ç‚¹å‡»ï¼š

  ğŸŒ° ä¾‹å­ / `div` ï¼š

  ```html
  <div class="box"></div>
  ```

  ```js
  var box = document.querySelector(".box");
  box.onclick = function() {
    console.log(this); // boxå¯¹è±¡
  }
  ```

  > å› ä¸ºå‘ç”Ÿç‚¹å‡»æ—¶ï¼Œæ‰§è¡Œä¼ å…¥çš„å›è°ƒå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šå°† `box` å¯¹è±¡ç»‘å®šåˆ°è¯¥å‡½æ•°ä¸­ã€‚



ä¼ å…¥åˆ°å†…ç½®å‡½æ•°çš„å›è°ƒå‡½æ•° `this` ï¼š

+ æŸäº›å†…ç½®å‡½æ•°å¾ˆéš¾åˆ¤æ–­ã€‚ä¸€æ–¹é¢å¯ä»¥åˆ†ææºç ï¼Œå¦ä¸€æ–¹é¢é€šè¿‡ç»éªŒåˆ¤æ–­ã€‚æ— è®ºå¦‚ä½•æœ€ç»ˆéƒ½æ˜¯æ ¹æ®ä¹‹å‰çš„ é»˜è®¤ç»‘å®šæˆ–è€…éšå¼/æ˜¾å¼ç»‘å®šã€‚



### `new` ç»‘å®š

JavaScript é€šè¿‡æ„é€ å™¨ `new` å…³é”®å­—ç”Ÿæˆä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ­¤æ—¶ `this` æŒ‡å‘è¿™ä¸ªå®ä¾‹å¯¹è±¡ã€‚

> æ­¥éª¤ï¼š
>
> - åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼›
> - è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«æ‰§è¡Œ `Prototype` è¿æ¥ï¼›
> - è¿™ä¸ªæ–°å¯¹è±¡ä¼šç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„ `this` ä¸Šï¼ˆ`this` çš„ç»‘å®šåœ¨è¿™ä¸ªæ­¥éª¤å®Œæˆï¼‰ï¼›
> - å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œè¡¨è¾¾å¼ä¼šè¿”å›è¿™ä¸ªæ–°å¯¹è±¡ï¼›

ğŸŒ° ä¾‹å­ï¼š

```js
function test() {
  this.x = 1
}

var obj = new test()
obj.x // 1
```

> ä¹‹æ‰€ä»¥ `obj.x` ä¸º `1`ï¼Œæ˜¯å› ä¸º `new` æ”¹å˜äº† `this` çš„æŒ‡å‘ã€‚



ğŸŒ° ä¾‹å­ / ç‰¹æ®Šæƒ…å†µï¼š

```js
function fn() {
  this.user = 'xxx'
  return {}
}
var a = new fn()
console.log(a.user) // undefined
```

> æ­¤æ—¶ `new` çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ª `return`ï¼Œæ­¤æ—¶ `this` æŒ‡å‘çš„æ˜¯è¿”å›çš„å¯¹è±¡ã€‚
>
> å½“è¿”å›çš„æ˜¯ä¸€ä¸ªç®€å•ç±»å‹æ—¶ï¼Œ`this` æŒ‡å‘å®ä¾‹å¯¹è±¡ï¼š
>
> ```js
> function fn() {
>   this.user = 'xxx'
>   return 1
> }
> var a = new fn()
> console.log(a.user) // xxx
> ```
>
> å½“è¿”å›çš„æ˜¯ `null` æ—¶ï¼Œè™½ç„¶ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä½†æ˜¯æ­¤æ—¶ `this` æŒ‡å‘å®ä¾‹å¯¹è±¡ã€‚





### ç»‘å®šçš„ä¼˜å…ˆçº§

æ˜¾ç¤ºç»‘å®š  >`new` ç»‘å®š  > éšå¼ç»‘å®š > é»˜è®¤ç»‘å®š

+ å› ä¸ºå­˜åœ¨å…¶ä»–è§„åˆ™æ˜¯ï¼Œå°±ä¼šä½¿ç”¨å…¶ä»–è§„åˆ™ç»‘å®š `this`ã€‚è€Œä¸æ˜¯é»˜è®¤ç»‘å®šï¼Œæ‰€ä»¥é»˜è®¤ç»‘å®šçš„ä¼˜å…ˆçº§æœ€ä½ã€‚



ğŸŒ° ä¾‹å­ / éšå¼ç»‘å®šä¸æ˜¾å¼ç»‘å®šæ¯”è¾ƒï¼š

```js
function foo() {
  console.log(this.a)
}

var obj1 = {
  a: 2,
  foo: foo
}

var obj2 = {
  a: 3,
  foo: foo
}

obj1.foo() // 2
obj2.foo() // 3
obj1.foo.call(obj2) // 3
obj2,foo.call(obj1) // 2
```



ğŸŒ° ä¾‹å­ / `new` ç»‘å®šä¸éšå¼ç»‘å®šæ¯”è¾ƒï¼š

```js
function foo(something) {
  this.a = something
}

var obj1 = {
  foo: foo
}
var obj2 = {}

obj1.foo(2)
console.log(obj1.a) // 2

obj1.foo.call(obj2, 3) // 3
console.log(obj2.a) // 3

var bar = new obj1.foo(4)
console.log(obj1.a) // 2
console.log(bar.a) // 4
```



ğŸŒ° ä¾‹å­ / `new` ç»‘å®šä¸æ˜¾ç¤ºç»‘å®šæ¯”è¾ƒï¼š

```js
function foo(something) {
  this.a = something
}

var obj1 = {}
var bar = foo.bind(obj1)
bar(2)
console.log(obj1.a) // 2

var baz = new bar(3);
console.log(obj1.a) // 2
console.log(baz.a) // 3
```

> `bar`è¢«ç»‘å®šåˆ°obj1ä¸Šï¼Œä½†æ˜¯`new bar(3)` å¹¶æ²¡æœ‰åƒæˆ‘ä»¬é¢„è®¡çš„é‚£æ ·æŠŠ`obj1.a`ä¿®æ”¹ä¸º3ã€‚ä½†æ˜¯ï¼Œ`new`ä¿®æ”¹äº†ç»‘å®šè°ƒç”¨`bar()`ä¸­çš„`this`



## å…¶ä»–æƒ…å†µç»‘å®šè§„åˆ™

### å¿½ç•¥è§„åˆ™ç»‘å®š

å¦‚æœåœ¨æ˜¾å¼ç»‘å®šä¸­ï¼Œç»‘å®šå¯¹è±¡æ—¶ä¼ å…¥çš„å‚æ•°ä¸º `undefined` æˆ–è€… `null`ï¼Œé‚£ä¹ˆè¿™ä¸ªæ˜¾å¼ç»‘å®šå°±ä¼šè¢«å¿½ç•¥ï¼Œç„¶åä½¿ç”¨é»˜è®¤è§„åˆ™ã€‚

ğŸŒ° ä¾‹å­ï¼š

```js
function foo() {
  console.log(this)
}

var obj = {
  name = "simon"
}

foo.call(obj) // obj
foo.call(undefined) // window
foo.call(null) // window

var bar = foo.bind(null)
bar() // window
```



### é—´æ¥å‡½æ•°å¼•ç”¨

åˆ›å»ºå‡½æ•°çš„é—´æ¥å¼•ç”¨ï¼Œè¿™æ—¶ä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚

ğŸŒ° ä¾‹å­ï¼š

```js
var num1 = 100
var num2 = 0
var result = (num2 = num1)
console.log(result) // 100
```

å¼•ç”³åˆ°ï¼š

```js
function foo() {
  console.log(this)
}

var obj1 = {
  name = "obj1",
  foo: foo
}

var obj2 = {
 	name = "obj2" 
}

obj1.foo() // obj1
(obj2.foo = obj1.foo)() // window 
```

> å› ä¸ºèµ‹å€¼ `(obj2.foo = obj1.foo)` çš„ç»“æœæ˜¯ `foo` å‡½æ•°ã€‚æ‰€ä»¥ `foo` å‡½æ•°è¢«ç›´æ¥è°ƒç”¨ï¼Œä½¿ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚



### ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘

ES6 ä¸­ç®­å¤´å‡½æ•°çš„è¯­æ³•ï¼Œä¸ä½¿ç”¨å››ç§ç»‘å®šè§„åˆ™ï¼ˆä¸ç»‘å®š `this` ï¼‰ï¼Œè€Œæ˜¯ç”±å¤–å±‚ä½œç”¨åŸŸå†³å®š `this`ã€‚

ğŸŒ° ä¾‹å­ï¼š

```js
var obj = {
  data: [],
  getData: function() {
    var _this = this;
    setTimeout(function() {
      // æ¨¡æ‹Ÿè·å–åˆ°çš„æ•°æ®
      var res = ["abc", "cba", "nba"];
      _this.data.push(...res);
    }, 1000);
  }
}

obj.getData();
```

> ä½¿ç”¨ `setTimeout` æ¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œéœ€è¦é€šè¿‡ `this` è·å– `obj` å¯¹è±¡å­˜æ”¾åˆ° `data`ã€‚ä½†æ˜¯`setTimeout` ä¸­çš„å‡½æ•°ç›´æ¥çš„ `this` ç»‘å®šçš„æ˜¯ `window` ï¼Œæ‰€ä»¥éœ€è¦åœ¨å¤–å±‚å®šä¹‰ `var _this = this`ã€‚

å¦‚æœä½¿ç”¨ ç®­å¤´å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `this`ã€‚å› ä¸ºç®­å¤´å‡½æ•°ä¸ä¼šç»‘å®š `this`  å¯¹è±¡ï¼Œé‚£ä¹ˆ `this` å¼•ç”¨å°±ä¼šä»ä¸Šå±‚ä½œç”¨åŸŸæ‰¾åˆ°å¯¹åº”çš„ `this`ï¼š
```js
var obj = {
  data: [],
  getData: function() {
    setTimeout(() => {
      // æ¨¡æ‹Ÿè·å–åˆ°çš„æ•°æ®
      var res = ["abc", "cba", "nba"];
      this.data.push(...res);
    }, 1000);
  }
}

obj.getData();
```

å¦‚æœ `getData` ä¹Ÿæ˜¯ç®­å¤´å‡½æ•°ï¼š

```js
var obj = {
  data: [],
  getData: () => {
    setTimeout(() => {
      console.log(this)
    }, 1000);
  }
}

obj.getData();
```

> é‚£ä¹ˆ `this` ä¼šä»ä¸Šå±‚ä½œç”¨åŸŸæ‰¾ï¼Œæ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸã€‚æ‰€ä»¥ä¸º `window`ã€‚



## å‚è€ƒ

+ [é¢è¯•å®˜ï¼šè°ˆè°ˆthiså¯¹è±¡çš„ç†è§£ | webå‰ç«¯é¢è¯• - é¢è¯•å®˜ç³»åˆ— (vue3js.cn)](https://vue3js.cn/interview/JavaScript/this.html#ä¸€ã€å®šä¹‰)
+ [å‰ç«¯é¢è¯•ä¹‹å½»åº•ææ‡‚thisæŒ‡å‘ (qq.com)](https://mp.weixin.qq.com/s/hYm0JgBI25grNG_2sCRlTA)
+ å°šç¡…è°· JavaScript è¿›é˜¶æ•™ç¨‹
+ [this - JavaScript | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this)
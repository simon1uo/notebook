---
title:  ğŸ JavaScript new æ“ä½œç¬¦ç›¸å…³
date: 2022-07-02 22:08:08
permalink: /pages/b0ab4c/
categories:
  -  ğŸª å‰ç«¯é¢è¯•é¢˜æ”¶é›†
  -  ğŸ—¾ JavaScript ç›¸å…³
  -  ğŸ JavaScript å¯¹è±¡ç›¸å…³
tags:
  - 
---
> ç›¸å…³é—®é¢˜ï¼›
>
> + å¯¹ `new` æ“ä½œç¬¦çš„ç†è§£ï¼Ÿ
>
> +  `new` æ“ä½œç¬¦å·å…·ä½“åšäº†ä»€ä¹ˆï¼Ÿ



## æ¦‚å¿µ

JavaScript ä¸­ï¼Œ `new` æ“ä½œç¬¦ç”¨äºåˆ›å»ºä¸€ä¸ªç»™å®š **æ„é€ å‡½æ•°** çš„ **å®ä¾‹å¯¹è±¡**ã€‚

ğŸŒ° ä¾‹å­ï¼š

```js
function Person(name, age) {
  this.name = name;
  this.age = age
}

Person.prototype.sayName = function() {
  console.log(this.name)
}

const person1 = new Person("Simon", 18)
console.log(person1)
person1.sayName() // "Simon"
```

è¿™ä¸ªä¾‹å­ä¸­ï¼š`new` é€šè¿‡æ„é€ å‡½æ•° `Person` åˆ›å»ºå‡ºæ¥çš„å®ä¾‹å¯¹è±¡å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§ï¼›å¹¶ä¸”å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹é“¾ä¸­çš„å±æ€§ï¼Œå³ **å®ä¾‹å¯¹è±¡ä¸æ„é€ å‡½æ•°é€šè¿‡åŸå‹é“¾ è¿æ¥èµ·æ¥**ã€‚



ğŸŒ° ä¾‹å­ / æ„é€ å‡½æ•°æ‹¥æœ‰è¿”å›å€¼ï¼š
```js
function Test(name) {
  this.name = name
  return 1
}

const test = new Test("test")
console.log(test.name) // "test"
```

> å¦‚æœæ„é€ å‡½æ•°æ‹¥æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”è¿”å›å€¼çš„ç±»å‹æ˜¯åŸå§‹ç±»å‹ã€‚ä½†æ˜¯è¿™ä¸ªè¿”å›å€¼å¹¶æ²¡æœ‰ä½œç”¨ã€‚

ä½†æ˜¯å¦‚æœ **æ„é€ å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯ä¸€ä¸ªå¯¹è±¡**ï¼š

```js
function Test(name) {
  this.name = name
  console.log(this.name)
  return {age: 18}
}

const test = new Test("Simon")
console.log(test) // {age: 18}
console.log(test.name) // undefined
```

> å¦‚æœæ„é€ å‡½æ•°çš„è¿”å›å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¼šè¢«æ­£å¸¸ä½¿ç”¨ã€‚å³åˆ›å»ºçš„å®ä¾‹å¯¹è±¡éƒ½æ˜¯è¿™ä¸ªè¿”å›å€¼ã€‚



## `new` çš„è¿‡ç¨‹ä¸­åšäº†ä»€ä¹ˆï¼Ÿ

ä¸»è¦å®Œæˆä»¥ä¸‹å·¥ä½œï¼š

+ åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›

+ å°†å¯¹è±¡ä¸æ„é€ å‡½æ•°é€šè¿‡åŸå‹é“¾é“¾æ¥èµ·æ¥ã€‚

  å°†æ–°å¯¹è±¡çš„ `[[prototype]]` æŒ‡å‘ä¸º `æ„é€ å‡½æ•°.prototype`

+ æ ¹æ®æ„é€ å‡½æ•°çš„è¿”å›ç±»å‹åšåˆ¤æ–­ï¼Œå¦‚æœæ˜¯åŸå§‹å€¼åˆ™ä¼šè¢«å¿½ç•¥ï¼Œå¦‚æœæ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦æ­£å¸¸å¤„ç†ã€‚



![b429b990-7a39-11eb-85f6-6fac77c0c9b3](https://cdn.jsdelivr.net/gh/simon1uo/image-flow@master/image/tMmnbx.png)



## æ‰‹å†™æ¨¡æ‹Ÿå®ç° `new` æ“ä½œç¬¦

```js
function iNew(func, ...args) {
  // åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡
  const obj = {}
  // è¿æ¥åŸå‹
  obj.__proto__ = func.prototype
  // å°†æ„é€ å‡½æ•°çš„ this è¿æ¥åˆ°æ–°çš„å¯¹è±¡
  let result = func.apply(obj, args)
  // æ ¹æ®è¿”å›å€¼åˆ¤æ–­
  return result instanceof Object ? result : obj
}
```

æµ‹è¯•ä½¿ç”¨ï¼š
```js
function Person(name, age) {
  this.name = name
  this.age = age
}

Person.prototype.sayName = function() {
  console.log(this.name)
}

let person = iNew(Person, "Simon", 18)
console.log(person)
```


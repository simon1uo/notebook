---
title:  ğŸŒ“ æ‹“å±•åˆ›å»ºaxiosé™æ€æ¥å£
date: 2022-06-17 01:06:02
permalink: /pages/87b8ba/
categories:
  -  ğŸš¶ğŸ» å‰ç«¯å·©å›ºåŸºç¡€
  -  ğŸšŸ axios
  -  ğŸ’½ ä½¿ç”¨ TypeScript é‡æ„ axios åº“
tags:
  - 
---
## éœ€æ±‚åˆ†æ

ç›®å‰ä¸ºæ­¢ï¼Œ`aixos` éƒ½æ˜¯ä¸€ä¸ªè›‹é‡Œï¼Œä¸€æ—¦ä¿®æ”¹äº† `aixos` çš„é»˜è®¤é…ç½®ï¼Œä¼šå½±å“æ‰€æœ‰çš„è¯·æ±‚ã€‚å¸Œæœ›æä¾›ä¸€ä¸ª `axios.create` çš„é™æ€æ¥å£å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `axios.create` çš„é™æ€æ¥å£å…è®¸åˆ›å»ºä¸€ä¸ªæ–°çš„ `axios` å®ä¾‹ï¼ŒåŒæ—¶å…è®¸ä¼ å…¥æ–°çš„é…ç½®å’Œé»˜è®¤é…ç½®åˆå¹¶ï¼Œå¹¶ä½œä¸ºæ–°çš„é»˜è®¤é…ç½®ã€‚

> ğŸŒ° ä¾‹å­ï¼š
>
> ```typescript
> const instance = axios.create({
>   transformRequest: [(function(data) {
>     return qs.stringify(data)
>   }), ...(axios.defaults.transformRequest as AxiosTransformer[])],
>   transformResponse: [...(axios.defaults.transformResponse as AxiosTransformer[]), function(data) {
>     if (typeof data === 'object') {
>       data.b = 2
>     }
>     return data
>   }]
> })
> 
> instance({
>   url: '/config/post',
>   method: 'post',
>   data: {
>     a: 1
>   }
> })
> ```
>
> > `instance` æ˜¯åˆ©ç”¨ `axios.create` åˆ›å»ºçš„ `axios` å®ä¾‹ã€‚



## é™æ€æ–¹æ³•æ‹“å±•

åœ¨ `src/type/index.ts` ä¸­ä¿®æ”¹æ¥å£ç±»å‹å®šä¹‰ï¼š

```typescript
export interface AxiosStatic extends AxiosInstance {
  create(config?: AxiosRequestConfig): AxiosInstance
}
```

> `create` å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ª `AxiosRequestConfig` ç±»å‹çš„é…ç½®ä½œä¸ºé»˜è®¤é…ç½®çš„æ‹“å±•ï¼Œä¹Ÿå¯ä»¥æ¥å—ä¸ä¼ å‚æ•°ã€‚



æ¥ä¸‹æ¥å®ç° `axios.create` é™æ€æ–¹æ³•ã€‚

åœ¨ `src/axios.ts` ä¸­ï¼š

```typescript
function createInstance(config: AxiosRequestConfig): AxiosStatic {
  const context = new Axios(config)
  const instance = Axios.prototype.request.bind(context)

  extend(instance, context)

  return instance as AxiosStatic
}

const axios = createInstance(defaults)

axios.create = function create(config) {
  return createInstance(mergeConfig(defaults, config))
}
```

> å°† `createInstance` æ–¹æ³•çš„è¿”å›å€¼ç±»å‹è®¾ç½®ä¸º `AxiosStatic`ã€‚
>
> `axios.create` çš„å†…éƒ¨è°ƒç”¨äº† `createInstance` å‡½æ•°ï¼Œå¹¶ä¸”æŠŠå‚æ•° `config` äº `defaults` åˆå¹¶ï¼Œä½œä¸ºæ–°çš„é»˜è®¤é…ç½®ã€‚



## ç¼–å†™æµ‹è¯• DEMO



```typescript
const instance = axios.create({
  transformRequest: [
    function(data) {
      return qs.stringify(data)
    },
    ...(axios.defaults.transformRequest as AxiosTransformer[])
  ],
  transformResponse: [
    ...(axios.defaults.transformResponse as AxiosTransformer[]),
    function(data) {
      if (typeof data === 'object') {
        data.b = 2
      }
      return data
    }
  ]
})

instance({
  url: '/config/post',
  method: 'post',
  data: {
    a: 1
  }
}).then((res) => {
  console.log(res.data)
})
```

> é€šè¿‡ `axios.create` æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ `instance`ï¼Œå¹¶ä¼ å…¥äº† `transformRequest` å’Œ `transformResponse` çš„é…ç½®ä¿®æ”¹äº†é»˜è®¤é…ç½®ï¼Œç„¶åé€šè¿‡ `instance` å‘é€è¯·æ±‚ï¼Œæ•ˆæœå’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ã€‚
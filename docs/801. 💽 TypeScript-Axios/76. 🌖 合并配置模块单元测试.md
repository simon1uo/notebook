---
title:  ğŸŒ– åˆå¹¶é…ç½®æ¨¡å—å•å…ƒæµ‹è¯•
date: 2022-06-18 15:31:03
permalink: /pages/f2e77e/
categories:
  -  ğŸš¶ğŸ» å‰ç«¯å·©å›ºåŸºç¡€
  -  ğŸšŸ axios
  -  ğŸ’½ ä½¿ç”¨ TypeScript é‡æ„ axios åº“
tags:
  - 
---
## æµ‹è¯•ä»£ç ç¼–å†™

åˆ›å»ºæ–‡ä»¶ `test/mergeConfig.spect.ts`ï¼š

```typescript
import axios from '../src/index'
import mergeConfig from '../src/core/mergeConfig'

describe('mergeConfig', () => {
  const defaults = axios.defaults

  test('should accept undefined for second argument', () => {
    expect(mergeConfig(defaults, undefined)).toEqual(defaults)
  })

  test('should accept an object for second argument', () => {
    expect(mergeConfig(defaults, {})).toEqual(defaults)
  })

  test('should not leave references', () => {
    const merged = mergeConfig(defaults, {})
    expect(merged).not.toBe(defaults)
    expect(merged.headers).not.toBe(defaults.headers)
  })

  test('should allow setting request options', () => {
    const config = {
      url: '__sample url__',
      params: '__sample params__',
      data: { foo: true }
    }
    const merged = mergeConfig(defaults, config)
    expect(merged.url).toBe(config.url)
    expect(merged.params).toBe(config.params)
    expect(merged.data).toEqual(config.data)
  })

  test('should not inherit request options', () => {
    const localDefaults = {
      url: '__sample url__',
      params: '__sample params__',
      data: { foo: true }
    }
    const merged = mergeConfig(localDefaults, {})
    expect(merged.url).toBeUndefined()
    expect(merged.params).toBeUndefined()
    expect(merged.data).toBeUndefined()
  })

  test('should return default headers if pass config2 with undefined', () => {
    expect(
      mergeConfig(
        {
          headers: 'x-mock-header'
        },
        undefined
      )
    ).toEqual({
      headers: 'x-mock-header'
    })
  })

  test('should merge auth, headers with defaults', () => {
    expect(
      mergeConfig(
        {
          auth: undefined
        },
        {
          auth: {
            username: 'foo',
            password: 'test'
          }
        }
      )
    ).toEqual({
      auth: {
        username: 'foo',
        password: 'test'
      }
    })
    expect(
      mergeConfig(
        {
          auth: {
            username: 'foo',
            password: 'test'
          }
        },
        {
          auth: {
            username: 'baz',
            password: 'foobar'
          }
        }
      )
    ).toEqual({
      auth: {
        username: 'baz',
        password: 'foobar'
      }
    })
  })

  test('should overwrite auth, headers with a non-object value', () => {
    expect(
      mergeConfig(
        {
          headers: {
            common: {
              Accept: 'application/json, text/plain, */*'
            }
          }
        },
        {
          headers: null
        }
      )
    ).toEqual({
      headers: null
    })
  })

  test('should allow setting other options', () => {
    const merged = mergeConfig(defaults, {
      timeout: 123
    })
    expect(merged.timeout).toBe(123)
  })
})
```

æµ‹è¯•å‘ç°çš„é—®é¢˜ï¼š

+ `mergeConfig.ts` æ–‡ä»¶çš„åˆ†æ”¯è¦†ç›–ç‡å¹¶æœªè¾¾åˆ° 100%ï¼Œæç¤ºæ˜¯ 23 è¡Œï¼Œæ‰“å¼€æ–‡ä»¶åå‘ç°æœ€åä¸€ä¸ª `else` é€»è¾‘å¹¶æœªèµ°åˆ°ï¼Œä¹Ÿå°±æ˜¯ `val1` ä¸º `undefined` çš„æƒ…å†µã€‚ä½†å®é™…ä¸Šå³ä½¿ `val1` ä¸º `undefined`ï¼Œä¹Ÿæ˜¯è¿”å› `undefined`ï¼Œä¹Ÿå°±æ˜¯è¿”å› `val1`ï¼Œæ‰€ä»¥è¿™å—ä»£ç çš„é€»è¾‘å¯ä»¥ä¼˜åŒ–ã€‚

  ï¼ˆ`src/core/mergeConfig.ts`ï¼‰ï¼š

  ```typescript
  function deepMergeStrat(val1: any, val2: any): any {
    if (isPlainObject(val2)) {
      return deepMerge(val1, val2)
    } else if (typeof val2 !== 'undefined') {
      return val2
    } else if (isPlainObject(val1)) {
      return deepMerge(val1)
    } else if (typeof val1 !== 'undefined') {
      return val1
    }
  }
  ```
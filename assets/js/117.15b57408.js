(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{445:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("é•¿è½®è¯¢æ˜¯ "),s("strong",[t._v("ä¸æœåŠ¡å™¨ä¿æŒæŒä¹…è¿æ¥")]),t._v(" çš„æœ€ç®€å•çš„æ–¹å¼ï¼Œå®ƒä¸ä½¿ç”¨ä»»ä½•ç‰¹å®šçš„åè®®ã€‚ï¼ˆä¾‹å¦‚ WebSocket æˆ–è€… Server Sent Eventï¼‰æ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œé€‚ç”¨è¾ƒå¤šåœºæ™¯ã€‚")]),t._v(" "),s("h2",{attrs:{id:"å¸¸è§„è½®è¯¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¸¸è§„è½®è¯¢"}},[t._v("#")]),t._v(" å¸¸è§„è½®è¯¢")]),t._v(" "),s("p",[t._v("å®šæœŸè½®è¯¢æ˜¯ä»æœåŠ¡å™¨è·å–æ–°ä¿¡æ¯çš„æœ€ç®€å•çš„æ–¹å¼ï¼ˆå®šæœŸå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼‰ã€‚ä½œä¸ºå“åº”ï¼ŒæœåŠ¡å™¨é¦–å…ˆé€šçŸ¥è‡ªå·±ï¼Œå®¢æˆ·ç«¯å¤„äºåœ¨çº¿çŠ¶æ€ï¼Œç„¶åå‘é€ç›®å‰ä¸ºæ­¢çš„æ¶ˆæ¯åŒ…ã€‚")]),t._v(" "),s("p",[t._v("ä½¿ç”¨å®šæœŸè½®è¯¢çš„ç¼ºç‚¹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¶ˆæ¯ä¼ é€’å­˜åœ¨å»¶è¿Ÿï¼ˆä¸¤ä¸ªè¯·æ±‚ä¹‹é—´ï¼‰ï¼›")]),t._v(" "),s("li",[t._v("å³ä½¿æ²¡æœ‰æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šæ¯éš” 10 ç§’è¢«è¯·æ±‚è½°ç‚¸ä¸€æ¬¡ï¼Œå³ä½¿ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–åœ°æ–¹æˆ–è€…å¤„äºä¼‘çœ çŠ¶æ€ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚å°±æ€§èƒ½è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ‹…ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("å¯¹äºå°å‹æœåŠ¡æˆ–è®¸å¯è¡Œã€‚")])]),t._v(" "),s("h2",{attrs:{id:"é•¿è½®è¯¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é•¿è½®è¯¢"}},[t._v("#")]),t._v(" é•¿è½®è¯¢")]),t._v(" "),s("p",[t._v("æ˜¯è½®è¯¢æœåŠ¡å™¨çš„ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼Œå®¹æ˜“å®ç°ï¼Œ"),s("strong",[t._v("å¯ä»¥æ— å»¶è¿Ÿä¼ é€’æ¶ˆæ¯")]),t._v("ã€‚é•¿è½®è¯¢æµç¨‹ä¸ºï¼š")]),t._v(" "),s("ul",[s("li",[t._v("è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼›")]),t._v(" "),s("li",[t._v("æœåŠ¡å™¨åœ¨"),s("strong",[t._v("æœ‰æ¶ˆæ¯æ—¶ä¹‹å‰ä¸ä¼šå…³é—­è¿æ¥")]),t._v("ï¼›")]),t._v(" "),s("li",[t._v("å½“æ¶ˆæ¯å‡ºç°æ—¶ï¼ŒæœåŠ¡å™¨å°†å¯¹å…¶åšå‡ºå“åº”ï¼›")]),t._v(" "),s("li",[t._v("æµè§ˆå™¨ç«‹å³å‘é€æ–°çš„è¯·æ±‚ã€‚")])]),t._v(" "),s("p",[t._v("å¯¹äºæ­¤æ–¹æ³•ï¼Œæµè§ˆå™¨å‘å‡ºä¸€ä¸ªè¯·æ±‚å¹¶ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹èµ·ä¸€ä¸ª "),s("strong",[t._v("æŒ‚èµ·çš„è¿æ¥")]),t._v(" çš„æƒ…å†µæ˜¯æ ‡å‡†çš„ã€‚ä»…åœ¨æœ‰æ¶ˆæ¯è¢«ä¼ é€’æ—¶ï¼Œæ‰ä¼šé‡æ–°å»ºç«‹è¿æ¥ã€‚")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"/Users/Simon/Library/Application%20Support/typora-user-images/image-20220601161138146.png",alt:"image-20220601161138146"}}),t._v(" "),s("p",[t._v("ğŸŒ° ä¾‹å­ / å®ç°é•¿è½®è¯¢å®¢æˆ·ç«¯çš„å‡½æ•°ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/subsribe"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 502 è¶…æ—¶é”™è¯¯")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¶…æ—¶å¯¼è‡´è¿æ¥æŒ‚èµ·æ—¶é—´è¿‡é•¿ï¼Œè¿œç¨‹æœåŠ¡å™¨æˆ–è€…ä»£ç†ä¼šå…³é—­è¯¥è¿æ¥")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é‡æ–°è¿æ¥")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subsribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‘ç”Ÿé”™è¯¯æ—¶")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("showMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸€ç§’åé‡æ–°è¿æ¥")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subsribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–æ¶ˆæ¯")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" message "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ˜¾ç¤ºæ¶ˆæ¯")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("showMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨ subsribe() è·å–ä¸‹ä¸€æ¡æ¶ˆæ¯")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subsribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br")])]),s("blockquote",[s("p",[s("code",[t._v("subscribe")]),t._v("  å‡½æ•°å‘èµ·äº†ä¸€ä¸ª  "),s("code",[t._v("fetch")]),t._v(" ï¼Œç„¶åç­‰å¾…å“åº”ï¼Œå¤„ç†å®ƒï¼Œå¹¶å†æ¬¡è°ƒç”¨è‡ªèº«ã€‚")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("æç¤º")]),t._v(" "),s("p",[t._v("å¯¹äºæœåŠ¡å™¨ï¼Œåº”è¯¥å¯ä»¥å¤„ç†è®¸å¤šæŒ‚èµ·çš„è¿æ¥ã€‚æŸäº›æœåŠ¡å™¨æ¶æ„æ˜¯æ¯ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯¼è‡´è¿›ç¨‹æ•°å’Œè¿æ¥æ•°ä¸€æ ·å¤šï¼Œè€Œæ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæ¶ˆè€—ç›¸å½“å¤šçš„å†…å­˜ã€‚å› æ­¤ï¼Œè¿‡å¤šçš„è¿æ¥ä¼šæ¶ˆè€—æ‰å…¨éƒ¨å†…å­˜ã€‚")])]),t._v(" "),s("p",[t._v("é•¿è½®è¯¢çš„ä½¿ç”¨åœºæ™¯ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åœ¨æ¶ˆæ¯å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œé•¿è½®è¯¢å¾ˆæœ‰æ•ˆã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœæ¶ˆæ¯æ¯”è¾ƒé¢‘ç¹ï¼Œé‚£ä¹ˆä¸Šé¢æç»˜çš„è¯·æ±‚ - æ¥æ”¶æ¶ˆæ¯çš„å›¾è¡¨å°±ä¼šå˜æˆé”¯çŠ¶çŠ¶ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚ï¼Œå¹¶å¸¦æœ‰ headerï¼Œèº«ä»½éªŒè¯ç­‰å¢åŠ äº†å¼€é”€ã€‚æ­¤æ—¶ï¼Œåº”è¯¥é€‰æ‹©å¦ä¸€ç§æ–¹æ³•ï¼ˆWebSocket æˆ–è€… Server Sent Eventsï¼‰")])]),t._v(" "),s("h2",{attrs:{id:"websocket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[t._v("#")]),t._v(" WebSocket")]),t._v(" "),s("p",[t._v("æ˜¯ä¸€ä¸ªæä¾›æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ "),s("strong",[t._v("å»ºç«‹æŒä¹…è¿æ¥")]),t._v(" æ¥ "),s("strong",[t._v("äº¤æ¢æ•°æ®")]),t._v(" çš„æ–¹æ³•åè®®ã€‚æ•°æ®å¯ä»¥ä½œä¸ºã€Œæ•°æ®åŒ…ã€åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä¼ é€’ï¼Œè€Œä¸ä¼šæ–­å¼€è¿æ¥å’Œå…¶ä»– HTTP è¯·æ±‚ã€‚")]),t._v(" "),s("p",[t._v("å¯¹äºéœ€è¦è¿ç»­æ•°æ®äº¤æ¢çš„æœåŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œæ¸¸æˆï¼Œå®æ—¶äº¤æ˜“ç³»ç»Ÿç­‰ï¼ŒWebSocket å°¤å…¶æœ‰ç”¨ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("WebSocket æ²¡æœ‰è·¨æºé™åˆ¶ã€‚")]),t._v(" "),s("li",[t._v("æµè§ˆå™¨å¯¹ WebSocket æ”¯æŒå¾ˆå¥½ã€‚")]),t._v(" "),s("li",[t._v("å¯ä»¥å‘é€ / æ¥æ”¶å­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶æ•°æ®ã€‚")])]),t._v(" "),s("p",[t._v("åˆ›å»º WebSocket è¿æ¥ï¼Œéœ€è¦åœ¨ URL "),s("strong",[t._v("ä½¿ç”¨ç‰¹æ®Šçš„åè®®  "),s("code",[t._v("ws")])]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" socket "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ws://javascript.info"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("åŠ å¯†çš„  "),s("code",[t._v("wss://")]),t._v("  åè®®ï¼Œç±»ä¼¼äº HTTPSã€‚")]),t._v(" "),s("p",[s("code",[t._v("wss://")]),t._v("  åè®®ä¸ä»…æ˜¯è¢«åŠ å¯†çš„ï¼Œè€Œä¸”æ›´å¯é ã€‚å› ä¸º  "),s("code",[t._v("ws://")]),t._v("  ä¸­æ•°æ®ä¸æ˜¯åŠ å¯†çš„ï¼Œå¯¹äºä»»ä½•ä¸­é—´äººæ¥è¯´å…¶æ•°æ®éƒ½æ˜¯å¯è§çš„ã€‚å¹¶ä¸”ï¼Œæ—§çš„ä»£ç†æœåŠ¡å™¨ä¸äº†è§£ WebSocketï¼Œå¯èƒ½ä¼šå› ä¸ºå¥‡æ€ªçš„ header è€Œä¸­æ­¢è¿æ¥ï¼› "),s("code",[t._v("wss://")]),t._v("  æ˜¯åŸºäº TLS çš„ WebSocketï¼Œç±»ä¼¼äº HTTPS æ˜¯åŸºäº TLS çš„ HTTPï¼‰ï¼Œ"),s("strong",[t._v("ä¼ è¾“å®‰å…¨å±‚åœ¨å‘é€æ–¹å¯¹æ•°æ®è¿›è¡Œäº†åŠ å¯†ï¼Œåœ¨æ¥æ”¶æ–¹è¿›è¡Œè§£å¯†")]),t._v("ã€‚å› æ­¤ï¼Œæ•°æ®åŒ…æ˜¯é€šè¿‡ä»£ç†åŠ å¯†ä¼ è¾“çš„ã€‚å®ƒä»¬çœ‹ä¸åˆ°ä¼ è¾“çš„é‡Œé¢çš„å†…å®¹ï¼Œä¸”ä¼šè®©è¿™äº›æ•°æ®é€šè¿‡ã€‚")])]),t._v(" "),s("p",[t._v("WebSocket è¢«å»ºç«‹åï¼Œå°±å¯ä»¥ç›‘å¬  "),s("code",[t._v("socket")]),t._v("  çš„äº‹ä»¶ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("open")]),t._v(" ï¼šè¿æ¥å·²å»ºç«‹ï¼›")]),t._v(" "),s("li",[s("code",[t._v("message")]),t._v(" ï¼šæ¥æ”¶åˆ°æ•°æ®ï¼›")]),t._v(" "),s("li",[s("code",[t._v("error")]),t._v(" ï¼šè¿æ¥å‡ºé”™ï¼›")]),t._v(" "),s("li",[s("code",[t._v("close")]),t._v(" ï¼šè¿æ¥å·²å…³é—­ï¼›")])]),t._v(" "),s("p",[t._v("ä½¿ç”¨ WebSocket å‘é€æ•°æ®ä½¿ç”¨  "),s("code",[t._v("socket.send(data)")]),t._v("  æ–¹æ³•ã€‚")]),t._v(" "),s("p",[t._v("ğŸŒ° ä¾‹å­ / ä½¿ç”¨ WebSocket å‘é€æ•°æ®ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" socket "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wss://javascript.info/article/websocket/demo/hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nsocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[open] Connection established"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sending to server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"My name is John"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‘é€æ¶ˆæ¯")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nsocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("[message] Data received from server: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nsocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wasClean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("[close] Connection closed cleanly, code=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" reason=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reason"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¾‹å¦‚æœåŠ¡å™¨è¿›ç¨‹è¢«æ€æ­»æˆ–ç½‘ç»œä¸­æ–­")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œevent.code é€šå¸¸ä¸º 1006")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[close] Connection died'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nsocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("[error] ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br")])]),s("h3",{attrs:{id:"å»ºç«‹è¿æ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å»ºç«‹è¿æ¥"}},[t._v("#")]),t._v(" å»ºç«‹è¿æ¥")]),t._v(" "),s("p",[t._v("å½“  "),s("code",[t._v("new WebSocket(url)")]),t._v("  åˆ›å»ºæ—¶ï¼Œå»ºç«‹èµ·äº†è¿æ¥ã€‚")]),t._v(" "),s("p",[t._v("è¿æ¥æœŸé—´ï¼Œæµè§ˆå™¨ä½¿ç”¨å“åº”å¤´ header å‘é€è¯·æ±‚è¯¢é—®æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ WebSocketï¼Œ å¦‚æœæ”¯æŒæ‰ä¼šä»¥ WebSocket åè®®ç»§ç»­è¿›è¡Œã€‚")]),t._v(" "),s("p",[t._v("ğŸŒ° ä¾‹å­ /  "),s("code",[t._v('new WebSocket("wss://javascript.info/chat")')]),t._v("  è¯·æ±‚å¤´å†…å®¹ï¼š")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("GET /chat\nHost: javascript.info\nOrigin: https://javascript.info\nConnection: Upgrade\nUpgrade: websocket\nSec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==\nSec-WebSocket-Version: 13\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("blockquote",[s("ul",[s("li",[s("code",[t._v("Origin")]),t._v(" ï¼šå®¢æˆ·ç«¯é¡µé¢çš„æºã€‚WebSocket å¯¹è±¡æ˜¯ "),s("strong",[t._v("åŸç”Ÿæ”¯æŒè·¨æº")]),t._v(" çš„ã€‚æ²¡æœ‰ç‰¹æ®Šçš„ header æˆ–å…¶ä»–é™åˆ¶ã€‚~~ æ—§çš„æœåŠ¡å™¨æ— æ³•å¤„ç† WebSocketï¼Œå› æ­¤ä¸å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚~~ ä½†æ˜¯  "),s("code",[t._v("Origin")]),t._v("  å¾ˆé‡è¦ï¼Œå®ƒå…è®¸æœåŠ¡å™¨å†³å®šæ˜¯å¦ä½¿ç”¨ WebSocket ä¸è¯¥ç½‘ç«™é€šä¿¡ï¼›")]),t._v(" "),s("li",[s("code",[t._v("Connection: Upgrade")]),t._v(" ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯æƒ³è¦ "),s("strong",[t._v("æ›´æ”¹åè®®")]),t._v("ï¼›")]),t._v(" "),s("li",[s("code",[t._v("Upgrade: websocket")]),t._v("  ï¼šæ›´æ”¹è¯·æ±‚çš„åè®®ä¸º "),s("strong",[s("code",[t._v("websocket")])]),t._v("ï¼›")]),t._v(" "),s("li",[s("code",[t._v("Sec-WebSocket-Key")]),t._v("  ï¼šæµè§ˆå™¨éšæœºç”Ÿæˆçš„å®‰å…¨å¯†é’¥ã€‚")]),t._v(" "),s("li",[s("code",[t._v("Sec-WebSocket-Version")]),t._v("  ï¼šWebSocket åè®®ç‰ˆæœ¬ï¼Œå½“å‰ä¸º 13ã€‚`")])])]),t._v(" "),s("p",[s("strong",[t._v("æ³¨æ„ä¸å¯ä»¥æ¨¡æ‹Ÿ WebSocket æ¡æ‰‹")]),t._v("ï¼Œä¾‹å¦‚ä½¿ç”¨  "),s("code",[t._v("XMLHttpRequest")]),t._v("  æˆ–  "),s("code",[t._v("fetch")]),t._v("  è®¾ç½®è¿™äº›è¯·æ±‚å¤´çš„å†…å®¹ã€‚")]),t._v(" "),s("p",[t._v("å¦‚æœæœåŠ¡å™¨åŒæ„åˆ‡æ¢ä¸º WebSocket åè®®ï¼Œåˆ™å“åº”å¤´å†…å®¹ä¸ºï¼ˆå“åº”ç ä¸º  "),s("code",[t._v("101")]),t._v(" ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: hsBlbuDTkk24srzEOTBUlZAlC2g=\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("blockquote",[s("p",[t._v("åŒæ—¶ï¼Œè¿™é‡Œçš„  "),s("code",[t._v("Sec-WebSocket-Accept")]),t._v("  æ˜¯  "),s("code",[t._v("Sec-WebSocket-Key")]),t._v(" ï¼Œ"),s("strong",[t._v("æµè§ˆå™¨ä½¿ç”¨å®ƒä¿è¯å“åº”ä¸è¯·æ±‚ç›¸å¯¹åº”")]),t._v("ã€‚")])]),t._v(" "),s("p",[t._v("ç„¶åå°±å¯ä»¥ä½¿ç”¨ WebSocket åè®®ä¼ è¾“æ•°æ®ã€‚å¹¶ä¸”ä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œå®ƒçš„ç»“æ„ä¸æ˜¯ HTTPã€‚")]),t._v(" "),s("p",[t._v("WebSocket æ‹“å±•å’Œå­åè®®ï¼š")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("ç‚¹å‡»æŸ¥çœ‹")]),t._v(" "),s("p",[t._v("WebSocket çš„å…¶ä»– headerï¼š "),s("code",[t._v("Sec-WebSocket-Extensions")]),t._v("  å’Œ  "),s("code",[t._v("Sec-WebSocket-Protocol")]),t._v(" ï¼Œå®ƒä»¬æè¿°äº†æ‰©å±•å’Œå­åè®®ã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("Sec-WebSocket-Extensions: deflate-frame")]),t._v("  ï¼šè¡¨ç¤ºæµè§ˆå™¨ "),s("strong",[t._v("æ”¯æŒæ•°æ®å‹ç¼©")]),t._v("ã€‚è¿™ä¸ªæ‹“å±•ä¸æ•°æ®ä¼ è¾“æœ‰å…³ï¼Œæ‹“å±•äº† WebSocket çš„åè®®çš„åŠŸèƒ½ã€‚")]),t._v(" "),s("p",[s("code",[t._v("Sec-WebSocket-Extensions")]),t._v("  header ç”±æµè§ˆå™¨è‡ªåŠ¨å‘é€ï¼Œå…¶ä¸­åŒ…å«å…¶æ”¯æŒçš„æ‰€æœ‰æ‰©å±•çš„åˆ—è¡¨ã€‚")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Sec-WebSocket-Protocol: soap, wamp")]),t._v(" ï¼šè¡¨ç¤ºä¸ä»…è¦ä¼ è¾“æ•°æ®ï¼Œè¿˜è¦ä¼ è¾“ SOAP / WAMP åè®®ä¸­çš„æ•°æ®ã€‚")]),t._v(" "),s("p",[t._v("è¿™ä¸ªå¯é€‰çš„ header æ˜¯ä½¿ç”¨  "),s("code",[t._v("new WebSocket")]),t._v("  çš„ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®çš„ã€‚å®ƒæ˜¯å­åè®®æ•°ç»„ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæƒ³ä½¿ç”¨ SOAP æˆ– WAMPï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" socket "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wss://javascript.info/chat"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"soap"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wamp"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])]),t._v(" "),s("p",[s("strong",[t._v("æœåŠ¡å™¨åº”è¯¥ä½¿ç”¨åŒæ„ä½¿ç”¨çš„åè®®å’Œæ‰©å±•çš„åˆ—è¡¨è¿›è¡Œå“åº”")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("ä¾‹å¦‚ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("è¯·æ±‚å¤´ headerï¼š")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("GET /chat\nHost: javascript.info\nUpgrade: websocket\nConnection: Upgrade\nOrigin: https://javascript.info\nSec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==\nSec-WebSocket-Version: 13\nSec-WebSocket-Extensions: deflate-frame\nSec-WebSocket-Protocol: soap, wamp\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("å“åº”å¤´ headerï¼š")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: hsBlbuDTkk24srzEOTBUlZAlC2g=\nSec-WebSocket-Extensions: deflate-frame\nSec-WebSocket-Protocol: soap\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])])])]),t._v(" "),s("h3",{attrs:{id:"æ•°æ®ä¼ è¾“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®ä¼ è¾“"}},[t._v("#")]),t._v(" æ•°æ®ä¼ è¾“")]),t._v(" "),s("p",[t._v("WebSocket é€šä¿¡ç”±  "),s("code",[t._v("frames")]),t._v(" ï¼ˆå³æ•°æ®ç‰‡æ®µï¼‰ç»„æˆï¼Œå¯ä»¥ä»ä»»ä½•ä¸€æ–¹å‘é€ï¼Œå¹¶ä¸”æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("text frames")]),t._v(" ï¼š"),s("strong",[t._v("æ–‡æœ¬æ•°æ®")]),t._v("ã€‚")]),t._v(" "),s("li",[s("code",[t._v("binary data frames")]),t._v(" ï¼š"),s("strong",[t._v("äºŒè¿›åˆ¶æ•°æ®")]),t._v("ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ping/pong frames")]),t._v(" ï¼šç”¨äºæ£€æŸ¥æœåŠ¡å™¨å‘é€çš„é“¾æ¥ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨å“åº”å®ƒä»¬ã€‚")]),t._v(" "),s("li",[s("code",[t._v("conection close frames")]),t._v("  â€¦")])]),t._v(" "),s("p",[t._v("åœ¨æµè§ˆå™¨é‡Œï¼Œ"),s("strong",[t._v("ä»…ä»…ä½¿ç”¨ æ–‡æœ¬æ•°æ®æˆ–è€…äºŒè¿›åˆ¶æ•°æ®")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("ä½¿ç”¨ WebSocket çš„  "),s("code",[t._v(".send")]),t._v("  æ–¹æ³•å‘é€æ–‡æœ¬æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("socket.send(body)")]),t._v("  è°ƒç”¨å…è®¸  "),s("code",[t._v("body")]),t._v("  æ˜¯å­—ç¬¦ä¸²æˆ–äºŒè¿›åˆ¶æ ¼å¼ï¼ŒåŒ…æ‹¬  "),s("code",[t._v("Blob")]),t._v(" ï¼Œ "),s("code",[t._v("ArrayBuffer")]),t._v("  ç­‰ã€‚ä¸éœ€è¦é¢å¤–çš„è®¾ç½®ï¼šç›´æ¥å‘é€å®ƒä»¬å°±å¯ä»¥äº†ã€‚")])]),t._v(" "),s("p",[t._v("å½“æ¥æ”¶åˆ°æ•°æ®ï¼Œæ–‡æœ¬æ€»æ˜¯ä»¥ "),s("strong",[t._v("å­—ç¬¦ä¸²")]),t._v(" å½¢å¼å‘ˆç°ã€‚å¯¹äºäºŒè¿›åˆ¶æ•°æ®ï¼Œåœ¨  "),s("code",[t._v("Blob")]),t._v("  å’Œ  "),s("code",[t._v("ArrayBuffer")]),t._v("  æ ¼å¼ä¹‹é—´é€‰æ‹©ã€‚ï¼ˆç”±  "),s("code",[t._v("socket.binaryType")]),t._v("  å±æ€§è®¾ç½®çš„ï¼Œé»˜è®¤ä¸º  "),s("code",[t._v('"blob"')]),t._v(" ï¼Œå› æ­¤äºŒè¿›åˆ¶æ•°æ®é€šå¸¸ä»¥  "),s("code",[t._v("Blob")]),t._v("  å¯¹è±¡å‘ˆç°ã€‚ï¼‰")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("Blob")]),t._v("  é«˜çº§äºŒè¿›åˆ¶å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä¸  "),s("code",[t._v("<a>")]),t._v(" ï¼Œ "),s("code",[t._v("<img>")]),t._v("  åŠå…¶ä»–æ ‡ç­¾é›†æˆåœ¨ä¸€èµ·ã€‚æ‰€ä»¥ä¸ºé»˜è®¤çš„æ ¼å¼ã€‚")]),t._v(" "),s("p",[t._v("è¦è®¿é—®å•ä¸ªæ•°æ®å­—èŠ‚ï¼Œå¯ä»¥ä¿®æ”¹ä¸º  "),s("code",[t._v("arrayBuffer")]),t._v(" ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("binaryType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"arraybuffer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// event.data å¯ä»¥æ˜¯æ–‡æœ¬ï¼ˆå¦‚æœæ˜¯æ–‡æœ¬ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ arraybufferï¼ˆå¦‚æœæ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼‰")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])]),t._v(" "),s("h3",{attrs:{id:"é™é€Ÿ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é™é€Ÿ"}},[t._v("#")]),t._v(" é™é€Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("å¦‚æœåº”ç”¨ç¨‹åºæ­£åœ¨ç”Ÿæˆå¤§é‡çš„æ•°æ®ï¼Œä½†æ˜¯ç”¨æˆ·çš„ç½‘é€Ÿå¾ˆæ…¢ã€‚")]),t._v(" "),s("p",[t._v("æ­¤æ—¶ï¼Œå¯ä»¥åå¤è°ƒç”¨  "),s("code",[t._v("socket.send(data)")]),t._v(" ã€‚ä½†æ˜¯æ•°æ®å°†ä¼šè¢«ç¼“å­˜ï¼ˆç¼“å†²å­˜å‚¨ï¼‰åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”åªèƒ½åœ¨ç½‘é€Ÿå…è®¸çš„æƒ…å†µä¸‹å°½å¿«å°†æ•°æ®å‘é€å‡ºå»ã€‚")])]),t._v(" "),s("p",[s("code",[t._v("socket.bufferedAmount")]),t._v("  å±æ€§å‚¨å­˜äº† "),s("strong",[t._v("ç›®å‰å·²ç¼“å†²çš„å­—èŠ‚æ•°")]),t._v("ï¼Œç­‰å¾…é€šè¿‡ç½‘ç»œå‘é€ã€‚")]),t._v(" "),s("p",[t._v("ğŸŒ° ä¾‹å­ / ä½¿ç”¨è¯¥å±æ€§æŸ¥çœ‹  "),s("code",[t._v("socket")]),t._v("  æ˜¯å¦çœŸçš„å¯ä»¥ç”¨äºä¼ è¾“ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bufferedAmount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("moreData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("blockquote",[s("p",[t._v("æ¯ 100 ms æ£€æŸ¥ä¸€æ¬¡  "),s("code",[t._v("socket")]),t._v(" ã€‚ä»…å½“æ‰€æœ‰ç°æœ‰çš„æ•°æ®éƒ½"),s("strong",[t._v("å·²è¢«å‘é€å‡ºå»æ—¶")]),t._v("ï¼ˆå³ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼‰ï¼Œå†å‘é€æ›´å¤šæ•°æ®ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"å…³é—­è¿æ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…³é—­è¿æ¥"}},[t._v("#")]),t._v(" å…³é—­è¿æ¥")]),t._v(" "),s("p",[t._v("é€šå¸¸ï¼Œå½“ä¸€æ–¹æƒ³è¦å…³é—­è¿æ¥æ—¶ï¼ˆæµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½å…·æœ‰ç›¸åŒçš„æƒé™ï¼‰ï¼Œå®ƒä»¬ä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰ "),s("strong",[t._v("æ•°å­—ç ")]),t._v(" å’Œæ–‡æœ¬å½¢å¼çš„åŸå› çš„  "),s("code",[t._v("connection close frame")]),t._v("  ã€‚")]),t._v(" "),s("p",[t._v("å…³é—­è¿æ¥çš„æ–¹æ³•ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("reason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[s("code",[t._v("[code]")]),t._v(" ï¼š"),s("strong",[t._v("å¯é€‰çš„")]),t._v(" ç‰¹æ®Šçš„ WebSocket å…³é—­ç ã€‚")]),t._v(" "),s("li",[s("code",[t._v("[reason]")]),t._v(" ï¼š"),s("strong",[t._v("å¯é€‰çš„")]),t._v(" æè¿°å…³é—­åŸå› çš„å­—ç¬¦ä¸²ã€‚")])]),t._v(" "),s("p",[t._v("å½“å¦ä¸€æ–¹é€šè¿‡  "),s("code",[t._v("close")]),t._v("  äº‹ä»¶å¤„ç†å™¨è·å–äº† å…³é—­ç å’Œå…³é—­åŸå›  æ—¶ã€‚ä¾‹å¦‚ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å…³é—­æ–¹ï¼š")]),t._v("\nsocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Work complete"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦ä¸€æ–¹")]),t._v("\nsocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// event.code === 1000")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// event.reason === "Work complete"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// event.wasClean === true (clean close)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("blockquote",[s("p",[t._v("å¯ä»¥é€šè¿‡  "),s("code",[t._v("event")]),t._v("  è·å–è¿™äº›å±æ€§ã€‚")])]),t._v(" "),s("p",[t._v("é€šå¸¸çš„ WebSocket å…³é—­ç ï¼š")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("ç‚¹å‡»æŸ¥çœ‹")]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("code",[t._v("1000")]),t._v("  ï¼šé»˜è®¤ï¼Œ"),s("strong",[t._v("æ­£å¸¸å…³é—­")]),t._v("ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡æ˜  "),s("code",[t._v("code")]),t._v("  æ—¶ä½¿ç”¨å®ƒï¼‰ï¼Œ")]),t._v(" "),s("li",[s("code",[t._v("1006")]),t._v("  ï¼šæ²¡æœ‰åŠæ³•æ‰‹åŠ¨è®¾å®šè¿™ä¸ªæ•°å­—ç ï¼Œè¡¨ç¤ºè¿æ¥ä¸¢å¤±ï¼ˆæ²¡æœ‰ close frameï¼‰ã€‚")])]),t._v(" "),s("p",[t._v("å…¶ä»–æ•°å­—ç ï¼Œä¾‹å¦‚ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("1001")]),t._v(" ï¼šä¸€æ–¹æ­£åœ¨ç¦»å¼€ï¼Œä¾‹å¦‚æœåŠ¡å™¨æ­£åœ¨å…³é—­ï¼Œæˆ–è€…æµè§ˆå™¨ç¦»å¼€äº†è¯¥é¡µé¢ï¼Œ")]),t._v(" "),s("li",[s("code",[t._v("1009")]),t._v("  ï¼šæ¶ˆæ¯å¤ªå¤§ï¼Œæ— æ³•å¤„ç†ï¼Œ")]),t._v(" "),s("li",[s("code",[t._v("1011")]),t._v("  ï¼š æœåŠ¡å™¨ä¸Šå‘ç”Ÿæ„å¤–é”™è¯¯ï¼Œ")]),t._v(" "),s("li",[t._v("â€¦â€¦ã€‚")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://tools.ietf.org/html/rfc6455#section-7.4.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC6455, Â§7.4.1"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("æ³¨æ„ï¼Œå°äº  "),s("code",[t._v("1000")]),t._v("  çš„ç éƒ½æ˜¯è¢«ä¿ç•™çš„ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•è®¾ç½®è¿™æ ·çš„ç ï¼Œå°†ä¼šå‡ºç°é”™è¯¯ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"è¿æ¥çŠ¶æ€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥çŠ¶æ€"}},[t._v("#")]),t._v(" è¿æ¥çŠ¶æ€")]),t._v(" "),s("p",[t._v("è¦è·å–è¿æ¥çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡å¸¦æœ‰å€¼çš„  "),s("code",[t._v("socket.readyState")]),t._v("  å±æ€§ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("0")])]),t._v(" â€”â€” â€œCONNECTINGâ€ï¼šè¿æ¥è¿˜æœªå»ºç«‹ï¼Œ")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("1")])]),t._v(" â€”â€” â€œOPENâ€ï¼šé€šä¿¡ä¸­ï¼Œ")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("2")])]),t._v(" â€”â€” â€œCLOSINGâ€ï¼šè¿æ¥å…³é—­ä¸­ï¼Œ")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("3")])]),t._v(" â€”â€” â€œCLOSEDâ€ï¼šè¿æ¥å·²å…³é—­ã€‚")])]),t._v(" "),s("h2",{attrs:{id:"server-sent-events"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server-sent-events"}},[t._v("#")]),t._v(" Server Sent Events")]),t._v(" "),s("p",[t._v("Server-Sent Event è§„èŒƒæè¿°äº†ä¸€ä¸ªå†…å»ºçš„ç±»  "),s("code",[t._v("EventSource")]),t._v(" ã€‚èƒ½ä¿æŒæœåŠ¡å™¨çš„è¿æ¥ï¼Œå¹¶ä¸”å…è®¸ä»ä¸­æ¥æ”¶äº‹ä»¶ã€‚ï¼ˆä¸ WebSocket è¿æ¥ç±»ä¼¼ï¼Œæ˜¯æŒä¹…çš„è¿æ¥ï¼‰")]),t._v(" "),s("blockquote",[s("p",[t._v("WebSocket ä¸ EventSource çš„åŒºåˆ«ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("code",[t._v("WebSocket")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("code",[t._v("EventSource")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("åŒå‘ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½äº¤æ¢æ¶ˆæ¯")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("å•å‘")]),t._v("ï¼šä»…æœåŠ¡ç«¯èƒ½å‘é€æ¶ˆæ¯")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("äºŒè¿›åˆ¶å’Œæ–‡æœ¬æ•°æ®")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("ä»…æ–‡æœ¬æ•°æ®")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("WebSocket åè®®")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("å¸¸è§„ HTTP åè®®")])])])])]),t._v(" "),s("p",[t._v("ç›¸æ¯” WebSocketï¼Œ EventSource æ›´åŠ ç®€å•ã€‚")]),t._v(" "),s("p",[t._v("å½“éœ€è¦ä»æœåŠ¡å™¨æ¥æ”¶ä¸€ä¸ªæ•°æ®æµï¼Œå¯èƒ½æ˜¯ èŠå¤©æ¶ˆæ¯æˆ–è€…å…¶ä»–ä¿¡æ¯ã€‚ "),s("code",[t._v("EventSource")]),t._v("  æ”¯æŒè‡ªåŠ¨é‡æ–°è¿æ¥ï¼Œè€Œåœ¨  "),s("code",[t._v("WebSocket")]),t._v("  éœ€è¦æ‰‹åŠ¨å®ç°ã€‚å¹¶ä¸”å®ƒæ”¯æŒå¸¸è§„çš„ HTTP åè®®ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"è·å–æ¶ˆæ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–æ¶ˆæ¯"}},[t._v("#")]),t._v(" è·å–æ¶ˆæ¯")]),t._v(" "),s("p",[t._v("ä½¿ç”¨  "),s("code",[t._v("new EventSource(url)")]),t._v(" ã€‚æµè§ˆå™¨å°†ä¼šè¿æ¥åˆ°  "),s("code",[t._v("url")]),t._v("  å¹¶ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç­‰å¾…äº‹ä»¶ã€‚")]),t._v(" "),s("p",[t._v("æœåŠ¡å™¨å“åº”çš„çŠ¶æ€ç åº”è¯¥ä¸º 200ï¼Œheader ä¸º  "),s("code",[t._v("Content-Type: text/event-stream")]),t._v(" ï¼Œç„¶åä¿æŒæ­¤è¿æ¥å¹¶ä»¥ä¸€ç§ç‰¹æ®Šçš„æ ¼å¼å†™å…¥æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼š")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("data: Message 1\n\ndata: Message 2\n\ndata: Message 3\ndata: of two lines\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("ul",[s("li",[s("code",[t._v("data")]),t._v(" ï¼šæ¶ˆæ¯æ–‡æœ¬ï¼Œ "),s("code",[t._v(":")]),t._v("  åçš„ç©ºæ ¼å¯é€‰ï¼›")]),t._v(" "),s("li",[t._v("æ¶ˆæ¯ä»¥ä¸¤ä¸ªæ¢è¡Œç¬¦  "),s("code",[t._v("\\n\\n")]),t._v("  åˆ†éš”ã€‚")]),t._v(" "),s("li",[t._v("è¦å‘é€ä¸€ä¸ªæ¢è¡Œç¬¦  "),s("code",[t._v("\\n")]),t._v("  çš„æ¶ˆæ¯ï¼Œåœ¨è¦æ¢è¡Œçš„ä½ç½®ç«‹å³å†å‘é€ä¸€ä¸ª  "),s("code",[t._v("data:")]),t._v(" ï¼ˆä¸Šé¢çš„ç¬¬ä¸‰æ¡æ¶ˆæ¯ï¼‰ã€‚")])]),t._v(" "),s("p",[t._v("å®é™…è¿ç”¨ä¸­ï¼Œå¤æ‚çš„æ¶ˆæ¯ä¸€èˆ¬ä½¿ç”¨ JSON ç¼–ç åå‘é€ã€‚æ¢è¡Œç¬¦åœ¨å…¶ä¸­ç¼–ç ä¸º  "),s("code",[t._v("\\n")]),t._v(" ï¼Œå› æ­¤ä¸éœ€è¦å¤šè¡Œ  "),s("code",[t._v("data:")]),t._v("  æ¶ˆæ¯ã€‚")]),t._v(" "),s("p",[t._v("ğŸŒ° ä¾‹å­ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"user"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"John"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"First line\\n Second line"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("å¯¹äºè¿™æ ·ç±»å‹çš„ä¿¡æ¯ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ª  "),s("code",[t._v("message")]),t._v("  äº‹ä»¶ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" eventSource "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventSource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/events/subsribe"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\neventSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"new Message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹äºä¸Šé¢çš„æ•°æ®æµå°†æ‰“å°ä¸‰æ¬¡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æˆ– eventSource.addEventListener('message', ...)")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("h3",{attrs:{id:"è·¨æºè¯·æ±‚"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·¨æºè¯·æ±‚"}},[t._v("#")]),t._v(" è·¨æºè¯·æ±‚")]),t._v(" "),s("p",[s("code",[t._v("EventSource")]),t._v("  æ”¯æŒè·¨æºè¯·æ±‚ï¼Œå°±åƒ  "),s("code",[t._v("fetch")]),t._v("  å’Œä»»ä½•å…¶ä»–ç½‘ç»œæ–¹æ³•ã€‚")]),t._v(" "),s("p",[t._v("æ‰€ä»¥ EventSource å¯ä»¥ä½¿ç”¨ä»»ä½• URLï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" source "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventSource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://another-site.com/events"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("è¿œç¨‹æœåŠ¡å™¨å°†ä¼šè·å–åˆ°  "),s("code",[t._v("Origin")]),t._v("  headerï¼Œå¹¶ä¸”å¿…é¡»ä»¥  "),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("  å“åº”æ¥å¤„ç†ã€‚è¦ä¼ é€’å‡­è¯ï¼ˆcredentialsï¼‰ï¼Œåº”è¯¥è®¾ç½®é™„åŠ é€‰é¡¹  "),s("code",[t._v("withCredentials")]),t._v(" ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" source "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventSource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://another-site.com/events"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("withCredentials")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h3",{attrs:{id:"é‡æ–°è¿æ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é‡æ–°è¿æ¥"}},[t._v("#")]),t._v(" é‡æ–°è¿æ¥")]),t._v(" "),s("p",[s("code",[t._v("new EventSource")]),t._v("  è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¦‚æœè¿æ¥æ–­å¼€ï¼Œåˆ™é‡æ–°è¿æ¥ã€‚æ¯æ¬¡é‡æ–°è¿æ¥ä¹‹é—´æœ‰ä¸€ç‚¹å°çš„å»¶è¿Ÿï¼Œé»˜è®¤ä¸ºå‡ ç§’é’Ÿã€‚")]),t._v(" "),s("p",[t._v("æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨  "),s("code",[t._v("retry:")]),t._v("  æ¥ "),s("strong",[t._v("è®¾ç½®éœ€è¦çš„å»¶è¿Ÿå“åº”æ—¶é—´")]),t._v("ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("retry: 15000\ndata: Hello, I set the reconnection delay to 15 seconds\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("ul",[s("li",[s("code",[t._v("retry:")]),t._v("  æ—¢å¯ä»¥ä¸æŸäº›æ•°æ®ä¸€èµ·å‡ºç°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºç‹¬ç«‹çš„æ¶ˆæ¯å‡ºç°ã€‚")])]),t._v(" "),s("p",[t._v("åœ¨é‡æ–°è¿æ¥ä¹‹å‰ï¼Œæµè§ˆå™¨éœ€è¦ç­‰å¾…è®¾å®šçš„å»¶è¿Ÿå“åº”æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæµè§ˆå™¨çŸ¥é“ï¼ˆä»æ“ä½œç³»ç»Ÿï¼‰"),s("strong",[t._v("æ­¤æ—¶æ²¡æœ‰ç½‘ç»œè¿æ¥")]),t._v("ï¼Œå®ƒä¼šç­‰åˆ°è¿æ¥å‡ºç°ï¼Œç„¶åé‡è¯•ã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å¦‚æœæœåŠ¡å™¨æƒ³è¦æµè§ˆå™¨ "),s("strong",[t._v("åœæ­¢é‡æ–°è¿æ¥")]),t._v("ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ HTTP çŠ¶æ€ç  204 è¿›è¡Œå“åº”ï¼›")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœæµè§ˆå™¨æƒ³è¦ "),s("strong",[t._v("å…³é—­è¿æ¥")]),t._v("ï¼Œåˆ™åº”è¯¥è°ƒç”¨  "),s("code",[t._v("eventSource.close()")]),t._v(" ï¼›")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" eventSource "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventSource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\neventSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœå“åº”å…·æœ‰ä¸æ­£ç¡®çš„  "),s("code",[t._v("Content-Type")]),t._v("  æˆ–è€… HTTP çŠ¶æ€ç ä¸æ˜¯ 301ï¼Œ307ï¼Œ200 å’Œ 204ï¼Œåˆ™ä¸ä¼šè¿›è¡Œé‡æ–°è¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä¼šå‘å‡º  "),s("code",[t._v("error")]),t._v("  é”™è¯¯äº‹ä»¶ï¼Œå¹¶ä¸”æµè§ˆå™¨ä¸ä¼šé‡æ–°è¿æ¥ã€‚")])])]),t._v(" "),s("blockquote",[s("p",[t._v("å½“è¿æ¥è¢«å…³é—­æ—¶ï¼Œåˆ™æ— æ³•ã€Œé‡æ–°æ‰“å¼€ã€è¯¥è¿æ¥ã€‚å¦‚æœè¦é‡æ–°è¿æ¥ï¼Œå°±è¦é‡æ–°åˆ›å»º  "),s("code",[t._v("new EventSource()")]),t._v(" ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"è¿æ¥-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥-id"}},[t._v("#")]),t._v(" è¿æ¥ id")]),t._v(" "),s("p",[t._v("å½“ä¸€ä¸ªè¿æ¥ç”±äºç½‘ç»œé—®é¢˜è€Œä¸­æ–­æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ— æ³•ç¡®å®šå“ªäº›æ¶ˆæ¯å·²ç»æ”¶åˆ°å“ªäº›æ²¡æœ‰æ”¶åˆ°ã€‚ä¸ºäº†æ­£ç¡®åœ°æ¢å¤è¿æ¥ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½åº”è¯¥æœ‰ä¸€ä¸ª  "),s("code",[t._v("id")]),t._v("  å­—æ®µï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("data: Message 1\nid: 1\n\ndata: Message 2\nid: 2\n\ndata: Message 3\ndata: of two lines\nid: 3\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("å½“æ”¶åˆ°å…·æœ‰  "),s("code",[t._v("id")]),t._v("  çš„æ¶ˆæ¯æ—¶ï¼Œæµè§ˆå™¨ä¼šï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å°†å±æ€§  "),s("code",[t._v("eventSource.lastEventId")]),t._v(" "),s("strong",[t._v("è®¾ç½®ä¸ºå…¶å€¼")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("é‡æ–°è¿æ¥åï¼Œå‘é€å¸¦æœ‰  "),s("code",[t._v("id")]),t._v("  çš„ header  "),s("code",[t._v("Last-Event-ID")]),t._v(" ï¼Œä»¥ä¾¿æœåŠ¡å™¨å¯ä»¥é‡æ–°å‘é€åé¢çš„æ¶ˆæ¯ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("æ³¨æ„ï¼š "),s("code",[t._v("id")]),t._v("  è¢«æœåŠ¡å™¨é™„åŠ åˆ°  "),s("code",[t._v("data")]),t._v("  æ¶ˆæ¯åï¼Œä»¥ç¡®ä¿åœ¨æ”¶åˆ°æ¶ˆæ¯å  "),s("code",[t._v("lastEventId")]),t._v("  ä¼šè¢«æ›´æ–°ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"è¿æ¥çŠ¶æ€-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥çŠ¶æ€-2"}},[t._v("#")]),t._v(" è¿æ¥çŠ¶æ€")]),t._v(" "),s("p",[s("code",[t._v("EventSource")]),t._v("  å¯¹è±¡æœ‰  "),s("code",[t._v("readyState")]),t._v("  è¿æ¥çŠ¶æ€å±æ€§ï¼Œè¯¥å±æ€§å…·æœ‰ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("EventSource.CONNECTING = 0;")]),t._v("  ï¼šè¿æ¥ä¸­æˆ–è€…é‡æ–°è¿æ¥ä¸­ï¼›")]),t._v(" "),s("li",[s("code",[t._v("EventSource.OPEN = 1;")]),t._v(" ï¼šå·²è¿æ¥ï¼›")]),t._v(" "),s("li",[s("code",[t._v("EventSource.CLOSED = 2;")]),t._v("  ï¼šè¿æ¥å·²å…³é—­ï¼›")])]),t._v(" "),s("p",[t._v("å¯¹è±¡åˆ›å»ºå®Œæˆæˆ–è€…è¿æ¥æ–­å¼€åï¼Œå®ƒå§‹ç»ˆæ˜¯  "),s("code",[t._v("EventSource.CONNECTING")]),t._v(" ï¼ˆç­‰äº  "),s("code",[t._v("0")]),t._v(" ï¼‰ã€‚")]),t._v(" "),s("p",[t._v("å¯ä»¥é€šè¿‡"),s("strong",[t._v("æŸ¥è¯¢è¯¥å±æ€§")]),t._v("è·å¾—  "),s("code",[t._v("EventSource")]),t._v("  çš„çŠ¶æ€ã€‚")]),t._v(" "),s("h3",{attrs:{id:"è¿æ¥äº‹ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥äº‹ä»¶"}},[t._v("#")]),t._v(" è¿æ¥äº‹ä»¶")]),t._v(" "),s("p",[s("code",[t._v("EventSource")]),t._v("  çš„å¯¹è±¡ä¼šé»˜è®¤ç”Ÿæˆä¸‰ä¸ªäº‹ä»¶ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("message")]),t._v("  ï¼š"),s("strong",[t._v("æ”¶åˆ°æ¶ˆæ¯")]),t._v("ï¼Œå¯ä»¥ç”¨  "),s("code",[t._v("event.data")]),t._v("  è®¿é—®ã€‚")]),t._v(" "),s("li",[s("code",[t._v("open")]),t._v("  ï¼š"),s("strong",[t._v("è¿æ¥å·²æ‰“å¼€")]),t._v("ã€‚")]),t._v(" "),s("li",[s("code",[t._v("error")]),t._v("  ï¼š"),s("strong",[t._v("æ— æ³•å»ºç«‹è¿æ¥")]),t._v("ï¼Œä¾‹å¦‚ï¼ŒæœåŠ¡å™¨è¿”å› HTTP 500 çŠ¶æ€ç ã€‚")])]),t._v(" "),s("p",[t._v("æœåŠ¡å™¨å¯ä»¥åœ¨äº‹ä»¶å¼€å§‹æ—¶ä½¿ç”¨  "),s("code",[t._v("event: ...")]),t._v("  æŒ‡å®šå¦ä¸€ç§ç±»å‹äº‹ä»¶ã€‚")]),t._v(" "),s("p",[t._v("ğŸŒ° ä¾‹å­ï¼š")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("event: join\ndata: Bob\n\ndata: Hello\n\nevent: leave\ndata: Bob\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("å¤„ç†è‡ªå®šä¹‰äº‹ä»¶  "),s("code",[t._v("join")]),t._v(" ï¼Œå¿…é¡»ä½¿ç”¨  "),s("code",[t._v("addEventListener")]),t._v(" ï¼š")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("eventSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'join'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Joined ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\neventSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Said: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\neventSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'leave'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Left ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[139],{465:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[t._v("#")]),t._v(" Cookie")]),t._v(" "),s("p",[t._v("Cookie 是一串 "),s("strong",[t._v("直接存储在浏览器的数据")]),t._v("；是 HTTP 协议的一部分；")]),t._v(" "),s("ul",[s("li",[t._v("通常由 Web 服务器使用响应  "),s("code",[t._v("Set-Cookie")]),t._v("  HTTP header 设置。")]),t._v(" "),s("li",[t._v("浏览器使用  "),s("code",[t._v("Cookie")]),t._v("  HTTP header 自动添加到（几乎） "),s("strong",[t._v("每个对相同域")]),t._v(" 的请求中。")])]),t._v(" "),s("blockquote",[s("p",[t._v("🌰 例子 / 登录身份验证：")]),t._v(" "),s("ul",[s("li",[t._v("登录成功后，服务器在响应中使用  "),s("code",[t._v("Set-Cookie")]),t._v("  HTTP-header 来设置具有唯一的会话标识符的 cookie。")]),t._v(" "),s("li",[t._v("下次当请求被发送到同一个域时，浏览器会使用  "),s("code",[t._v("Cookie")]),t._v("  HTTP-header 通过网络发送 cookie。")]),t._v(" "),s("li",[t._v("服务器通过这个 cookie 识别身份的请求。")])])]),t._v(" "),s("h3",{attrs:{id:"读取-cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读取-cookie"}},[t._v("#")]),t._v(" 读取 cookie")]),t._v(" "),s("p",[t._v("使用  "),s("code",[t._v("document.cookie")]),t._v("  读取网站存储的 cookie。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("cument.cookie")]),t._v("  的值由  "),s("code",[t._v("name=value")]),t._v("  对组成，以  "),s("code",[t._v(";")]),t._v("  分隔。")]),t._v(" "),s("li",[t._v("每一个都是"),s("strong",[t._v("独立的")]),t._v(" cookie。")])]),t._v(" "),s("h3",{attrs:{id:"写入-cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#写入-cookie"}},[t._v("#")]),t._v(" 写入 cookie")]),t._v(" "),s("blockquote",[s("p",[t._v("使用 JavaScript 写入 cookie 使用  "),s("code",[t._v("document.cookie")]),t._v(" （"),s("strong",[t._v("不是数据属性")]),t._v("），这个访问器 （包含  "),s("code",[t._v("getter")]),t._v("  /  "),s("code",[t._v("setter")]),t._v("  ），对其赋值操作会被特殊处理。")])]),t._v(" "),s("p",[t._v("对  "),s("code",[t._v("document.cookie")]),t._v("  的写入操作"),s("strong",[t._v("只会更新其中提到的 cookie")]),t._v("，"),s("strong",[t._v("而不会涉及其他 cookie")]),t._v("。")]),t._v(" "),s("p",[t._v("🌰 例子：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user=john"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只更新名称为 user 的 cookie")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 展示所有的 cookie")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("cookie 的名称和值 "),s("strong",[t._v("可以是任何字符")]),t._v("。为了保持有效的格式，它们应该使用内建的  "),s("code",[t._v("encodeURIComponent")]),t._v("  函数对其进行转义（与 URL 对象添加参数同理）：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 特殊字符（空格），需要编码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"John Smith"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将 cookie 编码为 my%20name=John%20Smith")]),t._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'='")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("blockquote",[s("p",[t._v("cookie 存储限制：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("encodeURIComponent")]),t._v("  编码后的  "),s("code",[t._v("name=value")]),t._v("  对，大小不能超过 4KB。")]),t._v(" "),s("li",[t._v("每个域的 cookie 总数不得超过 20+ 左右，"),s("strong",[t._v("具体限制取决于浏览器")]),t._v("。")])])]),t._v(" "),s("p",[s("strong",[t._v("Cookie 中的要设置的选项参数：")])]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user=John; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("path")]),t._v("  ：  "),s("code",[t._v("url")]),t._v(" "),s("strong",[t._v("路径前缀")]),t._v("。必须是绝对路径，使得该路径下的页面运行访问该 cookie。默认为当前路径。通常设置为  "),s("code",[t._v("path=/")]),t._v("  ，即使 cookie 对该网站的所有页面可见。")]),t._v(" "),s("p",[t._v("例子，一个 cookie 带有  "),s("code",[t._v("path=/admin")]),t._v("  设置，那么该 cookie 在  "),s("code",[t._v("/admin")]),t._v("  和  "),s("code",[t._v("/admin/something")]),t._v("  下都是可见的，但是在  "),s("code",[t._v("/home")]),t._v("  或  "),s("code",[t._v("/adminpage")]),t._v("  下不可见。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("domain")]),t._v(" ：控制可以访问 cookie 的域。在实际中，有一些安全限制无法设置的域，例如，无法从另一个二级域访问 cookie（ "),s("code",[t._v("other.com")]),t._v("  永远不会收到在  "),s("code",[t._v("site.com")]),t._v("  设置的 cookie），这使得 cookie 的敏感数据只能存储在一个站点上可用的 cookie 中。")]),t._v(" "),s("p",[t._v("** 默认情况下，cookie 只有在设置的域下才能被访问到。 ** 注意，默认情况下，cookie 不会共享给 "),s("strong",[t._v("子域")]),t._v("（例如，  "),s("code",[t._v("forum.site.com")]),t._v("  是  "),s("code",[t._v("site.com")]),t._v("  的子域）。")]),t._v(" "),s("p",[t._v("可以通过设置  "),s("code",[t._v("domain")]),t._v("  允许子域设置 cookie：当在  "),s("code",[t._v("site.com")]),t._v("  设置 cookie 时，应该明确地将  "),s("code",[t._v("domain")]),t._v("  选项设置为根域： "),s("code",[t._v("domain=site.com")]),t._v(" 。那么，所有子域都可以访问到这样的 cookie。")]),t._v(" "),s("p",[t._v("🌰 例子：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user=John; domain=site.com"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("在子域  "),s("code",[t._v("forum.site.com")]),t._v("  中，可以访问该 cookie：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 有 cookie user=John")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("expires")]),t._v("  /  "),s("code",[t._v("max-age")]),t._v("  ：控制 cookie 的过期事件。默认情况下， 不设置这两个参数的 cookie 在关闭浏览器后消失，即为 session cookie。可以通过设置这两个参数保持 cookie 在浏览器关闭后仍然存在。")]),t._v(" "),s("p",[s("code",[t._v("expire")]),t._v("  ：设置浏览器会清除掉该 cookie 的时间日期。")]),t._v(" "),s("p",[t._v("🌰 例子：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("expires=Tue, 19 Jan 2038 03:14:07 GMT\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("日期格式必须为 GMT 时区格式。可以通过  "),s("code",[t._v("date.toUTCString（）")]),t._v("   方法转换。")]),t._v(" "),s("p",[t._v("🌰 例子 / 将 cookie 设置为 "),s("strong",[t._v("一天后到期")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" date "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("86400e3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUTCString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user=john; expires="')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("如果将  "),s("code",[t._v("expires")]),t._v("  设置为过去的日期，那么 cookie 会被直接删除。")])]),t._v(" "),s("p",[s("code",[t._v("max-age")]),t._v("  ：是  "),s("code",[t._v("expires")]),t._v("  的替代选项，指明 cookie 的过期时间距离当前时间的秒数。（设置在设定的秒数之后过期）。")]),t._v(" "),s("p",[t._v("🌰 例子 / 将 cookie 设置为 1 个小时后失效：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user=John; max-age=3600"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("🌰 例子 / 设置为 0 或者负数，cookie 立即过期：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user=John; max-age=0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("secure")]),t._v("  ：设置 cookie 的安全协议。")]),t._v(" "),s("blockquote",[s("p",[t._v("默认情况下，如果在  "),s("code",[t._v("http://site.com")]),t._v("  上设置了 cookie，那么该 cookie 也会出现在  "),s("code",[t._v("https://site.com")]),t._v("  上，反之亦然。即此时的 cookie "),s("strong",[t._v("不区分 HTTP 协议")]),t._v("。")]),t._v(" "),s("p",[t._v("如果一个 cookie 是通过  "),s("code",[t._v("https://site.com")]),t._v("  设置的，那么它不会在相同域的 HTTP 环境下出现，例如  "),s("code",[t._v("http://site.com")]),t._v(" 。所以，如果一个 cookie 包含绝不应该通过未加密的 HTTP 协议发送的敏感内容，那么就应该设置  "),s("code",[t._v("secure")]),t._v("  标识。")])]),t._v(" "),s("p",[t._v("🌰 例子 / 设置为只能在当前协议下可访问的 cookie（如当前在 HTTPS 环境下）：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user=John; secure"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("samesite")]),t._v(" ：cookie 的另一个安全特性，可以防止 XSRF （跨网站请求伪造） 攻击。")]),t._v(" "),s("blockquote",[s("p",[t._v("XSRF 攻击的例子：当用户登录了  "),s("code",[t._v("bank.com")]),t._v(" ，有了当前网站的 cookie。浏览器会在每次请求时将其发送到  "),s("code",[t._v("bank.com")]),t._v("  的服务器，以便识别身份执行敏感的操作。")]),t._v(" "),s("p",[t._v("此时，在浏览器的另一个窗口访问另一个网站，该网站具有发送  "),s("code",[t._v("bank.com/pay")]),t._v("  请求的表单。当每次访问  "),s("code",[t._v("bank.com")]),t._v("  网站时，浏览器都会发送 cookie ，即使请求是从不同的网站发送的。")]),t._v(" "),s("p",[t._v("实际的网站不会允许这样的情况发生，所有由  "),s("code",[t._v("bank.com")]),t._v("  生成的表单都具有一个特殊的字段，（XSRF 保护 token）。恶意页面既不能生成，也不能从远程页面提取它。它可以在那里提交表单，但是无法获取数据。并且，网站  "),s("code",[t._v("bank.com")]),t._v("  会对收到的每个表单都进行这种 token 的检查。（一种防止 XSRF 的方式）")])]),t._v(" "),s("p",[t._v("上面的方法，需要检查每个表单请求的 token 字段。使用 cookie 的  "),s("code",[t._v("samesite")]),t._v("  选项：")]),t._v(" "),s("p",[s("code",[t._v("samesite=strict")]),t._v(" ：默认情况（没有值时）：除了来自同一个网站的请求，设置了  "),s("code",[t._v("samesite=strict")]),t._v("  的 cookie 在其他网站域永远不会被发送。")]),t._v(" "),s("blockquote",[s("p",[t._v("设置为  "),s("code",[t._v("strict")]),t._v("  后， XSRF 攻击是没有机会成功的，因为来自  "),s("code",[t._v("evil.com")]),t._v("  的提交没有 cookie。因此， "),s("code",[t._v("bank.com")]),t._v("  将无法识别用户，也就不会继续进行付款。")]),t._v(" "),s("p",[t._v("但是  "),s("code",[t._v("strict")]),t._v("  有不方便的地方：当从其他地方访问  "),s("code",[t._v("bank.com")]),t._v("  连接时，同样也不能发送  "),s("code",[t._v("samesite=strict")]),t._v("  的 cookie。可以通过设置两种不同的 cookie 解决 ：一种用于「一般识别」；另一种用于进行敏感数据信息操作时的识别（设为  "),s("code",[t._v("strict")]),t._v("  的 cookie）。这样用户从别处访问网站时同样可以识别身份；并且进行敏感操作时必须从同一个网站启动才能进行。")])]),t._v(" "),s("p",[s("code",[t._v("samesite=lax")]),t._v(" ：比  "),s("code",[t._v("strict")]),t._v("  轻松的 cookie 限制。 同样可以防止 XSRF 攻击，但是不会破坏用户的体验。")]),t._v(" "),s("p",[t._v("与  "),s("code",[t._v("strict")]),t._v("  相似，从外部来到网站的，禁止浏览器发送 cookie，但是有例外的情况（符合以下两个条件）：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("HTTP 方法为安全方法；（安全的 HTTP 方法一般用于读取数据，不会更改数据，例如 GET）")])]),t._v(" "),s("li",[s("p",[t._v("该操作执行顶级导航（会更改浏览器地址栏中的 URL 的操作）")]),t._v(" "),s("blockquote",[s("p",[t._v("通常成立。如果在  "),s("code",[t._v("<iframe>")]),t._v("  中执行就不是顶级；用于网络请求的 JavaScript 方法不会执行任何导航。")])])])]),t._v(" "),s("p",[s("code",[t._v("samesite=lax")]),t._v("  所做的是基本上"),s("strong",[t._v("允许最常见的前往 URL 操作携带 cookie。")]),t._v("（例如，从笔记中打开网站），但是来自另一个网站的网络请求 / 表单提交都不会携带 cookie。")])]),t._v(" "),s("li",[s("p",[t._v("httpOnly：Web 服务器使用  "),s("code",[t._v("Set-Cookie")]),t._v("  header 来设置 cookie。并且，它可以设置  "),s("code",[t._v("httpOnly")]),t._v("  选项。"),s("strong",[t._v("这个选项禁止任何 JavaScript 访问 cookie")]),t._v("，即使用  "),s("code",[t._v("document.cookie")]),t._v("  看不到此类 cookie，也无法对此类 cookie 进行操作。")])])]),t._v(" "),s("h3",{attrs:{id:"cookie-操作函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie-操作函数"}},[t._v("#")]),t._v(" cookie 操作函数")]),t._v(" "),s("p",[t._v("编写常见的 cookie 操作函数，相对于使用  "),s("code",[t._v("document.cookie")]),t._v("  更加方便（可以使用相似第三方库引入使用）：")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("getCookie(name)")]),t._v(" ：返回具有给定的  "),s("code",[t._v("name")]),t._v("  的 cookie。如果没有找到则返回  "),s("code",[t._v("undefined")]),t._v(" 。")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" matches "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(?:^|; )"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\\\$1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"=([^;]*)"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" matches "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeURIComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("matches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("setCookie(name, value, options)")]),t._v(" ：将 cookie 的  "),s("code",[t._v("name")]),t._v("  设置为具有默认值  "),s("code",[t._v("path=/")]),t._v(" （可以修改以添加其他默认值）和给定值  "),s("code",[t._v("value")]),t._v(" 。")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果需要，可以在这里添加其他默认值")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("options\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expires "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expires "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expires"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUTCString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" updatedCookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"="')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" optionKey "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    updatedCookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"; "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" optionKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" optionValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("optionKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("optionValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      updatedCookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"="')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" optionValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" updatedCookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用范例：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'John'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("secure")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'max-age'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("deleteCookie(name)")]),t._v("  ：删除 cookie。")]),t._v(" "),s("p",[t._v("通过设置过期时间  "),s("code",[t._v("max-age")]),t._v("   为 0 或者负数实现：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'max-age'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])])])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("当进行更新或删除一个 cookie 操作时，"),s("strong",[t._v("应该使用和设置 cookie 时相同的路径和域选项。")])])]),t._v(" "),s("h3",{attrs:{id:"第三方-cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三方-cookie"}},[t._v("#")]),t._v(" 第三方 cookie")]),t._v(" "),s("p",[t._v("常见的第三方 cookie 用与跟踪和广告服务。它们被绑定在原始域上，因此  "),s("code",[t._v("ads.com")]),t._v("  可以在不同网站之间跟踪同一用户，如果这些网站都可以访问  "),s("code",[t._v("ads.com")]),t._v("  的话。")]),t._v(" "),s("blockquote",[s("p",[t._v("例如：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("site.com")]),t._v("  网站的一个页面加载了另外一个网站的 banner： "),s("code",[t._v('<img src="https://ads.com/banner.png">')]),t._v(" 。")]),t._v(" "),s("li",[t._v("与 banner 一起， "),s("code",[t._v("ads.com")]),t._v("  的远程服务器可能会设置带有  "),s("code",[t._v("id=1234")]),t._v("  这样的 cookie 的  "),s("code",[t._v("Set-Cookie")]),t._v("  header。此类 cookie 源自  "),s("code",[t._v("ads.com")]),t._v("  域，并且仅在  "),s("code",[t._v("ads.com")]),t._v("  中可见。")]),t._v(" "),s("li",[t._v("下次访问  "),s("code",[t._v("ads.com")]),t._v("  网站时，远程服务器获取 cookie  "),s("code",[t._v("id")]),t._v("  并识别用户。")]),t._v(" "),s("li",[t._v("用户从  "),s("code",[t._v("site.com")]),t._v("  网站跳转至另一个也带有 banner 的网站  "),s("code",[t._v("other.com")]),t._v("  时， "),s("code",[t._v("ads.com")]),t._v("  会获得该 cookie，因为它属于  "),s("code",[t._v("ads.com")]),t._v(" ，从而识别用户并在他在网站之间切换时对其进行跟踪。")])])]),t._v(" "),s("blockquote",[s("p",[t._v("现代浏览器可能会禁用此类的 cookie：")]),t._v(" "),s("ul",[s("li",[t._v("Safari 浏览器完全不允许第三方 cookie。")]),t._v(" "),s("li",[t._v("Firefox 浏览器附带了一个第三方域的黑名单，它阻止了来自名单内的域的第三方 cookie。")])])]),t._v(" "),s("blockquote",[s("p",[t._v("对于加载来自第三方域的脚本中使用  "),s("code",[t._v("document.cookie")]),t._v("  设置 cookie，无论脚本来自何处，设置的 cookie 都属于当前网页的域而不是第三方 cookie。")])]),t._v(" "),s("h2",{attrs:{id:"localstorage-sessionstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#localstorage-sessionstorage"}},[t._v("#")]),t._v(" LocalStorage / SessionStorage")]),t._v(" "),s("p",[t._v("通过 Web 存储对象  "),s("code",[t._v("localStorage")]),t._v("  和  "),s("code",[t._v("sessionStorage")]),t._v("   在浏览器中保存 键 / 值对数据。在页面刷新（ "),s("code",[t._v("sessionStorage")]),t._v(" ） 或者浏览器重启之后（ "),s("code",[t._v("localStorage")]),t._v(" ）数据仍然可以保留在浏览器中。")]),t._v(" "),s("blockquote",[s("p",[t._v("相对于 cookie，Web 存储对象：")]),t._v(" "),s("ul",[s("li",[t._v("Web 存储对象不会随每个请求被发送到服务器。所以可以存储更多的数据，并且浏览器允许保存至少 2 MB 的数据（或者更多），并且具有配置数据的设置；")]),t._v(" "),s("li",[t._v("服务器无法通过 HTTP header 操作存储对象，一切通过 JavaScript 完成进行。")]),t._v(" "),s("li",[t._v("存储绑定到源（域 / 协议 / 端口三者）。也就是说，"),s("strong",[t._v("不同协议或子域对应不同的存储对象")]),t._v("，它们之间无法访问彼此数据。")])])]),t._v(" "),s("ul",[s("li",[t._v("键值  "),s("code",[t._v("key")]),t._v("  /  "),s("code",[t._v("value")]),t._v("  必须为字符串；")]),t._v(" "),s("li",[t._v("存储大小限制为 5 MB+。取决于浏览器；")]),t._v(" "),s("li",[t._v("没有过期时间（LocalStorage）")])]),t._v(" "),s("p",[s("strong",[t._v("两种存储对象提供相同的方法和属性")]),t._v("：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("setItem(key, value)")]),t._v("  ：存储键 / 值对。")]),t._v(" "),s("li",[s("code",[t._v("getItem(key)")]),t._v("  ：按照键获取值。")]),t._v(" "),s("li",[s("code",[t._v("removeItem(key)")]),t._v("  ：删除键及其对应的值。")]),t._v(" "),s("li",[s("code",[t._v("clear()")]),t._v("  ：删除所有数据。")]),t._v(" "),s("li",[s("code",[t._v("key(index)")]),t._v(" ： 获取该索引下的 "),s("strong",[t._v("键名")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("length")]),t._v("  ：存储的内容的长度。")])]),t._v(" "),s("h3",{attrs:{id:"localstorage-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#localstorage-的使用"}},[t._v("#")]),t._v(" "),s("code",[t._v("localStorage")]),t._v("  的使用")]),t._v(" "),s("p",[t._v("一般"),s("strong",[t._v("在所有同源的窗口之间")]),t._v("， "),s("code",[t._v("localStorage")]),t._v("  数据可以共享。")]),t._v(" "),s("p",[t._v("🌰 例子 / 使用  "),s("code",[t._v("localStorage")]),t._v("  ：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("存储数据：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("读取数据：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("在重新打开浏览器的同一个页面（不同窗口）也可以获取该数据；在同一个源（域 / 端口 / 协议），URL 路径可以不同，都可以共享该数据。")])]),t._v(" "),s("p",[t._v("🌰 例子 / 类对象形式的访问：")]),t._v(" "),s("p",[t._v("与使用一个普通对象一样使用 LocalStorage：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置 key")]),t._v("\nlocalStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取 key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除 key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("但一般不建议这样使用：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("键值对由用户生成，可以为任何的内容。如果设置与内置对象属性相同的键（如  "),s("code",[t._v("length")]),t._v("  /  "),s("code",[t._v("toString")]),t._v(" ），使用这种方式会出错，而使用  "),s("code",[t._v("setItem")]),t._v("  /  "),s("code",[t._v("getItem")]),t._v("  可以正常工作：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'length'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlocalStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Error，无法对 length 进行赋值")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("存在  "),s("code",[t._v("storage")]),t._v("  事件，使用 类对象的形式修改数据不会触发； "),s("code",[t._v("setItem")]),t._v("  正常修改数据会触发。")])])]),t._v(" "),s("p",[t._v("🌰 例子 / 遍历键：")]),t._v(" "),s("p",[s("strong",[t._v("由于存储对象是不可迭代的")]),t._v("。要获取所有的键（或者值）：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("使用遍历数组的方法：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(": ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("使用  "),s("code",[t._v("for... in")]),t._v("  循环方法：")]),t._v(" "),s("blockquote",[s("p",[t._v("注意这种方法会像处理常规对象一样；遍历所有的键，同时也会输出一些不需要的内建字段。")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显示 getItem，setItem 和其他内建的东西")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("需要使用  "),s("code",[t._v("hasOwnProperty")]),t._v("  检查过滤掉原型中的字段：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 跳过像 "setItem"，"getItem" 等这样的键')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(": ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("或者使用  "),s("code",[t._v("Object.keys")]),t._v("  获取只属于自己的键，需要的遍历出来：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" keys "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" keys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(": ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])])]),t._v(" "),s("p",[s("strong",[t._v("注意，存储的对象的 键 / 值必须为 字符串。")]),t._v(" 如果为其他类型（数值、对象），会被自动转换为字符串。")]),t._v(" "),s("p",[t._v("可以使用  "),s("code",[t._v("JSON.stringfy()")]),t._v("  存储对象：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"John"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("读取的数据使用  "),s("code",[t._v("JSON.parse()")]),t._v("  转换：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("或者对整个存储对象进行字符化处理：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringfy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"sessionstorage-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sessionstorage-的使用"}},[t._v("#")]),t._v(" "),s("code",[t._v("sessionStorage")]),t._v("  的使用")]),t._v(" "),s("p",[t._v("与  "),s("code",[t._v("localStorage")]),t._v("  的使用基本类似，使用频率较低。使用  "),s("code",[t._v("sessionStorage")]),t._v("  有以下的限制：")]),t._v(" "),s("ul",[s("li",[t._v("存储的数据只能保存在当前的会话（浏览器的标签页）：\n"),s("ul",[s("li",[t._v("意味着相同的页面不同的窗口会有不同的存储；")]),t._v(" "),s("li",[t._v("但是在同一个页面下的  "),s("code",[t._v("iframe")]),t._v("  下的存储是相同的。")])])]),t._v(" "),s("li",[t._v("存储的数据在刷新后能保留，但是关闭或者重启浏览器不会保留。")])]),t._v(" "),s("h3",{attrs:{id:"storage-事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#storage-事件"}},[t._v("#")]),t._v(" "),s("code",[t._v("storage")]),t._v("  事件")]),t._v(" "),s("p",[t._v("当  "),s("code",[t._v("localStorage")]),t._v("  或  "),s("code",[t._v("sessionStorage")]),t._v("  中的数据更新后， "),s("code",[t._v("storage")]),t._v("  事件就会被触发，它会有以下的属性：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("key")]),t._v(" ：发生数据更改的键  "),s("code",[t._v("key")]),t._v(" ；（如果调用的是  "),s("code",[t._v("clear")]),t._v("  ， "),s("code",[t._v("key")]),t._v("  为  "),s("code",[t._v("null")]),t._v(" ）")]),t._v(" "),s("li",[s("code",[t._v("oldValue")]),t._v(" ：旧值；（新增数值为  "),s("code",[t._v("null")]),t._v(" ）")]),t._v(" "),s("li",[s("code",[t._v("newValue")]),t._v(" ：新值；（删除数值为  "),s("code",[t._v("null")]),t._v(" ）")]),t._v(" "),s("li",[s("code",[t._v("url")]),t._v(" ："),s("strong",[t._v("发生数据更改的文档的")]),t._v(" "),s("code",[t._v("url")]),t._v("  ；")]),t._v(" "),s("li",[s("code",[t._v("storageData")]),t._v(" ：发生数据更改的（ "),s("code",[t._v("localStorage")]),t._v("  /  "),s("code",[t._v("sessionStorage")]),t._v(" ）对象；")]),t._v(" "),s("li",[s("code",[t._v("storageArea")]),t._v(" ：包含存储对象（ "),s("code",[t._v("sessionStorage")]),t._v("  和  "),s("code",[t._v("localStorage")]),t._v("  ）具有相同的事件，所以  "),s("code",[t._v("event.storageArea")]),t._v("  引用了"),s("strong",[t._v("被修改的对象")]),t._v("。 允许同源的不同窗口交换信息。")])]),t._v(" "),s("p",[t._v("并且，  "),s("code",[t._v("storage")]),t._v("  事件会在 "),s("strong",[t._v("所有可以访问到存储对象的  "),s("code",[t._v("window")]),t._v("  对象")]),t._v(" 上触发，导致当前数据发生改变的  "),s("code",[t._v("window")]),t._v("  对象除外。")]),t._v(" "),s("p",[t._v("🌰 例子 / 当有两个窗口具有相同的页面， "),s("code",[t._v("localStorage")]),t._v("  在它们之间共享数据。如果两个窗口都监听  "),s("code",[t._v("window.onstorage")]),t._v("  事件，那么每个窗口都会对另一个窗口中发生的更新作出反应。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在其他文档对同一存储进行更新时会触发：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onstorage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'now'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("newValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" at "')]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或者使用 window.addEventListener('storage', event => {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// })")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("会捕捉到关于  "),s("code",[t._v("key")]),t._v("  为  "),s("code",[t._v("now")]),t._v("  的数据的更新：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'now'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])]),t._v(" "),s("h2",{attrs:{id:"indexeddb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb"}},[t._v("#")]),t._v(" IndexedDB")]),t._v(" "),s("p",[t._v("是一个浏览器内建的数据库，比  "),s("code",[t._v("localStorage")]),t._v("  强大得多。")]),t._v(" "),s("ul",[s("li",[t._v("支持多种类型的键，可以存储几乎任何类型的值；")]),t._v(" "),s("li",[t._v("支持事务可靠性；")]),t._v(" "),s("li",[t._v("支持键值的范围查询、索引；")]),t._v(" "),s("li",[t._v("相比于  "),s("code",[t._v("localStorage")]),t._v("  可以存储更大的数据；")])]),t._v(" "),s("blockquote",[s("p",[t._v("IndexedDB 适用于 离线应用，可与 ServiceWorkers 和其他技术相结合使用。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);